"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[25192],{46778:(e,t,i)=>{i.d(t,{showPasteLineToolHint:()=>c});var r=i(87236),n=i(62802),s=i(38456),o=i(70316),l=i(11688);const a=(0,r.t)("Next time you can use {shortcut} for quick paste");function c(e,t){l.enabled("popup_hints")&&!s.CheckMobile.any()&&Promise.all([i.e(25113),i.e(11935),i.e(87995),i.e(26166)]).then(i.bind(i,10837)).then(i=>{const r=new i.ChartEventHintRenderer(e),s=a.format({shortcut:(0,o.humanReadableHash)(o.Modifiers.Mod+86)});let l=null;r.show(s,()=>{null!==l&&(clearTimeout(l),l=null,n.setValue(t,!0,{forceFlush:!0}))}),l=setTimeout(()=>{l=null,r.hide()},5e3)})}},90901:(e,t,i)=>{i.d(t,{solutionIds:()=>r});const r=JSON.parse('{"EXTENDED_HOURS":43000502023,"PRE_MARKET":43000502023,"POST_MARKET":43000502023,"SPREAD_CHARTS":43000502298,"ALERTS":43000520149,"ALERT_ON_STRATEGY":43000481368,"ALERT_WEBHOOK":43000529348,"ALERT_DESCRIPTION_PLACEHOLDER":43000531021,"VOLUME_PROFILE":43000502040,"VOLUME_PROFILE_INDICATOR":43000557450,"RENKO":43000502284,"KAGI":43000502272,"LINE_BREAK":43000502273,"PNF":43000502276,"FINANCIAL_DATA":43000543506,"BROKER_RATING":43000542490,"CRYPTO_MARKET_CAP":43000540941,"CRYPTO_PAYMENT":43000485536,"ALERT_ON_SPREAD":43000478406,"ALERT_ON_CUSTOM_SCRIPT":43000478415,"ALERT_FUNCTION":43000597494,"SMS_VERIFICATION":43000553429,"MAGNET_MODE":43000537270,"PINE_CANNOT_DETERMINE":43000587849,"PRIVACY_SETTINGS":43000548335,"PUBLICATION_TYPE":43000609497,"SCRIPT_ACCESS":43000482573,"MEMORY_LIMITS_EXCEEDED":43000590233,"FREE_USER_FAQS":43000590947,"STRATEGY_UNREALISTIC_RESULTS":43000481029,"STRATEGY_FUTURE_DATA":43000614705,"STREAM_RULES":43000591348,"HOW_TO_USE_PAPER":43000516466,"HOW_TO_USE_CQG":43000516372,"HOW_TO_USE_OANDA":43000516375,"HOW_TO_USE_FOREXCOM":43000516374,"FAVORITE_IDEA":43000555216,"YOUTUBE_ERROR":43000612153,"AUTHORS_INSTRUCTIONS_PUBCLICATION":43000549951,"AUTHORS_INSTRUCTIONS_EDIT":43000614618,"SCRIPT_INSTRUCTIONS":43000482573,"BAR_REPLAY_UNAVAILABILITY":43000475470,"WHAT_IS_CBOE_BZX_EXCHANGE":43000473924,"GOPRO_UPGRADE_DESCRIPTION":43000473324,"GOPRO_DOWNGRADE_DESCRIPTION":43000485437,"BROKERAGE_REVIEWS":43000591351,"CHANGE_SUBSCRIPTION":43000635806,"PINE_LIBRARY_INFO":43000638371,"HOW_TO_CREATE_A_STREAM":43000560174,"HOW_DO_I_UPDATE_DESKTOP_APP":43000647779,"TECHNICAL_RATINGS":43000614331,"BACKTESTING_WIDGET":43000561856,"DEEP_HISTORY_WIDGET":43000666265}')},77884:(e,t,i)=>{function r(e,t){return e<t}function n(e,t,i,r,n){let s=n-r;for(;0<s;){const n=s>>1,o=r+n;i(e(o),t)?(r=o+1,s-=n+1):s=n}return r}function s(e,t,i,r=0,s=e.length){return n(t=>e[t],t,i,r,s)}function o(e,t,i=0,n=e.length){return s(e,t,r,i,n)}function l(e,t,i,r=0,n=e.length){let s=n-r;for(;0<s;){const n=s>>1,o=r+n;i(t,e[o])?s=n:(r=o+1,s-=n+1)}return r}function a(e,t){return e.filter(e=>!t.includes(e))}function c(e,t){const i=e.indexOf(t);return i<0?e.slice():[t].concat(e.slice(0,i)).concat(e.slice(i+1))}function h(e,t,i){const r=new Set(t),n=[],s=[],l=[];return e.forEach((e,t)=>{r.has(e)?s.push(e):(n.push(e),l.push(t))}),
i=i<e.length-1?o(l,i+1):n.length,n.splice(i,0,...s),{newItems:n,movedItemsStartIndex:i}}function u(e,t,i){const r=new Set(t),n=[],s=[],l=[];return e.forEach((e,t)=>{r.has(e)?s.push(e):(n.push(e),l.push(t))}),i=i<=e.length-1?o(l,i):n.length,n.splice(i,0,...s),{newItems:n,movedItemsStartIndex:i}}function d(e,t){const i=new Set;return e.forEach(e=>{t.has(e)&&i.add(e)}),i}i.d(t,{lowerboundExt:()=>n,lowerbound:()=>s,upperbound:()=>l,subtract:()=>a,moveToHead:()=>c,moveAfter:()=>h,moveBefore:()=>u,intersect:()=>d})},45185:(e,t,i)=>{i.r(t),i.d(t,{LINESTYLE_SOLID:()=>r,LINESTYLE_DOTTED:()=>n,LINESTYLE_DASHED:()=>s,LINESTYLE_LARGE_DASHED:()=>o,LINESTYLE_SPARSE_DOTTED:()=>l,LINESTYLE_SMALL_DASHED:()=>a});const r=0,n=1,s=2,o=3,l=4,a=5},72461:(e,t,i)=>{var r=i(66915),n=r.greaterThan,s=r.lessThan,o=window.CanvasEx=i(45185);o.computeDashPattern=function(e){return[[e.lineWidth,2*e.lineWidth],[5*e.lineWidth,6*e.lineWidth],[6*e.lineWidth,6*e.lineWidth],[e.lineWidth,4*e.lineWidth],[2*e.lineWidth,e.lineWidth]][e.lineStyle-1]},o.drawLine=function(e,t,i,r,n){isFinite(t)&&isFinite(r)&&isFinite(i)&&isFinite(n)&&(e.lineStyle!==o.LINESTYLE_SOLID?o.drawDashedLine(e,t,i,r,n):o.drawSolidLine(e,t,i,r,n))},o.drawArrow=function(e,t,i,r,n,s){if(isFinite(t)&&isFinite(r)&&isFinite(i)&&isFinite(n)){var o=Math.round(s/2),l=t+o,a=r+o;e.beginPath(),e.moveTo(a,n),e.lineTo(l,i),e.moveTo(t,i+o),e.lineTo(l,i),e.lineTo(t+s,i+o),e.stroke()}},o.drawSolidLine=function(e,t,i,r,n){e.beginPath(),e.moveTo(t,i),e.lineTo(r,n),e.stroke()},o.setLineStyle=function(e,t){e.lineStyle=t;var i=[];t!==o.LINESTYLE_SOLID&&(i=o.computeDashPattern(e)),o.setLineDash(e,i)},o.setLineDash=function(e,t){"function"==typeof e.setLineDash?e.setLineDash(t):void 0!==e.mozDash?e.mozDash=t:void 0!==e.webkitLineDash&&(e.webkitLineDash=t)},o.drawPoly=function(e,t,i){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var r=0;r<t.length;r++){var n=t[r];e.lineTo(n.x,n.y)}e.closePath(),e.stroke(),i&&e.fill()},o.drawDashedLine=function(e,t,i,r,n){e.save();var s=o.computeDashPattern(e);if(e.beginPath(),"function"==typeof e.setLineDash)e.setLineDash(s);else if(void 0!==e.mozDash)e.mozDash=s;else{if(void 0===e.webkitLineDash)return o.dashedLineTo(e,t,i,r,n,s),e.stroke(),void e.restore();e.webkitLineDash=s}e.moveTo(t,i),e.lineTo(r,n),e.stroke(),e.restore()},o.drawDashedLineHorizontal=function(e,t,i,r){e.save();var n=o.computeDashPattern(e),s=0,l=e.lineWidth,a=l/2;e.translate(-a,-a);for(var c=!0,h=t+r;t<h;){var u=n[s];c&&e.fillRect(t,i,u,l),c=!c,t+=u,s=s===n.length-1?0:s+1}e.restore()},o.drawDashedLineVertical=function(e,t,i,r){e.save();var n=o.computeDashPattern(e),s=0,l=e.lineWidth,a=l/2;e.translate(-a,-a);for(var c=!0,h=i+r;i<h;){var u=n[s];c&&e.fillRect(t,i,l,u),c=!c,i+=u,s=s===n.length-1?0:s+1}e.restore()},o.dashedLineTo=function(e,t,i,r,o,l){var a={thereYet:n,cap:Math.min},c={thereYet:n,cap:Math.min};i-o>0&&(c.thereYet=s,c.cap=Math.max),t-r>0&&(a.thereYet=s,a.cap=Math.max),e.moveTo(t,i);for(var h=t,u=i,d=0,p=!0;!a.thereYet(h,r)||!c.thereYet(u,o);){var _=Math.atan2(o-i,r-t),P=l[d];h=a.cap(r,h+Math.cos(_)*P),
u=c.cap(o,u+Math.sin(_)*P),p?e.lineTo(h,u):e.moveTo(h,u),d=(d+1)%l.length,p=!p}},o.setFont=function(e,t){if(e.font!==t)try{e.font=t}catch(e){}},"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.setFont=function(e){o.setFont(this,e)},CanvasRenderingContext2D.prototype.lineStyle=o.LINESTYLE_SOLID),e.exports=o},77036:(e,t,i)=>{i.d(t,{TranslatedString:()=>r});class r{constructor(e,t){this._originalText=e,this._translatedText=t}originalText(){return this._originalText}translatedText(){return this._translatedText}format(e){const t={},i={};for(const n of Object.keys(e)){const s=e[n];s instanceof r?(t[n]=s.originalText(),i[n]=s.translatedText()):(t[n]=s.toString(),i[n]=s.toString())}const n=this._originalText.format(t),s=this._translatedText.format(i);return new r(n,s)}}},63585:(e,t,i)=>{var r;i.d(t,{ACTION_ID:()=>r}),function(e){e.TVActionId="TVActionId",e.ChartApplyIndicatorsToAllCharts="Chart.ApplyIndicatorsToAllCharts",e.ChartChangeTimeZone="Chart.ChangeTimeZone",e.ChartDialogsShowChangeInterval="Chart.Dialogs.ShowChangeInterval",e.ChartDialogsShowChangeSymbol="Chart.Dialogs.ShowChangeSymbol",e.ChartDialogsShowCompareOrAddSymbol="Chart.Dialogs.ShowCompareOrAddSymbol",e.ChartDialogsShowGeneralSettings="Chart.Dialogs.ShowGeneralSettings",e.ChartDialogsShowGeneralSettingsScalesTab="Chart.Dialogs.ShowGeneralSettings.ScalesTab",e.ChartDialogsShowGeneralSettingsSymbolTab="Chart.Dialogs.ShowGeneralSettings.SymbolTab",e.ChartDialogsShowGoToDate="Chart.Dialogs.ShowGoToDate",e.ChartDialogsShowInsertIndicators="Chart.Dialogs.ShowInsertIndicators",e.ChartDialogsShowSymbolInfo="Chart.Dialogs.ShowSymbolInfo",e.ChartDrawingToolbarToggleVisibility="Chart.DrawingToolbar.ToggleVisibility",e.ChartLinesToggleBidAskLinesVisibility="Chart.Lines.ToggleBidAskLinesVisibility",e.ChartLinesToggleHighLowLinesVisibility="Chart.Lines.ToggleHighLowLinesVisibility",e.ChartLinesToggleSeriesPrevCloseLineVisibility="Chart.Lines.ToggleSeriesPrevCloseLineVisibility",e.ChartLinesToggleSeriesPriceLineVisibility="Chart.Lines.ToggleSeriesPriceLineVisibility",e.ChartLineToolPitchforkChangeTypeToInside="Chart.LineTool.Pitchfork.ChangeTypeToInside",e.ChartLineToolPitchforkChangeTypeToModifiedSchiff="Chart.LineTool.Pitchfork.ChangeTypeToModifiedSchiff",e.ChartLineToolPitchforkChangeTypeToOriginal="Chart.LineTool.Pitchfork.ChangeTypeToOriginal",e.ChartLineToolPitchforkChangeTypeToSchiff="Chart.LineTool.Pitchfork.ChangeTypeToSchiff",e.ChartMarksToggleVisibility="Chart.Marks.ToggleVisibility",e.ChartMoveChartInLayout="Chart.MoveChartInLayout",e.ChartMoveChartInLayoutBack="Chart.MoveChartInLayout.Back",e.ChartMoveChartInLayoutForward="Chart.MoveChartInLayout.Forward",e.ChartObjectTreeShow="Chart.ObjectTree.Show",e.ChartPriceScaleLabelsToggleBidAskLabelsVisibility="Chart.PriceScale.Labels.ToggleBidAskLabelsVisibility",e.ChartPriceScaleLabelsToggleHighLowPriceLabelsVisibility="Chart.PriceScale.Labels.ToggleHighLowPriceLabelsVisibility",
e.ChartPriceScaleLabelsToggleIndicatorsNameLabelsVisibility="Chart.PriceScale.Labels.ToggleIndicatorsNameLabelsVisibility",e.ChartPriceScaleLabelsToggleIndicatorsValueLabelsVisibility="Chart.PriceScale.Labels.ToggleIndicatorsValueLabelsVisibility",e.ChartPriceScaleLabelsToggleSeriesLastValueVisibility="Chart.PriceScale.Labels.ToggleSeriesLastValueVisibility",e.ChartPriceScaleLabelsToggleSymbolNameLabelsVisibility="Chart.PriceScale.Labels.ToggleSymbolNameLabelsVisibility",e.ChartPriceScaleLabelsToggleSymbolPrevCloseValueVisibility="Chart.PriceScale.Labels.ToggleSymbolPrevCloseValueVisibility",e.ChartPriceScaleMergeAllScalesToLeft="Chart.PriceScale.MergeAllScalesToLeft",e.ChartPriceScaleMergeAllScalesToRight="Chart.PriceScale.MergeAllScalesToRight",e.ChartPriceScaleMoveToLeft="Chart.PriceScale.MoveToLeft",e.ChartPriceScaleMoveToRight="Chart.PriceScale.MoveToRight",e.ChartPriceScaleToggleAddOrderPlusButtonVisibility="Chart.PriceScale.ToggleAddOrderPlusButtonVisibility",e.ChartPriceScaleToggleAutoScaleSeriesOnly="Chart.PriceScale.ToggleAutoScaleSeriesOnly",e.ChartPriceScaleToggleCountdownToBarCloseVisibility="Chart.PriceScale.ToggleCountdownToBarCloseVisibility",e.ChartRedo="Chart.Redo",e.ChartRemoveAllIndicators="Chart.RemoveAllIndicators",e.ChartRemoveAllIndicatorsAndLineTools="Chart.RemoveAllIndicatorsAndLineTools",e.ChartRemoveAllLineTools="Chart.RemoveAllLineTools",e.ChartScalesReset="Chart.Scales.Reset",e.ChartScalesToggleLockPriceToBarRatio="Chart.Scales.ToggleLockPriceToBarRatio",e.ChartSelectedObjectHide="Chart.SelectedObject.Hide",e.ChartSelectedObjectRemove="Chart.SelectedObject.Remove",e.ChartSelectedObjectShowSettingsDialog="Chart.SelectedObject.ShowSettingsDialog",e.ChartSelectedObjectToggleLocked="Chart.SelectedObject.ToggleLocked",e.ChartSeriesPriceScaleToggleAutoScale="Chart.Series.PriceScale.ToggleAutoScale",e.ChartSeriesPriceScaleToggleIndexedTo100="Chart.Series.PriceScale.ToggleIndexedTo100",e.ChartSeriesPriceScaleToggleInvertPriceScale="Chart.Series.PriceScale.ToggleInvertPriceScale",e.ChartSeriesPriceScaleToggleLogarithmic="Chart.Series.PriceScale.ToggleLogarithmic",e.ChartSeriesPriceScaleTogglePercentage="Chart.Series.PriceScale.TogglePercentage",e.ChartSeriesPriceScaleToggleRegular="Chart.Series.PriceScale.ToggleRegular",e.ChartSessionBreaksToggleVisibility="Chart.SessionBreaks.ToggleVisibility",e.ChartTimeScaleReset="Chart.TimeScale.Reset",e.ChartUndo="Chart.Undo"}(r||(r={}))},29770:(e,t,i)=>{i.r(t),i.d(t,{Action:()=>a,ActionAsync:()=>c,Separator:()=>h,Loader:()=>u});var r=i(88537),n=i(97639),s=i.n(n),o=i(70316),l=i(95935);class a{constructor(e,t=l.guid()){this.type="action",this._destroyed=!1,this._binding=null,(0,r.assert)(void 0!==e.actionId,"actionId must be defined"),this.id=t,this._onUpdate=new(s()),this._options=e,this.update(e)}execute(){this._options.checkable&&this.update({checked:!this._options.checked}),this._options.onExecute&&this._options.onExecute(this)}getLabel(){return this._options.label||""}getSubItems(){return this._options.subItems||[]}isDisabled(){
return!0===this._options.disabled}isActive(){return!0===this._options.active}isCheckable(){return!0===this._options.checkable}isChecked(){return!0===this._options.checked}isLoading(){return!0===this._options.loading}getSize(){var e;return null!==(e=this._options.size)&&void 0!==e?e:"normal"}getPayload(){return this._options.payload}update(e){this._destroyed||(this._unbindShortcut(),e.hotkeyHash&&(this._options.shortcutHint=(0,o.humanReadableHash)(e.hotkeyHash)),this._options=Object.assign(this._options,e),this._bindShortcut(),this._onUpdate.fire(this))}onUpdate(){return this._onUpdate}getState(){return{actionId:this._options.actionId,label:this.getLabel(),disabled:this.isDisabled(),active:this.isActive(),subItems:this.getSubItems(),checkable:this.isCheckable(),checked:this.isChecked(),loading:this.isLoading(),size:this.getSize(),doNotCloseOnClick:this._options.doNotCloseOnClick||!1,shortcutHint:this._options.shortcutHint,hint:this._options.hint,icon:this._options.icon,iconChecked:this._options.iconChecked,toolbox:this._options.toolbox,showToolboxOnHover:this._options.showToolboxOnHover||!1,statName:this._options.statName,name:this._options.name,invisibleHotkey:this._options.invisibleHotkey,noInteractive:this._options.noInteractive}}getBinding(){return this._binding}setBinding(e){this._binding=e}destroy(){var e,t;this._destroyed=!0,this._onUpdate.destroy(),null!==this._binding&&this._binding.destroy(),this._unbindShortcut(),null===(t=(e=this._options).onDestroy)||void 0===t||t.call(e)}options(){return this._options}_bindShortcut(){if(!this._options.hotkeyGroup||!this._options.hotkeyHash)return;const e="string"==typeof this._options.label?this._options.label:this._options.name;this._hotkeyAction=this._options.hotkeyGroup.add({hotkey:this._options.hotkeyHash,desc:e,handler:()=>this.execute(),isDisabled:()=>this.isDisabled()})}_unbindShortcut(){this._hotkeyAction&&(this._hotkeyAction.destroy(),delete this._hotkeyAction)}}class c extends a{constructor(e,t,i){super({actionId:e},i),this._loader=t,this._loaded=!1}loadOptions(){return this._loadingPromise||(this._loadingPromise=this._loader().then(e=>{this._loaded=!0,this.update(e)})),this._loadingPromise}getState(){return this.loadOptions(),super.getState()}isLoading(){return!this.isLoaded()}isLoaded(){return this._loaded}}class h{constructor(e){this.type="separator",this.id=l.guid(),this._hint=e}getHint(){return this._hint}}class u extends a{constructor(e){super({actionId:e})}isLoading(){return!0}getSize(){return"big"}}},24112:(e,t,i)=>{i.d(t,{Size:()=>o,getCanvasDevicePixelRatio:()=>l,getContext2D:()=>a,getPrescaledContext2D:()=>c,getPretransformedContext2D:()=>h,fillRect:()=>u,clearRect:()=>d,drawScaled:()=>p,createDisconnectedCanvas:()=>_,createDisconnectedBoundCanvas:()=>P,createBoundCanvas:()=>v,calcTextHorizontalShift:()=>m,disableSelection:()=>f});var r=i(81746),n=i(88537),s=i(43498);class o{constructor(e,t){this.w=e,this.h=t}equals(e){return this.w===e.w&&this.h===e.h}}function l(e){var t,i
;return Math.max(1,(null===(i=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i?void 0:i.devicePixelRatio)||1)}function a(e){const t=(0,n.ensureNotNull)(e.getContext("2d"));return t.setTransform(1,0,0,1,0,0),t}function c(e){const t=(0,n.ensureNotNull)(e.getContext("2d")),i=l(e);return t.setTransform(i,0,0,i,0,0),t}function h(e,t){const i=(0,n.ensureNotNull)(e.canvas.getContext("2d"));return i.setTransform(e.pixelRatio,0,0,e.pixelRatio,0,0),t||i.translate(.5,.5),i}function u(e,t,i,r,n,s){e.save(),e.translate(-.5,-.5),e.fillStyle=s,e.fillRect(t,i,r,n),e.restore()}function d(e,t,i,r,n,s){e.save(),e.translate(-.5,-.5),e.globalCompositeOperation="copy",e.fillStyle=s,e.fillRect(t,i,r,n),e.restore()}function p(e,t,i){e.save(),e.scale(t,t),i(),e.restore()}function _(e,t,i){const r=g(e);return void 0===i&&(i=l(r)),r.width=t.w*i,r.height=t.h*i,r}function P(e,t){const i=g(e),n=(0,r.bindToDevicePixelRatio)(i,{allowDownsampling:!1});return n.resizeCanvas({width:t.w,height:t.h}),n}function g(e){const t=e.createElement("canvas");return f(t),t}function v(e,t){const i=g((0,n.ensureNotNull)(e.ownerDocument));e.appendChild(i);const s=(0,r.bindToDevicePixelRatio)(i,{allowDownsampling:!1});return s.resizeCanvas({width:t.w,height:t.h}),s}function m(e,t){return"center"===e.textAlign?0:(0,s.isRtl)()?"start"===e.textAlign||"right"===e.textAlign?t:0:"start"===e.textAlign||"left"===e.textAlign?0:t}function f(e){e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.msUserSelect="none",e.style.MozUserSelect="none",e.style.webkitTapHighlightColor="transparent"}},88427:(e,t,i)=>{i.r(t),i.d(t,{setChartFontFamily:()=>o,CHART_FONT_FAMILY:()=>l});var r=i(25226),n=i(14802);const s="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function o(e){l=e}let l=((0,n.isOnMobileAppPage)("old"),"'Trebuchet MS', Roboto, Ubuntu, sans-serif");if((0,r.isFeatureEnabled)("apply_new_fonts")){const e=["U+2E80-2FD5","U+3040-309F","U+1B100-1B12F","U+1AFF0-1AFFF","U+1B000-1B0FF","U+1B130-1B16F","U+3190-319F","U+30A0-30FF","U+31F0-31FF","U+3400-4DBF","U+4E00-9FFF","U+F900-FAFF","U+2F00-2FDF","U+2E80-2EFF","U+31C0-31EF","U+2FF0-2FFF","U+20000-2A6DF","U+2A700-2B738","U+2B740-2B81D","U+2B820-2CEA1","U+2CEB0-2EBE0","U+2F800-2FA1F","U+30000-3134A","U+0E00-0E7F","U+1100-11FF","U+A960-A97F","U+AC00-D7AF","U+D7B0-D7FF","U+3130-318F","U+FF00-FFEF"],t=l;(async()=>{if(!/iPhone OS 15_\d+?/.test(navigator.userAgent))return s;{const t=new FontFace("ChartIosFont","local(Helvetica), local(Arial)",{unicodeRange:e.join(", ")});try{return document.fonts.add(await t.load()),"ChartIosFont, "+s}catch(e){return l}}})().then(e=>{t===l&&o(e)})}},76553:(e,t,i)=>{i.d(t,{showCustomUrlEventDialog:()=>l});var r=i(87236),n=i(79923);const s=(0,r.t)("Ok"),o=(0,r.t)("Cancel");async function l(e){const{onConfirm:t,onClose:i,title:r,placeholderText:l}=e;return(0,n.showRename)({title:r,text:"",placeholder:l,mainButtonText:s,cancelButtonText:o,onRename:({newValue:e,dialogClose:i})=>{t(e),i()},onClose:i})}},63208:(e,t,i)=>{i.d(t,{
CHART_WIDGET_COLLECTION_SERVICE:()=>n,chartWidgetCollectionService:()=>s,CollectionViewMode:()=>o});var r=i(64894);const n={id:"ChartWidgetCollectionService"};function s(){return(0,r.hasService)(n)?(0,r.service)(n):null}var o;!function(e){e.Multichart="multichart",e.ForceFullscreen="force-fullscreen"}(o||(o={}))},88230:(e,t,i)=>{i.d(t,{InvalidationLevel:()=>r,InvalidationMask:()=>l,defaultInvalidationLevel:()=>o});var r,n=i(88537);class s{constructor(e=o){this._paneInvalidationLevel=o,this._leftPriceScalesInvalidationMap=new Map,this._rightPriceScalesInvalidationMap=new Map,this._invalidationLevel=e}fullInvalidation(){return this._invalidationLevel}invalidateAll(e){this._invalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePane(e){this._paneInvalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePriceScale(e,t,i){const r="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap,n=r.get(t)||o;r.set(t,Math.max(n,i))}invalidationLevelForPane(){return Math.max(this._paneInvalidationLevel,this._invalidationLevel)}getterForPriceScaleInvalidationLevelBySide(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;return e=>Math.max(t.get(e)||o,this._invalidationLevel)}priceScaleSideMaxLevel(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;let i=this._invalidationLevel;return t.size>0&&t.forEach(e=>{e>i&&(i=e)}),i}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._paneInvalidationLevel=Math.max(this._paneInvalidationLevel,e._paneInvalidationLevel),e._leftPriceScalesInvalidationMap.forEach((e,t)=>{const i=this._leftPriceScalesInvalidationMap.get(t)||o;this._leftPriceScalesInvalidationMap.set(t,Math.max(i,e))}),e._rightPriceScalesInvalidationMap.forEach((e,t)=>{const i=this._rightPriceScalesInvalidationMap.get(t)||o;this._rightPriceScalesInvalidationMap.set(t,Math.max(i,e))})}}!function(e){e[e.None=0]="None",e[e.Cursor=1]="Cursor",e[e.Light=2]="Light",e[e.Full=3]="Full"}(r||(r={}));const o=r.None;class l{constructor(e=o){this._panesOrderChanged=!1,this._keepVisibleTimeRangeOnResize=!1,this._timeAxisInvalidationLevel=o,this._invalidatedPanes=new Map,this._additionalActions=[],this._invalidationLevel=e}invalidateAll(e){this._invalidationLevel!==e&&(this._invalidationLevel=Math.max(this._invalidationLevel,e),this._invalidatedPanes.forEach(e=>{e.invalidateAll(this._invalidationLevel)}))}invalidateAllPane(e,t){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new s(this._invalidationLevel)),(0,n.ensureDefined)(this._invalidatedPanes.get(e)).invalidateAll(t)}invalidatePriceScale(e,t,i,r){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new s(this._invalidationLevel)),(0,n.ensureDefined)(this._invalidatedPanes.get(e)).invalidatePriceScale(t,i,r)}invalidateTimeScale(e){this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e)}invalidatePanesOrder(){this._panesOrderChanged=!0}lockVisibleTimeRangeOnResize(){
this._keepVisibleTimeRangeOnResize=!0}fullInvalidation(){return this._invalidationLevel}maxPaneInvalidation(){const e=[];return this._invalidatedPanes.forEach(t=>{e.push(t.fullInvalidation())}),Math.max(...e,this._invalidationLevel)}invalidateForPane(e){return this._invalidatedPanes.get(e)||new s(this._invalidationLevel)}invalidateForTimeScale(){return Math.max(this._timeAxisInvalidationLevel,this._invalidationLevel)}validationActions(){return this._additionalActions}addValidationAction(e){this._additionalActions.push(e)}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._panesOrderChanged=this._panesOrderChanged||e._panesOrderChanged,this._keepVisibleTimeRangeOnResize=this._keepVisibleTimeRangeOnResize||e._keepVisibleTimeRangeOnResize,this._invalidatedPanes.forEach(e=>{e.invalidateAll(this._invalidationLevel)}),e._invalidatedPanes.forEach((e,t)=>{this._invalidatedPanes.has(t)||this._invalidatedPanes.set(t,new s(this._invalidationLevel)),(0,n.ensureDefined)(this._invalidatedPanes.get(t)).merge(e)}),this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e._timeAxisInvalidationLevel);for(let t=0;t<e._additionalActions.length;t++)this._additionalActions.push(e._additionalActions[t])}panesOrderInvalidated(){return this._panesOrderChanged}isVisibleTimeRangeLockedOnResize(){return this._keepVisibleTimeRangeOnResize}static cursor(){return new l(r.Cursor)}static light(){return new l(r.Light)}static full(){return new l(r.Full)}static panesOrder(){const e=l.full();return e.invalidatePanesOrder(),e}static validateAction(e){const t=new l;return t._additionalActions.push(e),t}}},20808:(e,t,i)=>{i.d(t,{lastMouseOrTouchEventInfo:()=>n,setLastMouseOrTouchEventInfo:()=>s});let r=(0,i(38456).supportTouch)()?{isTouch:!0,stylus:!1}:{isTouch:!1};function n(){return r}function s(e){r=e.isTouch?{isTouch:!0,stylus:e.stylus}:{isTouch:!1}}},80560:(e,t,i)=>{var r,n,s,o,l,a,c,h,u,d,p,_,P,g,v;i.r(t),i.d(t,{CONNECTSTATUSES:()=>r,ORDERTYPE:()=>n,SIDE:()=>s,ORDERSTATUS:()=>o,ORDERSTATUSFILTER:()=>l,TradingEntityType:()=>a,PARENTTYPE:()=>c,BracketType:()=>h,TICKETFOCUS:()=>u,NOTIFICATION:()=>d,OrderOrPositionMessageType:()=>p,AccountType:()=>_,DisconnectType:()=>P,PipValueType:()=>g,RestrictionType:()=>v}),function(e){e[e.CONNECTED=1]="CONNECTED",e[e.CONNECTING=2]="CONNECTING",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.ERROR=4]="ERROR"}(r||(r={})),function(e){e[e.LIMIT=1]="LIMIT",e[e.MARKET=2]="MARKET",e[e.STOP=3]="STOP",e[e.STOPLIMIT=4]="STOPLIMIT"}(n||(n={})),function(e){e[e.BUY=1]="BUY",e[e.SELL=-1]="SELL"}(s||(s={})),function(e){e[e.CANCELED=1]="CANCELED",e[e.FILLED=2]="FILLED",e[e.INACTIVE=3]="INACTIVE",e[e.PLACING=4]="PLACING",e[e.REJECTED=5]="REJECTED",e[e.WORKING=6]="WORKING"}(o||(o={})),function(e){e[e.ALL=0]="ALL",e[e.CANCELED=1]="CANCELED",e[e.FILLED=2]="FILLED",e[e.INACTIVE=3]="INACTIVE",e[e.REJECTED=5]="REJECTED",e[e.WORKING=6]="WORKING"}(l||(l={})),function(e){e[e.Order=1]="Order",e[e.Position=2]="Position"}(a||(a={})),function(e){e[e.ORDER=1]="ORDER",e[e.POSITION=2]="POSITION"
}(c||(c={})),function(e){e[e.StopLoss=0]="StopLoss",e[e.TakeProfit=1]="TakeProfit",e[e.TrailingStop=2]="TrailingStop"}(h||(h={})),function(e){e[e.LIMITPRICE=1]="LIMITPRICE",e[e.STOPPRICE=2]="STOPPRICE",e[e.TAKEPROFIT=3]="TAKEPROFIT",e[e.STOPLOSS=4]="STOPLOSS"}(u||(u={})),function(e){e[e.ERROR=0]="ERROR",e[e.SUCCESS=1]="SUCCESS"}(d||(d={})),function(e){e.Information="information",e.Warning="warning",e.Error="error"}(p||(p={})),function(e){e.Demo="demo",e.Live="live"}(_||(_={})),function(e){e[e.LogOut=0]="LogOut",e[e.FailedRestoring=1]="FailedRestoring",e[e.Offline=2]="Offline",e[e.APIError=3]="APIError",e[e.TwoFactorRequired=4]="TwoFactorRequired",e[e.CancelAuthorization=5]="CancelAuthorization",e[e.TimeOutForAuthorization=6]="TimeOutForAuthorization",e[e.OauthError=7]="OauthError",e[e.BrokenConnection=8]="BrokenConnection"}(P||(P={})),function(e){e[e.None=0]="None",e[e.Pips=1]="Pips",e[e.Ticks=2]="Ticks"}(g||(g={})),function(e){e.Halted="HALTED",e.NotShortable="NOT-SHORTABLE",e.HardToBorrow="HARD-TO-BORROW"}(v||(v={}))},56616:(e,t,i)=>{var r=i(8214).makeFont,n=i(8214).parseFont,s=(0,i(11905).getLogger)("Model.ChartTradingUtils"),o={_fontHeightCache:{},_parsedColorCache:{},_parseColor:function(e){if(this._parsedColorCache[e])return this._parsedColorCache[e];var t=document.createElement("div");t.style.color=e;var i=t.style.color.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i)||t.style.color.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/i),r={r:i[1],g:i[2],b:i[3],a:i[4]||"1"};return this._parsedColorCache[e]=r,r},getColorFromProperties:function(e,t){var i=1-t.value()/100,r=this._parseColor(e.value());return"rgba("+r.r+","+r.g+","+r.b+","+i+")"},setColorToProperties:function(e,t,i){var r=this._parseColor(e);t.setValue("rgb("+r.r+","+r.g+","+r.b+")");var n=100*(1-r.a);i.setValue(Math.max(0,Math.min(n,100)))},getFontFromProperties:function(e,t,i,n){return r(t.value(),e.value(),n.value()?"italic":"",i.value()?"bold":"")},setFontToProperties:function(e,t,i,r,o){var l=n(e);null!==l?(l.family.length>0&&t.setValue(l.family),i.setValue(l.size),r.setValue(l.bold),o.setValue(l.italic)):s.logError("Invalid font: "+e)},fontHeight:function(e){if(!this._fontHeightCache[e]){var t=document.createElement("span");t.appendChild(document.createTextNode("height")),document.body.appendChild(t),t.style.cssText="font: "+e+"; white-space: nowrap; display: inline;";var i=t.offsetHeight;document.body.removeChild(t),this._fontHeightCache[e]=Math.ceil(i)}return this._fontHeightCache[e]},drawPolyHoverOrPress:function(e,t,i,r){r?(e.save(),e.fillStyle="rgba(0, 0, 0, 0.15)",CanvasEx.drawPoly(e,t,!0),e.restore()):i&&(e.save(),e.fillStyle="rgba(0, 0, 0, 0.1)",CanvasEx.drawPoly(e,t,!0),e.restore())},repaint:function(e){e.lightUpdate()},roundToMinTick:function(e,t){var i=1/e.mainSource().base();return i*Math.round(t/i)}};e.exports=o},62949:(e,t,i)=>{i.d(t,{DataSource:()=>c});var r=i(11688),n=i(62325),s=i.n(n),o=i(95935),l=i(97639),a=i.n(l);class c{constructor(e){this.hasAlert=new(s())(!1),this._zorder=0,
this.m_priceScale=null,this._ownerSource=null,this._userEditEnabled=!0,this._onPriceScaleChanged=new(a()),this._isSelectionEnabled=!0,this._instanceId=(0,o.randomHashN)(6),this._ownerSourceChanged=new(a()),this._zOrderChanged=new(a()),this._id=null!=e?e:(0,o.randomHashN)(6)}id(){return this._id}instanceId(){return this._instanceId}preferNoScale(){return!1}setId(e){this._id=e}zorder(){return this._zorder}setZorder(e){"number"==typeof e&&this._zorder!==e&&(this._zorder=e,this._zOrderChanged.fire(e))}isSpeciallyZOrderedSource(){return!1}title(){throw new Error("Implement this fun in a subclass")}name(){throw new Error("Implement this fun in a subclass")}priceScale(){return this.m_priceScale}setPriceScale(e){this.m_priceScale=e,this._onPriceScaleChanged.fire()}ownerSource(){return this._ownerSource}setOwnerSource(e){this._ownerSource=e,this._ownerSourceChanged.fire()}ownerSourceChanged(){return this._ownerSourceChanged}zOrderChanged(){return this._zOrderChanged}isSavedInChart(e){return!0}isSavedInStudyTemplates(){return!0}isRemovedByStudyTemplates(){return!0}hasContextMenu(){return!0}showInObjectTree(){return!0}setUserEditEnabled(e){this._userEditEnabled=e}userEditEnabled(){return this._userEditEnabled}canBeHidden(){return this.userEditEnabled()}isUserDeletable(){return this.userEditEnabled()}properties(){throw new Error("Implement this fun in a subclass")}isVisible(){return this.properties().visible.value()}dataWindowView(){return null}priceAxisViews(e,t){return null}timeAxisViews(){return null}updateAllViews(){}paneViews(e){return null}labelPaneViews(){return null}isFailed(){return!1}isLoading(){return!1}isPhantom(){return!1}isChildStudy(){return!1}hasChildren(){return!1}canHaveChildren(){return!1}onClickOutside(){}getSourceIcon(){return null}state(e){throw new Error("Implement this fun in a subclass")}onPriceScaleChanged(){return this._onPriceScaleChanged}doesMovingAffectsUndo(){return!0}isMultiPaneAvailable(){return!1}isMultiPaneEnabled(){return!1}copiable(){return!1}cloneable(){return!1}movable(){return!1}isIncludedInAutoScale(){return!1}isHoveredEnabled(){return this.isSelectionEnabled()}isSelectionEnabled(){return this._isSelectionEnabled}setSelectionEnabled(e){this._isSelectionEnabled=e}firstValue(){return null}priceRange(e,t){return null}autoScaleInfo(e,t){return{range:this.priceRange(e,t)}}stateForAlert(){return null}canHasAlert(){return!1}alertCreationAvailable(){return this.hasStateForAlert()}hasStateForAlert(){return r.enabled("alerts")}idForAlert(){return this._id}}},46090:(e,t,i)=>{i.r(t),i.d(t,{createDefaultsState:()=>d,saveDefaultProperties:()=>_,DefaultProperty:()=>P});var r=i(22914),n=i(36599),s=i(2040),o=i(85518),l=i(32567),a=i.n(l),c=i(97639),h=i.n(c);function u(e,t){const i=(0,r.default)(e);return t.forEach(e=>(0,s.default)(i,e.split("."))),i}function d(e,t,i,s){const l=e?o.defaults:o.factoryDefaults,a=t.startsWith("study_")?(0,r.default)(l("study")):{};let c=(0,r.default)(l(t,s));return t.startsWith("study_")&&c.inputs&&delete c.inputs.symbol,"linetoolicon"===t&&e&&(c.icon=(0,o.defaults)(t).icon),
c=u(c,i),(0,n.default)(a,c),a}let p=!1;function _(e){p=e}class P extends(a()){constructor(e,t,i,r){super(function(e,t,i,r){let s;return void 0===r&&(r=!0),i?s=t:(s=d(r,e,[],null),t&&(0,n.default)(s,t)),s}(e,t,i,r)),this._exclusions=[],this._restoreFactoryDefaultsEvent=new(h()),this._defaultName=e,this._useUserPreferences=null==r||r,this.listeners().subscribe(this,P.prototype.onPropertyChanged),this._restoreFactoryDefaultsEvent=new(h())}preferences(){return this.state(this._exclusions)}mergePreferences(e){this.mergeAndFire(u(e,this._exclusions))}addExclusion(e){this._exclusions.indexOf(e)<0&&this._exclusions.push(e)}removeExclusion(e){const t=this._exclusions.indexOf(e);-1!==t&&this._exclusions.splice(t,1)}restoreFactoryDefaults(){const e=d(!1,this._defaultName,this._exclusions,null);this.mergeAndFire(e),this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||(0,o.saveDefaults)(this._defaultName,void 0),this._restoreFactoryDefaultsEvent.fire()}onRestoreFactoryDefaults(){return this._restoreFactoryDefaultsEvent}onPropertyChanged(){!p||this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||this.saveDefaults()}saveDefaults(){this._useUserPreferences&&(0,o.saveDefaults)(this._defaultName,this.preferences())}clone(e){const t=new P(this._defaultName,this.state(),null==e?void 0:e.replaceByState,this._useUserPreferences);for(let e=0;e<this._exclusions.length;++e)t.addExclusion(this._exclusions[e]);return t}}},8170:(e,t,i)=>{i.r(t),i.d(t,{toolIsCursor:()=>p,toolIsMeasure:()=>_,resetToCursor:()=>P,lockTimeAxisTime:()=>T,tool:()=>w,iconTool:()=>S,cursorTool:()=>x,isToolCreatingNow:()=>b,isToolEditingNow:()=>L,isToolMovingNow:()=>A,isDirectionalMovementActive:()=>V,createdLineTool:()=>D,continuedLineTool:()=>M,cancelledLineTool:()=>I,beenSetLineToolLastPoint:()=>B,startedMovingLineTool:()=>R,movedLineTool:()=>E,finishedMovingLineTool:()=>k,startedChangingLineTool:()=>N,changedLineTool:()=>F,finishedChangingLineTool:()=>O,removedLineTool:()=>z,finishedLineTool:()=>W,changedLineStyle:()=>H,copiedLineTool:()=>U,restoredLineTool:()=>G,restoredLineToolState:()=>q,isPointSelectedNow:()=>j,isStudyEditingNow:()=>Q,createLineTool:()=>X,continueLineTool:()=>Z,cancelLineTool:()=>$,setLineToolLastPoint:()=>J,startMovingLineTool:()=>ee,moveLineTool:()=>te,finishMovingLineTool:()=>ie,startChangingLineTool:()=>re,changeLineTool:()=>ne,finishChangingLineTool:()=>se,removeLineTool:()=>oe,finishLineTool:()=>le,changeLineStyle:()=>ae,copyLineTool:()=>ce,restoreLineTool:()=>he,restoreLineToolState:()=>ue,init:()=>_e,runOnDrawingStateReady:()=>Pe,properties:()=>ge,hideAllDrawings:()=>ve,hideAllIndicators:()=>me,lockDrawings:()=>fe,hideMarksOnBars:()=>Ce,drawOnAllCharts:()=>ye,drawOnAllChartsMode:()=>Te,lockTimeAxis:()=>we});var r=i(88537),n=i(60949),s=i(46090),o=i(85518),l=i(62325),a=i.n(l),c=i(97639),h=i.n(c),u=i(62802),d=i(51954);function p(e){return"cursor"===e||"arrow"===e||"dot"===e}function _(e){return"measure"===e}function P(e=!1){if(!e&&g){
if(g.childs().stayInDrawingMode.value())return}w.setValue(x.value())}let g=null,v=null,m=null,f=null,C=null,y=null;const T=new(a()),w=new(a()),S=new(a()),x=new(a()),b=new(a())(!1),L=new(a())(!1),A=new(a())(!1),V=new(a())(!1),D=new(h()),M=new(h()),I=new(h()),B=new(h()),R=new(h()),E=new(h()),k=new(h()),N=new(h()),F=new(h()),O=new(h()),z=new(h()),W=new(h()),H=new(h()),U=new(h()),G=new(h()),q=new(h()),j=new(a())(!1),Q=new(a())(!1);function Y(e,t){const i=t||{value:!1};return t=>{i.value||(i.value=!0,e.fire(t),i.value=!1)}}const K={value:!1},X=Y(D,K),Z=Y(M,K),$=Y(I,K),J=Y(B,K),ee=Y(R),te=Y(E),ie=Y(k),re=Y(N),ne=Y(F),se=Y(O),oe=Y(z),le=Y(W),ae=Y(H,K),ce=Y(U,K),he=Y(G),ue=Y(q);let de=!1,pe=[];function _e(){de||(w.setValue(u.getValue("chart.cursorPreference","cursor")),w.subscribe(e=>p(e)&&x.setValue(e),{callWithLast:!0}),x.subscribe(e=>{e&&u.setValue("chart.cursorPreference",e)}),g=new s.DefaultProperty("drawings"),v=(0,n.createPrimitiveProperty)(),m=(0,n.createPrimitiveProperty)(),f=(0,n.createPrimitiveProperty)(),C=(0,n.createPrimitiveProperty)(),y=(0,n.createPrimitiveProperty)(),v.setValue(!1),m.setValue(!1),f.setValue(!1),C.setValue(!1),y.setValue(!1),w.subscribe(()=>{(0,d.emit)("onSelectedLineToolChanged")}),S.subscribe(()=>{(0,o.saveDefaults)("linetoolicon",{...(0,o.defaults)("linetoolicon"),icon:S.value()})}),de=!0,pe.forEach(e=>e()),pe=[])}function Pe(e){de?e():pe.push(e)}function ge(){return(0,r.ensureNotNull)(g)}function ve(){return(0,r.ensureNotNull)(v)}function me(){return(0,r.ensureNotNull)(m)}function fe(){return(0,r.ensureNotNull)(f)}function Ce(){return(0,r.ensureNotNull)(C)}function ye(){return ge().childs().drawOnAllCharts}function Te(){return ge().childs().drawOnAllChartsMode}function we(){return(0,r.ensureNotNull)(y)}},96484:(e,t,i)=>{i.d(t,{LimitedPrecisionNumericFormatter:()=>n});var r=i(70617);class n{constructor(e=1){this._precision=e}format(e){(0,r.isNumber)(e)||(e=parseFloat(e));const t=e.toFixed(this._precision),i=Math.pow(10,-this._precision);return Math.max(parseFloat(t),i)+""}parse(e){const t=parseFloat(e);return isNaN(t)?{res:!1}:{res:!0,value:t,suggest:this.format(t)}}}},18718:(e,t,i)=>{function r(e,t,i){if(e.isTouch){if(void 0!==i)return i(e),!0}else if(void 0!==t)return t(e),!0;return!1}function n(e,t,i,r){return void 0!==t.executeDefaultAction&&(e.isTouch?Boolean(t.executeDefaultAction[r]):Boolean(t.executeDefaultAction[i]))}var s;i.d(t,{tryCallHandler:()=>r,shouldDefaultActionBeExecuted:()=>n,AreaName:()=>s,HitTestResult:()=>o}),function(e){e.Style="Style",e.Text="Text",e.SourceItemMove="SourceItemMove"}(s||(s={}));class o{constructor(e,t,i){this._result=e,this._data=t||null,this._eraseMarker=i}result(){return this._result}data(){return this._data}hasPressedMoveHandler(e){return null!==this._data&&function(e,t,i){if(e.isTouch){if(void 0!==i)return!0}else if(void 0!==t)return!0;return!1}(e,this._data.pressedMouseMoveHandler,this._data.touchMoveHandler)}tryCallMouseDownOrTouchStartHandler(e){return null!==this._data&&r(e,this._data.mouseDownHandler,this._data.touchStartHandler)}
tryCallMouseUpOrTouchEndHandler(e){return null!==this._data&&r(e,this._data.mouseUpHandler,this._data.touchEndHandler)}tryCallMouseEnterHandler(e){return null!==this._data&&r(e,this._data.mouseEnterHandler)}tryCallMouseLeaveHandler(e){return null!==this._data&&r(e,this._data.mouseLeaveHandler)}tryCallMouseMoveHandler(e){return null!==this._data&&r(e,this._data.mouseMoveHandler)}tryCallClickOrTapHandler(e){return null!==this._data&&r(e,this._data.clickHandler,this._data.tapHandler)}tryCallDblClickOrDblTapHandler(e){return null!==this._data&&r(e,this._data.doubleClickHandler,this._data.doubleTapHandler)}tryCallContextMenuHandler(e){return null!==this._data&&r(e,this._data.contextMenuHandler,this._data.touchContextMenuHandler)}eraseMarker(){return this._eraseMarker}}o.MOVEPOINT_BACKGROUND=1,o.REGULAR=2,o.MOVEPOINT=3,o.CHANGEPOINT=4,o.CUSTOM=5},94543:(e,t,i)=>{i.d(t,{intervalsVisibilitiesDefaults:()=>r});const r={ticks:!0,seconds:!0,secondsFrom:1,secondsTo:59,minutes:!0,minutesFrom:1,minutesTo:59,hours:!0,hoursFrom:1,hoursTo:24,days:!0,daysFrom:1,daysTo:366,weeks:!0,weeksFrom:1,weeksTo:52,months:!0,monthsFrom:1,monthsTo:12,ranges:!0}},52500:(e,t,i)=>{i.d(t,{IntervalsVisibilitiesProperty:()=>a});var r=i(32567),n=i.n(r),s=i(25226),o=i(69415);const l=(0,s.isFeatureEnabled)("store_only_non_default_interval_visibilities");class a extends(n()){state(e){var t;return l?null!==(t=(0,o.nonDefaultIntervalsVisibilities)(super.state(e)))&&void 0!==t?t:void 0:super.state(e)}storeStateIfUndefined(){return!1}}},69415:(e,t,i)=>{i.d(t,{makeIntervalsVisibilitiesVisibleAtInterval:()=>l,isActualInterval:()=>c,nonDefaultIntervalsVisibilities:()=>h,mergeIntervalVisibilitiesDefaults:()=>u});var r=i(88537),n=i(73044),s=i(94543),o=i(70617);function l(e,t){let i=t.multiplier();if(t.isTicks()&&(e.ticks=!0),t.isSeconds()&&(i<60?(e.seconds=!0,e.secondsFrom=Math.min(e.secondsFrom,i),e.secondsTo=Math.max(e.secondsTo,i)):(i/=60,t=new n.Interval(n.ResolutionKind.Minutes,i))),t.isMinutes())if(i<60)e.minutes=!0,e.minutesFrom=Math.min(e.minutesFrom,i),e.minutesTo=Math.max(e.minutesTo,i);else{const t=Math.floor(i/60);e.hours=!0,e.hoursFrom=Math.min(e.hoursFrom,t),e.hoursTo=Math.max(e.hoursTo,t)}t.isDays()&&(e.days=!0,e.daysFrom=Math.min(e.daysFrom,i),e.daysTo=Math.max(e.daysTo,i)),t.isWeeks()&&(e.weeks=!0,e.weeksFrom=Math.min(e.weeksFrom,i),e.weeksTo=Math.max(e.weeksTo,i)),t.isMonths()&&(e.months=!0,e.monthsFrom=Math.min(e.monthsFrom,i),e.monthsTo=Math.max(e.monthsTo,i)),t.isRange()&&(e.ranges=!0)}function a(e,t,i,r){return e&&r>=t&&r<=i}function c(e,t){const i=t.childs();switch(e.kind()){case n.ResolutionKind.Ticks:return i.ticks.value();case n.ResolutionKind.Seconds:if(e.multiplier()<60)return a(i.seconds.value(),i.secondsFrom.value(),i.secondsTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return a(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),t)}case n.ResolutionKind.Minutes:if(e.multiplier()<60)return a(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60)
;return a(i.hours.value(),i.hoursFrom.value(),i.hoursTo.value(),t)}case n.ResolutionKind.Days:return a(i.days.value(),i.daysFrom.value(),i.daysTo.value(),e.multiplier());case n.ResolutionKind.Weeks:return a(i.weeks.value(),i.weeksFrom.value(),i.weeksTo.value(),e.multiplier());case n.ResolutionKind.Months:return a(i.months.value(),i.monthsFrom.value(),i.monthsTo.value(),e.multiplier());case n.ResolutionKind.Range:return i.ranges.value()}return(0,r.assert)(!1,"Unsupported resolution: "+e.value()),!1}function h(e){const t=Object.keys(e).filter(t=>s.intervalsVisibilitiesDefaults[t]!==e[t]);return 0===t.length?null:t.reduce((t,i)=>(t[i]=e[i],t),{})}function u(e){return(0,o.merge)((0,o.clone)(s.intervalsVisibilitiesDefaults),null!=e?e:{})}},55827:(e,t,i)=>{i.d(t,{LevelsProperty:()=>p});var r=i(70617),n=i(46090),s=i(85518);const o={prefixes:[""],range:[0,0],names:["coeff","color","visible","linestyle","linewidth"],typecheck:{pack:()=>Object(),unpack:()=>[]}};function l(e,t,i,r){return r.push(i[t]),r}function a(e,t,i,r){return r[t]=i[e],r}function c(){return[]}function h(){return{}}function u(e,t,i){return i.prefixes.forEach(n=>{const s=n+"level";for(let n=i.range[0];n<=i.range[1];n++)if(e[s+n]&&(0,r.isSameType)(e[s+n],t.typecheck())){let r=t.tpl();i.names.forEach((i,o)=>{r=t.fill(""+o,i,e[s+n],r)}),e[s+n]=r}}),e}function d(e,t,i){return i(e,{tpl:h,fill:a,typecheck:t.typecheck.unpack},t)}class p extends n.DefaultProperty{constructor(e,t,i,r,n){n=null!=n?n:u;const s={...o,...null!=r?r:{}};super(e,t?d(t,s,n):t,i),this._map=s,this._levelsIterator=n}state(e,t){const i=super.state(e);return t?i:(r=i,n=this._map,(0,this._levelsIterator)(r,{tpl:c,fill:l,typecheck:n.typecheck.pack},n));var r,n}saveDefaults(){this._useUserPreferences&&(0,s.saveDefaults)(this._defaultName,this.state(this._exclusions,!0))}clone(){const e=this.state(),t=new p(this._defaultName,e);for(let e=0;e<this._exclusions.length;++e)t.addExclusion(this._exclusions[e]);return t}merge(e,t){return super.merge(d(e,this._map,this._levelsIterator),t)}}},21595:(e,t,i)=>{i.d(t,{LineTool5PointsPattern:()=>l});var r=i(88537),n=i(46090),s=i(24145),o=i(24146);class l extends s.LineDataSource{constructor(e,t,i,r){super(e,t||l.createProperties(),i,r),this._loadPaneViews(e)}pointsCount(){return 5}name(){return"XABCD Pattern"}static createProperties(e){const t=new n.DefaultProperty("linetool5pointspattern",e);return l._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,49902)).then(e=>e.PatternWithBackgroundDefinitionViewModel)}_loadPaneViews(e){Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,5760)).then(t=>{this._setPaneViews([new t.Pattern5pointsPaneView(this,e)])})}static _configureProperties(e){s.LineDataSource._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}},96807:(e,t,i)=>{i.d(t,{LineToolABCD:()=>l})
;var r=i(88537),n=i(46090),s=i(24145),o=i(24146);class l extends s.LineDataSource{constructor(e,t,r,n){const s=t||l.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,87755)).then(t=>{this._setPaneViews([new t.ABCDPaneView(this,e)])})}pointsCount(){return 4}name(){return"ABCD Pattern"}static createProperties(e){const t=new n.DefaultProperty("linetoolabcd",e);return l._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,87412)).then(e=>e.PatternWithoutBackgroundDefinitionsViewModel)}static _configureProperties(e){s.LineDataSource._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}},89886:(e,t,i)=>{i.d(t,{LineToolArc:()=>h});var r=i(88537),n=i(4652),s=i(86441),o=i(25422),l=i(46090),a=i(24145),c=i(24146);class h extends a.LineDataSource{constructor(e,t,r,n){const s=t||h.createProperties();super(e,s,r,n),this.version=2,this._dist=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,9147)).then(({ArcPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)})}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,n.distanceToLine)(e,t,i).distance;const o=t.subtract(e),l=new s.Point(-o.y,o.x),a=e.add(t).scaled(.5);i.subtract(a).dotProduct(l)<0&&(this._dist=-this._dist)}}endChanging(e,t){return this._dist=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Arc"}hasEditableCoordinates(){return!1}setPoint(e,t){const i={...t},l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));switch(e){case 0:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),n=a.subtract(t),o=t.add(a).scaled(.5);let l=new s.Point(-n.y,n.x);l=l.normalized();const c=o.add(l.scaled(e));this._points[0]=i,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(c));break}case 1:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),n=t.subtract(l),o=l.add(t).scaled(.5),a=new s.Point(-n.y,n.x).normalized(),c=o.add(a.scaled(e));this._points[1]=i,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(c));break}case 2:{let e=(0,r.ensureNotNull)(this.pointToScreenPoint(i));const t=(0,n.distanceToLine)(l,a,e).distance,c=a.subtract(l),h=l.add(a).scaled(.5),u=new s.Point(-c.y,c.x).normalized(),d=h.add(u.scaled(t)),p=h.add(u.scaled(-t)),_=c.length(),P=c.x/_,g=c.y/_;let v=Math.acos(P);g<0&&(v=-v);let m=(0,o.translationMatrix)(-h.x,-h.y);e=(0,o.transformPoint)(m,e);let f=(0,o.transformPoint)(m,d);m=(0,o.rotationMatrix)(-v),e=(0,o.transformPoint)(m,e),f=(0,o.transformPoint)(m,f),m=(0,
o.scalingMatrix)(1,_/(2*t)),e=(0,o.transformPoint)(m,e),f=(0,o.transformPoint)(m,f);const C=e.y*f.y>=0?new s.Point(d.x,d.y):new s.Point(p.x,p.y);this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(C));break}}this.normalizePoints()}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=(2*this._points[0].price+3*this._points[1].price)/5;this._points.push({price:e,index:this._points[1].index})}if(1===e&&2===this._timePoint.length){const e={price:(2*this._timePoint[0].price+3*this._timePoint[1].price)/5,offset:this._timePoint[1].offset,time_t:this._timePoint[1].time_t};this._timePoint.push(e)}}static createProperties(e){const t=new l.DefaultProperty("linetoolarc",e);return h._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,80717))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){a.LineDataSource._configureProperties(e),e.addChild("linesColors",new c.LineToolColorsProperty([e.childs().color]))}}},50581:(e,t,i)=>{i.d(t,{LineToolArrowMark:()=>a,LineToolArrowMarkLeft:()=>c,LineToolArrowMarkUp:()=>h,LineToolArrowMarkRight:()=>u,LineToolArrowMarkDown:()=>d});var r=i(46090),n=i(24145),s=i(32567),o=i.n(s),l=i(24146);class a extends n.LineDataSource{constructor(e,t,r,n,s){const o=t||a.createProperties(null,r);super(e,o,n,s),this._textPaneView=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,35303)).then(({ArrowMarkPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)})}paneViews(e){const t=super.paneViews();return null!==t&&this._textPaneView&&t.push(this._textPaneView),t}pointsCount(){return 1}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t){const i=new r.DefaultProperty(t,e);return a._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,88010)).then(e=>e.ArrowMarkDefinitionsViewModel)}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().arrowColor])),e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().color])),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text")}}a.version=2;class c extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkleft",i,r)}direction(){return"left"}name(){return"Arrow Mark Left"}textAlignParams(){return{horzAlign:"left",vertAlign:"middle",offsetX:22,offsetY:3}}static createProperties(e){return a.createProperties(e,"linetoolarrowmarkleft")}}class h extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkup",i,r)}direction(){return"up"}name(){return"Arrow Mark Up"}textAlignParams(){return{horzAlign:"center",vertAlign:"top",offsetX:0,offsetY:20}}static createProperties(e){return a.createProperties(e,"linetoolarrowmarkup")}}class u extends a{constructor(e,t,i,r){
super(e,t,"linetoolarrowmarkright",i,r)}direction(){return"right"}name(){return"Arrow Mark Right"}textAlignParams(){return{horzAlign:"right",vertAlign:"middle",offsetX:22,offsetY:3,forceTextAlign:!0}}static createProperties(e){return a.createProperties(e,"linetoolarrowmarkright")}}class d extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkdown",i,r)}direction(){return"down"}name(){return"Arrow Mark Down"}textAlignParams(){return{horzAlign:"center",vertAlign:"bottom",offsetX:0,offsetY:20}}static createProperties(e){return a.createProperties(e,"linetoolarrowmarkdown")}}},65851:(e,t,i)=>{i.d(t,{LineToolArrowMarker:()=>l});var r=i(24145),n=i(46090),s=i(32567),o=i.n(s);class l extends r.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:l.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,15575)).then(({ArrowMarkerPaneView:e})=>{this._setPaneViews([new e(this,this.model())])})}pointsCount(){return 2}name(){return"Trend Line"}static createProperties(e){const t=new n.DefaultProperty("linetoolarrowmarker",e);return l._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,33871)).then(e=>e.ArrowMarkerDefinitionsViewModel)}static _configureProperties(e){r.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text")}}},60046:(e,t,i)=>{var r=i(39195).LineToolTrendLine,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Arrow"}static createProperties(e){var t=new n("linetoolarrow",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolArrow=s},97807:(e,t,i)=>{i.d(t,{LineToolBalloon:()=>h});var r=i(87236),n=i(46090),s=i(24145),o=i(32567),l=i.n(o),a=i(24146);const c=(0,r.t)("Comment");class h extends s.LineDataSource{constructor(e,t,r,n){const s=t||h.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,61627)).then(t=>{this._setPaneViews([new t.BalloonPaneView(this,e)])})}pointsCount(){return 1}name(){return"Balloon"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new n.DefaultProperty("linetoolballoon",e);return h._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,597)).then(e=>e.BalloonDefinitionsViewModel)}static _configureProperties(e){s.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())(c)),e.addExclusion("text"),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}}},83819:(e,t,i)=>{i.d(t,{LineToolBarsPattern:()=>m});var r=i(88537),n=i(87236),s=i(77036),o=i(70617),l=i(29770),a=i(46090),c=i(52280),h=i(24145),u=i(13580)
;const d=new s.TranslatedString("mirror bars pattern",(0,n.t)("mirror bars pattern")),p=new s.TranslatedString("flip bars pattern",(0,n.t)("flip bars pattern")),_=(0,n.t)("Mirrored"),P=(0,n.t)("Flipped"),g={0:2,1:4,2:1,3:1,4:2,5:3,6:-1},v={0:3,1:4,2:4,3:1,4:2,5:3,6:-1};class m extends h.LineDataSource{constructor(e,t=m.createProperties(),r,n){super(e,t,r,n),this._pattern=[],this._scale=1,this._pointsCoordinatePricesDiff=null;const s=t.childs().mode.value();(0,o.isString)(s)&&t.childs().mode.setValue(parseInt(s)),t.childs().mirrored.listeners().subscribe(this,this._mirror),t.childs().flipped.listeners().subscribe(this,this._flip),t.childs().mode.subscribe(this,this._updateLastPoint),this.version=2,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,44902)).then(t=>{this._setPaneViews([new t.BarsPatternPaneView(this,e)])})}pattern(){return this._pattern}isSynchronizable(){return!1}additionalActions(e){return[new l.Action({actionId:"Chart.LineTool.BarsPattern.ToggleMirrored",checked:this.properties().childs().mirrored.value(),checkable:!0,label:_,onExecute:()=>{e.setProperty(this.properties().childs().mirrored,!this.properties().childs().mirrored.value(),d),this.updateAllViews(),this._model.updateSource(this)}}),new l.Action({actionId:"Chart.LineTool.BarsPattern.ToggleFlipped",checked:this.properties().childs().flipped.value(),checkable:!0,label:P,onExecute:()=>{e.setProperty(this.properties().childs().flipped,!this.properties().childs().flipped.value(),p),this.updateAllViews(),this._model.updateSource(this)}})]}pointsCount(){return 2}state(e){return{...super.state(e),pattern:this._pattern,scale:this._scale,diff:this._pointsCoordinatePricesDiff}}restoreData(e){const{pattern:t=this._pattern,scale:i=this._scale,diff:r=this._pointsCoordinatePricesDiff}=e;this._pattern=t,this._scale=i,this._pointsCoordinatePricesDiff=r}name(){return"Bars Pattern"}hasEditableCoordinates(){return!1}cloneData(e){this._pattern=(0,o.clone)(e._pattern),this._scale=e._scale,this._pointsCoordinatePricesDiff=e._pointsCoordinatePricesDiff}firstPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[0];return e.value()===u.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[v[e.value()]]:i[g[e.value()]]}lastPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[this._pattern.length-1];return e.value()===u.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[g[e.value()]]:i[v[e.value()]]}addPoint(e,t,i){const n=super.addPoint(e,t,!0);if(n){const e=this._model.mainSeries(),[{index:t},{index:i}]=this.points(),n=(0,r.ensureDefined)(e.nearestIndex(Math.min(t,i),c.PlotRowSearchMode.NearestRight)),s=(0,r.ensureDefined)(e.nearestIndex(Math.max(t,i),c.PlotRowSearchMode.NearestLeft));this._pattern=this._createPattern(n,s),this._pattern.length>0&&(t>i&&this._points.reverse(),this._points[1].price=this._points[0].price+this._patternPriceDiff(),this._points[1].index=this._points[0].index+(s-n),this.normalizePoints(),this.createServerPoints()),this._updatePointsCoordinatePricesDiff()}return n}
setPoint(e,t,i,r){1===e&&t.index<=this._points[0].index&&(t.index=this._points[0].index+1),0===e&&t.index>=this._points[1].index&&(t.index=this._points[1].index-1),super.setPoint(e,t,i),this._updatePointsCoordinatePricesDiff()}move(e,t,i,r){super.move(e,t,i,r),this._updatePointsCoordinatePricesDiff()}migrateVersion(e,t,i){if(1===e&&this._pattern.length>0){const e=this._patternPriceDiff();2===this._timePoint.length&&(this._timePoint[1].price=this._timePoint[0].price+e),2===this._points.length&&(this._points[1].price=this._points[0].price+e)}}getScale(){return this._scale=this._calculateScale()}static createProperties(e){const t=new a.DefaultProperty("linetoolbarspattern",e);return m._configureProperties(t),t}_preparePoint(e,t){var i;const n=this._alignPointToRangeOfActualData(e),s=this._model.mainSeries(),o=(0,r.ensureNotNull)(s.bars().valueAt(n.index));this.properties().childs().mode.value()===u.LineToolBarsPatternMode.Bars?n.price=(0,r.ensure)(o[2]):n.price=(0,r.ensure)(o[4]);const l=(0,r.ensureNotNull)(this.priceScale()),a=(0,r.ensure)(null===(i=this.ownerSource())||void 0===i?void 0:i.firstValue()),c=.05*l.height(),h=l.priceToCoordinate(n.price,a)-c;return n.price=l.coordinateToPrice(h,a),super._preparePoint(n,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,83027))).BarsPatternDefinitionsViewModel}static _configureProperties(e){h.LineDataSource._configureProperties(e),e.addExclusion("mirrored"),e.addExclusion("flipped")}_calculatePatternCoordinatePricesDiff(){var e;return this._pattern.length>0&&null!==(e=this._priceCoordinateDiff([this.firstPatternPrice(),this.lastPatternPrice()]))&&void 0!==e?e:null}_updatePointsCoordinatePricesDiff(){this._pointsCoordinatePricesDiff=this._calculatePointsCoordinatePricesDiff()}_calculatePointsCoordinatePricesDiff(){var e;if(2===this._points.length){const[{price:t},{price:i}]=this.points();return null!==(e=this._priceCoordinateDiff([t,i]))&&void 0!==e?e:null}return null}_createPattern(e,t){const i=this._model.mainSeries().data(),n=[];for(let s=e;s<=t;s++)n.push((0,o.clone)((0,r.ensureNotNull)(i.valueAt(s))));return n}_switchPointsPrice(){const e=this._points[0].price;this._timePoint[0].price=this._points[0].price=this._points[1].price,this._timePoint[1].price=this._points[1].price=e}_mirror(){const e=this._pattern;let t=Math.min(e[0][3],e[0][2]),i=Math.max(e[0][3],e[0][2]);for(let r=1;r<e.length;r++)t=Math.min(t,e[r][3]),i=Math.max(i,e[r][2]);if(t<i){const r=(t+i)/2,n=e=>r-(e-r);for(let t=0;t<e.length;t++)e[t][2]=n(e[t][2]),e[t][3]=n(e[t][3]),e[t][1]=n(e[t][1]),e[t][4]=n(e[t][4])}this._switchPointsPrice(),this.updateAllViews()}_flip(){const e=this._pattern,t=e.length;for(let i=0;i<t/2;i++){const r=e[i];e[i]=e[t-i-1],e[t-i-1]=r}this._switchPointsPrice(),this.updateAllViews()}_patternPriceDiff(){return this.lastPatternPrice()-this.firstPatternPrice()}_pricesToCoordinates(e){var t,i;const r=this.priceScale(),n=null!==(i=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue())&&void 0!==i?i:null
;if(null!==n&&null!==r&&!r.isEmpty())return e.map(e=>r.priceToCoordinate(e,n))}_priceCoordinateDiff(e){const t=this._pricesToCoordinates(e);if(t)return t[1]-t[0]}_calculateScale(){let e=1;if(2===this._points.length){const t=this._calculatePatternCoordinatePricesDiff();if(!t)return e;const i=this._calculatePointsCoordinatePricesDiff();if(t&&null!==i&&(e=+(i/t).toFixed(8)),this._pointsCoordinatePricesDiff!==i){if(this._scale!==e)return this._updateLastPoint(),this._scale;this._updatePointsCoordinatePricesDiff()}}return e}_updateLastPoint(){var e,t;if(this._points.length<2)return;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===r||null===i||i.isEmpty())return;const n=this._calculatePatternCoordinatePricesDiff(),s=this._pricesToCoordinates([this.points()[0].price]);null!==n&&s&&(this._timePoint[1].price=this._points[1].price=i.coordinateToPrice(+(this._scale*n).toFixed(8)+s[0],r),this._updatePointsCoordinatePricesDiff())}}},95426:(e,t,i)=>{i.d(t,{LineToolBezierCubic:()=>o});var r=i(88537),n=i(46090),s=i(24145);class o extends s.LineDataSource{constructor(e,t,r,n){const s=t||o.createProperties();super(e,s,r,n),this._controlPoints=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,91042)).then(t=>{this._setPaneViews([new t.BezierCubicPaneView(this,e)])})}pointsCount(){return 2}name(){return"Double Curve"}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoints=this._calculateControlPoints(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoints();this._controlPoints=null,this._points.push(e[0]),this._points.push(e[1]),i||(this.normalizePoints(),this.createServerPoints()),this._createPointProperty(2),this._createPointProperty(3)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2),this._createPointProperty(3)}controlPoints(){return this._controlPoints}static createProperties(e){const t=new n.DefaultProperty("linetoolbeziercubic",e);return o._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,42811)).then(e=>e.GeneralBezierDefinitionsViewModel)}static _configureProperties(e){s.LineDataSource._configureProperties(e)}_calculateControlPoints(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),n=e.add(t).scaled(.33),s=e.add(t).scaled(.67),o=n.add(i),l=s.subtract(i);return[(0,r.ensureNotNull)(this.screenPointToPoint(o)),(0,r.ensureNotNull)(this.screenPointToPoint(l))]}}},81888:(e,t,i)=>{i.d(t,{LineToolBezierQuadro:()=>o});var r=i(88537),n=i(46090),s=i(24145);class o extends s.LineDataSource{constructor(e,t,r,n){const s=t||o.createProperties();super(e,s,r,n),this._controlPoint=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,51972)).then(t=>{this._setPaneViews([new t.BezierQuadroPaneView(this,e)])})}pointsCount(){return 2}name(){
return"Curve"}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoint=this._calculateControlPoint(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoint();this._points.push(e),this._controlPoint=null,i||(this.normalizePoints(),this.createServerPoints()),this._createPointProperty(2)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2)}controlPoint(){return this._controlPoint}static createProperties(e){const t=new n.DefaultProperty("linetoolbezierquadro",e);return o._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,42811)).then(e=>e.GeneralBezierDefinitionsViewModel)}static _configureProperties(e){s.LineDataSource._configureProperties(e)}_calculateControlPoint(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),n=e.add(t).scaled(.5).add(i);return(0,r.ensureNotNull)(this.screenPointToPoint(n))}}},85603:(e,t,i)=>{i.d(t,{LineToolBrushBase:()=>s});var r=i(88537),n=i(24145);class s extends n.LineDataSource{constructor(){super(...arguments),this._finished=!1}pointsCount(){return-1}finished(){return this._finished}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}hasEditableCoordinates(){return!1}addPoint(e,t,i){if(this._finished)return!0;if(this._lastPoint=null,this._points.length>0){const t=this._points[this._points.length-1],i=(0,r.ensureNotNull)(this.pointToScreenPoint(t));if((0,r.ensureNotNull)(this.pointToScreenPoint(e)).subtract(i).length()<2)return this._finished}return super.addPoint(e),this._finished}restorePoints(e,t,i){super.restorePoints(e,t,i),this._finished=!0}}},97537:(e,t,i)=>{i.d(t,{LineToolBrush:()=>o});var r=i(46090),n=i(85603),s=i(24146);class o extends n.LineToolBrushBase{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Brush"}hasEditableCoordinates(){return!1}static createProperties(e){const t=new r.DefaultProperty("linetoolbrush",e);return o._configureProperties(t),t}_loadPaneViews(e){Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,81443)).then(t=>{this._setPaneViews([new t.BrushPaneView(this,e)])})}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,47184)).then(e=>e.BrushDefinitionsViewModel)}static _configureProperties(e){n.LineToolBrushBase._configureProperties(e),e.addChild("backgroundsColors",new s.LineToolColorsProperty([e.childs().backgroundColor],e.childs().fillBackground))}}},27522:(e,t,i)=>{var r;i.d(t,{CalloutConsts:()=>r}),function(e){e[e.RoundRadius=8]="RoundRadius",e[e.TextMargins=2]="TextMargins",e[e.MinWidth=100]="MinWidth"}(r||(r={}))},86779:(e,t,i)=>{
var r=i(87236).t,n=i(24145).LineDataSource,s=i(62949).DataSource,o=i(32567),l=i(46090).DefaultProperty,a=i(27522).CalloutConsts,c=i(24146).LineToolColorsProperty;class h extends n{constructor(e,t,r,n){super(e,t||h.createProperties(),r,n),this._barOffset=0,this._timeScale=e.timeScale(),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,55340,19)).then(({CalloutPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 2}name(){return"Callout"}_correctPoints(e,t){var i=this._currentMovingPoint.logical.index-this._startMovingPoint.logical.index,r=this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price,n=e[1];n.index+=i,n.price+=r,e[1]=n}addPoint(e){var t=n.prototype.addPoint.call(this,e);return t&&this._calculateBarOffset(),t}_calculateBarOffset(){this.points().length>1&&(this._barOffset=this.points()[1].index-this.points()[0].index)}setLastPoint(e){var t=super.setLastPoint(e);return 2===this.points().length&&this._calculateBarOffset(),t}setPoint(e,t){switch(e){case 0:super.setPoint(e,t),this._calculateBarOffset();break;case 1:var i=this.properties();if(!i.wordWrapWidth)return;var r=this._points,n=this._dragStartLeftEdgeIndex,s=Math.round((t.index-n)/2);if(isFinite(n)&&isFinite(s)){r[1]={index:n+s,price:r[1].price},this._calculateBarOffset(),this.normalizePoints();var o=this._timeScale.indexToCoordinate(n+2*s)-this._timeScale.indexToCoordinate(n)-a.RoundRadius-a.TextMargins;if(!isFinite(o))return;i.wordWrapWidth.setValue(Math.max(a.MinWidth,o));break}r[1]=t,this._calculateBarOffset(),this.normalizePoints()}}setPoints(e){super.setPoints(e);var t=this.properties();if(t.wordWrapWidth){var i=this._dragStartLeftEdgeIndex,r=Math.round((e[1].index-i)/2);if(this._calculateBarOffset(),this.normalizePoints(),isFinite(i)&&isFinite(r)){var n=this._timeScale.indexToCoordinate(i+2*r)-this._timeScale.indexToCoordinate(i)-a.RoundRadius-a.TextMargins;if(!isFinite(n))return;t.wordWrapWidth.setValue(Math.max(a.MinWidth,n))}}}_onPointsetUpdated(e){super._onPointsetUpdated(e),0!==e.length&&(this._dragStartLeftEdgeIndex=this.points()[1].index)}move(e,t,i){super.move(e,t,i),this._calculateBarOffset()}state(e){var t=n.prototype.state.call(this,e);return t.barOffset=this._barOffset,t}restoreData(e){e.barOffset?this._barOffset=e.barOffset:this._calculateBarOffset(),this._calculatePoint2()}setPriceScale(e){s.prototype.setPriceScale.call(this,e),e&&e.priceRange()&&this._calculatePoint2()}template(){var e=n.prototype.template.call(this);return e.text=this.properties().childs().text.value(),e}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_calculatePoint2(){if(!(this._model.lineBeingEdited()===this||this._model.sourcesBeingMoved().includes(this)||this._points.length<2)){var e=this.points()[0],t=this.points()[1];this._points[1]={price:t.price,index:e.index+this._barOffset}}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,39428))).CalloutDefinitionsViewModel}
static createProperties(e){var t=new l("linetoolcallout",e);return h._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e),e.hasChild("text")||e.addChild("text",new o(r("Text"))),e.addExclusion("text"),e.addChild("textsColors",new c([e.childs().color]))}}t.LineToolCallout=h},47373:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,5184,19)).then(({LineToolCircleLinesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 2}name(){return"Cyclic Lines"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,64500))).CyclicAndSineLinesPatternDefinitionsViewModel}static createProperties(e){var t=new n("linetoolcirclelines",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolCircleLines=s},97314:(e,t,i)=>{i.d(t,{LineToolCircle:()=>o});var r=i(46090),n=i(24145),s=i(24146);class o extends n.LineDataSource{constructor(e,t){const r=t||o.createProperties();super(e,r),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,53622)).then(({CirclePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)})}pointsCount(){return 2}name(){return"Circle"}static createProperties(e){const t=new r.DefaultProperty("linetoolcircle",e);return o._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,80717))).GeneralFiguresDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([e.childs().color])),e.addChild("linesWidths",new s.LineToolWidthsProperty([e.childs().linewidth])),e.addChild("backgroundsColors",new s.LineToolColorsProperty([e.childs().backgroundColor])),e.addExclusion("linesColors"),e.addExclusion("linesWidths"),e.addExclusion("backgroundsColors")}}},41527:(e,t,i)=>{i.d(t,{LineToolCrossLine:()=>l});var r=i(46090),n=i(67001),s=i(44234),o=i(24145);class l extends o.LineDataSource{constructor(e,t,r,o){super(e,t||l.createProperties(),r,o),this._priceAxisView=new n.LineToolHorzLinePriceAxisView(this),this._timeAxisView=new s.LineToolVertLineTimeAxisView(this),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,20197)).then(({CrossLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 1}name(){return"Cross Line"}priceAxisViews(e,t){return this.isSourceHidden()?null:t===this.priceScale()&&this.properties().childs().showPrice.value()&&this._model.paneForSource(this)===e?[this._priceAxisView]:null}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(){super.updateAllViews(),this._priceAxisView.update(),this._timeAxisView.update()}canHasAlert(){return!1}lineColor(){
return this.properties().childs().linecolor.value()}lineWidth(){return this.properties().childs().linewidth.value()}lineStyle(){return this.properties().childs().linestyle.value()}static createProperties(e){const t=new r.DefaultProperty("linetoolcrossline",e);return l._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,17078)).then(e=>e.CrossLineDefinitionsViewModel)}static _configureProperties(e){o.LineDataSource._configureProperties(e)}}},13647:(e,t,i)=>{i.d(t,{CustomEventItem:()=>s,LineToolCustomUrlEvent:()=>o});var r=i(88537),n=i(74993);class s{constructor(e){this._source=e}position(){return this._props().childs().position.value()}_props(){return this._source.properties()}}class o extends n.LineToolWithRelativePriceCoordinate{constructor(){super(...arguments),this._item=null,this._eventTimePointIndex=null}pointsCount(){return 1}cloneable(){return!1}eventTimePointIndex(){return this._eventTimePointIndex}customEvent(){return this._item}restorePoints(e,t,i){i&&t.length>0&&(this._eventTimePointIndex=t[0].index),super.restorePoints(e,t,i)}priceAxisPoints(){return[]}_baseSeriesIndexForPoint(e){var t;return null!==(t=this._eventTimePointIndex)&&void 0!==t?t:e.index}_alignPointHorizontallyOrVertically(e){var t,i;if(null===this._eventTimePointIndex)return e;const n=this._points[0].index-this._eventTimePointIndex,s=(0,r.ensure)(null===(i=null===(t=this._startMovingPoint)||void 0===t?void 0:t.logical)||void 0===i?void 0:i.index)-n;return{price:e.price,index:s}}_snapPoint45Degree(e,t,i){this._eventTimePointIndex&&(e.index=this._eventTimePointIndex)}_snapTo45DegreesAvailable(){return!0}_allowChangeAnchorHorizontally(){return!0}_pointsForPointset(){return[[(0,r.ensureNotNull)(this._item).time(),0],...super._pointsForPointset()]}_onPointsetUpdated(e){if(0===e.length)return;const t=e.findIndex(e=>0===e.index);-1!==t&&(this._eventTimePointIndex=e[t].value[0]);const i=e.slice(1).map(e=>({value:e.value,index:e.index-1}));super._onPointsetUpdated(i)}_readyToCreatePointset(){return super._readyToCreatePointset()&&null!==this._item}}},9562:(e,t,i)=>{i.d(t,{LineToolCypherPattern:()=>s});var r=i(21595),n=i(46090);class s extends r.LineTool5PointsPattern{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Cypher Pattern"}static createProperties(e){const t=new n.DefaultProperty("linetoolcypherpattern",e);return s._configureProperties(t),t}_loadPaneViews(e){Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,56460)).then(t=>{this._setPaneViews([new t.CypherPaneView(this,e)])})}static _configureProperties(e){r.LineTool5PointsPattern._configureProperties(e)}}},67498:(e,t,i)=>{i.d(t,{LineToolDateAndPriceRange:()=>l});var r=i(88537),n=i(46090),s=i(24145),o=i(62203);class l extends s.LineDataSource{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._volumeCalculator=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,65440)).then(e=>{this._setPaneViews([new e.DateAndPriceRangePaneView(this,this._model)])})}destroy(){
super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date and Price Range"}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new o.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=new n.DefaultProperty("linetooldateandpricerange",e);return l._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,50152))).GeneralDatePriceRangeDefinitionsViewModel}static _configureProperties(e){s.LineDataSource._configureProperties(e)}}},28812:(e,t,i)=>{i.d(t,{LineToolDateRange:()=>l});var r=i(88537),n=i(46090),s=i(24145),o=i(62203);class l extends s.LineDataSource{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._volumeCalculator=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,34481)).then(e=>{this._setPaneViews([new e.DateRangePaneView(this,this._model)])})}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date Range"}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new o.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=new n.DefaultProperty("linetooldaterange",e);return l._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,50152))).GeneralDatePriceRangeDefinitionsViewModel}static _configureProperties(e){s.LineDataSource._configureProperties(e)}}},97364:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),this.version=s.version,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,13463,19)).then(({DisjointChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 3}name(){return"Disjoint Channel"}hasEditableCoordinates(){return!1}addPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),r.prototype.addPoint.call(this,e)}setLastPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),r.prototype.setLastPoint.call(this,e)}setPoint(e,t,i){var r=.5*(this._points[1].price+this._points[2].price);if(i&&i.shift()&&1===e){this._snapPoint45Degree(t,this.points()[0])}if(e<3&&super.setPoint(e,t),0!==e&&2!==e){if(1===e){var n=this._points[1].price-r;this._points[2].price=this._points[1].price-2*n}else if(3===e){
n=t.price-this._points[2].price;this._points[0].price=this._points[1].price-n,this._points[0].index=t.index}this.normalizePoints()}}getPoint(e){if(e<3)return r.prototype.getPoint.call(this,e);var t=this._points[0].price-this._points[2].price;return{index:this._points[0].index,price:this._points[1].price-t}}canHasAlert(){return!0}_getAlertPlots(){var e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));var r=this._points[2];r.time=t.time,r.index=t.index;var n,s,o,l,a={price:r.price+(t.price-e.price),time:e.time,index:e.index},c=[];r.index<=a.index?(c.push(r),c.push(a)):(c.push(a),c.push(r)),i[0].price>c[0].price?(n=i,s=c):c[0].price>i[0].price||c[1].price>i[1].price?(n=c,s=i):(n=i,s=c);var h=this.properties().extendLeft.value(),u=this.properties().extendRight.value();return e.index<=t.index?(o=h,l=u):(o=u,l=h),[this._linePointsToAlertPlot(n,"Upper",o,l),this._linePointsToAlertPlot(s,"Lower",o,l)]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,90743))).GeneralTrendFiguresDefinitionsViewModel}static createProperties(e){var t=new n("linetooldisjointangle",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}s.version=1,t.LineToolDisjointChannel=s},61708:(e,t,i)=>{i.d(t,{LineToolElliott:()=>d,LineToolElliottImpulse:()=>P,LineToolElliottTriangle:()=>v,LineToolElliottTripleCombo:()=>f,LineToolElliottCorrection:()=>T,LineToolElliottDoubleCombo:()=>S});var r=i(87236),n=i(77036),s=i(24145),o=i(29770),l=i(46090),a=i(24146);const c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],h=new n.TranslatedString("change Elliott degree",(0,r.t)("change Elliott degree")),u=[{value:0,title:(0,r.t)("Supermillennium")},{value:1,title:(0,r.t)("Millennium")},{value:2,title:(0,r.t)("Submillennium")},{value:3,title:(0,r.t)("Grand supercycle")},{value:4,title:(0,r.t)("Supercycle")},{value:5,title:(0,r.t)("Cycle")},{value:6,title:(0,r.t)("Primary")},{value:7,title:(0,r.t)("Intermediate")},{value:8,title:(0,r.t)("Minor",{context:"wave"})},{value:9,title:(0,r.t)("Minute",{context:"wave"})},{value:10,title:(0,r.t)("Minuette")},{value:11,title:(0,r.t)("Subminuette")},{value:12,title:(0,r.t)("Micro")},{value:13,title:(0,r.t)("Submicro")},{value:14,title:(0,r.t)("Minuscule")}];class d extends s.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:d.createProperties(),r,n),this.version=4,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,20203)).then(e=>{this._setPaneViews([new e.ElliottLabelsPaneView(this,this._model)])})}migrateVersion(e,t,i){if(i.properties.hasChild("background")&&i.properties.removeProperty("background"),i.properties.hasChild("backgroundColor")&&i.properties.removeProperty("backgroundColor"),i.properties.hasChild("showBackground")&&i.properties.removeProperty("showBackground"),1===e){const e=Object.assign({},this._timePoint[0]);if(this._timePoint.unshift(e),this._points.length>0){const e=Object.assign({},this._points[0]);this._points.unshift(e)}}}applyTemplate(e){const t=e
;delete t.background,delete t.backgroundColor,delete t.showBackground,super.applyTemplate(e)}name(){return"Elliott Labels"}additionalActions(e){return[new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",label:(0,r.t)("Degree"),subItems:c.map(t=>{const i=u.filter(e=>e.value===t)[0];return new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",label:i.title,checkable:!0,checked:this.properties().childs().degree.value()===t,onExecute:()=>{e.setProperty(this.properties().childs().degree,t,h)}})})})]}label(e){const t=c.length-this.properties().childs().degree.value()-1,i=Math.floor(t/3);return{group:i,bold:!!(i%2),decoration:["","brackets","circle"][t%3],label:this.labelsGroup()[i][e]}}availableDegreesValues(){return u}static createProperties(e){const t=new l.DefaultProperty("linetoolelliott",e);return d._configureProperties(t),t}static migrateState(e){const t={0:11,1:10,2:9,3:8,4:7,5:6,6:5,7:4,8:3},i={0:11,1:8};"LineToolElliottSubminuette"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinor"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottCircle"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize]),"LineToolElliottMajorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize])}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,30139))).ElliottPatternDefinitionsViewModel}static _configureProperties(e){s.LineDataSource._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addExclusion("linesColors")}}class p extends d{pointsCount(){return 6}static _configureProperties(e){d._configureProperties(e)}}const _=[["0","1","2","3","4","5"],["0","i","ii","iii","iv","v"],["0","1","2","3","4","5"],["0","I","II","III","IV","V"],["0","1","2","3","4","5"]];class P extends p{constructor(e,t){super(e,t||P.createProperties())}name(){return"Elliott Impulse Wave (12345)"}labelsGroup(){return _}static createProperties(e){const t=new l.DefaultProperty("linetoolelliottimpulse",e);return P._configureProperties(t),t}static _configureProperties(e){p._configureProperties(e)}}const g=[["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"]];class v extends p{constructor(e,t){super(e,t||v.createProperties())}name(){return"Elliott Triangle Wave (ABCDE)"}labelsGroup(){return g}static createProperties(e){const t=new l.DefaultProperty("linetoolelliotttriangle",e);return v._configureProperties(t),t}static _configureProperties(e){p._configureProperties(e)}}const m=[["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"]];class f extends p{constructor(e,t){super(e,null!=t?t:f.createProperties())}name(){
return"Elliott Triple Combo Wave (WXYXZ)"}labelsGroup(){return m}static createProperties(e){const t=new l.DefaultProperty("linetoolelliotttriplecombo",e);return f._configureProperties(t),t}static _configureProperties(e){p._configureProperties(e)}}class C extends d{pointsCount(){return 4}static _configureProperties(e){d._configureProperties(e)}}const y=[["0","A","B","C"],["0","a","b","c"],["0","A","B","C"],["0","a","b","c"],["0","A","B","C"]];class T extends C{constructor(e,t){super(e,null!=t?t:T.createProperties())}name(){return"Elliott Correction Wave (ABC)"}labelsGroup(){return y}static createProperties(e){const t=new l.DefaultProperty("linetoolelliottcorrection",e);return T._configureProperties(t),t}static _configureProperties(e){C._configureProperties(e)}}const w=[["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"]];class S extends C{constructor(e,t){super(e,null!=t?t:S.createProperties())}name(){return"Elliott Double Combo Wave (WXY)"}labelsGroup(){return w}static createProperties(e){const t=new l.DefaultProperty("linetoolelliottdoublecombo",e);return S._configureProperties(t),t}static _configureProperties(e){C._configureProperties(e)}}},46913:(e,t,i)=>{i.d(t,{LineToolEllipse:()=>c});var r=i(88537),n=i(4652),s=i(86441),o=i(24145),l=i(46090),a=i(24146);class c extends o.LineDataSource{constructor(e,t,r,n){super(e,t||c.createProperties(),r,n),this.version=2,this._dist=null,this._fakePointAdded=!1,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,33587)).then(({EllipsePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,n.distanceToLine)(e,t,i).distance||0}}addPoint(e,t,i){const r=o.LineDataSource.prototype.addPoint.call(this,e,t,i);return r&&(this._fakePointAdded=!1),r}setPoint(e,t,i,o){const l={...t};let a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),c=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),h=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));switch(e){case 0:{if(i&&i.shift()){this._snapPoint45Degree(l,this._points[1]),this._points[0]=l,this._points[2]=this._preparePointInternal(this._points[2],i,!0),this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[0],this._points[1],this._points[2]);break}a=(0,r.ensureNotNull)(this.pointToScreenPoint(l));const e=c.subtract(a),t=a.add(c).scaled(.5),n=new s.Point(-e.y,e.x).normalized();h=t.add(n.scaled((0,r.ensureNotNull)(this._dist))),this._points[0]=l,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}case 1:{if(i&&i.shift()){this._snapPoint45Degree(l,this._points[0]),this._points[1]=l,this._points[2]=this._preparePointInternal(this._points[2],i,!0),
this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[1],this._points[0],this._points[2]);break}c=(0,r.ensureNotNull)(this.pointToScreenPoint(l));const e=c.subtract(a),t=a.add(c).scaled(.5),n=new s.Point(-e.y,e.x).normalized();h=t.add(n.scaled((0,r.ensureNotNull)(this._dist))),this._points[1]=l,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}case 2:{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),t=(0,n.distanceToLine)(a,c,e).distance,i=c.subtract(a),o=a.add(c).scaled(.5),u=new s.Point(-i.y,i.x).normalized();h=o.add(u.scaled(t)),this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}case 3:{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),t=(0,n.distanceToLine)(a,c,e).distance,i=c.subtract(a),o=a.add(c).scaled(.5),u=new s.Point(-i.y,i.x).normalized();h=o.add(u.scaled(t)),this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}}this.normalizePoints()}pointsCount(){return 3}name(){return"Ellipse"}hasEditableCoordinates(){return!1}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._points[0].price,t=.5*(this._points[0].price+this._points[1].price);this._points[0]={price:t,index:this._points[0].index},this._points[1]={price:t,index:this._points[1].index},this._points.push({price:e,index:this._points[0].index})}if(1===e&&2===this._timePoint.length){const e=this._timePoint[0].price,t=.5*(this._timePoint[0].price+this._timePoint[1].price);this._timePoint[0].price=t,this._timePoint[1].price=t;const i={price:e,offset:this._timePoint[0].offset,time_t:this._timePoint[0].time_t};this._timePoint.push(i)}}static createProperties(e){const t=new l.DefaultProperty("linetoolellipse",e);return c._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,80717))).GeneralFiguresDefinitionsViewModelBase}_preparePoint(e,t){const i=this._preparePointInternal(e,t,!1);return t&&t.shift()&&this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[1],this._points[0],i),i}static _configureProperties(e){o.LineDataSource._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}_preparePointInternal(e,t,i){let n={...e};if(t&&t.shift()){const t=this.points().length;if(!this._fakePointAdded&&3===t&&!i)return n;if(this._fakePointAdded||2===t||i){this._snapPoint45Degree(e,this._points[0]),this._fakePointAdded?this._points[1]=e:i||(this._fakePointAdded=!0,super._addPointIntenal(e));const t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),l=o.x-t.x,a=o.y-t.y,c=Math.sqrt(l*l+a*a)/2,h=o.subtract(t),u=t.add(o).scaled(.5),d=new s.Point(-h.y,h.x).normalized(),p=u.add(d.scaled(c));n=(0,r.ensureNotNull)(this.screenPointToPoint(p)),(isNaN(n.price)||isNaN(n.index))&&(n=(0,r.ensureNotNull)(this.screenPointToPoint(u)))}}else this._fakePointAdded&&(this._points.splice(1,1),this._fakePointAdded=!1);return n}
_fixVerticalDiameterPoints(e,t,i){const n=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),o=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=this._model.timeScale(),a=l.indexToCoordinate(e.index),c=l.indexToCoordinate(i.index);let h=2*Math.abs(a-c);h*=t.price>e.price?1:-1,e.price=(0,r.ensureNotNull)(this.screenPointToPoint(new s.Point(n.x,o.y+h))).price}}},72353:(e,t,i)=>{var r=i(39195).LineToolTrendLine,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Extended Line"}static createProperties(e){var t=new n("linetoolextended",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolExtended=s},28901:(e,t,i)=>{i.d(t,{LineToolFibChannel:()=>h});var r=i(88537),n=i(87236),s=i(77036),o=i(24145),l=i(55827),a=i(24146);const c=new s.TranslatedString("erase level line",(0,n.t)("erase level line"));class h extends o.LineDataSource{constructor(e,t,r,n){super(e,t||h.createProperties(),r,n),this.version=2,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,47329)).then(({FibChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return 24}migrateVersion(e,t,i){i.properties.removeProperty("reverse")}pointsCount(){return 3}name(){return"Fib Channel"}processErase(e,t){const i="level"+t,r=this.properties().child(i).childs().visible;e.setProperty(r,!1,c)}static createProperties(e){const t=new l.LevelsProperty("linetoolfibchannel",e,!1,{range:[1,24],names:["coeff","color","visible"]});return h._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,26457))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){o.LineDataSource._configureProperties(e);const t=[];for(let i=1;i<=24;i++){const n=(0,r.ensureDefined)(e.child("level"+i));t.push((0,r.ensureDefined)(n.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(t))}}},51651:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,96763,19)).then(({FibCirclesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 2}name(){return"Fib Circles"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}static createProperties(e){var t=new o("linetoolfibcircles",e,!1,{range:[1,11]});return u._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,8086))).FibCirclesDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){s._configureProperties(e)
;for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.LevelsCount=11,t.LineToolFibCircles=u},45914:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(55827).LevelsProperty,o=i(24145).LineDataSource,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends o{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=u.version,this._properties._stateVersion=1,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,16858,19)).then(({FibRetracementPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 2}name(){return"Fib Retracement"}migrateVersion(e,t,i){1===e&&this.properties().extendLines.setValue(!0)}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,26457))).FibDrawingsWith24LevelsDefinitionsViewModel}static createProperties(e){var t=new s("linetoolfibretracement",e,!1,{range:[1,24],names:["coeff","color","visible"]});return u._configureProperties(t),t}static _configureProperties(e){o._configureProperties(e);for(var t=[e.child("trendline").child("linewidth"),e.child("levelsStyle").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=u.LevelsCount;r++)i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}fibLevelsBasedOnLogScale(){return this.properties().fibLevelsBasedOnLogScale.value()&&this.priceScale().isLog()}}u.version=2,u.LevelsCount=24,t.LineToolFibRetracement=u},3971:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,27866)).then(({FibSpeedResistanceArcsPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 2}name(){return"Fib Speed Resistance Arcs"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}static createProperties(e){var t=new o("linetoolfibspeedresistancearcs",e,!1,{range:[1,11]});return u._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,37333))).FibSpeedResistanceArcsDefinitionsViewModel}static _configureProperties(e){s._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),
i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.LevelsCount=11,t.LineToolFibSpeedResistanceArcs=u},58237:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146).LineToolColorsProperty,a=new n("erase level line",r("erase level line"));class c extends s{constructor(e,t,r,n){super(e,t||c.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,65491)).then(({FibSpeedResistanceFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}hLevelsCount(){return c.HLevelsCount}vLevelsCount(){return c.VLevelsCount}pointsCount(){return 2}name(){return"Fib Speed Resistance Fan"}processErase(e,t){var i="h"===t.type?"hlevel"+t.index:"vlevel"+t.index,r=this.properties()[i].visible;e.setProperty(r,!1,a)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,82868))).FibSpeedResistanceFanDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){void 0!==e&&void 0===e.reverse&&(e.reverse=!0);var t=new o("linetoolfibspeedresistancefan",e,!1,{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]});return c._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e);var t=[e.child("grid").child("color")];for(let i=1;i<=c.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(let i=1;i<=c.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new l(t)),e.addExclusion("linesColors")}}c.HLevelsCount=7,c.VLevelsCount=7,t.LineToolFibSpeedResistanceFan=c},39242:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,54298)).then(({FibSpiralPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 2}name(){return"Fib Spiral"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,37355))).FibSpiralDefinitionsViewModel}static createProperties(e){var t=new n("linetoolfibspiral",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolFibSpiral=s},58500:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=u.version,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,28618,19)).then(({FibTimeZonePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}migrateVersion(e,t,i){if(1===e){i.properties.level1.color.setValue(i.properties.baselinecolor.value());for(var r=2;r<=11;r++)i.properties["level"+r].color.setValue(i.properties.linecolor.value())
;for(r=1;r<=11;r++)i.properties["level"+r].linewidth.setValue(i.properties.linewidth.value()),i.properties["level"+r].linestyle.setValue(i.properties.linestyle.value())}}pointsCount(){return 2}name(){return"Fib Time Zone"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,52752))).FibTimezoneDefinitionsViewModel}static createProperties(e){var t=new o("linetoolfibtimezone",e,!1,{range:[1,11]});return u._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e);for(var t=[],i=[],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));for(t=[],i=[],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.version=2,u.LevelsCount=11,t.LineToolFibTimeZone=u},44040:(e,t,i)=>{i.d(t,{LineToolFibWedgeBase:()=>o});var r=i(88537),n=i(86441),s=i(24145);class o extends s.LineDataSource{pointsCount(){return 3}hasEditableCoordinates(){return!1}setPoint(e,t){if(super.setPoint(e,t),!this._recursiveGuard)try{if(this._recursiveGuard=!0,2===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0]));let t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));const i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2])).subtract(e).length();let s=t.subtract(e);s.length()<=0&&(s=new n.Point(1,0)),t=e.add(s.normalized().scaled(i));const o=(0,r.ensureNotNull)(this.screenPointToPoint(t)),l=this._pointsProperty.childs().points[1];l.childs().price.setValue(o.price),l.childs().bar.setValue(o.index)}else{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));const s=t.subtract(e).length();let o=i.subtract(e);o.length()<=0&&(o=new n.Point(1,0)),i=e.add(o.normalized().scaled(s));const l=(0,r.ensureNotNull)(this.screenPointToPoint(i)),a=this._pointsProperty.childs().points[2];a.childs().price.setValue(l.price),a.childs().bar.setValue(l.index)}}finally{this._recursiveGuard=!1}}addPoint(e){if(2===this._points.length){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let n=(0,r.ensureNotNull)(this.pointToScreenPoint(e));const s=i.subtract(t).length(),o=n.subtract(t).normalized();n=t.add(o.scaled(s));const l=(0,r.ensureNotNull)(this.ownerSource()),a=(0,r.ensureNotNull)(l.firstValue()),c=(0,r.ensureNotNull)(this.priceScale()).coordinateToPrice(n.y,a);e={index:Math.round(this._model.timeScale().coordinateToIndex(n.x)),price:c}}return s.LineDataSource.prototype.addPoint.call(this,e)}}},24615:(e,t,i)=>{
var r=i(87236).t,n=i(77036).TranslatedString,s=i(44040).LineToolFibWedgeBase,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,57257,19)).then(({FibWedgePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}isSynchronizable(){return!1}levelsCount(){return u.LevelsCount}name(){return"Fib Wedge"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}static createProperties(e){var t=new o("linetoolfibwedge",e,!1,{range:[1,11]});return u._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,81037))).FibWedgeDefinitionsViewModel}static _configureProperties(e){s._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.LevelsCount=11,t.LineToolFibWedge=u},20874:(e,t,i)=>{i.d(t,{LineToolFlagMark:()=>l});var r=i(86441),n=i(24145),s=i(46090),o=i(24146);class l extends n.LineDataSource{constructor(e,t,n,s){super(e,t||l.createProperties(),n,s),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,29884)).then(({FlagMarkPaneView:e})=>{const t=new e(this,this.model());t.setAnchors(new r.Point(0,0)),this._setPaneViews([t])})}pointsCount(){return 1}name(){return"Flag Mark"}static createProperties(e){e&&void 0===e.flagColor&&(e.flagColor="#318757");const t=new s.DefaultProperty("linetoolflagmark",e);return l._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,89695)).then(e=>e.FlagMarkDefinitionsViewModel)}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.addChild("backgroundsColors",new o.LineToolColorsProperty([e.childs().flagColor])),e.addExclusion("backgroundsColors")}}l.version=2},5047:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),this.version=s.version,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,44157,19)).then(({FlatBottomPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 3}name(){return"Flat Bottom"}hasEditableCoordinates(){return!1}addPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),r.prototype.addPoint.call(this,e)}setLastPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),r.prototype.setLastPoint.call(this,e)}setPoint(e,t,i){if(i&&i.shift()&&1===e){this._snapPoint45Degree(t,this.points()[0])}
if(2===e)this._points[1].index=t.index;else if(3===e)return this._points[0].index=t.index,this._points[2].price=t.price,void this.normalizePoints();super.setPoint(e,t)}getPoint(e){return e<3?r.prototype.getPoint.call(this,e):3===e?{index:this._points[0].index,price:this._points[2].price}:void 0}canHasAlert(){return!0}_getAlertPlots(){var e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));var r=this._points[2];r.time=t.time,r.index=t.index;var n,s,o,l,a={price:r.price,time:e.time,index:e.index},c=[];r.index<=a.index?(c.push(r),c.push(a)):(c.push(a),c.push(r)),i[0].price>c[0].price?(n=i,s=c):c[0].price>i[0].price||c[1].price>i[1].price?(n=c,s=i):(n=i,s=c);var h=this.properties().extendLeft.value(),u=this.properties().extendRight.value();return e.index<=t.index?(o=h,l=u):(o=u,l=h),[this._linePointsToAlertPlot(n,"Upper",o,l),this._linePointsToAlertPlot(s,"Lower",h,l)]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,90743))).GeneralTrendFiguresDefinitionsViewModel}static createProperties(e){var t=new n("linetoolflatbottom",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}s.version=1,t.LineToolFlatBottom=s},28584:(e,t,i)=>{i.d(t,{createPropertiesObject:()=>l});var r=i(70617),n=i(55827);function s(e,t,i){var n;for(const s of Object.keys(null!==(n=e.levels)&&void 0!==n?n:{}))if(e.levels[s]&&(0,r.isSameType)(e.levels[s],t.typecheck())){let r=t.tpl();i.names.forEach((i,n)=>{r=t.fill(""+n,i,e.levels[s],r)}),e.levels[s]=r}return e}class o extends n.LevelsProperty{constructor(e,t){super(e,t,!1,{names:["width","color","visible"]},s)}}function l(e,t){return new o(e,t)}},48807:(e,t,i)=>{i.d(t,{LineToolGannComplex:()=>u});var r=i(86441),n=i(88537),s=i(96484),o=i(24145),l=i(10196),a=i(28584),c=i(24146),h=i(88427);class u extends o.LineDataSource{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=2,this._scaleRatioFormatter=new s.LimitedPrecisionNumericFormatter(7),this.version=2,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,99175)).then(({GannComplexPaneView:e})=>{this._setPaneViews([new e(this,this.model())])});const o=this.properties();this._adjustScaleRatio(o),o.subscribe(this,this._adjustScaleRatio),o.childs().scaleRatio.subscribe(this,this._correctFirstPoint),this._syncStateExclusions=["scaleRatio"],o.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.subscribe(this,this._handleTemplateApplying),this._onTemplateApplied.subscribe(this,this._correctFirstPoint)}migrateVersion(e,t,i){1===e&&(this._points.length>=this.pointsCount()?setTimeout(()=>this._migratePoint()):this._timePoint.length>=this.pointsCount()&&this._pointAdded.subscribe(this,this._migratePoint))}destroy(){const e=this.properties();e.unsubscribe(this,this._adjustScaleRatio),e.childs().scaleRatio.unsubscribe(this,this._correctFirstPoint),e.onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),
this._onTemplateApplying.unsubscribe(this,this._handleTemplateApplying),this._onTemplateApplied.unsubscribe(this,this._correctFirstPoint),super.destroy()}pointsCount(){return 2}name(){return"Gann Square"}addPoint(e,t,i){this._points.length>1&&this._points.pop();const r=super.addPoint(e,t,i),s=this.priceScale();return!(0,n.ensureNotNull)(s).isLog()&&r&&this._correctFirstPoint(),r}setPoint(e,t,i){super.setPoint(e,t,i),void 0!==i&&i.shift()?this._correctPoint(e):this._correctScaleRatio()}setLastPoint(e,t){const i=this.priceScale();return(0,n.ensureNotNull)(i).isLog()||(this._points[1]=e,this._correctPoint(1)),super.setLastPoint(e,t)}isReversed(){return this.properties().childs().reverse.value()}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}isLabelsVisible(){return this.properties().childs().showLabels.value()}getLabelsStyle(){const e=this.properties().childs(),{fontSize:t,bold:i,italic:r}=e.labelsStyle.childs(),n=e.levels.childCount();return{textColor:e.levels.childs()[n-1].childs().color.value(),font:h.CHART_FONT_FAMILY,fontSize:t.value(),bold:i.value(),italic:r.value()}}getScaleRatioStep(){return 1e-7}getScaleRatioFormatter(){return this._scaleRatioFormatter}getPriceDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.price-t.price}getIndexDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.index-t.index}getScaleRatio(){const e=this.getPriceDiff(),t=this.getIndexDiff();return null!==e&&null!==t&&0!==t?Math.abs(e/t):null}static createProperties(e){const t=(0,a.createPropertiesObject)("linetoolganncomplex",e);return u._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,29997)).then(e=>e.GannComplexAndFixedDefinitionsViewModel)}static _configureProperties(e){o.LineDataSource._configureProperties(e),e.addExclusion("scaleRatio");const t=[],i=[],r=e.childs();{const e=r.levels.childCount()
;for(let n=0;n<e;n++){const e=r.levels.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let n=0;n<e;n++){const e=r.fanlines.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let n=0;n<e;n++){const e=r.arcs.childs()[n].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}_correctScaleRatio(){const e=this.properties().childs(),t=this.getScaleRatio();e.scaleRatio.setValue(t)}_getAdjustedScaleRatio(){const e=this.model().mainSeries().priceScale(),t=this.model().timeScale();return(0,l.scaleRatio)(t,e)}_adjustScaleRatio(e){const t=e.scaleRatio.value();""!==t&&null!==t||e.scaleRatio.setValue(this._getAdjustedScaleRatio())}_correctPoint(e){if(this._points.length<2)return;const t=this.getIndexDiff();if(null===t)return;const i=this.properties().childs().scaleRatio.value();if(null!==i){const r=this._points[e],n=0===e?this._points[1]:this._points[0],s=r.price-n.price>0,o=r.index-n.index>0;let l=s&&!o||!s&&o?-1:1;0===e&&(l=-l),r.price=n.price+l*t*i,this._pointChanged.fire(e)}this.normalizePoints()}_correctFirstPoint(){this._correctPoint(this.isReversed()?0:1)}_handleRestoringFactoryDefaults(){this.properties().childs().scaleRatio.setValue(this._getAdjustedScaleRatio())}_handleTemplateApplying(e){""===e.scaleRatio&&(e.scaleRatio=this._getAdjustedScaleRatio())}_migratePoint(){if(this.points().length<this.pointsCount())return;const e=this._getScreenPoints();if(null===e)return;const t=(0,n.ensureNotNull)(this.screenPointToPoint(e[1]));this.setPoint(1,t),this._pointAdded.unsubscribe(this,this._migratePoint)}_getScreenPoints(){const e=this._calcAngle();if(null===e)return null;let[t,i]=this.points();this.isReversed()&&([t,i]=[i,t]);const s=(0,n.ensureNotNull)(this.pointToScreenPoint(t)),o=(0,n.ensureNotNull)(this.pointToScreenPoint(i)),l=Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2)),a=new r.Point(Math.cos(e),-Math.sin(e)),c=a.normalized(),h=c.x<0?-1:1,u=c.y<0?-1:1;return[s.addScaled(a,l),s.add(new r.Point(5*l*h,5*l*u))]}_calcAngle(){const[e,t]=this.points(),i=(0,n.ensureNotNull)(this.pointToScreenPoint(e));let r=(0,n.ensureNotNull)(this.pointToScreenPoint(t)).subtract(i);if(r.length()>0){r=r.normalized();let e=Math.acos(r.x);return r.y>0&&(e=-e),e}return null}}},73949:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,34501)).then(({GannFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 2}name(){return"Gann Fan"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,88222))).GannFanDefinitionsViewModel}static createProperties(e){var t=new o("linetoolgannfan",e,!1,{range:[1,9]});return u._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e);for(var t=[],i=[],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.LevelsCount=9,t.LineToolGannFan=u},33091:(e,t,i)=>{i.d(t,{LineToolGannFixed:()=>a});var r=i(86441),n=i(88537),s=i(24145),o=i(24146),l=i(28584);class a extends s.LineDataSource{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),this._constructor="LineToolGannFixed",Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,80997)).then(({GannFixedPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}),this.properties().childs().reverse.subscribe(this,this._reversePoints)}pointsCount(){return 2}name(){return"Gann Square Fixed"}axisPoints(){const e=this.points(),t=this.getScreenPoints();return e.length<2||t.length<2?[]:[e[0],(0,n.ensureNotNull)(this.screenPointToPoint(t[1]))]}getScreenPoints(){const e=this.points();if(e.length<2)return[];const t=this._calcAngle();if(null===t)return[];const[i,s]=e,o=(0,n.ensureNotNull)(this.pointToScreenPoint(i)),l=(0,n.ensureNotNull)(this.pointToScreenPoint(s)),a=Math.sqrt(Math.pow(o.x-l.x,2)+Math.pow(o.y-l.y,2)),c=new r.Point(Math.cos(t),-Math.sin(t)),h=c.normalized(),u=h.x<0?-1:1,d=h.y<0?-1:1;return[o.addScaled(c,a),o.add(new r.Point(5*a*u,5*a*d))]}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}static createProperties(e){const t=(0,l.createPropertiesObject)("linetoolgannfixed",e);return a._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,29997)).then(e=>e.GannComplexAndFixedDefinitionsViewModel)}static _configureProperties(e){
s.LineDataSource._configureProperties(e);const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let n=0;n<e;n++){const e=r.levels.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let n=0;n<e;n++){const e=r.fanlines.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let n=0;n<e;n++){const e=r.arcs.childs()[n].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new o.LineToolColorsProperty(i)),e.addChild("linesWidths",new o.LineToolWidthsProperty(t))}_calcAngle(){const e=this.points();if(e.length<2)return null;const[t,i]=e,r=this.pointToScreenPoint(t),n=this.pointToScreenPoint(i);if(null===r||null===n)return null;let s=n.subtract(r);if(s.length()<=0)return null;s=s.normalized();let o=Math.acos(s.x);return s.y>0&&(o=-o),o}_reversePoints(){const[e,t]=this._points;this._points[0]=t,this._points[1]=e,this.normalizePoints(),this.restart()}}},90345:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(55827).LevelsProperty,s=i(24146).LineToolColorsProperty,o=[4.5,9,11.25,18,22.5,36,45],l=function(){for(var e=[],t=o.length-1,i=1,r=0,n=0;n<1e10;)n=o[r]*i,e.push(Math.round(n)),e.push(Math.ceil(-n)),r===t-1&&(i*=10),r=(r+1)%t;return e.sort((function(e,t){return e<t?-1:e>t?1:0})),e}();class a extends r{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,36650,19)).then(({GannSquarePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}hLevelsCount(){return a.HLevelsCount}vLevelsCount(){return a.VLevelsCount}pointsCount(){return 2}name(){return"Gann Box"}_alignPriceOnPattern(e,t){var i=Math.round(1e6*(e.price-t.price))/1e6;if(0===i)return t.price;for(var r=o[0],n=o[o.length-1],s=1,l=Math.abs(i);l<r*s||n*s<l;)l<r*s?s*=.1:n*s<l&&(s*=10);for(var a=n*s,c=o.length-2;c>=0&&!(o[c]*s<l);--c)a=o[c]*s;return e.price=t.price+(i>=0?a:-a),e}_alignTimeOnPattern(e,t){var i=e.index-t.index;if(0===i)return 0;for(var r=l.length-2;r>=0&&!(l[r]<i);--r);return r+=i>0?1:0,e.index=t.index+l[r],e}_alignPointsFixedIncrement(e,t){return this._alignTimeOnPattern(e,t),this._alignPriceOnPattern(e,t),e}_preparePoint(e,t){return t&&t.shift()&&0!==this._points.length&&this._alignPointsFixedIncrement(e,this._points[0]),super._preparePoint(e,t)}getPoint(e){if(e<2)return super.getPoint(e);var t=null;switch(e){case 2:case 3:var i=this.points();if(i.length===this.pointsCount()){var r=i[0].index,n=i[1].price;3===e&&(r=i[1].index,n=i[0].price),t={index:r,price:n}}}return t}setPoint(e,t,i){if(i&&i.shift()){var r=e%2==0?this._points[1]:this._points[0];this._alignPointsFixedIncrement(t,r)}switch(e){case 2:this._points[0].index=t.index,this._points[1].price=t.price;break;case 3:this._points[1].index=t.index,this._points[0].price=t.price;break;default:super.setPoint(e,t,i)}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,73927))).GannSquareDefinitionsViewModel}static createProperties(e){var t=new n("linetoolgannsquare",e,!1,{range:[1,7],
prefixes:["h","v"],names:["coeff","color","visible"]});return a._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e);for(var t=[e.child("color"),e.child("fans").child("color")],i=1;i<=a.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(i=1;i<=a.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new s(t)),e.addExclusion("linesColors")}}a.HLevelsCount=7,a.VLevelsCount=7,t.LineToolGannSquare=a},18440:(e,t,i)=>{i.d(t,{LineToolGhostFeed:()=>a});var r=i(46090),n=i(24145),s=i(88537),o=i(70617);class l{constructor(e,t,i){this._source=e,this._segmentIndex=t,this._bars=null!=i?i:[]}setBars(e){this._bars=e}clone(e){return new l(e,this._segmentIndex,(0,o.clone)(this._bars))}generate(){this._bars=[];const e=this._source.points(),t=e[this._segmentIndex],i=e[this._segmentIndex+1];if(!t||!i||t.index===i.index)return;const r=this._segmentIndex?t.index+1:t.index,n=Math.sign(i.index-t.index);for(let e=r;e!==i.index;e+=n)this._bars.push(this._createBar())}bars(){return this._bars}setSize(e){if(e<this._bars.length)this._bars.splice(e,this._bars.length-e);else for(;this._bars.length<e;)this._bars.push(this._createBar())}_createBar(){const e=this._source.properties().averageHL.value(),t=this._source.properties().variance.value()/100,i=(0,s.ensureNotNull)(this._source.ownerSource()).base();let r=Math.random();const n=e*(1-2*r)*t;r=Math.random();const o=e*(1+(.5-r)*t),l=n-o/2,a=l+o;return{o:(l+Math.random()*o)/i,h:a/i,l:l/i,c:(l+Math.random()*o)/i}}}class a extends n.LineDataSource{constructor(e,t,r,n){const s=t||a.createProperties();if(super(e,s,r,n),this._segments=[],this._finished=!1,this._segmentsPixelsWhileMoving=null,!r){const e=Math.round(this._calculateATR());s.childs().averageHL.setValue(e)}s.childs().averageHL.listeners().subscribe(this,a.prototype._regenerate),s.childs().variance.listeners().subscribe(this,a.prototype._regenerate),this._currentAverageHL=s.childs().averageHL.value(),this._currentVariance=s.childs().variance.value(),this._currentInterval=e.mainSeries().interval(),this.properties().onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,60024)).then(t=>{this._setPaneViews([new t.GhostFeedPaneView(this,e)])})}isSynchronizable(){return!1}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),super.destroy()}propertiesChanged(){super.propertiesChanged(),this._currentAverageHL===this.properties().childs().averageHL.value()&&this._currentVariance===this.properties().childs().variance.value()||this._regenerate()}pointsCount(){return-1}name(){return"Ghost Feed"}segmentBars(e){return this._segments[e].bars()}segments(){return this._segments}generateBars(e){this._segments.length<=e&&this._segments.push(new l(this,e)),this._segments[e].generate()}addPoint(e,t,i){if(this._points.length>0){if(this._points[this._points.length-1].index===e.index){this._lastPoint=null,this.normalizePoints(),this.createServerPoints()
;for(let e=0;e<this._points.length;e++)this._createPointProperty(e);return!0}}const r=n.LineDataSource.prototype.addPoint.call(this,e);return this._finished&&(this._lastPoint=null),this._points.length>1&&this.generateBars(this._points.length-2),r||this._finished}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}setPoint(e,t,i,r){if(super.setPoint(e,t,i),e>0){const i=this.points()[e-1],r=t.index-i.index;this._segments[e-1].setSize(Math.abs(r))}if(e<this.points().length-1){const i=this.points()[e+1].index-t.index;this._segments[e].setSize(Math.abs(i))}}state(e){const t=n.LineDataSource.prototype.state.call(this,e);return t.segments=this._segments.map(e=>({bars:[...e.bars()]})),t}restoreData(e){e.segments&&(this._segments=e.segments.map((e,t)=>new l(this,t,e.bars))),this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value()}onData(e){super.onData(e);if(!this.pointsProperty().childs().points.child("0"))for(let e=0;e<this._points.length;e++)this._createPointProperty(e);this._currentInterval!==this._model.mainSeries().interval()&&(this._regenerate(),this._currentInterval=this._model.mainSeries().interval())}cloneData(e){this._segments=e._segments.map(e=>e.clone(this))}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._preparePixelSegments()}move(e,t,i,r){super.move(e,t,i,r),this._restoreSegmentsFromPixels()}endMoving(e,t){return this._segmentsPixelsWhileMoving=null,super.endMoving(e,t)}static createProperties(e){const t=new r.DefaultProperty("linetoolghostfeed",e);return a._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,28205))).GhostFeedDefinitionsViewModel}_handleRestoringFactoryDefaults(){const e=Math.round(this._calculateATR());this.properties().childs().averageHL.setValue(e)}_regenerate(){this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value(),this._segments.forEach(e=>e.generate()),this.updateAllViews(),this._model.updateSource(this)}_calculateATR(){const e=this._model.mainSeries(),t=[];e.bars().each((e,i)=>{const r=i[2],n=i[3];return null!=r&&null!=n&&t.push(r-n),!1});let i=0===t.length?0:t.reduce((e,t)=>e+t,0)/t.length;return i*=e.base(),i}_preparePixelSegments(){var e,t;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===r||i.isEmpty()||!i.isLog())return;const n=this.points();this._segmentsPixelsWhileMoving=this._segments.map((e,t)=>{const s=n[t].price,o=n[t+1].price,l=i.priceToCoordinate(s,r),a=(i.priceToCoordinate(o,r)-l)/(e.bars().length-1);return{bars:e.bars().map((e,t)=>{const n=l+t*a,s=i.coordinateToPrice(n,r);return{open:i.priceToCoordinate(s+e.o,r)-n,high:i.priceToCoordinate(s+e.h,r)-n,low:i.priceToCoordinate(s+e.l,r)-n,close:i.priceToCoordinate(s+e.c,r)-n}})}})}_restoreSegmentsFromPixels(){var e,t
;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===r||null===this._segmentsPixelsWhileMoving)return;const n=this.points();this._segmentsPixelsWhileMoving.forEach((e,t)=>{const s=this._segments[t],o=n[t].price,l=n[t+1].price,a=i.priceToCoordinate(o,r),c=(i.priceToCoordinate(l,r)-a)/(e.bars.length-1),h=s.bars().map((t,n)=>{const s=e.bars[n],o=a+n*c,l=i.coordinateToPrice(o,r);return{...t,o:i.coordinateToPrice(s.open+o,r)-l,h:i.coordinateToPrice(s.high+o,r)-l,l:i.coordinateToPrice(s.low+o,r)-l,c:i.coordinateToPrice(s.close+o,r)-l}});s.setBars(h)})}}},50014:(e,t,i)=>{i.d(t,{LineToolHeadAndShoulders:()=>o});var r=i(46090),n=i(24145),s=i(24146);class o extends n.LineDataSource{constructor(e,t,r,n){const s=t||o.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,85444)).then(t=>{this._setPaneViews([new t.LineToolHeadAndShouldersPaneView(this,e)])})}pointsCount(){return 7}name(){return"Head and Shoulders"}static createProperties(e){const t=new r.DefaultProperty("linetoolheadandshoulders",e);return o._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,49902)).then(e=>e.PatternWithBackgroundDefinitionViewModel)}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new s.LineToolColorsProperty([e.childs().textcolor]))}}},33967:(e,t,i)=>{i.d(t,{LineToolHighlighter:()=>s});var r=i(46090),n=i(85603);class s extends n.LineToolBrushBase{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Highlighter"}static createProperties(e){const t=new r.DefaultProperty("linetoolhighlighter",e);return s._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,16240)).then(e=>e.HighlighterDefinitionsViewModel)}_loadPaneViews(e){Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,56757)).then(t=>{this._setPaneViews([new t.HighlighterPaneView(this,e)])})}static _configureProperties(e){n.LineToolBrushBase._configureProperties(e)}}},67001:(e,t,i)=>{i.d(t,{LineToolHorzLinePriceAxisView:()=>n});var r=i(98424);class n extends r.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1;const r=this._source.points(),n=this._source.priceScale();if(0===r.length||null===n||n.isEmpty())return;const s=r[0];if(!isFinite(s.price))return;const o=this._source.ownerSource(),l=null!==o?o.firstValue():null;if(null===l)return;const a=this._source.properties().linecolor.value();i.background=a,i.textColor=this.generateTextColor(a),i.coordinate=n.priceToCoordinate(s.price,l),e.text=n.formatPrice(s.price,l),e.visible=!0}}},73224:(e,t,i)=>{i.d(t,{LineToolHorzLine:()=>a});var r=i(32567),n=i.n(r),s=i(46090),o=i(24145),l=i(67001)
;class a extends o.LineDataSource{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),this._priceAxisView=new l.LineToolHorzLinePriceAxisView(this),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,51997)).then(({HorzLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}state(e){const t=super.state(e);return t.points&&0!==t.points.length&&(t.points[0].offset=0),t}pointsCount(){return 1}name(){return"Horizontal Line"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}timeAxisViews(){return null}timeAxisPoints(){return[]}updateAllViews(){super.updateAllViews(),this._priceAxisView.update()}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}denormalizeTimePoints(){this._points=[],this._timePoint.length>0&&this._points.push({price:this._timePoint[0].price,index:0})}clearData(){const e=this._points;super.clearData(),this._points=e}static createProperties(e){const t=new s.DefaultProperty("linetoolhorzline",e);return a._configureProperties(t),t}_getAlertPlots(){return[this.points()[0].price]}_pointsForPointset(){return[]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,54579)).then(e=>e.HorizontalLineDefinitionsViewModel)}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){o.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(n())("")),e.addExclusion("text")}}},99924:(e,t,i)=>{i.d(t,{LineToolHorzRay:()=>a});var r=i(46090),n=i(32567),s=i.n(n),o=i(67001),l=i(24145);class a extends l.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:a.createProperties(),r,n),this._priceAxisView=new o.LineToolHorzLinePriceAxisView(this),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,13304)).then(({HorzRayPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 1}name(){return"Horizontal Ray"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}updateAllViews(){super.updateAllViews(),this._priceAxisView.update()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}canHasAlert(){return!0}static createProperties(e){const t=new r.DefaultProperty("linetoolhorzray",e);return a._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index+1,price:e.price};return[this._linePointsToAlertPlot([e,t],null,!1,!0)]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,94039))).HorizontalRayDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),
this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){l.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(s())("")),e.addExclusion("text")}}},71215:(e,t,i)=>{i.d(t,{LineToolIcon:()=>a});var r=i(88537),n=i(86441),s=i(46090),o=i(24145),l=i(24146);class a extends o.LineDataSource{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),this.version=1,document.fonts&&document.fonts.check&&document.fonts.load&&!document.fonts.check("12px FontAwesome")&&document.fonts.load("12px FontAwesome","").then(()=>{this._isDestroyed||e.updateSource(this)}),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,1742)).then(t=>{this._setPaneViews([new t.IconPaneView(this,e)])})}pointsCount(){return 1}name(){return"Icon"}hasEditableCoordinates(){return!1}getAnchorLimit(){return 80}applyTemplate(e){delete e.icon,super.applyTemplate(e)}getChangePointForSync(e){return null}setPoint(e,t,i){const s=Object.assign({},t),o=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),l=(0,r.ensureNotNull)(this.pointToScreenPoint(s)).subtract(o),a=this.properties().childs();if(0===e||1===e){const t=l.normalized();let i=Math.acos(-t.x);Math.asin(t.y)>0&&(i=2*Math.PI-i),0===e&&(i+=Math.PI),a.angle.setValue(i)}else{const t=l.add(new n.Point(15*(3===e?-1:1),0));a.size.setValue(2*Math.abs(t.x))}}getSourceIcon(){return{type:"text",text:String.fromCharCode(this.properties().childs().icon.value())}}static createProperties(e){const t=new s.DefaultProperty("linetoolicon",e);return a._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,48074)).then(e=>e.IconsDefinitionsViewModel)}static _configureProperties(e){o.LineDataSource._configureProperties(e),e.addChild("backgroundsColors",new l.LineToolColorsProperty([e.childs().color])),e.addExclusion("angle")}}},32962:(e,t,i)=>{i.d(t,{isIdeaUrl:()=>c,isIdeaAuthorProfileImageUrl:()=>h,createIdeaLineToolByUrl:()=>d});var r=i(88537),n=i(62802),s=i(95935),o=i(94755),l=i(49318);const a=/^\/chart\/.+?\/([0-9a-zA-Z]{8})(-[-\w]+)?\/?$/;function c(e){try{const t=new URL(e);return"https:"===t.protocol&&t.hostname.endsWith(".tradingview.com")&&a.test(t.pathname)}catch(e){return!1}}function h(e){if(e.startsWith("data:image/svg+xml,"))return!0;try{const t=new URL(e),i=new URL(window.AWS_S3_CDN);return t.protocol===i.protocol&&t.hostname===i.hostname&&t.pathname.includes("/userpics/")}catch(e){return!1}}async function u(e){const t=new URL(`/api/v1/ideas/${i=e,(0,r.ensureNotNull)(a.exec(new URL(i).pathname))[1]}/`,location.href);var i;return fetch(t.toString()).then(e=>{if(!e.ok)throw new Error("Error processing idea: "+e.statusText);return e.json()})}function d(e,t,i=!1){return u(e).then(e=>{const a=function(e,t){var i;const n=(0,r.ensureDefined)(e.user);let s;n.avatars&&h(n.avatars.small)&&(s=n.avatars.small.startsWith("data:image/svg+xml,")?n.avatars.small:n.avatars.small.replace(window.AWS_S3_CDN,"")+"?resetCache=true");const l={avatarUrl:s,
badges:null===(i=n.badges)||void 0===i?void 0:i.map(e=>e.name),username:n.username};return{createdAt:e.created_timestamp,direction:e.direction,name:(0,o.clean)(e.name,!0),author:l,uuid:e.uuid}}(e),c={price:0,time_t:a.createdAt,offset:0},u=t.mainSeries(),d=(0,r.ensureNotNull)(t.model().paneForSource(u)),p=d.newLineToolZOrder(!0),_={type:"drawing",source:{id:(0,s.randomHashN)(6),zorder:p,type:"LineToolIdea",position:50,state:{interval:"1",...l.LineToolIdea.createProperties().state()},ideaData:a,symbol:u.symbol(),ownerSource:u.id(),points:[c]},geometry:[],modelId:t.model().id()},P=t.pasteLineTool(d,_,!0,!0);return i&&n.setValue("hint.pasteIdea",!0,{forceFlush:!0}),P.pointAdded().subscribe(null,()=>t.scrollToLineTool(P),!0),P})}},49318:(e,t,i)=>{i.d(t,{LineToolIdea:()=>S});var r=i(46090),n=i(24145),s=i(87236),o=i(62802),l=i(45848),a=i(11905),c=i(46778),h=i(63208),u=i(8170),d=i(76553),p=i(32962);const _=(0,a.getLogger)("Chart.IdeaDialog"),P=(0,s.t)("Idea"),g=(0,s.t)("Insert a link to the idea");let v=null;function m(e){"LineToolIdea"===e?(window.is_authenticated||(0,u.resetToCursor)(!0),window.runOrSignIn(()=>{u.tool.setValue("LineToolIdea"),v=(0,d.showCustomUrlEventDialog)({onConfirm:f,onClose:()=>{v=null,"LineToolIdea"===u.tool.value()&&(0,u.resetToCursor)(!0)},title:P,placeholderText:g}),(0,l.trackEvent)("Idea","Open idea dialog")},{source:"Change drawing tool state"})):null!==v&&v.then(e=>e())}function f(e){const t=(0,h.chartWidgetCollectionService)();if(null===t)return;if(!(0,p.isIdeaUrl)(e))return void _.logWarn("Invalid idea url: "+e);const i=!Boolean(o.getBool("hint.pasteIdea")),r=t.activeChartWidget.value();(0,p.createIdeaLineToolByUrl)(e,r.model()).then(()=>{i&&(0,c.showPasteLineToolHint)(t.getContainer(),"hint.pasteIdea")})}var C=i(32567),y=i.n(C),T=i(13647);class w extends T.CustomEventItem{constructor(e,t){super(t),this._data=e}ideaData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){var e;return null===(e=this._data.author)||void 0===e?void 0:e.avatarUrl}}class S extends T.LineToolCustomUrlEvent{constructor(e,t,r,n){super(e,t||S.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,30302)).then(t=>{this._setPaneViews([new t.IdeaPaneView(this,e)])})}name(){return"Idea"}state(e){const t=super.state(e);return this._item&&(t.ideaData=this._item.ideaData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){e.ideaData&&(this._item=new w(e.ideaData,this)),void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){const t=new r.DefaultProperty("linetoolIdea",e);return S._configureProperties(t),t.hasChild("position")||t.addChild("position",new(y())(50)),t.addExclusion("position"),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,222)).then(e=>e.IdeaDefinitionsViewModel)}static _configureProperties(e){n.LineDataSource._configureProperties(e)}}(0,u.runOnDrawingStateReady)(()=>{u.tool.subscribe(m)})},
61559:(e,t,i)=>{i.d(t,{buildAbsoluteUserImageUrl:()=>p,LineToolImage:()=>_});var r=i(88537),n=i(86441),s=i(11905),o=i(46090),l=i(32567),a=i.n(l),c=i(24145);const h=(0,s.getLogger)("Chart.LineToolImage");function u(e){return e.toLowerCase().startsWith("blob:")}const d=window.AWS_BBS3_DOMAIN;function p(e){if(u(e))return e;const t=new URL(e,d),i=new URL(t.pathname,d);if("/"===i.pathname)return null;const r=i.toString();return t.toString()!==r?null:r}class _ extends c.LineDataSource{constructor(e,t,r,n){var s;super(e,t||_.createProperties(),r,n),this._image=null,this._originPoint=4;const o=this.properties().childs().url;this._absoluteUserImageUrl=new(a())(null!==(s=p(this.properties().childs().url.value()))&&void 0!==s?s:""),this._absoluteUserImageUrl.subscribe(this,e=>{const t=e.value();if(u(t))return;const i=p(t);null!==i&&o.setValue(new URL(i).pathname)}),o.subscribe(this,()=>{const e=p(o.value());null!==e&&this._absoluteUserImageUrl.setValue(e)}),this._loadImage(),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,60085)).then(({ImagePaneView:t})=>{this._setPaneViews([new t(this,e)])}),this.properties().childs().url.subscribe(this,()=>{this._loadImage()})}absoluteUserImageUrl(){return this._absoluteUserImageUrl}cssWidth(){return this.properties().childs().cssWidth.value()}cssHeight(){return this.properties().childs().cssHeight.value()}angle(){return this.properties().childs().angle.value()}originPoint(){return this._originPoint}dOffsetX(){return this._dOffsetX||0}pointsCount(){return 1}name(){return"Image"}image(){return this._image}setBlobImageUrl(e){this._image||(this._createImage(e),this._blobUrl=e)}getChangePointForSync(e){return null}hasEditableCoordinates(){return!1}pointToScreenPoint({index:e,price:t},i=0){const s=this._model.timeScale(),o=(0,r.ensureNotNull)(this.priceScale()),l=(0,r.ensureNotNull)((0,r.ensureNotNull)(this.ownerSource()).firstValue()),a=s.indexToCoordinate(e)+i,c=o.priceToCoordinate(t,l);return new n.Point(a,c)}setPoint(e,t,i){if(null===this._image)return;const{width:n,height:s}=this._image,o=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0],this.dOffsetX())),a=Math.max(Math.abs(l.x-o.x)/n,Math.abs(l.y-o.y)/s),c=Math.round(n*a),h=Math.round(s*a),u=this.properties().childs();u.cssWidth.setValue(c),u.cssHeight.setValue(h),this.propertiesChanged()}startChanging(e,t){super.startChanging(e,t),this._changeOriginPoint(_._oppositePoints[e])}endChanging(e,t){return this._changeOriginPoint(4),super.endChanging(e,t)}getPoint(){return null}syncLineStyleState(){const e=super.syncLineStyleState();return!e.url&&this._blobUrl&&(e.blobUrl=this._blobUrl),e}restoreExternalState(e){const{blobUrl:t,...i}=e;t&&this.setBlobImageUrl(t),super.restoreExternalState(i)}isSavedInChart(){return super.isSavedInChart()&&""!==this.absoluteUserImageUrl().value()}static createProperties(e){const t=new o.DefaultProperty("linetoolimage",e);return _._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,35306)).then(e=>e.ImageDefinitionsViewModel)}static _configureProperties(e){c.LineDataSource._configureProperties(e),e.hasChild("url")||e.addChild("url",new(a())("")),e.addExclusion("url"),e.addExclusion("cssWidth"),e.addExclusion("cssHeight"),e.addExclusion("angle")}_loadImage(){const e=this.properties(),t=(0,r.ensureDefined)(e.child("url")).value();t&&this._createImage(t)}_changeOriginPoint(e){const t=this.originPoint(),i=4===t?_._correctOriginDirections[e]:_._correctOriginDirections[_._oppositePoints[t]],s=this.properties().childs().cssWidth.value()/2,o=this.properties().childs().cssHeight.value()/2,[l]=this._points,a=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),c=new n.Point(a.x+s*i[0],a.y+o*i[1]),h=(0,r.ensureNotNull)(this.screenPointToPoint(c));this._dOffsetX=4===t?c.x-(0,r.ensureNotNull)(this.pointToScreenPoint(h)).x:void 0,l.index=h.index,l.price=h.price,this._originPoint=e}_createImage(e){var t;const i=u(e),n=p(e);if(null===n)return void h.logWarn("Invalid image URL: "+e);if(n===(null===(t=this._image)||void 0===t?void 0:t.src))return;const s=document.createElement("img");s.crossOrigin="anonymous",s.src=n,s.addEventListener("load",()=>{this._image=s;const e=this._model,t=this.properties().childs();if(!i){const e=new URL(n).pathname;t.url.setValue(e),this._blobUrl=void 0}if(t.cssWidth.value()&&t.cssHeight.value())return void this._model.updateSource(this);const o=e.timeScale().width()/4,l=(0,r.ensureNotNull)(this.priceScale()).height()/4,a=s.naturalWidth,c=s.naturalHeight,h=Math.min(1,o/a),u=Math.min(1,l/c),d=Math.min(h,u),p=Math.round(d*a),_=Math.round(d*c);t.cssWidth.setValue(p),t.cssHeight.setValue(_),this.updateAllViews(),this._model.updateSource(this)}),s.addEventListener("error",()=>{this.model().removeSource(this)})}}_._correctOriginDirections=[[-1,-1],[1,-1],[-1,1],[1,1],[0,0]],_._oppositePoints=[3,2,1,0,4]},87910:(e,t,i)=>{i.d(t,{LineToolInfoLine:()=>s});var r=i(46090),n=i(39195);class s extends n.LineToolTrendLine{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}pointsCount(){return 2}name(){return"Info Line"}static createProperties(e){const t=new r.DefaultProperty("linetoolinfoline",e);return s._configureProperties(t),t}static _configureProperties(e){n.LineToolTrendLine._configureProperties(e)}}},44900:(e,t,i)=>{var r=i(55827).LevelsProperty,n=i(19310).LineToolPitchfork;class s extends n{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Inside Pitchfork"}static createProperties(e){var t=new r("linetoolinsidepitchfork",e,!1,{range:[0,8]});return s._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e)}}t.LineToolInsidePitchfork=s},29084:(e,t,i)=>{var r;i.d(t,{isStudyLineToolName:()=>o,isLineToolName:()=>l,isLineDrawnWithPressedButton:()=>a,isLineToolDrawWithoutPoints:()=>c,isImageToolName:()=>h,isTextToolName:()=>u});var n=i(3573)
;const s=new Set(["LineStudyMtpAnalysis","LineStudyMtpDecisionPoint","LineStudyMtpRiskReward","LineStudyMtpElliotWaveMain","LineStudyMtpElliotWaveMajor","LineStudyMtpElliotWaveMinor","LineStudyMtpDownWave1OrA","LineStudyMtpDownWave2OrB","LineStudyMtpDownWave3","LineStudyMtpDownWave4","LineStudyMtpDownWave5","LineStudyMtpDownWaveC","LineStudyMtpUpWave1OrA","LineStudyMtpUpWave2OrB","LineStudyMtpUpWave3","LineStudyMtpUpWave4","LineStudyMtpUpWave5","LineStudyMtpUpWaveC"]);function o(e){let t="LineToolRegressionTrend"===e||"LineToolVbPFixed"===e||"LineToolFixedRangeVolumeProfile"===e;return t||(t="LineToolAnchoredVWAP"===e||function(e){return s.has(e)}(e)),t}function l(e){return e in(r||(r=i.t(n,2)))||o(e)}function a(e){return"LineToolBrush"===e||"LineToolHighlighter"===e}function c(e){return"LineToolTweet"===e||"LineToolIdea"===e}function h(e){return"LineToolImage"===e}function u(e){switch(e){case"LineToolBalloon":case"LineToolText":case"LineToolTextAbsolute":case"LineToolCallout":case"LineToolNote":case"LineToolNoteAbsolute":case"LineToolSignpost":return!0}return!1}},29494:(e,t,i)=>{i.d(t,{LineDataSourceBase:()=>R});var r=i(86441),n=i(88537),s=i(51954),o=i(11905),l=i(62949),a=i(8170),c=i(97639),h=i.n(c),u=i(32567),d=i.n(u),p=i(24146),_=i(71073),P=i(52778);class g extends(d()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t,e.pointAdded().subscribe(this,e=>{this._pointIndex===e&&this._listeners.fire(this)}),e.pointChanged().subscribe(this,e=>{this._pointIndex===e&&this._listeners.fire(this)})}value(){const e=this._lineSource.points()[this._pointIndex].price,t=(0,n.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),r=t.parse(i);return r.res?r.value:e}return e}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.price=parseFloat(""+e),this._lineSource.startChanging(this._pointIndex,t),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}}var v=i(39916),m=i(73044),f=i(46511),C=i(6342),y=i(49473),T=i(20358),w=i(62325),S=i.n(w),x=i(88230),b=i(64019),L=i(69415),A=i(94543),V=i(52500),D=i(70617);const M=(0,o.getLogger)("Chart.LineDataSource");class I{constructor(){this._states=[]}start(e){this._states.push(e)}finish(e){const t=(0,n.ensureDefined)(this._states.pop());return r=t,(i=e).length!==r.length?{indexesChanged:!0,pricesChanged:!0}:i.reduce((e,t,i)=>{const n=r[i];return e.indexesChanged=e.indexesChanged||t.index!==n.index,e.pricesChanged=e.pricesChanged||t.price!==n.price,e},{indexesChanged:!1,pricesChanged:!1});var i,r}isEmpty(){return 0===this._states.length}}let B=0;class R extends l.DataSource{constructor(e,t,i,r){if(super(r),this.version=1,this.customization={forcePriceAxisLabel:!1,disableErasing:!1,disableSave:!1,showInObjectsTree:!0},this._currentPointsetAndSymbolId=null,this._pointChanged=new(h()),this._pointAdded=new(h()),this._alertUndoMode=!1,this._priceAxisViews=[],this._timeAxisViews=[],
this._timePoint=[],this._points=[],this._lastPoint=null,this._paneViews=new Map,this._normalizedPointsChanged=new(h()),this._fixedPointsChanged=new(h()),this._changeStatesStack=new I,this._startMovingPoint=null,this._currentMovingPoint=null,this._fixedPoints=[],this._isActualSymbol=!1,this._isActualInterval=!1,this._isActualCurrency=!1,this._isActualUnit=!1,this._isDestroyed=!1,this._sharingMode=new(S())(0),this._onTemplateApplying=new(h()),this._onTemplateApplied=new(h()),this._syncStateExclusions=[],this._definitionsViewModel=null,this._syncLineStyleMuted=!1,this._onIsActualIntervalChange=new(h()),this._linkKey=new(S())(null),this._serverUpdateTime=null,this._model=e,this._properties=t,this._localAndServerAlertsMismatch=!1,this._properties.hasChild("interval")||this._properties.addChild("interval",new(d())(e.mainSeries().interval())),this.calcIsActualSymbol(),this._properties.childs().intervalsVisibilities.listeners().subscribe(this,this.calcIsActualSymbol),this._properties.subscribe(this,()=>this.propertiesChanged()),this._createPointsProperties(),this.pointsCount()>0)for(let e=0;e<this.pointsCount();e++)this._priceAxisViews.push(this.createPriceAxisView(e)),this._timeAxisViews.push(new P.LineDataSourceTimeAxisView(this,e));this._properties.childs().visible.subscribe(this,e=>{const t=!1===(0,a.hideAllDrawings)().value();e.value()?e.value()&&t&&s.emit("drawing_event",this._id,"show"):(this._model.selection().isSelected(this)&&this._model.selectionMacro(e=>{e.removeSourceFromSelection(this)}),t&&s.emit("drawing_event",this._id,"hide")),this._onSourceHiddenMayChange()}),(0,a.hideAllDrawings)().subscribe(this,this._onSourceHiddenMayChange),this._definitionsViewModel=null,this._isDestroyed=!1}destroy(){this._paneViews.forEach((e,t)=>this._destroyPanePaneViews(t)),this.stop(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this)),(0,a.hideAllDrawings)().unsubscribeAll(this),this.deleteAlert(),this._isDestroyed=!0}createPriceAxisView(e){return new _.LineToolPriceAxisView(this,{pointIndex:e})}model(){return this._model}linkKey(){return this._linkKey}serverUpdateTime(){return this._serverUpdateTime}setServerUpdateTime(e){this._serverUpdateTime=e}boundToSymbol(){return!0}points(){const e=[];for(let t=0;t<this._points.length;t++){const i=this._points[t];e.push({index:i.index,price:i.price,time:i.time})}return this._lastPoint&&e.push(this._correctLastPoint(this._lastPoint)),!this.isFixed()&&this._currentMovingPoint&&this._startMovingPoint&&this._correctPoints(e),e}timeAxisPoints(){return this.points()}priceAxisPoints(){return this.points()}normalizedPoints(){return this._timePoint}normalizedPointsChanged(){return this._normalizedPointsChanged}fixedPointsChanged(){return this._fixedPointsChanged}widthsProperty(){var e;return null!==(e=this._properties.childs().linesWidths)&&void 0!==e?e:null}lineColorsProperty(){var e
;return null!==(e=this._properties.childs().linesColors)&&void 0!==e?e:null}backgroundColorsProperty(){var e;return null!==(e=this._properties.childs().backgroundsColors)&&void 0!==e?e:null}textColorsProperty(){var e;return null!==(e=this._properties.childs().textsColors)&&void 0!==e?e:null}pointsProperty(){return this._pointsProperty}startMoving(e,t,i,r){this.isFixed()&&this.restoreFixedPoints(),this._startMovingPoint=e}move(e,t,i,r){if(i&&(i.shiftOnly()||i.modShift()))if(this.isFixed()){const t=this._alignScreenPointHorizontallyOrVertically((0,n.ensureDefined)(e.screen));this._currentMovingPoint={screen:t}}else{const t=this._alignPointHorizontallyOrVertically((0,n.ensureDefined)(e.logical)),i=(0,n.ensureNotNull)(this.pointToScreenPoint(t));this._currentMovingPoint={logical:t,screen:i}}else this._currentMovingPoint=e;this.updateAllViews()}endMoving(e,t,i){let r=!1,o=!1;if(this._currentMovingPoint&&this._startMovingPoint){if(this.isFixed())this._correctFixedPoints(this._fixedPoints)&&this._fixedPointsChanged.fire();else{const e=(0,n.ensureDefined)(this._currentMovingPoint.logical),t=(0,n.ensureDefined)(this._startMovingPoint.logical);r=e.index!==t.index,o=e.price!==t.price;if(this._correctPoints(this._points,i)){s.emit("drawing_event",this._id,"move");for(let e=0;e<this._points.length;e++)this._pointChanged.fire(e)}}this._startMovingPoint=null,this._currentMovingPoint=null}const l={indexesChanged:r,pricesChanged:o};return this.isFixed()?(this.calcPositionPercents(),this.updateAllViews(),l):(this.updateAllViews(),r&&!e?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),t||!o&&!r||this.synchronizeAlert(!this._alertUndoMode),l)}startMovingPoint(){return this._startMovingPoint?{...this._startMovingPoint}:null}currentMovingPoint(){return this._currentMovingPoint?{...this._currentMovingPoint}:null}startChanging(e,t){void 0!==e&&void 0!==t&&(e<this._priceAxisViews.length&&this._priceAxisViews[e].setActive(!0),e<this._timeAxisViews.length&&this._timeAxisViews[e].setActive(!0)),this._changeStatesStack.start(this.points())}endChanging(e,t,i){const r=this._changeStatesStack.finish(this.points());r.indexesChanged&&this._changeStatesStack.isEmpty()?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),t||this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire());for(let e=0;e<this._priceAxisViews.length;e++)this._priceAxisViews[e].setActive(!1);for(let e=0;e<this._timeAxisViews.length;e++)this._timeAxisViews[e].setActive(!1);return i||this.synchronizeAlert(!e),r}setPoint(e,t,i,r){if(i&&i.shift()&&this._snapTo45DegreesAvailable()){const i=0===e?1:e-1;this._snapPoint45Degree(t,this.points()[i])}this._points[e].index===t.index?(this._points[e].price=t.price,this._pointChanged.fire(e)):(this._points[e]=t,this._pointChanged.fire(e))}getPoint(e){return this.points()[e]||null}
alignCrossHairToAnchor(e){return!0}setLastPoint(e,t){return this._lastPoint=this._preparePoint(e,t),this.updateAllViews(),this._lastPoint}lastPoint(){return this._lastPoint}getChangePointForSync(e){return this.getPoint(e)}setPoints(e){this._points=e}isForcedDrawPriceAxisLabel(){return this.customization.forcePriceAxisLabel}clearData(){this._points=[]}denormalizeTimePoints(){let e=[];for(let t=0;t<this._timePoint.length;t++){const i=this._model.timeScale().denormalizeTimePoint(this._timePoint[t]);if(void 0===i){e=[];break}e.push({index:i,price:this._timePoint[t].price})}e.length>0&&(this._points=e)}restorePoints(e,t,i){const r=this._timePoint.length>0&&!(0,D.deepEquals)(this._timePoint,e)[0];this._timePoint=(0,f.deepCopy)(e),this._points=t,i||this.denormalizeTimePoints(),r&&this._normalizedPointsChanged.fire()}restorePositionPercents(e){this._positionPercents=e}calcIsActualSymbol(){if(this._model.mainSeries().hasDelayedSymbolIntervalChange())return;const e=this.ownerSource();if(null===e)this._isActualSymbol=!1;else{const t=(0,n.ensureNotNull)(e.symbolSource());this._migrateSymbolProperty();const i=this._properties.childs().symbol,r=i.value();if(this._isActualSymbol=t.symbolSameAsCurrent(r),this._isActualSymbol){const e=t.symbol();(0,C.areEqualSymbols)(r,e)||(M.logWarn('Possible drawing "migrating" detected from "'+r+'" to "'+e+'"'),M.logWarn("Series symbolInfo: "+JSON.stringify(t.symbolInfo())),M.logWarn(""+(new Error).stack)),i.setValue(e)}}this.calcIsActualInterval(),this.calcIsActualCurrency(),this.calcIsActualUnit(),this._onSourceHiddenMayChange()}calcIsActualCurrency(){const e=this.ownerSource();if(null===e)return void(this._isActualCurrency=!1);let t=this._properties.childs().currencyId.value();if(null!==t){const i=e.symbolSource();if(null===i)return;"pct"===t&&(this._properties.childs().currencyId.setValue(null),t=null),this._isActualCurrency=t===(0,y.symbolCurrency)(i.symbolInfo(),void 0,!0)}else{const t=(0,n.ensureNotNull)(e.symbolSource()).symbolInfo();this._isActualCurrency=null!==t&&(0,y.symbolCurrency)(t)===(0,y.symbolOriginalCurrency)(t)}this._onSourceHiddenMayChange()}calcIsActualUnit(){const e=this.ownerSource();if(null===e)return void(this._isActualUnit=!1);const t=this._properties.childs().unitId.value();if(null!==t)this._isActualUnit=t===(0,n.ensureNotNull)(e.symbolSource()).unit();else{const t=(0,n.ensureNotNull)(e.symbolSource()).symbolInfo(),i=this._model.unitConversionEnabled();this._isActualUnit=null!==t&&(0,y.symbolUnit)(t,i)===(0,y.symbolOriginalUnit)(t,i)}this._onSourceHiddenMayChange()}calcIsActualInterval(){const e=this._isActualInterval,t=this._properties,i=this._model.mainSeries();this._isActualInterval=(0,L.isActualInterval)(m.Interval.parse(i.interval()),t.childs().intervalsVisibilities),!this._isActualInterval&&this._model.selection().isSelected(this)&&this._model.selectionMacro(e=>e.removeSourceFromSelection(this)),this._isActualInterval!==e&&this._onIsActualIntervalChange.fire(),this._onSourceHiddenMayChange()}paneViews(e){if(this.isSourceHidden())return null
;const t=this._getPaneViews(this.isMultiPaneAvailable()?e:void 0);if(null===t)return null;if(1===t.length)return[t[0]];const i=[];for(let e=t.length-1;e>=0;--e)i.push(t[e]);return i}isSavedInChart(){return!this.customization.disableSave}setSavingInChartEnabled(e){this.customization.disableSave=!e}detachAlert(){const e=this.getAlertSync();if(e&&this._alertCallbacks){const t=this._alertCallbacks;e.off("destroy",t.remove),e.off("change:hovered",t.hovered),e.off("change:selected",t.selected)}this.hasAlert.setValue(!1),this._alertId=void 0}removeAlert(){this._alertId=void 0,this.hasAlert.setValue(!1)}deleteAlert(){{if(!this.hasAlert.value()||void 0===this._alertId)return;const e=(0,T.getPriceAlertsDispatcherIfExists)();e&&e.deleteAlert(this._alertId),this.removeAlert()}}areLocalAndServerAlertsMismatch(){return this._localAndServerAlertsMismatch}showInObjectTree(){return this.customization.showInObjectsTree}setShowInObjectsTreeEnabled(e){this.customization.showInObjectsTree=e}start(){this.createServerPoints()}processHibernate(){this.isSourceHidden()?this.isStarted()&&this.stop():this.isStarted()||this.start()}onData(e){"pointset_error"!==e.method?e.params.customId===this._currentPointsetIdWithPrefix()&&this._onPointsetUpdated(e.params.plots):M.logError(`Error getting pointset: ${e.params[0]} ${e.params[1]}`)}isActualSymbol(){return this._isActualSymbol}isActualCurrency(){return this._isActualCurrency}isActualInterval(){return this._isActualInterval}isActualUnit(){return this._isActualUnit}onIsActualIntervalChange(){return this._onIsActualIntervalChange}setOwnerSource(e){null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this)),super.setOwnerSource(e),e&&(this.setPriceScale(e.priceScale()),e.currencyChanged().subscribe(this,this.calcIsActualCurrency),e.unitChanged().subscribe(this,this.calcIsActualUnit),this.calcIsActualSymbol(),this._migrateZOrder())}dataAndViewsReady(){return this._paneViews.size>0}pointAdded(){return this._pointAdded}pointChanged(){return this._pointChanged}pointToScreenPoint(e){var t;const i=this._model.timeScale(),n=this.priceScale(),s=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(!n||n.isEmpty()||i.isEmpty()||null==s)return null;const o=i.indexToCoordinate(e.index),l=n.priceToCoordinate(e.price,s);return new r.Point(o,l)}screenPointToPoint(e){var t;const i=this.priceScale(),r=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(null==r||!isFinite(r)||null===i)return null;const n=this._model.timeScale().coordinateToIndex(e.x);return{price:i.coordinateToPrice(e.y,r),index:n}}addPoint(e,t,i){const r=this._preparePoint(e,t);return this._addPointIntenal(r,t,i)}propertiesChanged(e){this.calcIsActualInterval(),this.updateAllViewsAndRedraw(),e||this._syncLineStyleIfNeeded()}state(e){var t,i;const r={type:this.toolname,id:this.id(),state:this.properties().state(null!==(t=this._propertiesStateExclusions())&&void 0!==t?t:void 0),points:(0,f.deepCopy)(this._timePoint),zorder:this.zorder(),
ownerSource:null===(i=this.ownerSource())||void 0===i?void 0:i.id()};return this.linkKey().value()&&(r.linkKey=this.linkKey().value()),delete r.state.points,e&&(r.indexes=this._points),this.isFixed()&&(r.positionPercents=this._positionPercents||this.calcPositionPercents()),"version"in this&&1!==this.version&&(r.version=this.version),this._saveAlertIdInState()&&this.hasAlert.value()&&void 0!==this._alertId&&(r.alertId=this._alertId.toString()),r}updateAllViews(){if(this._isActualSymbol&&this._isActualCurrency&&this._isActualUnit&&this._isActualInterval&&this._properties.childs().visible.value()){this._updateAllPaneViews();for(const e of this._priceAxisViews)e.update();for(const e of this._timeAxisViews)e.update()}}updateAllViewsAndRedraw(){this.updateAllViews(),this._model.updateSource(this)}properties(){return this._properties}restoreExternalPoints(e,t){if(this._timePoint=(0,f.deepCopy)(e.points),t.indexesChanged){if(this.properties().childs().interval.setValue(e.interval),!this.isActualSymbol())return this._clearServerPoints(),void this._normalizedPointsChanged.fire();this.createServerPoints()}else{const t=Math.min(this._points.length,e.points.length);for(let i=0;i<t;i++)this._points[i].price=e.points[i].price}this._normalizedPointsChanged.fire()}restoreExternalState(e){this.properties().mergeAndFire(e)}applyTemplate(e){this._onTemplateApplying.fire(e),this._applyTemplateImpl(e),this.calcIsActualSymbol(),this.updateAllViews(),this.model().lightUpdate(),this._onTemplateApplied.fire()}template(){return this.properties().preferences()}isSourceHidden(){return!this._properties.childs().visible.value()||(0,a.hideAllDrawings)().value()&&this.canBeHidden()||!this._isActualInterval||!this._isActualSymbol||!this._isActualCurrency||!this._isActualUnit}async getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){const e=await this._getPropertyDefinitionsViewModelClass();return null===e||this._isDestroyed?null:(this._definitionsViewModel=new e(this._model.undoModel(),this),this._definitionsViewModel)}return this._definitionsViewModel}syncAlert(e){this.hasAlert.value()||this.setAlert(e,{sync:!0,noChartSave:!0})}createServerPoints(){if(!this._isActualSymbol)return;if(!this._model.chartApi().isConnected().value())return;if(this._clearServerPoints(),this._model.timeScale().isEmpty())return;if(0===this._timePoint.length&&this._points.length>0&&this.normalizePoints(),!this._readyToCreatePointset())return;const e=this._pointsForPointset();if(0===e.length)return;++B,this._currentPointsetAndSymbolId={pointsetId:B,symbolId:(0,n.ensureNotNull)(this._model.mainSeries().seriesSource().symbolInstanceId())};const t=(0,b.getServerInterval)(this.properties().childs().interval.value());this._model.chartApi().createPointset(this._currentPointsetIdWithPrefix(),"turnaround",this._currentPointsetAndSymbolId.symbolId,t,e,this.onData.bind(this))}finish(){}realign(){var e;this.calcIsActualSymbol(),
this.isFixed()||this.isSourceHidden()||this._model.lineBeingCreated()===this||this._model.lineBeingEdited()===this||(null===(e=this._currentPointsetAndSymbolId)||void 0===e?void 0:e.symbolId)===this._model.mainSeries().seriesSource().symbolInstanceId()||this._clearServerPoints(),this.updateAllViews()}stop(){this._clearServerPoints()}restart(){this.isFixed()||(this._currentPointsetAndSymbolId=null,this.createServerPoints())}isStarted(){return null!==this._currentPointsetAndSymbolId}convertYCoordinateToPriceForMoving(e,t){var i;const r=(0,n.ensureNotNull)(this.priceScale());if(r.isEmpty())return null;const s=this.ownerSource(),o=(0,n.ensure)(null===(i=s||t)||void 0===i?void 0:i.firstValue());return r.coordinateToPrice(e,o)}syncMultichartState(e){const t={points:this._timePoint,interval:this._model.mainSeries().interval()},i=this.linkKey().value();if(null!==i&&this.isSynchronizable()){const r={model:this._model,linkKey:i,symbol:this._model.mainSeries().symbol(),finalState:t,changes:e};(0,a.finishChangingLineTool)(r)}}enableCurrentIntervalVisibility(){const e=this.properties().childs().intervalsVisibilities.state();void 0!==e&&((0,L.makeIntervalsVisibilitiesVisibleAtInterval)(e,m.Interval.parse(this._model.mainSeries().interval())),this.properties().childs().intervalsVisibilities.mergeAndFire(e))}clonePositionOffset(){return this.isFixed()?{barOffset:0,xCoordOffset:20,yCoordOffset:20}:{barOffset:0,xCoordOffset:0,yCoordOffset:-40}}sharingMode(){return this._sharingMode}share(e){this.isSynchronizable()&&this._sharingMode.setValue(e)}syncLineStyleState(){const e=this.properties().state(this._syncStateExclusions);return delete e.interval,e.intervalsVisibilities=(0,L.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities),e}_correctLastPoint(e){return(0,D.clone)(e)}_pointsForPointset(){return this._timePoint.map(e=>[e.time_t,e.offset])}_snapPoint45Degree(e,t,i){const r=this._model.timeScale(),s=r.indexToCoordinate(t.index),o=r.indexToCoordinate(e.index)-s,l=(0,n.ensureNotNull)(this.priceScale()),a=t.price,c=e.price,h=(0,n.ensureNotNull)((0,n.ensureNotNull)(this.ownerSource()).firstValue()),u=l.priceToCoordinate(a,h),d=l.priceToCoordinate(c,h)-u,p=Math.round(Math.atan2(o,d)/Math.PI*4);if(2===Math.abs(p))i||(e.price=a);else if(0===Math.abs(p)||4===Math.abs(p))i||(e.index=t.index);else{const t=Math.sqrt(o*o+d*d),i=o<0?-1:1,n=d<0?-1:1;let a=Math.max(Math.abs(d),Math.abs(o));a/=a*Math.sqrt(2)/t;const c=Math.round(r.coordinateToIndex(s+a*i)),p=Math.abs(r.indexToCoordinate(c)-s),_=l.coordinateToPrice(u+p*n,h);e.index=c,e.price=_}}normalizePoint(e){return{...this._model.timeScale().normalizeBarIndex(e.index),price:e.price}}normalizePoints(){this._timePoint=[];for(let e=0;e<this._points.length;e++)if(void 0!==this._points[e].index){const t=this.normalizePoint(this._points[e]);if(!t.time_t){this._timePoint=[];break}this._timePoint.push(t)}this._normalizedPointsChanged.fire()}_setPaneViews(e,t,i){this._paneViews.set(t,e),void 0!==t&&i&&t.onDestroyed().subscribe(this,()=>this._destroyPanePaneViews(t)),this._model.lightUpdate()}
_getPaneViews(e){return this._paneViews.get(e)||null}_updateAllPaneViews(){this._paneViews.forEach(e=>{for(const t of e)t.update()})}_alignPointHorizontallyOrVertically(e){const t=(0,n.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).logical),r=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),s=Math.abs(r.x-t.x),o=Math.abs(r.y-t.y);if(s<10&&o<10)return e;return{index:s<o?i.index:e.index,price:s<o?e.price:i.price}}_alignScreenPointHorizontallyOrVertically(e){const t=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i<10&&s<10?e:i<s?new r.Point(t.x,e.y):new r.Point(e.x,t.y)}_correctPoints(e,t){const i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._currentMovingPoint).screen),r=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),s=i.subtract(r);if(s.length()<1&&!t)return!1;for(let t=0;t<e.length;t++){const i=e[t],r=(0,n.ensureNotNull)(this.pointToScreenPoint(i)).add(s),o=(0,n.ensureNotNull)(this.screenPointToPoint(r));e[t].index=o.index,e[t].price=o.price}return!0}_correctFixedPoints(e){const t=(0,n.ensureDefined)((0,n.ensureNotNull)(this._currentMovingPoint).screen),i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),r=t.subtract(i);if(r.length()>=1){for(let t=0;t<e.length;t++)e[t]=e[t].add(r);return!0}return!1}_currentPointsetIdWithPrefix(){return"pointset_"+(0,n.ensureNotNull)(this._currentPointsetAndSymbolId).pointsetId}_clearServerPoints(){null!==this._currentPointsetAndSymbolId&&this._model.chartApi().isConnected().value()&&this._model.chartApi().removePointset(this._currentPointsetIdWithPrefix()),this._currentPointsetAndSymbolId=null}_createPointProperty(e){const t=this._pointsProperty.childs().points;t.addProperty(""+e,{});const i=t[e];i.addChild("price",new g(this,e)),i.addChild("bar",new v.LineDataSourcePointIndexProperty(this,e))}_createPointsProperties(){this._pointsProperty=new(d()),this._pointsProperty.addChild("points",new(d()));for(let e=0;e<this.pointsCount();e++)this._createPointProperty(e)}_alignPointToRangeOfActualData(e){const t=(0,n.ensureNotNull)(this._model.mainSeries().bars().firstIndex()),i=(0,n.ensureNotNull)(this._model.mainSeries().bars().lastIndex());let r=Math.max(e.index,t);return r=Math.min(r,i),{...e,index:r}}_migrateSymbolProperty(){const e=this._properties.childs();if(e.symbolStateVersion.value()<2){const t=(0,n.ensureNotNull)(this.ownerSource()),i=(0,n.ensureNotNull)(t.symbolSource());if(i===this._model.mainSeries())return void e.symbolStateVersion.setValueSilently(2);if(null===i.symbolInfo())return;this._model.mainSeries().symbolSameAsCurrent(e.symbol.value())&&e.symbol.setValueSilently(i.symbol()),e.symbolStateVersion.setValueSilently(2)}}_migrateZOrder(){const e=this._properties.childs();e.zOrderVersion.value()<2&&(this.ownerSource()===this.model().mainSeries()&&this.setZorder(this.zorder()-this.model().mainSeries().obsoleteZOrder()),e.zOrderVersion.setValueSilently(2))}_preparePoint(e,t){
const i=e;return t&&t.shift()&&this.points().length>=2&&this._snapTo45DegreesAvailable()&&this._snapPoint45Degree(i,this.points()[this.points().length-2]),i}_addPointIntenal(e,t,i){this._points.push(e);const r=this._points.length===this.pointsCount();return r?(this._lastPoint=null,i||(this.normalizePoints(),this.createServerPoints())):this._lastPoint=e,this._pointAdded.fire(this._points.length-1),r}_onSourceHiddenMayChange(){this._model.invalidate(x.InvalidationMask.validateAction(()=>{this!==this._model.lineBeingCreated()&&(this._isDestroyed||this.processHibernate())}))}_saveAlertIdInState(){return!0}_onPointsetUpdated(e){if(0===e.length)return;for(let t=0;t<e.length;t++){const i=e[t],r=this._timePoint[i.index],n={index:i.value[0],time:new Date(1e3*i.value[1]),price:r.price};this._points.length<=i.index?(this._points.push(n),this._pointAdded.fire(this._points.length-1)):(this._points[i.index]=n,this._pointChanged.fire(i.index))}const t=this;t.checkAlert&&t.checkAlert(),this.updateAllViewsAndRedraw()}_snapTo45DegreesAvailable(){return!1}_onMainSeriesSymbolResolved(){const e=this.ownerSource();null===e||this._model.mainSeries()===e.symbolSource()||this.isSourceHidden()||this.createServerPoints()}_readyToCreatePointset(){return this._timePoint.length>0}_onAlertData(e){}_propertiesStateExclusions(){return null}_syncLineStyleIfNeeded(){const e=this.linkKey().value();!this._syncLineStyleMuted&&e&&(0,a.changeLineStyle)({linkKey:e,state:this.syncLineStyleState(),model:this._model})}_muteSyncLineStyle(){this._syncLineStyleMuted=!0}_unmuteSyncLineStyleWithoutApplyingChanges(){this.propertiesChanged(),this._syncLineStyleMuted=!1}_applyTemplateImpl(e){e.intervalsVisibilities=(0,L.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities);const t=this.properties();t.mergePreferences(e),t.saveDefaults(),this.propertiesChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}static _configureProperties(e){if(R._addCollectedProperties(e),e.hasChild("symbolStateVersion")||e.addChild("symbolStateVersion",new(d())(R._initialSymbolStateVersion())),e.hasChild("zOrderVersion")||e.addChild("zOrderVersion",new(d())(R._initialZOrderVersion())),e.hasChild("visible")||e.addChild("visible",new(d())(!0)),e.hasChild("frozen")||e.addChild("frozen",new(d())(!1)),e.hasChild("symbol")||e.addChild("symbol",new(d())("")),e.hasChild("currencyId")||e.addChild("currencyId",new(d())(null)),e.hasChild("unitId")||e.addChild("unitId",new(d())(null)),e.addExclusion("symbolStateVersion"),e.addExclusion("zOrderVersion"),e.addExclusion("visible"),e.addExclusion("frozen"),e.addExclusion("symbol"),e.addExclusion("currencyId"),e.addExclusion("unitId"),e.hasChild("intervalsVisibilities")){const t=(0,D.merge)((0,D.clone)(A.intervalsVisibilitiesDefaults),e.childs().intervalsVisibilities.state());e.removeProperty("intervalsVisibilities"),e.addChild("intervalsVisibilities",new V.IntervalsVisibilitiesProperty(t))}else e.addChild("intervalsVisibilities",new V.IntervalsVisibilitiesProperty(A.intervalsVisibilitiesDefaults))
;e.hasChild("title")||e.addChild("title",new(d())("")),e.addExclusion("symbolInfo"),e.addExclusion("points"),e.addExclusion("interval"),e.addExclusion("title"),e.hasChild("singleChartOnly")&&e.removeProperty("singleChartOnly"),e.hasChild("font")&&e.removeProperty("font")}static _addCollectedProperties(e){e.hasChild("linewidth")&&e.addChild("linesWidths",new p.LineToolWidthsProperty([(0,n.ensureDefined)(e.child("linewidth"))])),e.hasChild("linecolor")&&e.addChild("linesColors",new p.LineToolColorsProperty([(0,n.ensureDefined)(e.child("linecolor"))])),e.hasChild("backgroundColor")&&e.addChild("backgroundsColors",new p.LineToolColorsProperty([(0,n.ensureDefined)(e.child("backgroundColor"))])),e.hasChild("textColor")&&e.addChild("textsColors",new p.LineToolColorsProperty([(0,n.ensureDefined)(e.child("textColor"))])),e.addExclusion("linesWidths"),e.addExclusion("linesColors"),e.addExclusion("backgroundsColors"),e.addExclusion("textsColors")}static _initialSymbolStateVersion(){return 1}static _initialZOrderVersion(){return 1}_destroyPanePaneViews(e){const t=this._paneViews.get(e);if(void 0!==t)for(const e of t)e.destroy&&e.destroy();void 0!==e&&e.onDestroyed().unsubscribeAll(this),this._paneViews.delete(e)}_copyPricesWithoutNormalization(){const e=Math.min(this._points.length,this._timePoint.length);for(let t=0;t<e;t++)this._timePoint[t].price=this._points[t].price}}},39916:(e,t,i)=>{i.d(t,{LineDataSourcePointIndexProperty:()=>s});var r=i(32567),n=i.n(r);class s extends(n()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){return this._lineSource.points()[this._pointIndex].index}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.index=e,this._lineSource.startChanging(this._pointIndex,t),this._setPointImpl(t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}_setPointImpl(e){this._lineSource.setPoint(this._pointIndex,e)}}},71073:(e,t,i)=>{i.d(t,{LineToolPriceAxisView:()=>s});var r=i(88537),n=i(98424);class s extends n.PriceAxisView{constructor(e,t){super(),this._active=!1,this._source=e,this._data=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_updateRendererData(e,t,i){e.visible=!1;const r=this._source.model();if(!r.timeScale()||r.timeScale().isEmpty())return;const n=this._source.priceScale();if(null===n||n.isEmpty())return;if(!r.selection().isSelected(this._source)&&!this._source.isForcedDrawPriceAxisLabel())return;if(null===r.timeScale().visibleBarsStrictRange())return;const s=this._source.priceAxisPoints(),o=this._data.pointIndex;if(s.length<=o)return;const l=s[o];if(!isFinite(l.price))return;const a=this._source.ownerSource(),c=null!==a?a.firstValue():null;if(null===c)return;let h=this._data.backgroundPropertyGetter?this._data.backgroundPropertyGetter():null;null===h&&(h=this._getBgColor()),i.background=h,i.borderColor="#2E84A6",i.textColor=this.generateTextColor(h),i.coordinate=n.priceToCoordinate(l.price,c),
e.text=this._formatPrice(l.price,c),e.visible=!0}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_formatPrice(e,t){return(0,r.ensureNotNull)(this._source.priceScale()).formatPrice(e,t)}}},52778:(e,t,i)=>{i.d(t,{LineDataSourceTimeAxisView:()=>n});var r=i(42053);class n extends r.TimeAxisView{constructor(e,t){super(e.model()),this._active=!1,this._source=e,this._pointIndex=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_getIndex(){if(!this._model.selection().isSelected(this._source))return null;const e=this._source.timeAxisPoints();return e.length<=this._pointIndex?null:e[this._pointIndex].index}}},24145:(e,t,i)=>{var r=i(86441).Point,n=i(71073).LineToolPriceAxisView,s=i(8170),o=i(73044).Interval,l=i(11905).getLogger("Chart.LineDataSource"),a=i(11688),c=i(52279).reloginOrGoPro,h=i(17540).canPlaceAlertOnResolution,u=i(44853).showGoProAlertsOnSecondsDialog,d=i(20358).getPriceAlertsDispatcher,p=i(20358).getPriceAlertsDispatcherIfExists,_=i(85481).lineToolsLocalizedNames,P=a.enabled("datasource_copypaste"),g=i(29494).LineDataSourceBase;class v extends g{isAvailableInFloatingWidget(){return!0}visibilityKeyByInterval(e){var t,i=o.parse(e);return v.IntervalsVisibilities.forEach((function(e){e.kind===i.kind()&&e.from<=i.multiplier()&&e.to>=i.multiplier()&&(t=e.key)})),t}priceScale(){return this._ownerSource?this._ownerSource.m_priceScale:null}symbol(){return this._properties.symbol.value()}isSavedInStudyTemplates(){return!1}fixedPoints(){var e=[];if(this._positionPercents&&!this.priceScale().isEmpty())for(var t=0;t<this._positionPercents.length;t++){var i=this._positionPercents[t],n=this._model.timeScale().width()*i.x,s=this.priceScale().height()*i.y;e.push(new r(n,s))}else for(t=0;t<this._fixedPoints.length;t++)e.push(this._fixedPoints[t].clone());return this._lastPoint&&e.push(this._lastPoint.clone()),this._currentMovingPoint&&this._startMovingPoint&&this._correctFixedPoints(e),e}addFixedPoint(e){this._fixedPoints.push(e);var t=this._fixedPoints.length===this.pointsCount();return t&&this.calcPositionPercents(),t}calcPositionPercents(){if(!this.priceScale()||this.priceScale().isEmpty())return[];this._positionPercents=[];for(var e=0;e<this._fixedPoints.length;e++){var t=this._fixedPoints[e],i=t.x/this._model.timeScale().width(),r=t.y/this.priceScale().height();this._positionPercents.push({x:i,y:r})}return this._positionPercents}calcMiddlePoint(e,t){return new r((e.x+t.x)/2,(e.y+t.y)/2)}getPointByPosition(e,t,i,r){return[t,i,r][e]}restoreFixedPoints(){this._fixedPoints=this.fixedPoints()}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}priceAxisViews(e,t){if(t!==this.priceScale()||this.isSourceHidden())return null
;if(this._model.lineBeingEdited()===this){var i=this._model.linePointBeingEdited();if(null!==i&&i<this._priceAxisViews.length){var r=this._priceAxisViews.slice(),n=r[i];return r.splice(i,1),r.push(n),r}return this._priceAxisViews}return this._priceAxisViews}timeAxisViews(){if(this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){var e=this._model.linePointBeingEdited();if(null!==e&&e<this._timeAxisViews.length){var t=this._timeAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._timeAxisViews}return this._timeAxisViews}setLastFixedPoint(e){this._lastFixedPoint=e,this.updateAllViews()}title(){return this.translatedType()}translatedType(){return void 0!==_[this.toolname]?_[this.toolname]:"Line Tool"}name(){return"Line Tool"}isBeingEdited(){return this===this._model.lineBeingEdited()||this===this._model.sourceBeingMoved}isFixed(){return!1}isLocked(){return this.properties().frozen&&this.properties().frozen.value()}tags(){return[this.toolname]}alertId(){return this._alertId}setAlert(e,t){var i=this;t=t||{};if(!this.canHasAlert())return Promise.reject("Line data source can not has alert");function r(){!t.noChartSave&&window.saver&&window.saver.saveChartSilently(null,(function(e){e&&413===e.status||c({feature:"savedChartsForAlertLimit"})}),{noDefaultOnFail:!0})}return i._alertId=parseInt(e),i.hasAlert.setValue(!0),i.getAlert().then((function(e){var t=i._model.selection().isSelected(i);return e?(i._processAlertHandlers("unsubscribe"),i._processAlertHandlers("subscribe"),e.set("selected",t),setTimeout(r,0),i._onAlertData(e),e):(l.logError("Failed to get alert, alert will not be saved with drawing in chart"),Promise.reject("got_no_alert"))})).then(()=>{var i=this.linkKey().value();null===i||t.sync||s.changeLineStyle({linkKey:i,model:this._model,state:{},alertId:e})}).catch((function(t){i._processAlertHandlers("unsubscribe"),"not_exists"===t?d().then((function(t){t.removeAlertFromAllChartsSilently(i.id(),e)})):l.logError("Getting alert or Saving chart failed: "+t)}))}_processAlertHandlers(e){var t,i,r=this;if("unsubscribe"!==(e="subscribe"===e?"subscribe":"unsubscribe")||r._alertCallbacks){i="subscribe"===e?"on":"off",t=r.properties();var n=r._alertCallbacks||{remove:r.removeAlert.bind(r),selected:function(e,t){t?r._model.selectionMacro((function(e){e.addSourceToSelection(r)})):r._model.selectionMacro((function(e){e.removeSourceFromSelection(r)}))},synchronizeSilently:function(e){r.synchronizeAlert(!1)}};r._alertCallbacks||(r._alertCallbacks=n),r.getAlert().then((function(s){s&&(s[i]("destroy",n.remove),s[i]("change:selected",n.selected),t.extendLeft&&t.extendLeft[e](r,n.synchronizeSilently),t.extendRight&&t.extendRight[e](r,n.synchronizeSilently))}))}}editAlert(e){var t=this;t.hasAlert.value()&&d().then((function(i){i.openEditDialog(t._alertId,{actionSource:e,error:function(e){"not_exists"===e&&t.removeAlert()}})}))}getAlert(){var e=this;return new Promise((function(t,i){d().then((function(r){r.requestAlert(e._alertId,{success:t,error:i})}))}))}getAlertSync(){
if(!this._alertId)return null;var e=p();return e&&e.getAlertSync(this._alertId)||null}synchronizeAlert(e){this.hasAlert.value()&&setTimeout(()=>{this._isDestroyed||this._synchronizeAlert(e)},0)}_synchronizeAlert(e){var t=this,i=t._getUndoHistory();if(!t._undoCheckpointAlert&&!t._alertUndoMode){var r=i.undoStack().pop();t._undoCheckpointAlert=i.createUndoCheckpoint(),r&&i.undoStack().push(r)}function n(){t._alertUndoMode=!0,i.undoToCheckpoint(t._undoCheckpointAlert),setTimeout((function(){t._alertUndoMode=!1,t._localAndServerAlertsMismatch=!1}),0)}function s(e){"not_exists"!==e&&(l.logError("Getting alert failed: "+e),n())}h(t.stateForAlert().interval)?t.getAlert().then((function(i){i?(!function(e){var i=e.get("description")!==e.defaultDescription(),r=e.get("extra"),n=r.alertSeries(),s=t._model.mainSeries().stateForAlert();"MainSeries"===n.type&&s.actualSymbol===n.actualSymbol&&r.alertSeries(s);r.mainSeries(s),e.set("symbolInternal",s.symbolString),e.set("resolution",t.stateForAlert().interval),r.drawing(t),i||e.setDefaultDescription();t._localAndServerAlertsMismatch=!0}(i),e&&(!function(e){d().then((function(i){i.restartAlert(e,{success:function(){t._localAndServerAlertsMismatch=!1},error:s,complete:function(){delete t._undoCheckpointAlert},actionSource:"drawing_sync"})}))}(i),t._onAlertData(i))):l.logError("Failed to get alert, drawing and alert are not synchronized")})).catch(s):t._alertUndoMode||(u(),n(),delete t._undoCheckpointAlert)}_getUndoHistory(){return this._model._undoModel.undoHistory()}stateForAlert(){if(!this.canHasAlert())return null;var e=this.state();e.id=this.idForAlert(),e.uniqueId=this.idForAlert(),e.title=this.title(),e.interval=this._model.mainSeries().interval();var t=this._getAlertPlots();return t&&(e.plots=t),e}_getAlertPlots(){return null}_linePointsToAlertPlot(e,t,i,r){if(2!==e.length)return l.logError("[Drawing Alert] Wrong points"),null;var n=this._model.timeScale();return!n||n.isEmpty()?null:{type:"LinePlot",title:t||this.title(),timestamp:n.indexToTimePoint(0),offset1:e[0].index,offset2:e[1].index,price1:e[0].price,price2:e[1].price,extendBackward:i||!1,extendForward:r||!1}}getAlertIsActive(){if(!this._alertId)return!1;var e=this.getAlertSync(this._alertId);return Boolean(e&&e.get("active"))}geometry(){var e=this;return this.points().map((function(t){return function(t){var i=t.x/e._model.timeScale().width(),n=t.y/e.priceScale().height();return new r(i,n)}(e.pointToScreenPoint(t))}))}hasEditableCoordinates(){return!0}getSourceIcon(){return{type:"loadSvg",svgId:"linetool."+this.toolname}}getOrderTemplate(){return null}copiable(){return P}cloneable(){return null!==this._ownerSource&&null!==this._ownerSource.firstValue()}movable(){return!0}}v.prototype.version=1,t.LineDataSource=v},24146:(e,t,i)=>{i.r(t),i.d(t,{LineToolMultiplePropertyBaseImpl:()=>a,LineToolCollectedProperty:()=>c,LineToolWidthsProperty:()=>h,LineToolColorsProperty:()=>u,MultipleLineWidthsProperty:()=>p,MultipleLineColorsProperty:()=>_});var r=i(11905),n=i(97639),s=i.n(n);const o=(0,
r.getLogger)("Chart.LineToolCollectedProperty");class l{applyValue(e,t){e.setValue(t)}}class a{constructor(e,t){this._onChange=new(s()),this._properties=e,e.forEach(e=>e.subscribe(this,()=>{this._onChange.fire(this)})),this._showIfProperty=t}visible(){var e;return!this._showIfProperty||(null===(e=this._showIfProperty)||void 0===e?void 0:e.value())}value(){if(0===this._properties.length)return o.logError("Incorrect call, should not request value of 0 properties"),"mixed";const e=this._properties[0].value();return 1===this._properties.length||this._properties.every(t=>t.value()===e)?e:"mixed"}state(){}merge(){}destroy(){this._properties.forEach(e=>e.unsubscribeAll(this))}subscribe(e,t){this._onChange.subscribe(e,t)}unsubscribe(e,t){this._onChange.unsubscribe(e,t)}unsubscribeAll(e){this._onChange.unsubscribeAll(e)}storeStateIfUndefined(){return!0}}class c extends a{setValue(e,t,i){if("mixed"===e)return;const r=null!=i?i:new l;this._properties.forEach(t=>r.applyValue(t,e))}}class h extends c{}class u extends c{firstColor(){return this._properties[0].value()}}class d extends a{setValue(e,t,i){if("mixed"===e)return;const r=null!=i?i:new l;this._properties.forEach(t=>t.setValue(e,void 0,r))}}class p extends d{}class _ extends d{}},3573:(e,t,i)=>{t.LineToolFibRetracement=i(45914).LineToolFibRetracement,t.LineToolFibChannel=i(28901).LineToolFibChannel,t.LineToolFibSpeedResistanceArcs=i(3971).LineToolFibSpeedResistanceArcs,t.LineToolProjection=i(89789).LineToolProjection,t.LineToolTrendBasedFibExtension=i(51848).LineToolTrendBasedFibExtension,t.LineToolElliott=i(61708).LineToolElliott,t.LineToolFibCircles=i(51651).LineToolFibCircles,t.LineToolVertLine=i(8374).LineToolVertLine,t.LineToolCrossLine=i(41527).LineToolCrossLine,t.LineToolBarsPattern=i(83819).LineToolBarsPattern,t.LineToolTrendBasedFibTime=i(21564).LineToolTrendBasedFibTime,t.LineToolFibTimeZone=i(58500).LineToolFibTimeZone,t.LineToolCircleLines=i(47373).LineToolCircleLines,t.LineToolDateRange=i(28812).LineToolDateRange,t.LineToolPriceRange=i(54503).LineToolPriceRange,t.LineToolDateAndPriceRange=i(67498).LineToolDateAndPriceRange,t.LineToolParallelChannel=i(1421).LineToolParallelChannel,t.LineToolTrendAngle=i(9304).LineToolTrendAngle,t.LineToolTrendLine=i(39195).LineToolTrendLine,t.LineToolInfoLine=i(87910).LineToolInfoLine,t.LineToolArrowMark=i(50581).LineToolArrowMark,t.LineToolImage=i(61559).LineToolImage,t.LineToolPitchfan=i(59488).LineToolPitchfan,t.LineToolGannSquare=i(90345).LineToolGannSquare,t.LineToolFibSpeedResistanceFan=i(58237).LineToolFibSpeedResistanceFan,t.LineToolGannComplex=i(48807).LineToolGannComplex,t.LineToolGannFixed=i(33091).LineToolGannFixed,t.LineToolGannFan=i(73949).LineToolGannFan,t.LineToolFibWedge=i(24615).LineToolFibWedge,t.LineToolPitchfork=i(19310).LineToolPitchfork,t.LineToolDisjointAngle=i(97364).LineToolDisjointChannel,t.LineToolFlatBottom=i(5047).LineToolFlatBottom,t.LineToolIcon=i(71215).LineToolIcon,t.LineToolRotatedRectangle=i(91983).LineToolRotatedRectangle,t.LineToolFibSpiral=i(39242).LineToolFibSpiral,
t.LineToolHeadAndShoulders=i(50014).LineToolHeadAndShoulders,t.LineToolTriangle=i(53077).LineToolTriangle,t.LineToolTrianglePattern=i(79963).LineToolTrianglePattern,t.LineTool5PointsPattern=i(21595).LineTool5PointsPattern,t.LineToolThreeDrivers=i(52078).LineToolThreeDrivers,t.LineToolABCD=i(96807).LineToolABCD,t.LineToolPolyline=i(47244).LineToolPolyline,t.LineToolPath=i(37575).LineToolPath,t.LineToolPrediction=i(45178).LineToolPrediction,t.LineToolPriceLabel=i(83258).LineToolPriceLabel,t.LineToolArrowMarker=i(65851).LineToolArrowMarker,t.LineToolNote=i(25143).LineToolNote,t.LineToolNoteAbsolute=i(25143).LineToolNoteAbsolute,t.LineToolSignpost=i(23036).LineToolSignpost,t.LineToolBrush=i(97537).LineToolBrush,t.LineToolArc=i(89886).LineToolArc,t.LineToolCallout=i(86779).LineToolCallout,t.LineToolBalloon=i(97807).LineToolBalloon,t.LineToolText=i(91458).LineToolText,t.LineToolHorzLine=i(73224).LineToolHorzLine,t.LineToolHorzRay=i(99924).LineToolHorzRay,t.LineToolRectangle=i(38642).LineToolRectangle,t.LineToolCircle=i(97314).LineToolCircle,t.LineToolEllipse=i(46913).LineToolEllipse,t.LineToolTimeCycles=i(24214).LineToolTimeCycles,t.LineToolSineLine=i(10646).LineToolSineLine,t.LineToolGhostFeed=i(18440).LineToolGhostFeed,t.LineToolBezierQuadro=i(81888).LineToolBezierQuadro,t.LineToolBezierCubic=i(95426).LineToolBezierCubic,t.LineToolArrow=i(60046).LineToolArrow,t.LineToolRay=i(94678).LineToolRay,t.LineToolExtended=i(72353).LineToolExtended,t.LineToolSchiffPitchfork=i(73758).LineToolSchiffPitchfork,t.LineToolSchiffPitchfork2=i(92621).LineToolSchiffPitchfork2,t.LineToolInsidePitchfork=i(44900).LineToolInsidePitchfork,t.LineToolTextAbsolute=i(91458).LineToolTextAbsolute,t.LineToolArrowMarkLeft=i(50581).LineToolArrowMarkLeft,t.LineToolArrowMarkRight=i(50581).LineToolArrowMarkRight,t.LineToolArrowMarkUp=i(50581).LineToolArrowMarkUp,t.LineToolArrowMarkDown=i(50581).LineToolArrowMarkDown,t.LineToolFlagMark=i(20874).LineToolFlagMark,t.LineToolCypherPattern=i(9562).LineToolCypherPattern,t.LineToolElliottImpulse=i(61708).LineToolElliottImpulse,t.LineToolElliottTriangle=i(61708).LineToolElliottTriangle,t.LineToolElliottTripleCombo=i(61708).LineToolElliottTripleCombo,t.LineToolElliottCorrection=i(61708).LineToolElliottCorrection,t.LineToolElliottDoubleCombo=i(61708).LineToolElliottDoubleCombo,t.LineToolRiskRewardLong=i(6711).LineToolRiskRewardLong,t.LineToolRiskRewardShort=i(6711).LineToolRiskRewardShort,t.LineToolPosition=i(31113).LineToolPosition,t.LineToolOrder=i(39344).LineToolOrder,t.LineToolHighlighter=i(33967).LineToolHighlighter,t.LineToolPriceNote=i(42754).LineToolPriceNote,t.LineToolTweet=i(4129).LineToolTweet,t.LineToolIdea=i(49318).LineToolIdea},74993:(e,t,i)=>{i.d(t,{LineToolWithRelativePriceCoordinate:()=>l});var r=i(88537),n=i(24145),s=i(99452),o=i(8170);class l extends n.LineDataSource{constructor(){super(...arguments),this._startMovingAnchorY=NaN}priceSource(){return this.ownerSource()}addPoint(e,t,i){return super.addPoint(this._updatePositionAndCorrectPoint(e),t,i)}setPoint(e,t,i){
super.setPoint(e,this._updatePositionAndCorrectPoint(t,!this.isPhantom()&&!this._allowChangeAnchorHorizontally()),i),this._syncPosition()}setPointAndChangeIndex(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!1),i),this._syncPosition()}startMoving(e,t,i,n){n||(this._startMovingAnchorY=(0,r.ensureNotNull)(this._anchorYCoordinate())),super.startMoving(e,t,i)}move(e,t,i,n){var s;const o=(0,r.ensureDefined)((0,r.ensureNotNull)(this.startMovingPoint()).logical),l=(0,r.ensureDefined)(e.logical);if(!n&&0===t){const e=this._points[0],t=l.index-o.index,i=(0,r.ensureNotNull)(this.priceScale()),n=(0,r.ensure)(null===(s=this.ownerSource())||void 0===s?void 0:s.firstValue()),a=i.priceToCoordinate(l.price,n)-i.priceToCoordinate(o.price,n),c=this._startMovingAnchorY+a,h=i.coordinateToPrice(c,n);this._updatePositionAndCorrectPoint({index:e.index+t,price:h})}super.move(e,t,i),n||this._syncPosition()}_allowChangeAnchorHorizontally(){return!1}_updatePositionAndCorrectPoint(e,t){t&&(e.index=this._points[0].index);const i=this.priceSource();if(null===i)return e;const r=i.priceScale(),n=i.firstValue();if(null===r||r.isEmpty()||null===n)return e;const o=r.height();let l=o/2,a=e.price>=r.coordinateToPrice(l,n)?1:-1;const c=this._model.mainSeries();if(i===c){const t=c.data().search(this._baseSeriesIndexForPoint(e));if(null!==t){const i=(0,s.seriesPrice)(c,t,-1),o=(0,s.seriesPrice)(c,t,1);a=e.price>=i?1:-1,l=r.priceToCoordinate(1===a?o:i,n),e.price=1===a?Math.max(o,e.price):e.price}}const h=1===(-1===a!==r.isInverted()?-1:1)?l:o-l,u=r.priceToCoordinate(e.price,n),d=Math.min(o,Math.abs(u-l)),p=Math.max(0,Math.min(100,100*d/h))*a;return this.properties().childs().position.setValue(p),e}_baseSeriesIndexForPoint(e){return e.index}_syncPosition(){const e=this.linkKey().value();if(null!==e){const t={position:this.properties().childs().position.value()};(0,o.changeLineStyle)({linkKey:e,state:t,model:this._model})}}_anchorYCoordinate(){const e=this.priceSource();if(null===e)return null;const t=e.priceScale(),i=e.firstValue();if(null===t||t.isEmpty()||null===i)return null;const r=this._model.mainSeries(),n=this.customEvent();if(null===n)return null;let o=null;if(e===r&&(o=(0,s.seriesBasePosition)(r,n)),null===o&&(o=(0,s.noDataBasePosition)(n,t,i)),null===o)return null;const l=n.position(),a=t.priceToCoordinate(o.price,i);return(0,s.positionToCoordinate)(l,t.height(),a,(0,s.positionVisualDirection)(l,t.isInverted()))}}},85481:(e,t,i)=>{i.d(t,{lineToolsLocalizedNames:()=>s});var r=i(25226),n=i(87236);const s={LineTool5PointsPattern:(0,n.t)("XABCD Pattern"),LineToolABCD:(0,n.t)("ABCD Pattern"),LineToolArc:(0,n.t)("Arc"),LineToolArrow:(0,n.t)("Arrow"),LineToolArrowMarkDown:(0,n.t)("Arrow Mark Down"),LineToolArrowMarkLeft:(0,n.t)("Arrow Mark Left"),LineToolArrowMarkRight:(0,n.t)("Arrow Mark Right"),LineToolArrowMarkUp:(0,n.t)("Arrow Mark Up"),LineToolBalloon:(0,n.t)("Balloon"),LineToolBarsPattern:(0,n.t)("Bars Pattern"),LineToolBezierCubic:(0,n.t)("Double Curve"),LineToolBezierQuadro:(0,n.t)("Curve"),LineToolBrush:(0,n.t)("Brush"),
LineToolCallout:(0,n.t)("Callout"),LineToolCircleLines:(0,n.t)("Cyclic Lines"),LineToolCypherPattern:(0,n.t)("Cypher Pattern"),LineToolDateAndPriceRange:(0,n.t)("Date and Price Range"),LineToolDateRange:(0,n.t)("Date Range"),LineToolDisjointAngle:(0,n.t)("Disjoint Channel"),LineToolElliottCorrection:(0,n.t)("Elliott Correction Wave (ABC)"),LineToolElliottDoubleCombo:(0,n.t)("Elliott Double Combo Wave (WXY)"),LineToolElliottImpulse:(0,n.t)("Elliott Impulse Wave (12345)"),LineToolElliottTriangle:(0,n.t)("Elliott Triangle Wave (ABCDE)"),LineToolElliottTripleCombo:(0,n.t)("Elliott Triple Combo Wave (WXYXZ)"),LineToolEllipse:(0,n.t)("Ellipse"),LineToolExtended:(0,n.t)("Extended Line"),LineToolFibChannel:(0,n.t)("Fib Channel"),LineToolFibCircles:(0,n.t)("Fib Circles"),LineToolFibRetracement:(0,n.t)("Fib Retracement"),LineToolFibSpeedResistanceArcs:(0,n.t)("Fib Speed Resistance Arcs"),LineToolFibSpeedResistanceFan:(0,n.t)("Fib Speed Resistance Fan"),LineToolFibSpiral:(0,n.t)("Fib Spiral"),LineToolFibTimeZone:(0,n.t)("Fib Time Zone"),LineToolFibWedge:(0,n.t)("Fib Wedge"),LineToolFlagMark:(0,n.t)("Flag Mark"),LineToolImage:(0,n.t)("Image"),LineToolFlatBottom:(0,n.t)("Flat Top/Bottom"),LineToolAnchoredVWAP:(0,n.t)("Anchored VWAP"),LineToolGannComplex:(0,n.t)("Gann Square"),LineToolGannFixed:(0,n.t)("Gann Square Fixed"),LineToolGannFan:(0,n.t)("Gann Fan"),LineToolGannSquare:(0,n.t)("Gann Box"),LineToolHeadAndShoulders:(0,n.t)("Head and Shoulders"),LineToolHorzLine:(0,n.t)("Horizontal Line"),LineToolHorzRay:(0,n.t)("Horizontal Ray"),LineToolIcon:(0,n.t)("Icon"),LineToolInsidePitchfork:(0,n.t)("Inside Pitchfork"),LineToolNote:(0,n.t)("Note"),LineToolNoteAbsolute:(0,n.t)("Anchored Note"),LineToolSignpost:(0,n.t)("Signpost"),LineToolParallelChannel:(0,n.t)("Parallel Channel"),LineToolPitchfan:(0,n.t)("Pitchfan"),LineToolPitchfork:(0,n.t)("Pitchfork"),LineToolPolyline:(0,n.t)("Polyline"),LineToolPath:(0,n.t)("Path"),LineToolPrediction:(0,n.t)("Forecast"),LineToolPriceLabel:(0,n.t)("Price Label"),LineToolArrowMarker:(0,n.t)("Arrow Marker"),LineToolPriceRange:(0,n.t)("Price Range"),LineToolProjection:(0,n.t)("Projection"),LineToolRay:(0,n.t)("Ray"),LineToolRectangle:(0,n.t)("Rectangle"),LineToolCircle:(0,n.t)("Circle"),LineToolRegressionTrend:(0,n.t)("Regression Trend"),LineToolRiskRewardLong:(0,n.t)("Long Position"),LineToolRiskRewardShort:(0,n.t)("Short Position"),LineToolFixedRangeVolumeProfile:(0,n.t)("Fixed Range Volume Profile"),LineToolRotatedRectangle:(0,n.t)("Rotated Rectangle"),LineToolSchiffPitchfork:(0,n.t)("Modified Schiff Pitchfork"),LineToolSchiffPitchfork2:(0,n.t)("Schiff Pitchfork"),LineToolSineLine:(0,n.t)("Sine Line"),LineToolText:(0,n.t)("Text",{context:"tool"}),LineToolTextAbsolute:(0,n.t)("Anchored Text"),LineToolThreeDrivers:(0,n.t)("Three Drives Pattern"),LineToolTimeCycles:(0,n.t)("Time Cycles"),LineToolTrendAngle:(0,n.t)("Trend Angle"),LineToolTrendBasedFibExtension:(0,n.t)("Trend-Based Fib Extension"),LineToolTrendBasedFibTime:(0,n.t)("Trend-Based Fib Time"),LineToolTrendLine:(0,n.t)("Trend Line"),
LineToolInfoLine:(0,n.t)("Info Line"),LineToolTriangle:(0,n.t)("Triangle"),LineToolTrianglePattern:(0,n.t)("Triangle Pattern"),LineToolVertLine:(0,n.t)("Vertical Line"),LineToolCrossLine:(0,n.t)("Cross Line"),LineToolHighlighter:(0,n.t)("Highlighter"),LineToolPriceNote:(0,n.t)("Price Note"),LineToolVbPFixed:(0,n.t)("Volume Profile Fixed Range")};(0,r.isFeatureEnabled)("remove-line-tool-ghost-feed")||(s.LineToolGhostFeed=(0,n.t)("Ghost Feed")),s.LineToolTweet=(0,n.t)("Tweet"),s.LineToolIdea=(0,n.t)("Idea")},25143:(e,t,i)=>{var r=i(87236).t,n=i(24145).LineDataSource,s=i(32567),o=i(46090).DefaultProperty;class l extends n{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this.version=l.version,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,91453)).then(({NotePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 1}name(){return"Note"}getTooltipWidth(){return l.TOOLTIP_WIDTH}getTooltipPadding(){return l.TOOLTIP_PADDING}getTooltipLineSpacing(){return l.TOOLTIP_LINESPACING}template(){var e=n.prototype.template.call(this);return e.text=this.properties().childs().text.value(),e}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static createProperties(e){void 0!==e&&void 0!==e.markerColor&&void 0===e.borderColor&&(e.borderColor=e.markerColor);var t=new o("linetoolnote",e);return l._configureProperties(t),t}state(e){var t=n.prototype.state.call(this,e);return e&&(t.state.fixedSize=!1),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,21332))).NoteDefinitionsViewModel}static _configureProperties(e){n._configureProperties(e),e.hasChild("text")||e.addChild("text",new s(r("Text"))),e.addExclusion("text")}}l.TOOLTIP_WIDTH=300,l.TOOLTIP_PADDING=10,l.TOOLTIP_LINESPACING=5,l.version=1;class a extends l{constructor(e,t){super(e,t||a.createProperties())}title(){return r("Anchored Note")}name(){return"Anchored Note"}isFixed(){return!0}hasEditableCoordinates(){return!1}static createProperties(e){var t=new o("linetoolnoteabsolute",e);return a._configureProperties(t),t}static _configureProperties(e){l._configureProperties(e)}}t.LineToolNote=l,t.LineToolNoteAbsolute=a},39344:(e,t,i)=>{var r=i(57759).LineToolTrading,n=i(71073).LineToolPriceAxisView,s=i(56616),o=i(24145).LineDataSource,l=i(46090).DefaultProperty;const a=i(11688);var c=i(34953).sortSourcesPreOrdered.LineToolOrder;function h(e){return null==e?e="":e+="",e}class u{constructor(e){this._line=e,this._data={bodyText:"order",quantityText:"0"},this._editable=!0,this._cancellable=!0,this._mode="",this._direction="buy",this._active=!0}setMode(e){return this._mode=e,this._line.updateAllViewsAndRedraw(),this}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setActive(e){return this._active=e,this._line.updateAllViewsAndRedraw(),this}setEditable(e){return this._editable=e,this._line.updateAllViewsAndRedraw(),this}getEditable(){return this._editable}setCancellable(e){return this._cancellable=e,
this._line.updateAllViewsAndRedraw(),this}getCancellable(){return this._cancellable}hasMoveCallback(){return this.isFunction(this._onMoveCallback)}hasModifyCallback(){return this.isFunction(this._onModifyCallback)}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line._points[0]=t,this._line.normalizePoints(),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(h(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setModifyTooltip(e){return this._line.properties().modifyTooltip.setValue(h(e)),this}getModifyTooltip(){return this._line.properties().modifyTooltip.value()}setCancelTooltip(e){return this._line.properties().cancelTooltip.setValue(h(e)),this}getCancelTooltip(){return this._line.properties().cancelTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e){return this._line.properties().lineLength.setValue(Math.max(0,Math.min(e,100))),this}getLineColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.lineActiveBuyColor.value():e.lineInactiveBuyColor.value():this._active?e.lineActiveSellColor.value():e.lineInactiveSellColor.value()}setLineColor(e){return"buy"===this._direction?this._active?this.setLineActiveBuyColor(e):this.setLineInactiveBuyColor(e):this._active?this.setLineActiveSellColor(e):this.setLineInactiveSellColor(e),this}setLineActiveBuyColor(e){return this._line.properties().lineActiveBuyColor.setValue(e),this}setLineInactiveBuyColor(e){return this._line.properties().lineInactiveBuyColor.setValue(e),this}setLineActiveSellColor(e){return this._line.properties().lineActiveSellColor.setValue(e),this}setLineInactiveSellColor(e){return this._line.properties().lineInactiveSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}
getBodyBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.bodyBorderActiveBuyColor.value():e.bodyBorderInactiveBuyColor.value():this._active?e.bodyBorderActiveSellColor.value():e.bodyBorderInactiveSellColor.value()}setBodyBorderColor(e){return"buy"===this._direction?this._active?this.setBodyBorderActiveBuyColor(e):this.setBodyBorderInactiveBuyColor(e):this._active?this.setBodyBorderActiveSellColor(e):this.setBodyBorderInactiveSellColor(e),this}setBodyBorderActiveBuyColor(e){return this._line.properties().bodyBorderActiveBuyColor.setValue(e),this}setBodyBorderInactiveBuyColor(e){return this._line.properties().bodyBorderInactiveBuyColor.setValue(e),this}setBodyBorderActiveSellColor(e){return this._line.properties().bodyBorderActiveSellColor.setValue(e),this}setBodyBorderInactiveSellColor(e){return this._line.properties().bodyBorderInactiveSellColor.setValue(e),this}getBodyBackgroundColor(){return s.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return s.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return"limit"===this._mode?this._active?e.bodyTextActiveLimitColor.value():e.bodyTextInactiveLimitColor.value():"stop"===this._mode?this._active?e.bodyTextActiveStopColor.value():e.bodyTextInactiveStopColor.value():"buy"===this._direction?this._active?e.bodyTextActiveBuyColor.value():e.bodyTextInactiveBuyColor.value():this._active?e.bodyTextActiveSellColor.value():e.bodyTextInactiveSellColor.value()}setBodyTextColor(e){return"limit"===this._mode?this._active?this.setBodyTextActiveLimitColor(e):this.setBodyTextInactiveLimitColor(e):"stop"===this._mode?this._active?this.setBodyTextActiveStopColor(e):this.setBodyTextInactiveStopColor(e):"buy"===this._direction?this._active?this.setBodyTextActiveBuyColor(e):this.setBodyTextInactiveBuyColor(e):this._active?this.setBodyTextActiveSellColor(e):this.setBodyTextInactiveSellColor(e),this}setBodyTextInactiveLimitColor(e){return this._line.properties().bodyTextInactiveLimitColor.setValue(e),this}setBodyTextActiveLimitColor(e){return this._line.properties().bodyTextActiveLimitColor.setValue(e),this}setBodyTextInactiveStopColor(e){return this._line.properties().bodyTextInactiveStopColor.setValue(e),this}setBodyTextActiveStopColor(e){return this._line.properties().bodyTextActiveStopColor.setValue(e),this}setBodyTextInactiveBuyColor(e){return this._line.properties().bodyTextInactiveBuyColor.setValue(e),this}setBodyTextActiveBuyColor(e){return this._line.properties().bodyTextActiveBuyColor.setValue(e),this}setBodyTextInactiveSellColor(e){return this._line.properties().bodyTextInactiveSellColor.setValue(e),this}setBodyTextActiveSellColor(e){return this._line.properties().bodyTextActiveSellColor.setValue(e),this}getBodyFont(){
return s.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return s.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBorderActiveBuyColor.value():e.quantityBorderInactiveBuyColor.value():this._active?e.quantityBorderActiveSellColor.value():e.quantityBorderInactiveSellColor.value()}setQuantityBorderColor(e){return"buy"===this._direction?this._active?this.setQuantityBorderActiveBuyColor(e):this.setQuantityBorderInactiveBuyColor(e):this._active?this.setQuantityBorderActiveSellColor(e):this.setQuantityBorderInactiveSellColor(e),this}setQuantityBorderActiveBuyColor(e){return this._line.properties().quantityBorderActiveBuyColor.setValue(e),this}setQuantityBorderInactiveBuyColor(e){return this._line.properties().quantityBorderInactiveBuyColor.setValue(e),this}setQuantityBorderActiveSellColor(e){return this._line.properties().quantityBorderActiveSellColor.setValue(e),this}setQuantityBorderInactiveSellColor(e){return this._line.properties().quantityBorderInactiveSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBackgroundActiveBuyColor.value():e.quantityBackgroundInactiveBuyColor.value():this._active?e.quantityBackgroundActiveSellColor.value():e.quantityBackgroundInactiveSellColor.value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this._active?this.setQuantityBackgroundActiveBuyColor(e):this.setQuantityBackgroundInactiveBuyColor(e):this._active?this.setQuantityBackgroundActiveSellColor(e):this.setQuantityBackgroundInactiveSellColor(e),this}setQuantityBackgroundActiveBuyColor(e){return this._line.properties().quantityBackgroundActiveBuyColor.setValue(e),this}setQuantityBackgroundInactiveBuyColor(e){return this._line.properties().quantityBackgroundInactiveBuyColor.setValue(e),this}setQuantityBackgroundActiveSellColor(e){return this._line.properties().quantityBackgroundActiveSellColor.setValue(e),this}setQuantityBackgroundInactiveSellColor(e){return this._line.properties().quantityBackgroundInactiveSellColor.setValue(e),this}getQuantityTextColor(){return s.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return s.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return s.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){
return s.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getCancelButtonBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonBorderActiveBuyColor.value():e.cancelButtonBorderInactiveBuyColor.value():this._active?e.cancelButtonBorderActiveSellColor.value():e.cancelButtonBorderInactiveSellColor.value()}setCancelButtonBorderColor(e){return"buy"===this._direction?this._active?this.setCancelButtonBorderActiveBuyColor(e):this.setCancelButtonBorderInactiveBuyColor(e):this._active?this.setCancelButtonBorderActiveSellColor(e):this.setCancelButtonBorderInactiveSellColor(e),this}setCancelButtonBorderActiveBuyColor(e){return this._line.properties().cancelButtonBorderActiveBuyColor.setValue(e),this}setCancelButtonBorderInactiveBuyColor(e){return this._line.properties().cancelButtonBorderInactiveBuyColor.setValue(e),this}setCancelButtonBorderActiveSellColor(e){return this._line.properties().cancelButtonBorderActiveSellColor.setValue(e),this}setCancelButtonBorderInactiveSellColor(e){return this._line.properties().cancelButtonBorderInactiveSellColor.setValue(e),this}getCancelButtonBackgroundColor(){return s.getColorFromProperties(this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency)}setCancelButtonBackgroundColor(e){return s.setColorToProperties(e,this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency),this}getCancelButtonIconColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonIconActiveBuyColor.value():e.cancelButtonIconInactiveBuyColor.value():this._active?e.cancelButtonIconActiveSellColor.value():e.cancelButtonIconInactiveSellColor.value()}setCancelButtonIconColor(e){return"buy"===this._direction?this._active?this.setCancelButtonIconActiveBuyColor(e):this.setCancelButtonIconInactiveBuyColor(e):this._active?this.setCancelButtonIconActiveSellColor(e):this.setCancelButtonIconInactiveSellColor(e),this}setCancelButtonIconActiveBuyColor(e){return this._line.properties().cancelButtonIconActiveBuyColor.setValue(e),this}setCancelButtonIconInactiveBuyColor(e){return this._line.properties().cancelButtonIconInactiveBuyColor.setValue(e),this}setCancelButtonIconActiveSellColor(e){return this._line.properties().cancelButtonIconActiveSellColor.setValue(e),this}setCancelButtonIconInactiveSellColor(e){return this._line.properties().cancelButtonIconInactiveSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}getBlocked(){return this._blocked}isFunction(e){return"function"==typeof e}onCancel(e,t){return t?this.isFunction(t)&&(this._onCancelData=e,this._onCancelCallback=t):this.isFunction(e)&&(this._onCancelCallback=e),this}callOnCancel(){
this.isFunction(this._onCancelCallback)&&this._onCancelCallback.call(this,this._onCancelData)}isOnCancelCallbackPresent(){return this.isFunction(this._onCancelCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onMove(e,t){return t?this.isFunction(t)&&(this._onMoveData=e,this._onMoveCallback=t):this.isFunction(e)&&(this._onMoveCallback=e),this}callOnMove(){this.isFunction(this._onMoveCallback)&&this._onMoveCallback.call(this,this._onMoveData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class d extends r{constructor(e,t){super(e,t||d.createProperties()),this._adapter=new u(this),this.setSelectionEnabled(!0),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,2716)).then(({OrderPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}zorder(){return c}isSpeciallyZOrderedSource(){return!0}setPoint(e,t,i){this._points[e]=t,this.normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}name(){return"Order"}endMoving(e){var t=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.endMoving(),!e&&t&&this._adapter.callOnMove()}createPriceAxisView(e){var t={pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()};return this._priceAxisView=new n(this,t),this._priceAxisView}paneViews(){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.priceAxisViews.call(this,e,t):null}adapter(){return this._adapter}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}movable(){return Boolean(this._adapter._onMoveCallback)}static createProperties(e){var t=new l("linetoolorder",e,!1,!1);return d._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolOrder=d},1421:(e,t,i)=>{i.d(t,{LineToolParallelChannel:()=>c});var r=i(88537),n=i(86441),s=i(46090),o=i(8170),l=i(24145),a=i(70617);class c extends l.LineDataSource{constructor(e,t,r,n){super(e,t||c.createProperties(),r,n),this._priceAxisViews.push(this.createPriceAxisView(3)),this._coordOffsetWhileMovingOrChanging=null,
this._pendingPriceOffset=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,9779)).then(({ParallelChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}paneViews(e){return null!==this._pendingPriceOffset&&this._applyPendingPriceOffset(),super.paneViews(e)}setLastPoint(e,t){t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[0]);const i=(0,a.clone)(e);return super.setLastPoint(e),i}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endMoving(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endMoving(e,t,i)}startChanging(e,t){super.startChanging(e,t),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endChanging(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endChanging(e,t)}restoreExternalPoints(e,t,i){const r=i?e.points:this._timePoint.map((t,i)=>({price:t.price,offset:e.points[i].offset,time_t:e.points[i].time_t}));if(super.restoreExternalPoints({...e,points:r},t),t.pricesChanged&&this._points.length===r.length)for(let e=0;e<r.length;e++)this._points[e].price=r[e].price}setPoint(e,t,i,n){var s;if(this._points[0].index===this._points[1].index&&e>=4)return;this._snapPointBeforeChange(e,t,i);const l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),c=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),h=(0,r.ensureNotNull)(this._coordOffsetWhileMovingOrChanging),u=(0,r.ensureNotNull)(this.priceScale()),d=(0,r.ensure)(null===(s=this.ownerSource())||void 0===s?void 0:s.firstValue());switch(e){case 0:super.setPoint(e,t,i),this._points[2].price=u.coordinateToPrice(c.y+h,d);break;case 1:super.setPoint(e,t,i);break;case 2:super.setPoint(e,t,i),this._points[0].price=u.coordinateToPrice(c.y-h,d),this._points[0].index=t.index;break;case 3:this._points[1].price=u.coordinateToPrice(c.y-h,d),this._points[1].index=t.index;break;case 4:{const e=a.subtract(l),t=(c.x-l.x)/e.x,i=l.addScaled(e,t),r=c.y-i.y;this._points[2].price=u.coordinateToPrice(l.y+r,d);break}case 5:{const e=a.subtract(l),t=(c.x-l.x)/e.x,i=l.addScaled(e,t),r=c.y-i.y;this._points[0].price=u.coordinateToPrice(l.y+r,d),this._points[1].price=u.coordinateToPrice(a.y+r,d);break}}const p=this.linkKey().value();if(p&&!n&&e<4){const e=this._points.map(e=>e.price);(0,o.changeLineStyle)({model:this._model,linkKey:p,state:{prices:e}})}}state(e){const t=l.LineDataSource.prototype.state.call(this,e);return this._pendingPriceOffset&&(t.priceOffset=this._pendingPriceOffset),t}restoreExternalState(e){const t={...e};if(t.prices&&this.isActualSymbol())for(let e=0;e<t.prices.length;e++)this._points[e].price=t.prices[e],this._timePoint[e].price=t.prices[e];delete t.prices,super.restoreExternalState(t)}restoreData(e){void 0!==e.priceOffset&&(this._pendingPriceOffset=e.priceOffset)}getPoint(e){if(e<3)return l.LineDataSource.prototype.getPoint.call(this,e)
;const t=this.pointToScreenPoint(this._points[0]),i=this.pointToScreenPoint(this._points[1]),r=this.pointToScreenPoint(this._points[2]);if(!t||!i||!r)return null;switch(e){case 3:{const e=r.y-t.y,s=i.add(new n.Point(0,e));return this.screenPointToPoint(s)}case 4:{const e=r.y-t.y,s=i.add(new n.Point(0,e)),o=r.add(s).scaled(.5);return this.screenPointToPoint(o)}case 5:{const e=t.add(i).scaled(.5);return this.screenPointToPoint(e)}}return null}alignCrossHairToAnchor(e){return e<=3}pointsCount(){return 3}name(){return"Parallel Channel"}hasEditableCoordinates(){return!1}addPoint(e,t,i){const n=this.points().length;return t&&t.shift()&&2===n&&this._snapPoint45Degree(e,this.points()[0]),2===this._points.length&&(e=this._convertLastPointTo3rdPoint((0,r.ensureNotNull)(this._lastPoint))),l.LineDataSource.prototype.addPoint.call(this,e,t)}timeAxisPoints(){return this._axisPoints()}priceAxisPoints(){return this._axisPoints()}canHasAlert(){return!0}static createProperties(e){const t=new s.DefaultProperty("linetoolparallelchannel",e);return c._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,45109))).ParallelChannelDefinitionsViewModel}_getAlertPlots(){const e=this.getPoint(3);if(!e)return[];const t=[this._points[0],this._points[1],this._points[2],e],i=(e,t)=>e.index<=t.index?[e,t]:[t,e],r=i(t[0],t[1]),n=i(t[2],t[3]);let s,o,l,a;t[2].price<t[0].price?(o=n,s=r):(o=r,s=n);const c=this.properties().childs().extendLeft.value(),h=this.properties().childs().extendRight.value();return t[0].index<=t[1].index?(l=c,a=h):(l=h,a=c),[this._linePointsToAlertPlot(s,"Upper",l,a),this._linePointsToAlertPlot(o,"Lower",l,a)]}_correctLastPoint(e){if(this._points.length<2||this._points[1].index===this._points[0].index)return e;const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),s=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=i.subtract(s),l=(t.x-s.x)/o.x,a=s.addScaled(o,l),c=t.y-a.y,h=s.add(new n.Point(0,c));return(0,r.ensureNotNull)(this.screenPointToPoint(h))}static _configureProperties(e){l.LineDataSource._configureProperties(e)}_axisPoints(){const e=this.points(),t=this._points[0]?this.pointToScreenPoint(this._points[0]):null,i=this._points[1]?this.pointToScreenPoint(this._points[1]):null,s=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(t&&i&&s){const o=i.y-t.y,l=s.add(new n.Point(0,o));e.push((0,r.ensureNotNull)(this.screenPointToPoint(l)))}return e}_convertLastPointTo3rdPoint(e){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),s=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=i.subtract(s),l=(t.x-s.x)/o.x,a=s.addScaled(o,l),c=t.y-a.y,h=s.add(new n.Point(0,c));return(0,r.ensureNotNull)(this.screenPointToPoint(h))}_findPixelsHeight(){const e=this.pointToScreenPoint(this._points[2]),t=this.pointToScreenPoint(this._points[0]);return e&&t?e.y-t.y:null}
_applyPendingPriceOffset(){const e=this._pendingPriceOffset;if(null===e||this._points.length<3)return;const t=this.priceScale(),i=(0,r.ensureNotNull)(this.ownerSource()).firstValue();if(!t||t.isEmpty()||null===i)return;const n=e+this._points[0].price,s=e+this._points[1].price,o=.5*(n+s)-e,l=.5*(n+s),a=t.priceToCoordinate(o,i),c=t.priceToCoordinate(l,i)-a,h=t.priceToCoordinate(this._points[0].price,i)+c,u=t.coordinateToPrice(h,i);this._points[2].price=u,this._timePoint[2].price=u,this._points[2].index=this._points[0].index,this._timePoint[2].time_t=this._timePoint[0].time_t,this._timePoint[2].offset=this._timePoint[0].offset,this._pendingPriceOffset=null}_snapPointBeforeChange(e,t,i){if(i&&i.shift())switch(e){case 0:case 1:this._snapPoint45Degree(t,this._points[1-e]);break;case 2:case 3:const i=(0,r.ensureNotNull)(this.getPoint(5-e));this._snapPoint45Degree(t,i)}}}},37575:(e,t,i)=>{i.d(t,{LineToolPath:()=>c});var r=i(88537),n=i(86441),s=i(46090),o=i(1132),l=i(24145),a=i(24146);class c extends l.LineDataSource{constructor(e,t,r,n){const s=t||c.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,43093)).then(t=>{this._setPaneViews([new t.PathPaneView(this,e)])})}pointsCount(){return-1}name(){return"Path"}hasEditableCoordinates(){return!1}addPoint(e,t,i){var s;const l=(0,r.ensureNotNull)(this.priceScale()),a=this._model.timeScale().indexToCoordinate(e.index),c=e.price,h=(0,r.ensure)(null===(s=this.ownerSource())||void 0===s?void 0:s.firstValue()),u=l.priceToCoordinate(c,h);if(this._points.length>0){const e=this._points[this._points.length-1],t=this._model.timeScale().indexToCoordinate(e.index),i=e.price,r=l.priceToCoordinate(i,h);if(new n.Point(a,u).subtract(new n.Point(t,r)).length()<(0,o.interactionTolerance)().minDistanceBetweenPoints)return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}static createProperties(e){const t=new s.DefaultProperty("linetoolpath",e);return c._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,5782)).then(e=>e.PathDefinitionsViewModel)}static _configureProperties(e){l.LineDataSource._configureProperties(e),e.addChild("linesWidths",new a.LineToolWidthsProperty([(0,r.ensureDefined)(e.child("lineWidth"))])),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().lineColor]))}}},59488:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,95491)).then(({PitchfanLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 3}name(){return"Pitchfan"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}
async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,99025))).PitchBaseDefinitionsViewModel}static createProperties(e){var t=new o("linetoolpitchfan",e,!1,{range:[0,8]});return u._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e);for(var t=[e.child("median").child("linewidth")],i=[e.child("median").child("color")],r=0;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.LevelsCount=8,t.LineToolPitchfan=u},19310:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(29770).Action,a=i(63585).ACTION_ID,c=i(78142).LineToolPitchforkStyle,h=null,u=i(24146),d=u.LineToolWidthsProperty,p=u.LineToolColorsProperty,_=new n("erase level line",r("erase level line")),P=new n("change {title} style",r("change {title} style"));class g extends s{constructor(e,t,i,r){super(e,t||g.createProperties(),i,r),this._properties.style.listeners().subscribe(this,g.prototype._recreatePaneView),this._recreatePaneView()}levelsCount(){return g.LevelsCount}additionalActions(e){for(var t=[],i=[{title:r("Original"),actionId:a.ChartLineToolPitchforkChangeTypeToOriginal},{title:r("Modified Schiff"),actionId:a.ChartLineToolPitchforkChangeTypeToModifiedSchiff},{title:r("Inside"),actionId:a.ChartLineToolPitchforkChangeTypeToInside},{title:r("Schiff"),actionId:a.ChartLineToolPitchforkChangeTypeToSchiff}],s=0;s<4;s++){var o=new l({actionId:i[s].actionId,checked:this.properties().style.value()===s,checkable:!0,label:i[s].title,payload:{target:this,value:s},onExecute:function(t){var i=t.getPayload(),r=i.target;e.setProperty(r.properties().style,i.value,P.format({title:new n(r.name(),r.title())})),r.updateAllViews(),r._model.updateSource(r)}});t.push(o)}return[t[0],t[3],t[1],t[2]]}_recreatePaneView(){if(null!==h){var e=[];this._properties.style.value()===c.Original?e=[new h.PitchforkLinePaneView(this,this._model)]:this._properties.style.value()===c.Schiff?e=[new h.SchiffPitchforkLinePaneView(this,this._model)]:this._properties.style.value()===c.Schiff2?e=[new h.SchiffPitchfork2LinePaneView(this,this._model)]:this._properties.style.value()===c.Inside&&(e=[new h.InsidePitchforkLinePaneView(this,this._model)]),this._setPaneViews(e)}else Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,23440)).then(e=>{null===h&&(h=e),this._recreatePaneView()})}pointsCount(){return 3}name(){return"Pitchfork"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,_)}static createProperties(e){var t=new o("linetoolpitchfork",e,!1,{range:[0,8]});return g._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,48195))).PitchForkDefinitionsViewModel}static _configureProperties(e){s._configureProperties(e)
;for(var t=[e.child("median").child("linewidth")],i=[e.child("median").child("color")],r=0;r<=g.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new p(i)),e.addChild("linesWidths",new d(t))}}g.LevelsCount=8,t.LineToolPitchfork=g},47244:(e,t,i)=>{i.d(t,{LineToolPolyline:()=>a});var r=i(88537),n=i(86441),s=i(46090),o=i(1132),l=i(24145);class a extends l.LineDataSource{constructor(e,t,r,n){const s=t||a.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,62955)).then(t=>{this._setPaneViews([new t.PolylinePaneView(this,e)])})}pointsCount(){return-1}name(){return"Polyline"}hasEditableCoordinates(){return!1}addPoint(e,t,i){var s;const l=(0,r.ensureNotNull)(this.priceScale()),a=this._model.timeScale().indexToCoordinate(e.index),c=e.price,h=(0,r.ensure)(null===(s=this.ownerSource())||void 0===s?void 0:s.firstValue()),u=l.priceToCoordinate(c,h),d=(0,o.interactionTolerance)().minDistanceBetweenPoints;if(this._points.length>0){const e=this._points[this._points.length-1],t=this._model.timeScale().indexToCoordinate(e.index),i=e.price,r=l.priceToCoordinate(i,h);if(new n.Point(a,u).subtract(new n.Point(t,r)).length()<d)return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0;const s=this._points[0],o=this._model.timeScale().indexToCoordinate(s.index),c=s.price,p=l.priceToCoordinate(c,h);if(new n.Point(a,u).subtract(new n.Point(o,p)).length()<d)return this.properties().childs().filled.setValue(!0),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}setPoint(e,t,i){var s;super.setPoint(e,t,i);const l=this.priceScale();if(!(this._model.timeScale().isEmpty()||null===l||l.isEmpty()||e!==this._points.length-1&&0!==e)){const i=(0,r.ensure)(null===(s=this.ownerSource())||void 0===s?void 0:s.firstValue()),a=this._model.timeScale().indexToCoordinate(t.index),c=l.priceToCoordinate(t.price,i),h=e===this._points.length-1?this._points[0]:this._points[this._points.length-1],u=this._model.timeScale().indexToCoordinate(h.index),d=l.priceToCoordinate(h.price,i);new n.Point(a,c).subtract(new n.Point(u,d)).length()<(0,o.interactionTolerance)().minDistanceBetweenPoints&&this.properties().childs().filled.setValue(!0)}}static createProperties(e){const t=new s.DefaultProperty("linetoolpolyline",e);return a._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,38645)).then(e=>e.PolylinesDefinitionsViewModel)}static _configureProperties(e){l.LineDataSource._configureProperties(e),e.addExclusion("filled")}}},42651:(e,t,i)=>{i.d(t,{PositionAveragePriceAxisView:()=>n});var r=i(71073);class n extends r.LineToolPriceAxisView{_formatPrice(e,t){return this._source.formatter().format(e)}}},31113:(e,t,i)=>{var r=i(57759).LineToolTrading,n=i(24145).LineDataSource,s=i(42651).PositionAveragePriceAxisView,o=i(56616),l=i(46090).DefaultProperty,a=i(89765).PriceFormatter;const c=i(11688)
;var h=i(34953).sortSourcesPreOrdered.LineToolPosition;function u(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"position",quantityText:"0"},this._closeEnabled=!0,this._direction="buy",this._profitState="neutral"}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setProfitState(e){return this._profitState=e,this._line.updateAllViewsAndRedraw(),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line._points[0]=t,this._line.normalizePoints(),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setProtectTooltip(e){return this._line.properties().protectTooltip.setValue(u(e)),this}getProtectTooltip(){return this._line.properties().protectTooltip.value()}setCloseTooltip(e){return this._line.properties().closeTooltip.setValue(u(e)),this}getCloseTooltip(){return this._line.properties().closeTooltip.value()}setReverseTooltip(e){return this._line.properties().reverseTooltip.setValue(u(e)),this}getReverseTooltip(){return this._line.properties().reverseTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e){return this._line.properties().lineLength.setValue(Math.max(0,Math.min(e,100))),this}getLineColor(){var e=this._line.properties();return("buy"===this._direction?e.lineBuyColor:e.lineSellColor).value()}setLineColor(e){return"buy"===this._direction?this.setLineBuyColor(e):this.setLineSellColor(e),this}setLineBuyColor(e){return this._line.properties().lineBuyColor.setValue(e),this}setLineSellColor(e){return this._line.properties().lineSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties()
;return("buy"===this._direction?e.bodyBorderBuyColor:e.bodyBorderSellColor).value()}setBodyBorderColor(e){return"buy"===this._direction?this.setBodyBorderBuyColor(e):this.setBodyBorderSellColor(e),this}setBodyBorderBuyColor(e){return this._line.properties().bodyBorderBuyColor.setValue(e),this}setBodyBorderSellColor(e){return this._line.properties().bodyBorderSellColor.setValue(e),this}getBodyBackgroundColor(){return o.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return("positive"===this._profitState?e.bodyTextPositiveColor:"negative"===this._profitState?e.bodyTextNegativeColor:e.bodyTextNeutralColor).value()}setBodyTextColor(e){return"positive"===this._profitState?this.setBodyTextPositiveColor(e):"negative"===this._profitState?this.setBodyTextNegativeColor(e):this.setBodyTextNeutralColor(e),this}setBodyTextPositiveColor(e){return this._line.properties().bodyTextPositiveColor.setValue(e),this}setBodyTextNegativeColor(e){return this._line.properties().bodyTextNegativeColor.setValue(e),this}setBodyTextNeutralColor(e){return this._line.properties().bodyTextNeutralColor.setValue(e),this}getBodyFont(){return o.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return o.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBorderBuyColor:e.quantityBorderSellColor).value()}setQuantityBorderColor(e){return"buy"===this._direction?this.setQuantityBorderBuyColor(e):this.setQuantityBorderSellColor(e),this}setQuantityBorderBuyColor(e){return this._line.properties().quantityBorderBuyColor.setValue(e),this}setQuantityBorderSellColor(e){return this._line.properties().quantityBorderSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBackgroundBuyColor:e.quantityBackgroundSellColor).value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this.setQuantityBackgroundBuyColor(e):this.setQuantityBackgroundSellColor(e),this}setQuantityBackgroundBuyColor(e){return this._line.properties().quantityBackgroundBuyColor.setValue(e),this}setQuantityBackgroundSellColor(e){return this._line.properties().quantityBackgroundSellColor.setValue(e),this}getQuantityTextColor(){return o.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){
return o.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return o.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return o.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getReverseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonBorderBuyColor:e.reverseButtonBorderSellColor).value()}setReverseButtonBorderColor(e){return"buy"===this._direction?this.setReverseButtonBorderBuyColor(e):this.setReverseButtonBorderSellColor(e),this}setReverseButtonBorderBuyColor(e){return this._line.properties().reverseButtonBorderBuyColor.setValue(e),this}setReverseButtonBorderSellColor(e){return this._line.properties().reverseButtonBorderSellColor.setValue(e),this}getReverseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency)}setReverseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency),this}getReverseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonIconBuyColor:e.reverseButtonIconSellColor).value()}setReverseButtonIconColor(e){return"buy"===this._direction?this.setReverseButtonIconBuyColor(e):this.setReverseButtonIconSellColor(e),this}setReverseButtonIconBuyColor(e){return this._line.properties().reverseButtonIconBuyColor.setValue(e),this}setReverseButtonIconSellColor(e){return this._line.properties().reverseButtonIconSellColor.setValue(e),this}getCloseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonBorderBuyColor:e.closeButtonBorderSellColor).value()}setCloseButtonBorderColor(e){return"buy"===this._direction?this.setCloseButtonBorderBuyColor(e):this.setCloseButtonBorderSellColor(e),this}setCloseButtonBorderBuyColor(e){return this._line.properties().closeButtonBorderBuyColor.setValue(e),this}setCloseButtonBorderSellColor(e){return this._line.properties().closeButtonBorderSellColor.setValue(e),this}getCloseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency)}setCloseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency),this}getCloseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonIconBuyColor:e.closeButtonIconSellColor).value()}setCloseButtonIconColor(e){
return"buy"===this._direction?this.setCloseButtonIconBuyColor(e):this.setCloseButtonIconSellColor(e),this}setCloseButtonIconBuyColor(e){return this._line.properties().closeButtonIconBuyColor.setValue(e),this}setCloseButtonIconSellColor(e){return this._line.properties().closeButtonIconSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}isFunction(e){return"function"==typeof e}onReverse(e,t){return t?this.isFunction(t)&&(this._onReverseData=e,this._onReverseCallback=t):this.isFunction(e)&&(this._onReverseCallback=e),this}callOnReverse(){this.isFunction(this._onReverseCallback)&&this._onReverseCallback.call(this,this._onReverseData)}isOnReverseCallbackPresent(){return this.isFunction(this._onReverseCallback)}onClose(e,t){return t?this.isFunction(t)&&(this._onCloseData=e,this._onCloseCallback=t):this.isFunction(e)&&(this._onCloseCallback=e),this}setCloseEnabled(e){return this._closeEnabled===e||(this._closeEnabled=e,this._onCloseCallback&&this._line.updateAllViewsAndRedraw()),this}isCloseEnabled(){return this._closeEnabled}callOnClose(){this.isFunction(this._onCloseCallback)&&this._closeEnabled&&this._onCloseCallback.call(this,this._onCloseData)}isOnCloseCallbackPresent(){return this._closeEnabled&&this.isFunction(this._onCloseCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends r{constructor(e,t){super(e,t||p.createProperties()),this._adapter=new d(this),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,46738,19)).then(({PositionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])});var r=e.mainSeries().symbolInfo(),n=null!==r?r.pricescale:100,s=null!==r&&r.fractional?r.minmov:1,o=null!==r&&r.fractional,l=null!==r?r.minmove2:void 0;this._formatter=new a(n,s,o,l)}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t,i){this._points[e]=t,this.normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}name(){return"Position"}createPriceAxisView(e){return this._priceAxisView=new s(this,{pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()}),this._priceAxisView}paneViews(){return TradingView.printing&&!c.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?n.prototype.paneViews.call(this):null}
priceAxisViews(e,t){return TradingView.printing&&!c.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?n.prototype.priceAxisViews.call(this,e,t):null}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}formatter(){return this._formatter}static createProperties(e){var t=new l("linetoolposition",e,!1,!1);return p._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolPosition=p},29377:(e,t,i)=>{var r,n;i.r(t),i.d(t,{AlertStatus:()=>r,Direction:()=>n}),function(e){e[e.Waiting=0]="Waiting",e[e.Success=1]="Success",e[e.Failure=2]="Failure"}(r||(r={})),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down"}(n||(n={}))},45178:(e,t,i)=>{var r=i(88537).ensureNotNull,n=i(24145).LineDataSource,s=i(46090).DefaultProperty,o=i(29377);class l extends n{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._predictionPaneView=null;const s=this._model.mainSeries();s.properties().interval.subscribe(this,()=>{this.setStatus(o.AlertStatus.Waiting)}),s.dataEvents().dataUpdated().subscribe(this,this.checkAlert),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,77053,19)).then(({PredictionPaneView:e})=>{this._predictionPaneView=new e(this,this._model),this._setPaneViews([this._predictionPaneView])})}destroy(){const e=this._model.mainSeries();e.properties().interval.unsubscribeAll(this),e.dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}dataAndViewsReady(){return n.prototype.dataAndViewsReady.call(this)&&this._predictionPaneView&&this._predictionPaneView.iconsReady()}isSynchronizable(){return!1}status(){return this._properties.status.value()}setStatus(e){return this._properties.status.setValue(e)}pointsCount(){return 2}name(){return"Forecast"}restorePoints(e,t,i){super.restorePoints(e,t,i),this.checkAlert()}checkAlert(){if(!this.isSourceHidden()&&!(this._points.length<2||this._model.mainSeries().bars().isEmpty())){var e=this._points[1];if(this.status())e.index>this._model.timeScale().baseIndex()&&this.setStatus(o.AlertStatus.Waiting);else{var t=this._model.mainSeries().bars().valueAt(e.index);if(null!==t){var i=this.direction();if(i===o.Direction.Up&&t[TradingView.HIGH_PLOT]>=e.price)this.setStatus(o.AlertStatus.Success);else if(i===o.Direction.Down&&t[TradingView.LOW_PLOT]<=e.price)this.setStatus(o.AlertStatus.Success);else{var n=r(this._model.mainSeries().bars().lastIndex());e.index!==n&&this.setStatus(o.AlertStatus.Failure)}}}}}addPoint(e){var t=n.prototype.addPoint.call(this,e);return t&&this.checkAlert(),t}endChanging(){super.endChanging(),this.setStatus(o.AlertStatus.Waiting),this.checkAlert()}onData(e){super.onData(e),this.checkAlert()}endMoving(e,t,i){super.endMoving(e,t,i),this.setStatus(o.AlertStatus.Waiting),this.checkAlert()}direction(){if(this.points().length<2)return o.Direction.Up;var e=this.points()[0];return this.points()[1].price>e.price?o.Direction.Up:o.Direction.Down}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,89062))).PredictionDefinitionsViewModel}cloneable(){return!1}static createProperties(e){var t=new s("linetoolprediction",e);return l._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e),e.merge({status:o.AlertStatus.Waiting})}}t.LineToolPrediction=l},83258:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty,s=i(24146).LineToolColorsProperty;class o extends r{constructor(e,t,r,n){super(e,t||o.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,86314,19)).then(({PriceLabelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 1}name(){return"Price Label"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,11798))).PriceLabelDefinitionsViewModel}static createProperties(e){var t=new n("linetoolpricelabel",e);return o._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e),e.addChild("linesColors",new s([e.childs().borderColor])),e.addChild("textsColors",new s([e.childs().color]))}}t.LineToolPriceLabel=o},42754:(e,t,i)=>{i.d(t,{LineToolPriceNote:()=>a});var r=i(88537),n=i(46090),s=i(32567),o=i.n(s),l=i(24145);class a extends l.LineDataSource{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),this._labelMovingDelta=null,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,84122)).then(t=>{this._setPaneViews([new t.PriceNotePaneView(this,e)])})}pointsCount(){return 2}name(){return"Price Note"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}startMoving(e,t,i){if(1===t){if(this.isSourceHidden())return;const i=(0,r.ensureDefined)(e.logical),n=this.points()[1];this._labelMovingDelta={index:n.index-i.index,price:n.price-i.price},this.startChanging(t,i)}else this._labelMovingDelta=null,super.startMoving(e,t,i)}move(e,t,i){if(null!==this._labelMovingDelta){const t=(0,r.ensureDefined)(e.logical),n={index:t.index+this._labelMovingDelta.index,price:t.price+this._labelMovingDelta.price};this.setPoint(1,n,i),this.updateAllViews()}else super.move(e,t,i)}endMoving(e,t,i){return null!==this._labelMovingDelta?(this._labelMovingDelta=null,this.endChanging(!1,e)):super.endMoving(e,t,i)}static createProperties(e){const t=new n.DefaultProperty("linetoolpricenote",e);return a._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,8387)).then(e=>e.PriceNoteDefinitionsViewModel)}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){l.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text"),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors"),e.hasChild("textsColors")&&e.removeProperty("textsColors")}}},54503:(e,t,i)=>{i.d(t,{LineToolPriceRange:()=>s})
;var r=i(46090),n=i(24145);class s extends n.LineDataSource{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,41331)).then(e=>{this._setPaneViews([new e.PriceRangePaneView(this,this._model)])})}pointsCount(){return 2}name(){return"Price Range"}static createProperties(e){const t=new r.DefaultProperty("linetoolpricerange",e);return s._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,50152))).GeneralDatePriceRangeDefinitionsViewModel}static _configureProperties(e){n.LineDataSource._configureProperties(e)}}},89789:(e,t,i)=>{var r=i(55827).LevelsProperty,n=i(44040).LineToolFibWedgeBase,s=i(24146).LineToolColorsProperty;class o extends n{constructor(e,t,r,n){super(e,t||o.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,87265,19)).then(({ProjectionLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return 1}name(){return"Projection"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,11937))).ProjectionDefinitionsViewModel}static createProperties(e){var t=new r("linetoolprojection",e,!1,{range:[1,1]});return o._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e),e.addChild("linesColors",new s([e.trendline.color]))}}t.LineToolProjection=o},94678:(e,t,i)=>{var r=i(39195).LineToolTrendLine,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Ray"}static createProperties(e){var t=new n("linetoolray",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolRay=s},38642:(e,t,i)=>{i.d(t,{LineToolRectangle:()=>h});var r=i(86441),n=i(46090),s=i(32567),o=i.n(s),l=i(24145),a=i(24146),c=i(88537);class h extends l.LineDataSource{constructor(e,t,r,n){const s=t||h.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,89314)).then(({RectanglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)})}pointsCount(){return 2}textColorsProperty(){return this.properties().childs().showLabel.value()?super.textColorsProperty():null}name(){return"Rectangle"}setPoint(e,t,i){if(e<2&&super.setPoint(e,t,i),i&&i.shift()){const i=this._getAnchorPointForIndex(e);if(e>=4)return this._correctMiddlePoints(e,t,i),void this.normalizePoints();this._snapPoint45Degree(t,i)}switch(e){case 2:this._points[1].price=t.price,this._points[0].index=t.index;break;case 3:this._points[0].price=t.price,this._points[1].index=t.index;break;case 4:this._points[0].index=t.index;break;case 5:this._points[1].index=t.index;break;case 6:this._points[0].price=t.price;break;case 7:this._points[1].price=t.price}this.normalizePoints()}getPoint(e){return e<2?super.getPoint(e):this._getAnchorPointForIndex(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){
const t=new n.DefaultProperty("linetoolrectangle",e);return h._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,95069)).then(e=>e.RectangleDefinitionsViewModel)}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_snapPoint45Degree(e,t,i){const r=this.m_priceScale,n=this.ownerSource();if(null===r||null===n)return;const s=n.firstValue();if(null===s)return;const o=this._model.timeScale(),l=(0,c.ensureNotNull)(this.pointToScreenPoint(e)),a=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),h=l.x-a.x,u=l.y-a.y,d=h<0?-1:1,p=u<0?-1:1,_=Math.max(Math.abs(h),Math.abs(u)),P=Math.round(o.coordinateToIndex(a.x+_*d)),g=Math.abs(o.indexToCoordinate(P)-a.x),v=r.coordinateToPrice(a.y+g*p,s);e.index=P,e.price=v}_correctMiddlePoints(e,t,i){e<6?this._correctRightLeftMiddlePoint(e,t,i):this._correctTopBottomMiddlePoint(e,t,i)}_correctRightLeftMiddlePoint(e,t,i){const n=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),s=(0,c.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[0])),l=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let a=n.x-s.x;if(0===a)return;const h=o.x<l.x?1:-1,u=o.y<l.y?1:-1;switch(a*=h,e){case 4:{const e=l.y-u*a/2,t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(l.x,e)));this._points[1].price=t.price;const i=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(o.x+h*a,o.y+u*a/2)));this._points[0].price=i.price,this._points[0].index=i.index;break}case 5:{const e=o.y-u*a/2,t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(o.x,e)));this._points[0].price=t.price;const i=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(l.x+h*a,l.y+u*a/2)));this._points[1].price=i.price,this._points[1].index=i.index;break}}}_correctTopBottomMiddlePoint(e,t,i){const n=this.m_priceScale,s=this.ownerSource();if(null===n||null===s)return;const o=this._model.timeScale(),l=s.firstValue();if(null===l)return;const a=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),h=(0,c.ensureNotNull)(this.pointToScreenPoint(i)),u=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[0])),d=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[1])),p=a.y-h.y,_=p<0?-1:1,P=u.x<d.x?1:-1,g=u.y<d.y?1:-1;switch(e){case 6:{const e=Math.floor(d.x-P*p/2),t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(e,d.y))),i=Math.abs(this._points[1].index-t.index),s=P*g*_*Math.ceil(i/2);if(0===s)return;this._points[1].index=this._points[1].index-s;const a=_*Math.abs(o.indexToCoordinate(this._points[1].index)-d.x);this._points[0].price=n.coordinateToPrice(u.y+a,l),this._points[0].index=this._points[0].index+s;break}case 7:{const e=Math.floor(u.x-P*p/2),t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(e,u.y))),i=Math.abs(this._points[0].index-t.index),s=P*g*_*Math.ceil(i/2);if(0===s)return;this._points[0].index=this._points[0].index-s;const a=_*Math.abs(o.indexToCoordinate(this._points[0].index)-u.x)
;this._points[1].price=n.coordinateToPrice(d.y+a,l),this._points[1].index=this._points[1].index+s;break}}}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){l.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("text"),e.addExclusion("linesColors"),e.addExclusion("textsColors")}_getAnchorPointForIndex(e){const t=this.points(),i=t[0],r=t[1];let n=0,s=0;switch(e){case 0:n=i.price,s=i.index;break;case 1:n=r.price,s=r.index;break;case 2:n=r.price,s=i.index;break;case 3:n=i.price,s=r.index;break;case 4:n=(r.price+i.price)/2,s=i.index;break;case 5:n=(r.price+i.price)/2,s=r.index;break;case 6:n=i.price,s=(r.index+i.index)/2;break;case 7:n=r.price,s=(r.index+i.index)/2}return{index:s,price:n}}}},55277:(e,t,i)=>{i.d(t,{LineToolRiskRewardBase:()=>m});var r=i(88537),n=i(1336),s=i(52280),o=i(59270),l=i(24145),a=i(34021),c=i(90283),h=i(98424);class u extends h.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){if(e.visible=!1,!this._showAxisLabel())return;const r=this._source.priceScale();if(0===this._source.points().length||null===r||r.isEmpty())return;const n=this._source.ownerSource(),s=null!==n?n.firstValue():null;if(null===s)return;const o=this._data.priceProperty.value(),l=this._data.colorProperty.value();i.background=l,i.textColor=this.generateTextColor(l),i.coordinate=r.priceToCoordinate(o,s),e.text=r.formatPrice(o,s),e.visible=!0}_showAxisLabel(){return this._source.properties().childs().showPriceLabels.value()}}var d=i(32567),p=i.n(d);class _ extends(p()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){const e=this._lineSource.points()[this._pointIndex].price;return this._formatAndParsePrice(e)}state(){return this.value()}merge(e,t){return this.setValue(e),t?[]:null}_formatAndParsePrice(e){const t=(0,r.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),r=t.parse(i);return r.res?r.value:e}return e}}class P extends _{constructor(e){super(e,0)}setValue(e){const t=this._lineSource.points()[this._pointIndex];this._lineSource.startChanging(this._pointIndex,t),t.price=parseFloat(""+e),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.recalculate(),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this),this._lineSource.endChanging(!1,!1),this._lineSource.syncPriceLevels()}}class g extends _{constructor(e){super(e,1)}value(){const e=this._lineSource.stopPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.model().mainSeries().base());this._lineSource.properties().childs().stopLevel.setValue(t),this._lineSource.syncPriceLevels()}}class v extends _{constructor(e){super(e,2)}value(){const e=this._lineSource.profitPrice();return this._formatAndParsePrice(e)}
setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.model().mainSeries().base());this._lineSource.properties().childs().profitLevel.setValue(t),this._lineSource.syncPriceLevels()}}class m extends l.LineDataSource{constructor(e,t,s,l){if(super(e,t,s,l),this._syncStateExclusions=["points","entryPrice","stopPrice","targetPrice","stopLevel","profitLevel","riskSize","qty","amountTarget","amountStop"],!t.hasChild("stopLevel")&&!t.hasChild("profitLevel")){const i=(0,r.ensureNotNull)(e.timeScale().visibleBarsStrictRange()),n=i.firstBar(),s=i.lastBar();let l=(0,r.ensureNotNull)(e.mainSeries().priceRange(n,s));const a=e.mainSeries().priceScale();if(a.isLog()){const e=a.logicalToPrice(l.minValue()),t=a.logicalToPrice(l.maxValue());l=new o.PriceRange(e,t)}if(l&&!l.isEmpty()){const i=Math.round(.2*l.length()*e.mainSeries().base());t.merge({stopLevel:i,profitLevel:i})}}t.childs().stopLevel.listeners().subscribe(this,this.recalculate),t.childs().stopLevel.listeners().subscribe(null,()=>{this.properties().childs().stopPrice.childChanged("",0)}),t.childs().profitLevel.listeners().subscribe(this,this.recalculate),t.childs().profitLevel.listeners().subscribe(null,()=>{this.properties().childs().targetPrice.childChanged("",0)}),t.addChild("entryPrice",new P(this)),t.addChild("stopPrice",new g(this)),t.addChild("targetPrice",new v(this)),t.hasChild("riskSize")||t.addProperty("riskSize",0),t.hasChild("qty")||t.addProperty("qty",0),t.hasChild("amountTarget")||t.addProperty("amountTarget",t.childs().accountSize.value()),t.hasChild("amountStop")||t.addProperty("amountStop",t.childs().accountSize.value()),t.addExclusion("riskSize"),t.addExclusion("qty"),t.addExclusion("amountTarget"),t.addExclusion("amountStop"),this._riskInPercentsFormatter=new n.NumericFormatter(2),this._riskInMoneyFormatter=new n.NumericFormatter,t.childs().risk.subscribe(this,this._recalculateRiskSize),t.childs().accountSize.subscribe(this,this._recalculateRiskSize),t.childs().riskDisplayMode.subscribe(this,this._recalculateRisk),t.childs().riskDisplayMode.subscribe(this,this._recalculateRiskSize),t.childs().entryPrice.subscribe(this,this._recalculateRiskSize),t.childs().stopPrice.subscribe(this,this._recalculateRiskSize),t.childs().profitLevel.subscribe(this,this._recalculateRiskSize),t.childs().profitLevel.subscribe(this,this.syncPriceLevels.bind(this)),t.childs().stopLevel.subscribe(this,this._recalculateRiskSize),t.childs().stopLevel.subscribe(this,this.syncPriceLevels.bind(this)),t.childs().qty.subscribe(this,this._recalculateRiskSize),e.mainSeries().dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated),this.pointAdded().subscribe(this,e=>{switch(e){case c.RiskRewardPointIndex.Entry:case c.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}}),this.pointChanged().subscribe(this,e=>{switch(e){case c.RiskRewardPointIndex.Entry:case c.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}}),
t.childs().riskDisplayMode.value()===a.RiskDisplayMode.Percentage&&t.childs().risk.value()>100&&t.childs().riskDisplayMode.setValueSilently(a.RiskDisplayMode.Money),this.version=2,this._entryPriceAxisView=new u(this,{colorProperty:t.childs().linecolor,priceProperty:t.childs().entryPrice}),this._stopPriceAxisView=new u(this,{colorProperty:t.childs().stopBackground,priceProperty:t.childs().stopPrice}),this._profitPriceAxisView=new u(this,{colorProperty:t.childs().profitBackground,priceProperty:t.childs().targetPrice}),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,73075)).then(({RiskRewardPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)})}destroy(){this._model.mainSeries().dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}checkAlert(){this.recalculate()}calculatePL(e){return this.entryPrice()-e}lastBarData(){const e=this._model.mainSeries().bars().firstIndex(),t=this._model.mainSeries().bars().lastIndex();if(null===e||null===t||isNaN(e)||isNaN(t))return null;const i=this.points();if(4===i.length){const r=i[c.RiskRewardPointIndex.ActualClose];return r.index<e?null:{closePrice:r.price,index:Math.min(t,r.index)}}const n=i[c.RiskRewardPointIndex.Close];if(n.index<e)return null;const o=Math.min(t,n.index),l=this._model.mainSeries().bars().search(o,s.PlotRowSearchMode.NearestLeft);return null===l?null:{closePrice:(0,r.ensure)(l.value[4]),index:l.index}}_onSeriesUpdated(e,t,i){this.isSourceHidden()||this._points.length<2||null!==i&&i.index>Math.max(this._points[0].index,this._points[1].index)||this.checkAlert()}}},34021:(e,t,i)=>{var r;i.d(t,{RiskDisplayMode:()=>r}),function(e){e.Percentage="percents",e.Money="money"}(r||(r={}))},90283:(e,t,i)=>{var r;i.d(t,{RiskRewardPointIndex:()=>r}),function(e){e[e.Entry=0]="Entry",e[e.Close=1]="Close",e[e.ActualEntry=2]="ActualEntry",e[e.ActualClose=3]="ActualClose"}(r||(r={}))},6711:(e,t,i)=>{var r=i(88537).ensureNotNull,n=i(24145).LineDataSource,s=i(8170),o=i(46090).DefaultProperty,l=i(90283).RiskRewardPointIndex,a=i(34021).RiskDisplayMode,c=i(55277).LineToolRiskRewardBase,h=i(70617).isNumber,u=i(80560),d=u.SIDE,p=u.ORDERTYPE;class _ extends c{riskFormatter(e){return e===a.Percentage?this._riskInPercentsFormatter:this._riskInMoneyFormatter}getRiskStep(e){return e===a.Percentage?.01:1}_roundValue(e){return parseFloat(e.toFixed(2))}hasEditableCoordinates(){return!1}_recalculateRisk(){var e=this.properties(),t=e.riskDisplayMode.value(),i=e.riskSize.value(),r=e.accountSize.value(),n=e.risk.value();n=t===a.Percentage?this._roundValue(i/r*100):this._roundValue(r/100*n),this._riskInChange=!0,e.risk.setValue(this.riskFormatter(t).format(n)),this._riskInChange=!1}_recalculateRiskSize(){if(!this._riskInChange){var e=this.properties(),t=e.risk.value(),i=e.riskDisplayMode.value(),r=e.accountSize.value();i===a.Percentage?e.riskSize.setValue(t/100*r):t>r?(e.risk.setValue(r),e.riskSize.setValue(r)):e.riskSize.setValue(t)}}migrateVersion(e,t,i){if(1===e&&this._points.length>=1){var r=[];if(r.push(this._points[0]),s={price:(s=this._points[0]).price,
index:this._getClosePointIndex(s.index)},r.push(s),this._points[1]&&r.push(this._points[1]),this._points[2]&&r.push(this._points[2]),this._points=r,this._timePoint.length>=1){var n=[],s=this._timePoint[0];n.push(s);var o={price:s.price,time_t:s.time_t,offset:this._getClosePointIndex(s.offset)};n.push(o),this._timePoint[1]&&r.push(this._points[1]),this._timePoint[2]&&r.push(this._points[2]),this._timePoint=n}}}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||this._model.paneForSource(this)!==e?null:[this._entryPriceAxisView,this._stopPriceAxisView,this._profitPriceAxisView]}updateAllViews(){this.isActualSymbol()&&this._properties.visible.value()&&(s.hideAllDrawings().value()&&this.userEditEnabled()||(super.updateAllViews(),this._entryPriceAxisView.update(),this._stopPriceAxisView.update(),this._profitPriceAxisView.update()))}restoreExternalState(e){if(h(e.entryPrice)){if(e=Object.assign({},e),!this.isActualSymbol())this._timePoint[0].price=e.entryPrice,delete e.entryPrice;this.properties().merge(e)}else super.restoreExternalState(e)}_changeEntryPoint(e){var t=this.properties().stopPrice.value(),i=this.properties().targetPrice.value(),r=1/this._model.mainSeries().base(),n=Math.min(t,i)+r,s=Math.max(t,i)-r;e.price=Math.max(n,Math.min(s,this._roundPrice(e.price))),super.setPoint(0,e),this.properties().stopPrice.setValue(t),this.properties().targetPrice.setValue(i)}setPoint(e,t,i){if(this.isActualSymbol()){switch(this._muteSyncLineStyle(),e){case 0:this._changeEntryPoint(t);break;case 2:this.properties().stopPrice.setValue(this.preparseStopPrice(t.price));break;case 3:this.properties().targetPrice.setValue(this.preparseProfitPrice(t.price));break;case 1:t.price=this._roundPrice(t.price),super.setPoint(1,t),this.recalculate()}this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels()}}getPoint(e){switch(e){case 0:return this._points[0];case 1:return{index:this._points[1].index,price:this._points[0].price};case 2:return{index:this._points[0].index,price:this.stopPrice()};case 3:return{index:this._points[0].index,price:this.profitPrice()}}return null}setPoints(e){this._muteSyncLineStyle(),super.setPoints(e),this.recalculate(),this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels()}syncPriceLevels(){if(this.linkKey().value()){var e=this.properties(),t={entryPrice:e.entryPrice.value(),stopLevel:e.stopLevel.value(),profitLevel:e.profitLevel.value()};s.changeLineStyle({linkKey:this.linkKey().value(),state:t,model:this._model})}}pointsCount(){return 1}name(){return"Risk/Reward"}addPoint(e){e.price=this._roundPrice(e.price),super.addPoint(e,null,!0);var t={price:e.price,index:this._getClosePointIndex(e.index)};super._addPointIntenal(t,null,!0);var i=this.calculateActualEntry(e,t);i&&(super._addPointIntenal(i,null,!0),(t=this.findClosePoint(i,t))&&super._addPointIntenal(t,null,!0));return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}setOwnerSource(e){super.setOwnerSource(e),this._model.mainSeries().symbolInfo()&&(this._recalculateAmount(),
this._recalculateRiskSize(),this._recalculateQty())}_roundPrice(e){var t=this._model.mainSeries().base();return Math.round(e*t)/t}recalculate(){if(0!==this.points().length){var e=this.properties().targetPrice.value(),t=this.properties().stopPrice.value(),i=[this._points[0],this._points[1]],r=this.calculateActualEntry(this.points()[0],this.points()[1]);if(r){i.push(r);var n=this.findClosePoint(r,this.points()[1]);n&&i.push(n)}this._points=i,e!==this.properties().targetPrice.value()&&this.properties().targetPrice._listeners.fire(this.properties().targetPrice),t!==this.properties().stopPrice.value()&&this.properties().stopPrice._listeners.fire(this.properties().stopPrice)}}start(){super.start(),this.recalculate()}startMoving(e,t,i){e.logical.price=this._roundPrice(e.logical.price),super.startMoving(e,t,i)}move(e,t,i){e.logical.price=this._roundPrice(e.logical.price),super.move(e,t,i),this.recalculate(),this._entryPriceAxisView.update()}_correctPoints(e,t){return!!this.isActualSymbol()&&n.prototype._correctPoints.call(this,[e[0],e[1]],t)}entryPrice(){return this.points()[0].price}findClosePoint(e,t){for(var i=this._model.mainSeries().bars(),n=r(i.firstIndex()),s=Math.max(e.index,n),o=r(i.lastIndex()),l=Math.min(o,t.index),a=s;a<=l;a++){var c=i.valueAt(a);if(null!==c){var h=this.checkStopPrice(c);if(null!=h)return{index:a,price:h}}}return null}calculateActualEntry(e,t){var i=this._model.mainSeries().bars();if(i.isEmpty())return null;for(var n=r(i.firstIndex()),s=Math.max(e.index,n),o=e.price,l=r(i.lastIndex()),a=Math.min(l,t.index),c=s;c<=a;c++){var h=i.valueAt(c);if(null!==h&&h[TradingView.HIGH_PLOT]>=o&&h[TradingView.LOW_PLOT]<=o)return{index:c,price:o}}return null}axisPoints(){if(!this._points[l.ActualEntry])return[];var e=this._points[l.ActualEntry],t=null;if(4===this._points.length)t=this._points[l.ActualClose];else{var i=this.lastBarData();if(!i)return[];t={index:i.index,price:i.closePrice}}return[e,t]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,14946))).RiskRewardDefinitionsViewModel}template(){var e=this.properties(),t=n.prototype.template.call(this);return t.stopLevel=e.stopLevel.value(),t.profitLevel=e.profitLevel.value(),t}_applyTemplateImpl(e){delete e.targetPrice,delete e.stopPrice,delete e.entryPrice,super._applyTemplateImpl(e);var t=this.properties();void 0!==e.stopLevel&&t.stopLevel.setValue(e.stopLevel),void 0!==e.profitLevel&&t.profitLevel.setValue(e.profitLevel)}getOrderTemplate(){var e=this.properties();return{qty:e.qty.value()/e.lotSize.value(),limitPrice:e.entryPrice.value(),stopLoss:e.stopPrice.value(),takeProfit:e.targetPrice.value(),side:this._orderSide(),type:p.LIMIT,seenPrice:null}}_propertiesStateExclusions(){return["entryPrice","stopPrice","targetPrice"]}static _configureProperties(e){n._configureProperties(e),e.addExclusion("stopLevel"),e.addExclusion("profitLevel"),e.addExclusion("stopPrice"),e.addExclusion("targetPrice"),e.addExclusion("entryPrice")}_getClosePointIndex(e){
var t=this._model.timeScale(),i=Math.round(t.width()/t.barSpacing());return e+Math.max(3,Math.round(.15*i))}}_.version=2;class P extends _{constructor(e,t,i){super(e,t||P.createProperties(),i);var r=this.properties();r.entryPrice.subscribe(this,this._recalculateQty),r.stopPrice.subscribe(this,this._recalculateQty),r.riskSize.subscribe(this,this._recalculateQty),r.entryPrice.subscribe(this,this._recalculateAmount),r.profitLevel.subscribe(this,this._recalculateAmount),r.stopLevel.subscribe(this,this._recalculateAmount),r.accountSize.subscribe(this,this._recalculateAmount),r.riskSize.subscribe(this,this._recalculateAmount),r.qty.subscribe(this,this._recalculateAmount)}_recalculateQty(){if(0!==this.points().length){var e=this.properties(),t=e.entryPrice.value(),i=e.stopPrice.value(),r=e.riskSize.value(),n=this._model.mainSeries().pointValue(),s=r/(Math.abs(i-t)*n);e.qty.setValue(s)}}_recalculateAmount(){if(0!==this.points().length){var e=this.properties(),t=e.accountSize.value(),i=e.entryPrice.value(),r=e.qty.value(),n=e.stopPrice.value(),s=e.targetPrice.value(),o=this._model.mainSeries().pointValue(),l=this._roundValue(t+(i-s)*r*o),a=this._roundValue(t-(n-i)*r*o);e.amountTarget.setValue(l),e.amountStop.setValue(a)}}name(){return"Risk/Reward short"}stopPrice(){return this.entryPrice()+this.properties().stopLevel.value()/this._model.mainSeries().base()}profitPrice(){return this.entryPrice()-this.properties().profitLevel.value()/this._model.mainSeries().base()}preparseStopPrice(e){e=this._roundPrice(e);var t=this.entryPrice()+1/this._model.mainSeries().base();return Math.max(e,t)}preparseProfitPrice(e){e=this._roundPrice(e);var t=this.entryPrice()-1/this._model.mainSeries().base();return Math.min(e,t)}checkStopPrice(e){var t=this.stopPrice(),i=this.profitPrice();return e[TradingView.HIGH_PLOT]>=t?this.stopPrice():e[TradingView.LOW_PLOT]<=i?this.profitPrice():null}_orderSide(){return d.SELL}static createProperties(e){var t=new o("linetoolriskrewardshort",e);return P._configureProperties(t),t}static _configureProperties(e){_._configureProperties(e)}}class g extends _{constructor(e,t,i){super(e,t||g.createProperties(),i);var r=this.properties();r.entryPrice.subscribe(this,this._recalculateQty),r.stopPrice.subscribe(this,this._recalculateQty),r.riskSize.subscribe(this,this._recalculateQty),r.entryPrice.subscribe(this,this._recalculateAmount),r.profitLevel.subscribe(this,this._recalculateAmount),r.stopLevel.subscribe(this,this._recalculateAmount),r.accountSize.subscribe(this,this._recalculateAmount),r.riskSize.subscribe(this,this._recalculateAmount),r.qty.subscribe(this,this._recalculateAmount)}_recalculateQty(){if(0!==this.points().length){var e=this.properties(),t=e.entryPrice.value(),i=e.stopPrice.value(),r=e.riskSize.value(),n=this._model.mainSeries().pointValue(),s=r/(Math.abs(t-i)*n);e.qty.setValue(s)}}_recalculateAmount(){if(0!==this.points().length){
var e=this.properties(),t=e.accountSize.value(),i=e.entryPrice.value(),r=e.qty.value(),n=e.stopPrice.value(),s=e.targetPrice.value(),o=this._model.mainSeries().pointValue(),l=this._roundValue(t+(s-i)*r*o),a=this._roundValue(t-(i-n)*r*o);e.amountTarget.setValue(l),e.amountStop.setValue(a)}}stopPrice(){return this.entryPrice()-this.properties().stopLevel.value()/this._model.mainSeries().base()}profitPrice(){return this.entryPrice()+this.properties().profitLevel.value()/this._model.mainSeries().base()}calculatePL(e){return e-this.entryPrice()}preparseStopPrice(e){e=this._roundPrice(e);var t=this.entryPrice()-1/this._model.mainSeries().base();return Math.min(e,t)}preparseProfitPrice(e){e=this._roundPrice(e);var t=this.entryPrice()+1/this._model.mainSeries().base();return Math.max(e,t)}checkStopPrice(e){var t=this.stopPrice(),i=this.profitPrice();return e[TradingView.LOW_PLOT]<=t?this.stopPrice():e[TradingView.HIGH_PLOT]>=i?this.profitPrice():null}name(){return"Risk/Reward long"}_orderSide(){return d.BUY}static createProperties(e){var t=new o("linetoolriskrewardlong",e);return g._configureProperties(t),t}static _configureProperties(e){_._configureProperties(e)}}t.LineToolRiskRewardLong=g,t.LineToolRiskRewardShort=P},91983:(e,t,i)=>{var r=i(86441).Point,n=i(4652).distanceToLine,s=i(24145).LineDataSource,o=i(46090).DefaultProperty,l=i(24146).LineToolColorsProperty;class a extends s{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,51282,19)).then(({RotatedRectanglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){var i=this._getPaneViews()[0],r=i._points[0],s=i._points[1],o=i._points[2];this._distance=n(r,s,o).distance}}setPoint(e,t,i){if(super.setPoint(e,t,i),0===e||1===e){var n=this._getPaneViews()[0];n.update();var s=n._points[0],o=n._points[1].subtract(s),l=new r(o.y,-o.x).normalized().scaled(this._distance),a=s.add(l),c=this.screenPointToPoint(a);this._points[2]=c}}endChanging(e,t){delete this._distance,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Rotated Rectangle"}hasEditableCoordinates(){return!1}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,80717))).GeneralFiguresDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){var t=new o("linetoolrotatedrectangle",e);return a._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e),e.addChild("linesColors",new l([e.color]))}}t.LineToolRotatedRectangle=a},73758:(e,t,i)=>{var r=i(55827).LevelsProperty,n=i(19310).LineToolPitchfork;class s extends n{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Modified Schiff Pitchfork"}static createProperties(e){var t=new r("linetoolschiffpitchfork",e,!1,{range:[0,8]});return s._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e)}}t.LineToolSchiffPitchfork=s},92621:(e,t,i)=>{
var r=i(55827).LevelsProperty,n=i(19310).LineToolPitchfork;class s extends n{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}name(){return"Schiff Pitchfork"}static createProperties(e){var t=new r("linetoolschiffpitchfork2",e,!1,{range:[0,8]});return s._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e)}}t.LineToolSchiffPitchfork2=s},23036:(e,t,i)=>{i.d(t,{LineToolSignpost:()=>v});var r=i(87236),n=i(46090),s=i(24145),o=i(32567),l=i.n(o),a=i(33156),c=i(97639),h=i.n(c);class u{constructor(e){this._image=null,this._currentImageURL=null,this._imageReady=!1,this._ready=new(h()),this._source=e,this.updateImage()}updateImage(){const e=this.imageURL();this._currentImageURL!==e&&(this._currentImageURL=e,this._image=null,this._imageReady=!1,null!==this._currentImageURL&&(this._image=new Image,this._image.onload=()=>{this._imageReady=!0,this._ready.fire()},this._image.crossOrigin="anonymous",this._image.src=this._currentImageURL))}itemIndex(){return 1}labelIndex(){return 0}image(){return this._imageReady&&this.showPlate()?this._image:null}showPlate(){return this._props().childs().showImage.value()}backgroundPlateColor(e){return this._props().childs().plateColor.value()}ready(){return this._ready}type(){return this._props().childs().itemType.value()}category(){return 1}index(){const e=this._source.points();return 0===e.length?null:e[0].index}imageURL(){const e=this._props().childs().emoji.value();return(0,a.getTwemojiUrl)(e,"png")||null}sourceImage(){return null}additionalImageURL(){return null}additionalImageSource(){return null}name(){return""}headline(){return this._props().childs().text.value()}text(){return""}fullTextAst(){return null}position(){return this._props().childs().position.value()}fontSize(){return this._props().childs().fontSize.value()}fontBold(){return this._props().childs().bold.value()}fontItalic(){return this._props().childs().italic.value()}sourceLabel(){return null}_props(){return this._source.properties()}}class d extends(l()){constructor(e){super(),this._source=e,e.pointAdded().subscribe(this,()=>this.listeners().fire(this)),e.pointChanged().subscribe(this,()=>this.listeners().fire(this))}value(){const e=this._source.properties().childs().position.value();return parseFloat(e.toFixed(2))}setValue(e){this._source.properties().childs().position.setValue(e),this._source.model().updateSource(this._source),this.listeners().fire(this),this._source.syncMultichartState({pricesChanged:!1,indexesChanged:!1})}}var p=i(39916);class _ extends p.LineDataSourcePointIndexProperty{constructor(e,t){super(e,t),this._source=e}_setPointImpl(e){this._source.setPointAndChangeIndex(this._pointIndex,e)}}var P=i(24146),g=i(74993);class v extends g.LineToolWithRelativePriceCoordinate{constructor(e,t,r,n){const s=t||v.createProperties();super(e,s,r,n),this._item=new u(this),this.properties().childs().emoji.subscribe(this,()=>this._item.updateImage()),this._item.ready().subscribe(this,()=>this._model.updateSource(this)),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,65205)).then(t=>{
this._setPaneViews([new t.SignpostPaneView(this,e)])})}isItemHovered(e){return!1}isItemSelected(e){return!1}isHidden(e){return!1}items(){return[this.customEvent()]}priceSource(){return this.ownerSource()}pointsCount(){return 1}name(){return"Signpost"}customEvent(){return this._item}showInObjectTree(){return!this.isPhantom()&&super.showInObjectTree()}isPhantom(){return this._model.isPhantomLine(this)}clonePositionOffset(){return{barOffset:1,xCoordOffset:0,yCoordOffset:0}}template(){const e=super.template(),t=this.properties().childs();return e.text=t.text.value(),e.position=t.position.value(),e}static createProperties(e){const t=new n.DefaultProperty("linetoolsignpost",e);return v._configureProperties(t),t.hasChild("text")||t.addChild("text",new(l())((0,r.t)("Text"))),t.hasChild("position")||t.addChild("position",new(l())(50)),t.addExclusion("text"),t.addExclusion("position"),t.addChild("backgroundsColors",new P.LineToolColorsProperty([t.childs().plateColor])),t}_createPointProperty(e){super._createPointProperty(e);const t=this._pointsProperty.childs().points[e];t.removeProperty("price"),t.removeProperty("bar"),t.addChild("price",new d(this)),t.addChild("bar",new _(this,0))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text),this.properties().childs().position.setValue(e.position)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,11951)).then(e=>e.SignpostDefinitionsViewModel)}static _configureProperties(e){s.LineDataSource._configureProperties(e)}}v.supportPhantomMode=!0},10646:(e,t,i)=>{i.d(t,{LineToolSineLine:()=>s});var r=i(46090),n=i(24145);class s extends n.LineDataSource{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,10039)).then(e=>{this._setPaneViews([new e.SineLinePaneView(this,this._model)])})}pointsCount(){return 2}name(){return"Sine Line"}static createProperties(e){const t=new r.DefaultProperty("linetoolsineline",e);return s._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,64500))).CyclicAndSineLinesPatternDefinitionsViewModel}static _configureProperties(e){n.LineDataSource._configureProperties(e)}}},91458:(e,t,i)=>{i.d(t,{LineToolText:()=>u,LineToolTextAbsolute:()=>d});var r=i(88537),n=i(86441),s=i(87236),o=i(24145),l=i(32567),a=i.n(l),c=i(46090),h=i(24146);class u extends o.LineDataSource{constructor(e,t,r,n){const s=t||u.createProperties();super(e,s,r,n),this._barSpacing=e.timeScale().barSpacing(),this._recalculatePointsOnCenter=!1,Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,38710)).then(({TextPaneView:t})=>{const i=this._recalculatePointsOnCenter?(e,t)=>{this._recalculatePointsOnCenter&&this._recalculateCenterPosition(e,t)}:void 0;this._setPaneViews([new t(this,e,void 0,void 0,void 0,void 0,void 0,i)])})}centerPosition(){this._recalculatePointsOnCenter=!0}setPoint(e,t,i){const r=this.properties().childs();let n
;if(1===e&&r.wordWrapWidth.value()){const e=this.model().timeScale();n=this.isFixed()?this.fixedPoints()[0].x:e.indexToCoordinate(this.points()[0].index);const i=e.indexToCoordinate(t.index)-n-~~(r.fontsize.value()/6);if(!isFinite(i))return;r.wordWrapWidth.setValue(Math.max(100,i))}}pointsCount(){return 1}name(){return"Text"}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&(this._priceDencity=e.height()/(0,r.ensureNotNull)(e.priceRange()).length(),this._isPriceDencityLog=e.isLog())}restoreSize(){const e=(0,r.ensureNotNull)(this.priceScale());this._barSpacing=this.model().timeScale().barSpacing(),this._priceDencity=e.height()/(0,r.ensureNotNull)(e.priceRange()).length(),this.redraw()}redraw(){this.updateAllViews(),this._model.updateSource(this)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}state(e){const t=super.state(e);return e&&(t.state.fixedSize=!1),t}barSpacing(){return this._barSpacing}priceDencity(){return this._priceDencity}isPriceDencityLog(){return this._isPriceDencityLog}hasEditableCoordinates(){return!1}static createProperties(e){const t=new c.DefaultProperty("linetooltext",e);return u._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,23603)).then(e=>e.TextDefinitionsViewModel)}static _configureProperties(e){o.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(a())((0,s.t)("Text"))),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().color])),e.addExclusion("text"),e.addExclusion("linesColors"),e.addExclusion("textsColors")}_recalculateCenterPosition(e,t){const i=this.isFixed()?this.fixedPoints()[0]:(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),s=new n.Point(i.x-e/2,i.y-t/2),o=(0,r.ensureNotNull)(this.screenPointToPoint(s));this.setPoints([o]),this.normalizePoints(),this.createServerPoints(),this.redraw()}}class d extends u{constructor(e,t){super(e,t||d.createProperties())}name(){return"Anchored Text"}hasEditableCoordinates(){return!1}isFixed(){return!0}static createProperties(e){const t=new c.DefaultProperty("linetooltextabsolute",e);return d._configureProperties(t),t}static _configureProperties(e){u._configureProperties(e)}}},52078:(e,t,i)=>{i.d(t,{LineToolThreeDrivers:()=>o});var r=i(46090),n=i(24145),s=i(24146);class o extends n.LineDataSource{constructor(e,t,r,n){const s=t||o.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,55148)).then(t=>{this._setPaneViews([new t.LineToolThreeDrivesPaneView(this,e)])})}pointsCount(){return 7}name(){return"Three Drives Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetoolthreedrivers",e);return o._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,87412)).then(e=>e.PatternWithoutBackgroundDefinitionsViewModel)}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new s.LineToolColorsProperty([e.childs().textcolor])),e.addChild("linesWidths",new s.LineToolWidthsProperty([e.childs().linewidth])),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors")}}},24214:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty;class s extends r{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,64806,19)).then(({TimeCyclesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 2}name(){return"Time Cycles"}setPoint(e,t,i){var r=Object.assign({},t),n=this._points[0],s=this._points[1];n.price=r.price,s.price=r.price,this._points[e]=r,this.normalizePoints()}addPoint(e,t,i){var n=r.prototype.addPoint.call(this,e,t,!0);if(n){var s=this._points[0];this._points[1].price=s.price,i||(this.normalizePoints(),this.createServerPoints())}return n}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,46423))).TimeCyclesPatternDefinitionsViewModel}static createProperties(e){var t=new n("linetooltimecycles",e);return s._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e)}}t.LineToolTimeCycles=s},57759:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(93751).fixComputationError;class s extends r{constructor(e,t){super(e,t),this.customization.forcePriceAxisLabel=!0,this.customization.disableErasing=!0,this.customization.showInObjectsTree=!1,this.setSelectionEnabled(!1)}isSynchronizable(){return!1}pointsCount(){return s.POINTS_COUNT}hasContextMenu(){return!1}state(){return null}startMoving(){r.prototype.startMoving.apply(this,arguments),this._cursorMoved=!1}endMoving(){r.prototype.endMoving.apply(this,arguments),this._cursorMoved=!1}_correctPoints(e,t){this._currentMovingPoint&&this._startMovingPoint?this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price&&(this._cursorMoved=!0):this._cursorMoved=!1;for(var i=1/this.priceScale().mainSource().base(),r=0;r<e.length;r++){var s=e[r];this._cursorMoved&&(s.price=this._currentMovingPoint.logical.price),s.price=n(i*Math.round(s.price/i)),e[r]=s}}userEditEnabled(){return!0}movable(){return!1}canBeHidden(){return!1}isUserDeletable(){return!1}showInObjectTree(){return!1}doesMovingAffectsUndo(){return!1}isAvailableInFloatingWidget(){return!1}timeAxisViews(){return null}cloneable(){return!1}copiable(){return!1}static _configureProperties(e){r._configureProperties(e)}}s.POINTS_COUNT=1,e.exports.LineToolTrading=s},9304:(e,t,i)=>{var r=i(32567),n=i(86441).Point,s=i(24145).LineDataSource,o=i(46090).DefaultProperty;class l extends r{constructor(e){super(),this._lineSource=e}value(){var e=180*this._lineSource._angle/Math.PI;return Math.round(e)}setValue(e){
var t=e*Math.PI/180;this._lineSource._angle=t;var i=this._lineSource.pointToScreenPoint(this._lineSource.points()[0]),r=Math.cos(this._lineSource._angle),s=-Math.sin(this._lineSource._angle),o=new n(r,s),l=i.addScaled(o,this._lineSource._distance),a=this._lineSource.screenPointToPoint(l);this._lineSource._points[1]=a,this._lineSource._model.updateSource(this._lineSource),this._lineSource.updateAllViews(),this._lineSource._model.updateSource(this._lineSource)}}class a extends s{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),this._properties.addChild("angle",new l(this)),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,88878,19)).then(({TrendAnglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}isSynchronizable(){return!1}pointsCount(){return 2}name(){return"Trend Angle"}_calculateAngle(){var e=this.pointToScreenPoint(this.points()[0]),t=this.pointToScreenPoint(this.points()[1]),i=t.subtract(e);i.length()>0?(i=i.normalized(),this._angle=Math.acos(i.x),i.y>0&&(this._angle=-this._angle),this._distance=t.subtract(e).length()):delete this._angle,this.properties().hasOwnProperty("angle")&&this.properties().angle.listeners().fire(this.properties().angle)}addPoint(e,t){var i=s.prototype.addPoint.call(this,e,t);return i&&this._calculateAngle(),i}setLastPoint(e,t){var i=super.setLastPoint(e,t);return this.points().length>1&&this._calculateAngle(),i}axisPoints(){if(this.points().length<2)return[];var e=[this.points()[0]],t=this.pointToScreenPoint(this.points()[0]),i=Math.cos(this._angle)*this._distance,r=-Math.sin(this._angle)*this._distance,s=t.add(new n(i,r)),o=this.screenPointToPoint(s);return e.push(o),e}setPoint(e,t,i){super.setPoint(e,t,i),this.points().length>1&&1===e&&this._calculateAngle()}restoreData(e){this._angle=e.angle,this._distance=e.distance}state(e){var t=s.prototype.state.call(this,e);return t.angle=this._angle,t.distance=this._distance,t}cloneData(e){this._angle=e._angle,this._distance=e._distance}canHasAlert(){return!0}_getAlertPlots(){return[this._linePointsToAlertPlot(this._points,null,this.properties().extendLeft.value(),this.properties().extendRight.value())]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,69598))).TrendAngleDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){var t=new o("linetooltrendangle",e);return a._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e)}}t.LineToolTrendAngle=a},51848:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=u.version,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,60063,19)).then(({TrendBasedFibExtensionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 3}name(){
return"Trend-Based Fib Extension"}migrateVersion(e,t,i){1===e&&this.properties().extendLines.setValue(!0)}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}static createProperties(e){var t=new o("linetooltrendbasedfibextension",e,!1,{range:[0,8]});return u._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,26457))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){s._configureProperties(e);for(var t=[e.child("trendline").child("linewidth"),e.child("levelsStyle").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=u.LevelsCount;r++)i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}fibLevelsBasedOnLogScale(){return this.properties().fibLevelsBasedOnLogScale.value()&&this.priceScale().isLog()}}u.version=2,u.LevelsCount=24,t.LineToolTrendBasedFibExtension=u},21564:(e,t,i)=>{var r=i(87236).t,n=i(77036).TranslatedString,s=i(24145).LineDataSource,o=i(55827).LevelsProperty,l=i(24146),a=l.LineToolWidthsProperty,c=l.LineToolColorsProperty,h=new n("erase level line",r("erase level line"));class u extends s{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=u.version,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,99362,19)).then(({TrendBasedFibTimePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}levelsCount(){return u.LevelsCount}pointsCount(){return 3}name(){return"Trend-Based Fib Time"}migrateVersion(e,t,i){}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,h)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,93955))).TrendBasedFibTimeDefinitionsViewModel}static createProperties(e){var t=new o("linetooltrendbasedfibtime",e,!1,{range:[1,11]});return u._configureProperties(t),t}static _configureProperties(e){s._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=u.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new c(i)),e.addChild("linesWidths",new a(t))}}u.LevelsCount=11,u.version=1,t.LineToolTrendBasedFibTime=u},39195:(e,t,i)=>{var r=i(32567),n=i(24145).LineDataSource,s=i(71073).LineToolPriceAxisView,o=i(46090).DefaultProperty;class l extends n{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._trendLinePaneView=null,Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,55944,19)).then(({TrendLinePaneView:e})=>{this._trendLinePaneView=new e(this,this._model),this._setPaneViews([this._trendLinePaneView])})}dataAndViewsReady(){return n.prototype.dataAndViewsReady.call(this)&&this._trendLinePaneView&&this._trendLinePaneView.iconsReady()}stop(){super.stop()}pointsCount(){return 2}name(){return"Trend Line"}canHasAlert(){return!0}showPriceLabels(){
return this._properties.childs().showPriceLabels.value()}createPriceAxisView(e){return new s(this,{pointIndex:e,backgroundPropertyGetter:()=>this.showPriceLabels()?this._properties.linecolor.value():null})}isForcedDrawPriceAxisLabel(){return this.showPriceLabels()}_getAlertPlots(){return[this._linePointsToAlertPlot(this._points,null,this.properties().extendLeft.value(),this.properties().extendRight.value())]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,61354))).TrendLineDefinitionsViewModel}template(){var e=n.prototype.template.call(this);return e.text=this.properties().childs().text.value(),e}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}_snapTo45DegreesAvailable(){return!0}static createProperties(e){var t=new o("linetooltrendline",e);return l._configureProperties(t),t}static _configureProperties(e){n._configureProperties(e),e.hasChild("text")||e.addChild("text",new r("")),e.addExclusion("text")}}t.LineToolTrendLine=l},79963:(e,t,i)=>{i.d(t,{LineToolTrianglePattern:()=>o});var r=i(46090),n=i(24145),s=i(24146);class o extends n.LineDataSource{constructor(e,t,r,n){const s=t||o.createProperties();super(e,s,r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,35336)).then(t=>{this._setPaneViews([new t.LineToolTrianglePatternPaneView(this,e)])})}pointsCount(){return 4}name(){return"Triangle Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetooltrianglepattern",e);return o._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,49902)).then(e=>e.PatternWithBackgroundDefinitionViewModel)}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new s.LineToolColorsProperty([e.childs().textcolor])),e.addChild("backgroundsColors",new s.LineToolColorsProperty([e.childs().backgroundColor]))}}},53077:(e,t,i)=>{var r=i(24145).LineDataSource,n=i(46090).DefaultProperty,s=i(24146).LineToolColorsProperty;class o extends r{constructor(e,t,r,n){super(e,t||o.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.t.bind(i,73528,19)).then(({TrianglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])})}pointsCount(){return 3}name(){return"Triangle"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,80717))).GeneralFiguresDefinitionsViewModel}static createProperties(e){var t=new n("linetooltriangle",e);return o._configureProperties(t),t}static _configureProperties(e){r._configureProperties(e),e.addChild("linesColors",new s([e.childs().color]))}}t.LineToolTriangle=o},54013:(e,t,i)=>{i.d(t,{isTwitterUrl:()=>a,isTwitterProfileImageUrl:()=>c,createTweetLineToolByUrl:()=>h});var r=i(88537),n=i(62802),s=i(95935),o=i(94755),l=i(4129);function a(e){try{const t=new URL(e)
;return("twitter.com"===t.hostname||t.hostname.endsWith(".twitter.com"))&&"https:"===t.protocol}catch(e){return!1}}function c(e){try{const t=new URL(e);return"pbs.twimg.com"===t.hostname&&"https:"===t.protocol&&t.pathname.startsWith("/profile_images/")}catch(e){return!1}}function h(e,t,i=!1){return async function(e){const t=new URL("/api/v1/get-tweet-data/",location.href);return t.searchParams.append("tweet_url",e),fetch(t.toString()).then(e=>{if(!e.ok)throw new Error("Error processing tweet: "+e.statusText);return e.json()})}(e).then(a=>{const c=function(e,t){var i;return{id:e.id,createdAt:e.created_at,text:(0,o.clean)(e.text,!0),username:"@"+e.username,user:e.user,profileImageUrl:e.profile_image_url,hashtags:e.hashtags.join(" "),tweetUrl:null!==(i=e.tweet_url)&&void 0!==i?i:t}}(a,e),h={price:0,time_t:c.createdAt,offset:0},u=t.mainSeries(),d=(0,r.ensureNotNull)(t.model().paneForSource(u)),p=d.newLineToolZOrder(!0),_={type:"drawing",source:{id:(0,s.randomHashN)(6),zorder:p,type:"LineToolTweet",position:50,state:{interval:"1",...l.LineToolTweet.createProperties().state()},tweetData:c,symbol:u.symbol(),ownerSource:u.id(),points:[h]},geometry:[],modelId:t.model().id()},P=t.pasteLineTool(d,_,!0,!0);return i&&n.setValue("hint.pasteTweet",!0,{forceFlush:!0}),P.pointAdded().subscribe(null,()=>t.scrollToLineTool(P),!0),P})}},4129:(e,t,i)=>{i.d(t,{LineToolTweet:()=>w});var r=i(46090),n=i(87236),s=i(62802),o=i(45848),l=i(11905),a=i(46778),c=i(63208),h=i(8170),u=i(76553),d=i(54013);const p=(0,l.getLogger)("Chart.TweetDialog"),_=(0,n.t)("Tweet"),P=(0,n.t)("Insert a link to the tweet");let g=null;function v(e){"LineToolTweet"===e?(window.is_authenticated||(0,h.resetToCursor)(!0),window.runOrSignIn(()=>{h.tool.setValue("LineToolTweet"),g=(0,u.showCustomUrlEventDialog)({onConfirm:m,onClose:()=>{g=null,"LineToolTweet"===h.tool.value()&&(0,h.resetToCursor)(!0)},title:_,placeholderText:P}),(0,o.trackEvent)("Tweet","Open tweet dialog")},{source:"Change drawing tool state"})):null!==g&&g.then(e=>e())}function m(e){const t=(0,c.chartWidgetCollectionService)();if(null===t)return;if(!(0,d.isTwitterUrl)(e))return void p.logWarn("Invalid tweet url: "+e);const i=!Boolean(s.getBool("hint.pasteTweet")),r=t.activeChartWidget.value();(0,d.createTweetLineToolByUrl)(e,r.model()).then(()=>{i&&(0,a.showPasteLineToolHint)(t.getContainer(),"hint.pasteTweet")})}var f=i(32567),C=i.n(f),y=i(13647);class T extends y.CustomEventItem{constructor(e,t){super(t),this._data=e}tweetData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){return this._data.profileImageUrl}}class w extends y.LineToolCustomUrlEvent{constructor(e,t,r,n){super(e,t||w.createProperties(),r,n),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,45513)).then(t=>{this._setPaneViews([new t.TweetPaneView(this,e)])})}name(){return"Tweet"}state(e){const t=super.state(e);return this._item&&(t.tweetData=this._item.tweetData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){if(e.tweetData){if(!(0,
d.isTwitterUrl)(e.tweetData.tweetUrl))throw new Error("Invalid url for tweet line tool: "+e.tweetData.tweetUrl);this._item=new T(e.tweetData,this)}void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){const t=new r.DefaultProperty("linetoolTweet",e);return w._configureProperties(t),t.hasChild("position")||t.addChild("position",new(C())(50)),t.addExclusion("position"),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,40072)).then(e=>e.TweetDefinitionsViewModel)}}(0,h.runOnDrawingStateReady)(()=>{h.tool.subscribe(v)})},44234:(e,t,i)=>{i.d(t,{LineToolVertLineTimeAxisView:()=>n});var r=i(52778);class n extends r.LineDataSourceTimeAxisView{constructor(e){super(e,0)}_getBgColor(){return this._source.properties().linecolor.value()}_getAlwaysInViewPort(){return!1}_getIndex(){const e=this._source.points();return 0===e.length?null:e[0].index}}},8374:(e,t,i)=>{i.d(t,{LineToolVertLine:()=>h});var r=i(88537),n=i(86441),s=i(46090),o=i(32567),l=i.n(o),a=i(24145),c=i(44234);class h extends a.LineDataSource{constructor(e,t,r,n){const s=t||h.createProperties();super(e,s,r,n),this._timeAxisView=new c.LineToolVertLineTimeAxisView(this),this._paneViewFactory=null,this.properties().childs().extendLine.subscribe(this,()=>e.lightUpdate()),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,98954)).then(t=>{this._paneViewFactory=i=>new t.VertLinePaneView(this,e,i),this._model.lightUpdate()})}destroy(){this.properties().childs().extendLine.unsubscribeAll(this),super.destroy()}pointsCount(){return 1}name(){return"Vertical Line"}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(){super.updateAllViews(),this._timeAxisView.update()}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}isMultiPaneAvailable(){return!0}isMultiPaneEnabled(){return this.properties().childs().extendLine.value()}paneViews(e){return e=(0,r.ensureDefined)(e),this.isMultiPaneEnabled()||this._model.paneForSource(this)===e?(null===this._getPaneViews(e)&&null!==this._paneViewFactory&&this._setPaneViews([this._paneViewFactory(e)],e,!0),super.paneViews(e)):null}priceAxisViews(){return null}priceAxisPoints(){return[]}pointToScreenPoint(e){const t=this._model.timeScale();if(t.isEmpty())return null;const i=t.indexToCoordinate(e.index);return new n.Point(i,0)}convertYCoordinateToPriceForMoving(e){return 0}static createProperties(e){null!=e&&(void 0===e.textOrientation&&(e.textOrientation="horizontal"),void 0===e.extendLine&&(e.extendLine=!1));const t=new s.DefaultProperty("linetoolvertline",e);return h._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index,price:e.price+1};return[this._linePointsToAlertPlot([e,t],null,!0,!0)]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,7022)).then(e=>e.VerticalLineDefinitionsViewModel)}
_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){a.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())("")),e.addExclusion("text")}}},87511:(e,t,i)=>{var r;i.d(t,{PaneCursorType:()=>r}),function(e){e[e.Default=0]="Default",e[e.Pointer=1]="Pointer",e[e.Eraser=2]="Eraser",e[e.Dot=3]="Dot",e[e.Grabbing=4]="Grabbing",e[e.ZoomIn=5]="ZoomIn",e[e.VerticalResize=6]="VerticalResize",e[e.HorizontalResize=7]="HorizontalResize",e[e.DiagonalNeSwResize=8]="DiagonalNeSwResize",e[e.DiagonalNwSeResize=9]="DiagonalNwSeResize"}(r||(r={}))},64149:(e,t,i)=>{i.d(t,{clearRectWithGradient:()=>o,fillRectInnerBorder:()=>l,drawHorizontalLine:()=>a,drawVerticalLine:()=>c,drawRoundRect:()=>u,drawRoundRectWithInnerBorder:()=>d,fillRectWithBorder:()=>p,createCircle:()=>_});var r=i(86441),n=i(72461),s=i(31825);function o(e,t,i,r,n,s,o){e.save(),e.globalCompositeOperation="copy";const l=e.createLinearGradient(0,0,0,n);l.addColorStop(0,s),l.addColorStop(1,o),e.fillStyle=l,e.fillRect(t,i,r,n),e.restore()}function l(e,t,i,r,n,s){e.fillRect(t+s,i,r-2*s,s),e.fillRect(t+s,i+n-s,r-2*s,s),e.fillRect(t,i,s,n),e.fillRect(t+r-s,i,s,n)}function a(e,t,i,r){e.beginPath();const n=e.lineWidth%2?.5:0;e.moveTo(i,t+n),e.lineTo(r,t+n),e.stroke()}function c(e,t,i,r){e.beginPath();const n=e.lineWidth%2?.5:0;e.moveTo(t+n,i),e.lineTo(t+n,r),e.stroke()}function h(e,t){return Array.isArray(e)?e.map(e=>0===e?e:e+t):e+t}function u(e,t,i,r,n,s,o){let l,a,c,h;if(Array.isArray(s))if(2===s.length){const e=Math.max(0,s[0]),t=Math.max(0,s[1]);l=e,a=e,c=t,h=t}else{if(4!==s.length)throw new Error("Wrong border radius - it should be like css border radius");l=Math.max(0,s[0]),a=Math.max(0,s[1]),c=Math.max(0,s[2]),h=Math.max(0,s[3])}else{const e=Math.max(0,s);l=e,a=e,c=e,h=e}o||e.beginPath(),e.moveTo(t+l,i),e.lineTo(t+r-a,i),0!==a&&e.arcTo(t+r,i,t+r,i+a,a),e.lineTo(t+r,i+n-c),0!==c&&e.arcTo(t+r,i+n,t+r-c,i+n,c),e.lineTo(t+h,i+n),0!==h&&e.arcTo(t,i+n,t,i+n-h,h),e.lineTo(t,i+l),0!==l&&e.arcTo(t,i,t+l,i,l)}function d(e,t,i,r,o,l,a=0,c=0,d="",p=s.LineStyle.Solid){if(e.save(),!c||!d||d===l)return u(e,t,i,r,o,a),e.fillStyle=l,e.fill(),void e.restore();const _=c/2;if("transparent"!==l){const n="transparent"!==d&&p!==s.LineStyle.Solid;u(e,n?t:t+c,n?i:i+c,n?r:r-2*c,n?o:o-2*c,n?a:h(a,-c)),e.fillStyle=l,e.fill()}if("transparent"!==d){u(e,t+_,i+_,r-c,o-c,h(a,-_)),e.lineWidth=c,e.strokeStyle=d,(0,n.setLineStyle)(e,p),e.closePath(),e.stroke()}e.restore()}function p(e,t,i,s,o,l,a,c,h,u,d,p,_,P,g){const v=u?0:t,m=d?_:s;if(void 0!==l&&(e.fillStyle=l,e.fillRect(v,i,m-v+P,o-i)),void 0!==a&&c>0){if(e.beginPath(),(0,n.setLineStyle)(e,h),void 0!==g){const t=g.map(e=>e*c);(0,n.setLineDash)(e,t)}let l=(0,r.point)(0,0),u=(0,r.point)(0,0),d=(0,r.point)(0,0),_=(0,r.point)(0,0);switch(p){case"outer":{const e=.5*c;d=(0,r.point)(0,e),_=(0,r.point)(0,e),l=(0,r.point)(e,-c),u=(0,r.point)(e,-c);break}case"center":{const e=c%2?.5:0,t=c%2?.5:P;d=(0,r.point)(.5*c-e,-e),_=(0,r.point)(t+.5*c,-e),l=(0,
r.point)(-e,e+.5*c),u=(0,r.point)(t,e+.5*c);break}case"inner":{const e=.5*c;d=(0,r.point)(0,-e),_=(0,r.point)(1,-e),l=(0,r.point)(-e,c),u=(0,r.point)(1-e,c);break}}e.lineWidth=c,e.strokeStyle=a,e.moveTo(v-d.x,i-d.y),e.lineTo(m+_.x,i-_.y),e.moveTo(s+u.x,i+u.y),e.lineTo(s+u.x,o-u.y),e.moveTo(v-d.x,o+d.y),e.lineTo(m+_.x,o+_.y),e.moveTo(t-l.x,i+l.y),e.lineTo(t-l.x,o-l.y),e.stroke()}}function _(e,t,i,r){e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.closePath()}},1132:(e,t,i)=>{i.r(t),i.d(t,{extendAndClipLineSegment:()=>h,getArrowPoints:()=>u,optimalBarWidth:()=>d,optimalCandlestickWidth:()=>p,optimalHiLoWidth:()=>_,interactionTolerance:()=>P,coordinateIsValid:()=>g,setValidLineStyle:()=>v,fillScaledRadius:()=>m,strokeScaledRadius:()=>f});var r=i(86441),n=i(5531),s=i(20808),o=i(70617),l=i(72461);const a={line:13,minDistanceBetweenPoints:10,series:14,curve:10,anchor:13,esd:4},c={line:3,minDistanceBetweenPoints:5,series:2,curve:3,anchor:2,esd:0};function h(e,t,i,s,o,l){if((0,r.equalPoints)(e,t))return null;const a=new r.Point(0,0),c=new r.Point(i,s);if(o){if(l){const i=(0,n.intersectLineAndBox)((0,r.lineThroughPoints)(e,t),(0,r.box)(a,c));return Array.isArray(i)?i:null}{const i=(0,n.intersectRayAndBox)(t,e,(0,r.box)(a,c));return null===i||(0,r.equalPoints)(t,i)?null:(0,r.lineSegment)(t,i)}}if(l){const i=(0,n.intersectRayAndBox)(e,t,(0,r.box)(a,c));return null===i||(0,r.equalPoints)(e,i)?null:(0,r.lineSegment)(e,i)}{const i=(0,n.intersectLineSegmentAndBox)((0,r.lineSegment)(e,t),(0,r.box)(a,c));return Array.isArray(i)?i:null}}function u(e,t,i,r){const n=.5*i,s=Math.sqrt(2),o=t.subtract(e),l=o.normalized();let a=5*i;r&&(a=Math.min(a,.35*o.length()));const c=1*n;if(a*s*.2<=c)return[];const h=l.scaled(a),u=t.subtract(h),d=l.transposed(),p=1*a,_=d.scaled(p),P=u.add(_),g=u.subtract(_),v=P.subtract(t).normalized().scaled(c),m=g.subtract(t).normalized().scaled(c),f=t.add(v),C=t.add(m),y=n*(s-1),T=d.scaled(y),w=Math.min(a-1*n/s,n*s*1),S=l.scaled(w),x=t.subtract(T),b=t.add(T),L=t.subtract(S);return[[P,f],[g,C],[x,L.subtract(T)],[b,L.add(T)]]}function d(e,t){return t=t||1,Math.floor(.3*e*t)}function p(e,t){if(e>=2.5&&e<=4)return Math.floor(3*t);const i=1-.2*Math.atan(Math.max(4,e)-4)/(.5*Math.PI),r=Math.floor(e*i*t),n=Math.floor(e*t),s=Math.min(r,n);return Math.max(Math.floor(t),s)}function _(e){return.4*e}function P(){return(0,s.lastMouseOrTouchEventInfo)().isTouch?a:c}function g(e){return null!=e&&!(0,o.isNaN)(e)}function v(e,t){void 0!==t&&(0,l.setLineStyle)(e,t)}function m(e,t){const i=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+i}function f(e,t,i){const r=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+(r!==i%2?.5:0)}},34953:(e,t,i)=>{i.d(t,{sortSourcesPreOrdered:()=>r,sortSources:()=>n});const r={ChartEventsSource:10000001,Dividends:10000002,Splits:10000003,Earnings:10000004,LineToolOrder:10000005,LineToolPosition:10000006,LineToolExecution:10000007,AlertLabel:10000008};function n(e){return[...e].sort((e,t)=>e.zorder()-t.zorder())}},52280:(e,t,i)=>{i.r(t),i.d(t,{PlotRowSearchMode:()=>l,PlotList:()=>h,
mergeMinMax:()=>u,mergePlotRows:()=>d});var r=i(88537),n=i(77884),s=i(76745);const o=(0,i(11905).getLogger)("Chart.PlotList");var l;!function(e){e[e.NearestLeft=-1]="NearestLeft",e[e.Exact=0]="Exact",e[e.NearestRight=1]="NearestRight"}(l||(l={}));function a(e){return e.index}function c(e){return e.value[0]}class h{constructor(e=null,t=null){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache=new Map,this._rowSearchCacheByIndex=new Map,this._rowSearchCacheByIndexWithoutEmptyValues=new Map,this._rowSearchCacheByTime=new Map,this._rowSearchCacheByTimeWithoutEmptyValues=new Map,this._plotFunctions=e||new Map,this._emptyValuePredicate=t}clear(){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache.clear(),this._invalidateSearchCaches()}first(){return this.size()>0?this._items[this._start]:null}last(){return this.size()>0?this._items[this._end-1]:null}firstIndex(){return this.size()>0?this._indexAt(this._start):null}lastIndex(){return this.size()>0?this._indexAt(this._end-1):null}size(){return this._end-this._start}isEmpty(){return 0===this.size()}contains(e){return null!==this.search(e,l.Exact)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}add(e,t){if(this._shareRead)return o.logDebug("add: readonly collection modification attempt"),!1;const i={index:e,value:t},r=this._nonCachedSearch(e,l.Exact,a);return this._invalidateSearchCaches(),null===r?(this._items.splice(this._lowerbound(e,a),0,i),this._start=0,this._end=this._items.length,!0):(this._items[r]=i,!1)}search(e,t=l.Exact,i){return this._searchImpl(e,t,this._rowSearchCacheByIndex,this._rowSearchCacheByIndexWithoutEmptyValues,a,i)}searchByTime(e,t=l.Exact,i){return this._searchImpl(e,t,this._rowSearchCacheByTime,this._rowSearchCacheByTimeWithoutEmptyValues,c,i)}fold(e,t){let i=t;for(let t=this._start;t<this._end;++t){i=e(this._indexAt(t),this._valueAt(t),i)}return i}findFirst(e,t){const i=void 0!==t&&Math.min(this._start+t,this._end)||this._end;for(let t=this._start;t<i;++t){const i=this._indexAt(t),r=this._valueAt(t);if(e(i,r))return{index:i,value:r}}return null}findLast(e,t){const i=void 0!==t&&Math.max(this._end-t,this._start)||this._start;for(let t=this._end-1;t>=i;--t){const i=this._indexAt(t),r=this._valueAt(t);if(e(i,r))return{index:i,value:r}}return null}each(e){for(let t=this._start;t<this._end;++t){if(e(this._indexAt(t),this._valueAt(t)))break}}reduce(e,t){let i=t;for(let t=this._start;t<this._end;++t){i=e(i,this._indexAt(t),this._valueAt(t))}return i}range(e,t){const i=new h(this._plotFunctions,this._emptyValuePredicate);return i._items=this._items,i._start=this._lowerbound(e,a),i._end=this._upperbound(t),i._shareRead=!0,i}rangeIterator(e,t){const i=this._lowerbound(e,a),r=this._upperbound(t);if(i===r)return{hasNext:()=>!1,next:()=>{throw new Error("Invalid operation")}};let n=i-1;return{hasNext:()=>n<r-1,next:()=>(n+=1,this._items[n])}}minMaxOnRangeCached(e,t,i){if(this.isEmpty())return null;let r=null;for(const n of i){r=u(r,this._minMaxOnRangeCachedImpl(e-n.offset,t-n.offset,n.name))}
return r}minMaxOnRange(e,t,i){if(this.isEmpty())return null;let r=null;for(const n of i){r=u(r,this._minMaxOnRange(e-n.offset,t-n.offset,n.name))}return r}merge(e){return this._shareRead?(o.logDebug("merge: readonly collection modification attempt"),null):0===e.length?null:this.isEmpty()||e[e.length-1].index<this._items[0].index?this._prepend(e):e[0].index>this._items[this._items.length-1].index?this._append(e):1===e.length&&e[0].index===this._items[this._items.length-1].index?(this._updateLast(e[0]),e[0]):this._merge(e)}addTail(e,t=!1){let i=0;t&&this._end-this._start>0&&(i=1,this._items[this._end-this._start-1].value=e[0].value);for(let t=i;t<e.length;++t){const i=e[t],r=this.lastIndex();if(null===r){o.logError("Can't add tail to the empty plotlist");break}this.add(r+1,i.value)}this._invalidateSearchCaches()}move(e){if(this._shareRead)return void o.logDebug("move: readonly collection modification attempt");if(0===e.length)return;const t=this._items.slice();for(const i of e){const e=this._bsearch(i.old,a);if(null!==e&&void 0!==t[e])if(i.new===s.INVALID_TIME_POINT_INDEX)t[e]=void 0;else{t[e]={index:i.new,value:t[e].value};const r=this._bsearch(i.new,a);if(null!==r){const e=t[r];void 0!==e&&e.index===i.new&&(t[r]=void 0)}}}this._items=t.filter(e=>void 0!==e).sort((e,t)=>e.index-t.index),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._start=0,this._end=this._items.length}remove(e){if(this._shareRead)return o.logDebug("remove: readonly collection modification attempt"),null;const t=this._nonCachedSearch(e,l.NearestRight,a);if(null===t)return null;const i=this._items.splice(t);return this._end=this._items.length,this._minMaxCache.clear(),this._invalidateSearchCaches(),i.length>0?i[0]:null}state(){return{start:this._start,end:this._end,data:this._items,shareread:this._shareRead}}restoreState(e){e?(this._start=e.start,this._end=e.end,this._shareRead=e.shareread,this._items=e.data,this._minMaxCache.clear(),this._invalidateSearchCaches()):this.clear()}_indexAt(e){return this._items[e].index}_valueAt(e){return this._items[e].value}_length(){return this._items.length}_searchImpl(e,t,i,r,n,s){const o=void 0!==s?i:r,l=void 0!==s?1e4*(t+1)+s:t;let a=o.get(e);if(void 0!==a){const e=a.get(l);if(void 0!==e)return e}const c=this._nonCachedSearch(e,t,n,s);if(null===c)return null;const h={index:this._indexAt(c),value:this._valueAt(c)};return void 0===a&&(a=new Map,o.set(e,a)),a.set(l,h),h}_nonCachedSearch(e,t,i,r){const n=this._lowerbound(e,i),s=n===this._end||e!==i(this._items[n]);if(s&&t!==l.Exact)switch(t){case l.NearestLeft:return this._searchNearestLeft(n,r);case l.NearestRight:return this._searchNearestRight(n,r);default:throw new TypeError("Unknown search mode")}if(void 0===r||s||t===l.Exact)return s?null:n;switch(t){case l.NearestLeft:return this._nonEmptyNearestLeft(n,r);case l.NearestRight:return this._nonEmptyNearestRight(n,r);default:throw new TypeError("Unknown search mode")}}_nonEmptyNearestRight(e,t){const i=(0,r.ensure)(this._emptyValuePredicate),n=(0,r.ensure)(t)
;for(;e<this._end&&i(this._valueAt(e),n);)e+=1;return e===this._end?null:e}_nonEmptyNearestLeft(e,t){const i=(0,r.ensureNotNull)(this._emptyValuePredicate),n=(0,r.ensure)(t);for(;e>=this._start&&i(this._valueAt(e),n);)e-=1;return e<this._start?null:e}_searchNearestLeft(e,t){if(e===this._start)return null;const i=e-1,r=i!==this._end?i:null;return void 0!==t&&null!==r?this._nonEmptyNearestLeft(r,t):r}_searchNearestRight(e,t){const i=e,r=i!==this._end?i:null;return void 0!==t&&null!==r?this._nonEmptyNearestRight(r,t):r}_bsearch(e,t){const i=this._lowerbound(e,t);return i!==this._end&&e===t(this._items[i])?i:null}_lowerbound(e,t){return(0,n.lowerbound)(this._items,e,(e,i)=>t(e)<i,this._start,this._end)}_upperbound(e){return(0,n.upperbound)(this._items,e,(e,t)=>t.index>e,this._start,this._end)}_plotMinMax(e,t,i){let r=null;const n=this._plotFunctions.get(i);if(void 0===n)throw new Error(`Plot "${i}" is not registered`);for(let i=e;i<t;i++){const e=n(this._items[i].value);null==e||Number.isNaN(e)||(null===r?r={min:e,max:e}:(e<r.min&&(r.min=e),e>r.max&&(r.max=e)))}return r}_invalidateCacheForRow(e){const t=Math.floor(e.index/30);this._minMaxCache.forEach(e=>e.delete(t))}_prepend(e){return(0,r.assert)(!this._shareRead,"collection should not be readonly"),(0,r.assert)(0!==e.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=e.concat(this._items),this._start=0,this._end=this._items.length,e[0]}_append(e){return(0,r.assert)(!this._shareRead,"collection should not be readonly"),(0,r.assert)(0!==e.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=this._items.concat(e),this._start=0,this._end=this._items.length,e[0]}_updateLast(e){(0,r.assert)(!this.isEmpty(),"plot list should not be empty");const t=this._items[this._end-1];(0,r.assert)(t.index===e.index,"last row index should match new row index"),this._invalidateCacheForRow(e),this._invalidateSearchCaches(),this._items[this._end-1]=e}_merge(e){return(0,r.assert)(0!==e.length,"plot rows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=d(this._items,e),this._start=0,this._end=this._items.length,e[0]}_minMaxOnRangeCachedImpl(e,t,i){if(this.isEmpty())return null;let n=null;const s=(0,r.ensureNotNull)(this.firstIndex()),o=(0,r.ensureNotNull)(this.lastIndex()),l=Math.max(e,s),a=Math.min(t,o),c=30*Math.ceil(l/30),h=Math.max(c,30*Math.floor(a/30));n=u(n,this._minMaxOnRange(l,Math.min(c,t,a),i));let d=this._minMaxCache.get(i);void 0===d&&(d=new Map,this._minMaxCache.set(i,d));for(let e=Math.max(c+1,l);e<h;e+=30){const t=Math.floor(e/30);let r=d.get(t);if(void 0===r){const e=30*t,n=30*(t+1)-1;r=this._minMaxOnRange(e,n,i),d.set(t,r)}n=u(n,r)}n=u(n,this._minMaxOnRange(h,a,i));return n}_minMaxOnRange(e,t,i){return this._plotMinMax(this._lowerbound(e,a),this._upperbound(t),i)}_invalidateSearchCaches(){this._rowSearchCacheByIndex.clear(),this._rowSearchCacheByIndexWithoutEmptyValues.clear(),this._rowSearchCacheByTime.clear(),
this._rowSearchCacheByTimeWithoutEmptyValues.clear()}}function u(e,t){if(null===e)return t;if(null===t)return e;return{min:Math.min(e.min,t.min),max:Math.max(e.max,t.max)}}function d(e,t){const i=function(e,t){const i=e.length,r=t.length;let n=i+r,s=0,o=0;for(;s<i&&o<r;)e[s].index<t[o].index?s++:e[s].index>t[o].index?o++:(s++,o++,n--);return n}(e,t),r=new Array(i);let n=0,s=0;const o=e.length,l=t.length;let a=0;for(;n<o&&s<l;)e[n].index<t[s].index?(r[a]=e[n],n++):e[n].index>t[s].index?(r[a]=t[s],s++):(r[a]=t[s],n++,s++),a++;for(;n<o;)r[a]=e[n],n++,a++;for(;s<l;)r[a]=t[s],s++,a++;return r}},98424:(e,t,i)=>{i.d(t,{PriceAxisView:()=>p});var r=i(86441),n=i(34026),s=i(20808),o=i(21386),l=i(43498),a=i(24112),c=i(18718),h=i(64149),u=i(87511);class d{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,r,n,s,c){var u,d,p;const _=this._data;if(!_.visible||this._isOutOfScreen(t,n))return;const P=this._commonData,g=void 0!==_.labelIcon,v=_.ignoreOffset?0:t.offsetSize,m=t.borderSize,f=t.paddingTop+P.additionalPaddingTop,C=t.paddingBottom+P.additionalPaddingBottom,y=t.paddingInner,T=t.paddingOuter,w=t.fontSize;let S=_.text,x=_.textColor||P.textColor,b=_.secondLine||"",L=P.secondLineTextColor||x,A=_.thirdLine||"";const V=P.thirdLineTextColor||x;0===b.length&&(b=A,L=V,A=""),0===S.length&&(S=b,x=L,b=A,L=V,A=""),e.save(),e.font=t.font;const D=i.yMidCorrection(e,S)*c,M=Math.ceil(i.measureText(e,S)),I=w+f+C,B=Boolean(b),R=Boolean(A),E=B?Math.ceil(i.measureText(e,b)):0,k=R?Math.ceil(i.measureText(e,A)):0,N=m+y+T+M+v,F=E>0?m+y+T+E+v:0,O=k>0?m+y+T+k+v:0,z=Math.max(N,F,O),W=Math.max(1,Math.floor(c));let H=Math.round(I*c);H%2!=W%2&&(H+=1);const U=Math.round((w+t.lineSpacing)*c),G=Math.round(2*(w+t.lineSpacing)*c),q=Math.max(1,Math.floor(m*c)),j=_.separatorVisible?q:0,Q=_.borderVisible?q:0,Y=g?H:Math.round(z*c),K=Math.round(v*c),X=Math.ceil(r*c),Z=Math.ceil(y*c),$=Math.round((null!==(u=P.fixedCoordinate)&&void 0!==u?u:P.coordinate)*c)-Math.floor(.5*c),J=Math.floor($+W/2-H/2),ee=J+H,te="right"===s,ie=te?X-j:j,re=X;let ne,se=ie;const oe=(0,o.resetTransparency)(null!==(d=_.backgroung)&&void 0!==d?d:P.background);e.fillStyle=oe;const le=2*c;if(e.textAlign=te?"right":"left",e.textBaseline="middle",te?(se=ie-Y,ne=ie-K-Z-1):(se=ie+Y,ne=ie+K+Z),S||g){const i=R?H+G:B?H+U:H;if(((t,r,n)=>{te?(0,h.drawRoundRectWithInnerBorder)(e,se,J,Y,i,t,[le,0,0,le],Q,r,n):(0,h.drawRoundRectWithInnerBorder)(e,ie,J,Y,i,t,[0,le,le,0],Q,r,n)})(oe,null!==(p=P.borderColor)&&void 0!==p?p:oe,P.borderStyle),_.separatorVisible&&(e.fillStyle=t.paneBackgroundColor,e.fillRect(te?re-j:0,J,j,ee-J)),g){switch(_.labelIcon){case 0:this._drawPlusIcon(e,ie,se,J,$,ee,W);break;case 1:this._drawClockIcon(e,ie,se,$,W,c)}return void e.restore()}e.save(),e.translate(ne,(J+ee)/2+D),(0,a.drawScaled)(e,c,()=>{e.fillStyle=x,e.fillText(S,0,0)}),e.restore()}B&&(e.fillStyle=L,e.save(),e.translate(ne,(J+ee)/2+D+U),(0,a.drawScaled)(e,c,()=>{e.fillText((0,l.startWithLTR)(b),0,0)}),e.restore()),R&&(e.fillStyle=V,e.save(),e.translate(ne,(J+ee)/2+D+G),(0,
a.drawScaled)(e,c,()=>{e.fillText((0,l.startWithLTR)(A),0,0)}),e.restore()),e.restore()}height(e){const t=this._lines();return this._data.visible&&0!==t?t*e.fontSize+(t-1)*e.lineSpacing+e.paddingTop+this._commonData.additionalPaddingTop+e.paddingBottom+this._commonData.additionalPaddingBottom:0}hitTest(e){const t=this._data.hitTestData;if(void 0===t||!this._data.visible)return null;const i=(0,s.lastMouseOrTouchEventInfo)().isTouch?10:0,o=(0,r.box)(new r.Point(t.xl-i,t.y-i),new r.Point(t.xl+t.containerWidth+i,t.y+t.containerHeight+i)),l=t.left&&(0,n.pointInBox)(e,o),a=(0,r.box)(new r.Point(t.xr-i,t.y-i),new r.Point(t.xr+t.containerWidth+i,t.y+t.containerHeight+i)),h=t.right&&(0,n.pointInBox)(e,a);if(l||h){const i=l?"left":"right";return new c.HitTestResult(c.HitTestResult.CUSTOM,{cursorType:u.PaneCursorType.Default,clickHandler:void 0===t.clickHandler?void 0:t.clickHandler.bind(this,e,i),tapHandler:void 0===t.clickHandler?void 0:t.clickHandler.bind(this,e,i),tooltip:t.tooltip})}return null}_drawPlusIcon(e,t,i,r,n,s,o){e.fillStyle=this._commonData.textColor,e.strokeStyle=this._commonData.textColor,e.lineWidth=o;const l=Math.abs(t-i);let a=Math.round(.35*l);a%2!=o%2&&(a+=1);let c=Math.round(.65*l);c%2!=o%2&&(c+=1);const h=Math.floor((l-a)/2),u=Math.min(t,i),d=u+Math.floor(l/2-o/2);e.fillRect(u+h,n,a,o),e.fillRect(d,r+h,o,a),e.beginPath(),e.arc(d+o/2,n+o/2,c/2,0,2*Math.PI,!1),e.stroke()}_drawClockIcon(e,t,i,r,n,s){e.fillStyle=this._commonData.textColor,e.lineWidth=n;const o=Math.abs(t-i);let l=Math.round(.35*o);l%2!=n%2&&(l+=1);let a=Math.round(.65*o);a%2!=n%2&&(a+=1);const c=Math.min(t,i)+Math.floor(o/2-n/2);e.save(),e.translate(c+n/2-a/2,r+n/2-a/2),e.scale(s,s);const h=new Path2D("M7.5 0.8a1 1 0 0 0 0 13.4 1 1 0 0 0 0-13.4zm0 1a1 1 0 0 1 0 11 1 1 0 0 1 0-11zm-.97-.25A3.5 3.5 0 0 0 3.5 0 3.5 3.5 0 0 0 0 3.5a3.5 3.5 0 0 0 1.75 3.03l.5-.86A2.5 2.5 0 0 1 1 3.5 2.5 2.5 0 0 1 3.5 1a2.5 2.5 0 0 1 2.17 1.25zm6.72 4.78A3.5 3.5 0 0 0 15 3.5 3.5 3.5 0 0 0 11.5 0a3.5 3.5 0 0 0-3.03 1.75l.86.5A2.5 2.5 0 0 1 11.5 1 2.5 2.5 0 0 1 14 3.5a2.5 2.5 0 0 1-1.25 2.17zM7 5h1v5H7zm3 2v1H5V7z");e.fill(h),e.restore()}_lines(){const e=this._data;return(e.text?1:0)+(e.secondLine?1:0)+(e.thirdLine?1:0)}_isOutOfScreen(e,t){var i;const r=this._commonData,n=null!==(i=r.fixedCoordinate)&&void 0!==i?i:r.coordinate,s=this.height(e),o=s/this._lines();return n-o/2-3>t||n+(s-o/2)+3<0}}class p{constructor(e){this._commonRendererData={coordinate:0,textColor:"#FFF",background:"#000",additionalPaddingBottom:0,additionalPaddingTop:0},this._axisRendererData={text:"",visible:!1,separatorVisible:!1,borderVisible:!1,ignoreOffset:!1},this._paneRendererData={text:"",visible:!1,separatorVisible:!0,borderVisible:!1,ignoreOffset:!0},this._invalidated=!0,this._axisRenderer=new(e||d)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(e||d)(this._paneRendererData,this._commonRendererData)}text(){return this._updateRendererDataIfNeeded(),this._axisRendererData.text}secondLineText(){return this._updateRendererDataIfNeeded(),
this._axisRendererData.secondLine}thirdLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.thirdLine}background(){return this._updateRendererDataIfNeeded(),this._commonRendererData.background}color(){return this._updateRendererDataIfNeeded(),this.generateTextColor(this.background())}generateTextColor(e){return(0,o.colorFromBackground)(e)}coordinate(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate}floatCoordinate(){var e;return this._updateRendererDataIfNeeded(),null!==(e=this._commonRendererData.floatCoordinate)&&void 0!==e?e:this._commonRendererData.coordinate}update(){this._invalidated=!0}height(e){return this._updateRendererDataIfNeeded(),Math.max(this._axisRenderer.height(e),this._paneRenderer.height(e))}getFixedCoordinate(){return this._commonRendererData.fixedCoordinate||0}setFixedCoordinate(e){this._commonRendererData.fixedCoordinate=e}isVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible}isAxisLabelVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible}isPaneLabelVisible(){return this._updateRendererDataIfNeeded(),this._paneRendererData.visible}renderer(){return this._updateRendererDataIfNeeded(),this._axisRenderer}paneRenderer(){return this._updateRendererDataIfNeeded(),this._paneRenderer}setPaneRendererLabelIcon(e){this._paneRendererData.labelIcon=e}setPaneLabelVisible(e){this._paneRendererData.visible=e,this._invalidated=!0}ignoreAlignment(){return!1}_updateRendererDataIfNeeded(){this._invalidated&&(this._commonRendererData.fixedCoordinate=void 0,this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData),this._invalidated=!1)}}},59270:(e,t,i)=>{i.r(t),i.d(t,{PriceRange:()=>s});var r=i(70617);const n=(0,i(11905).getLogger)("Chart.PriceRange");class s{constructor(e,t){if(null!==e&&"object"==typeof e){const t=e;this._minValue=t.m_minValue,this._maxValue=t.m_maxValue}else{const i=e;this._minValue=i,void 0!==t&&(this._maxValue=t)}}equals(e){return this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new s(this._minValue,this._maxValue)}minValue(){return this._minValue}setMinValue(e){this._minValue=e}maxValue(){return this._maxValue}setMaxValue(e){this._maxValue=e}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||this._maxValue!=this._maxValue||this._minValue!=this._minValue}serialize(){return{m_maxValue:this._maxValue,m_minValue:this._minValue}}state(){return{max:this._maxValue,min:this._minValue}}merge(e){return new s(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))}apply(e,t){this._minValue=Math.min(this._minValue,e),this._maxValue=Math.max(this._maxValue,t)}set(e,t){this._minValue=e,this._maxValue=t}scaleAroundCenter(e){if(!(0,r.isNumber)(e))return void n.logDebug("PriceRange.scaleAroundCenter: invalid coeff");if(0===this._maxValue-this._minValue)return;const t=.5*(this._maxValue+this._minValue)
;let i=this._maxValue-t,s=this._minValue-t;i*=e,s*=e,this._maxValue=t+i,this._minValue=t+s}shift(e){(0,r.isNumber)(e)?(this._maxValue+=e,this._minValue+=e):n.logDebug("PriceRange.shift: invalid coeff")}containsStrictly(e){return e.minValue()>this._minValue&&e.maxValue()<this._maxValue}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}},60949:(e,t,i)=>{i.d(t,{createPrimitiveProperty:()=>s});var r=i(32567),n=i.n(r);function s(e){return new(n())(e)}},10196:(e,t,i)=>{i.d(t,{scaleRatio:()=>n,priceRangeByScaleRatio:()=>s,barSpacingByScaleRatio:()=>o});var r=i(59270);function n(e,t){if(t.isLog()||e.isEmpty()||t.isEmpty())return null;const i=function(e){if(e.isEmpty())return null;const t=e.priceRange();if(null===t)return null;const i=t.length();return e.internalHeight()/i}(t);if(null===i)return null;return e.getValidBarSpacing()/Math.max(1e-10,i)}function s(e,t,i){if(e.isLog()||null===i||e.isEmpty())return null;const n=e.priceRange();if(null===n||n.isEmpty())return null;const s=e.internalHeight()/(t/i),o=n.length();if(s===o)return n;const l=(s-o)/2;return new r.PriceRange(n.minValue()-l,n.maxValue()+l)}function o(e,t){if(e.isLog()||null===t||e.isEmpty())return null;const i=e.priceRange();if(null===i)return null;const r=i.length();return e.internalHeight()/r*t}},62203:(e,t,i)=>{i.d(t,{SeriesTimeRangeVolumeCalculator:()=>r});class r{constructor(e){this._value=null,this._series=e,this._series.dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated)}destroy(){this._series.dataEvents().dataUpdated().unsubscribeAll(this)}volume(e,t){if(null!==this._value&&this._value.from===e&&this._value.to===t)return this._value.value;let i=0;const r=this._series.data().bars(),n=r.firstIndex(),s=r.lastIndex();if(null!==n&&e<n&&t<n||null!==s&&e>s&&t>s)i=NaN;else{const r=this._series.data().bars().rangeIterator(Math.min(e,t),Math.max(e,t));for(;r.hasNext();){const e=r.next().value[5];if(void 0===e){i=NaN;break}i+=e}}return this._value={from:e,to:t,value:i},i}_onSeriesUpdated(e,t){if(null===this._value)return;if(t)return void(this._value=null);const i=this._series.data().bars().lastIndex();(null===i||i<=this._value.to)&&(this._value=null)}}},99452:(e,t,i)=>{i.d(t,{seriesPrice:()=>s,positionVisualDirection:()=>l,positionToCoordinate:()=>a,noDataBasePosition:()=>c,seriesBasePosition:()=>h,getNoDataPosition:()=>u,getSeriesPosition:()=>d});var r=i(88537),n=i(52280);function s(e,t,i){const r=e.barFunction();switch(e.style()){case 3:case 10:case 2:return r(t.value);default:return t.value[-1===i?3:2]}}function o(e){return e>=0?1:-1}function l(e,t){return-1===o(e)!==t?-1:1}function a(e,t,i,r){const n=Math.min(t,Math.max(0,1===r?i:t-i));return i-r*Math.abs(n*e/100)}function c(e,t,i){const r=e.index();return null===r?null:{index:r,price:t.coordinateToPrice(t.height()/2,i)}}function h(e,t){const i=e.data().bars(),r=i.first(),l=i.last();if(null===r||null===l)return null;let a;const c=t.index();if(null===c){if(void 0===t.time)return null;const e=t.time(),s=r.value[0],o=l.value[0];if(e<s-86400||e>o)return null
;a=i.searchByTime(e,n.PlotRowSearchMode.NearestRight,4)}else a=i.search(c);return null===a?null:{index:a.index,price:s(e,a,o(t.position()))}}function u(e,t,i){const r=c(e,t,i);if(null===r)return null;const n=l(e.position(),t.isInverted());return{index:r.index,price:r.price,poleStartY:t.height(),visualDirection:1,positionPointDirection:n}}function d(e,t){const i=h(e,t),n=e.priceScale(),s=(0,r.ensureNotNull)(e.firstValue());if(null===i)return u(t,n,s);let o=0;const a=e.properties().childs(),c=e.model().timeScale(),d=n.priceToCoordinate(i.price,s);switch(e.style()){case 3:o=a.areaStyle.childs().linewidth.value()/2;break;case 2:o=a.lineStyle.childs().linewidth.value()/2;break;case 10:const e=Math.abs(100-a.baselineStyle.childs().baseLevelPercentage.value());o=n.height()*e/100>d?a.baselineStyle.childs().topLineWidth.value()/2:a.baselineStyle.childs().bottomLineWidth.value()/2;break;case 1:case 9:case 8:case 12:o=3;break;case 0:o=a.barStyle.childs().thinBars.value()?3:Math.max(3,.25*c.barSpacing());break;case 11:o=a.rangeStyle.childs().thinBars.value()?3:Math.max(3,.25*c.barSpacing());break;case 4:case 7:o=3;break;case 5:o=Math.max(4,.25*c.barSpacing());break;case 6:o=Math.max(5,.25*c.barSpacing())}const p=l(t.position(),n.isInverted()),_=d-p*o;return{index:i.index,price:i.price,poleStartY:_,visualDirection:p,positionPointDirection:p}}},31825:(e,t,i)=>{var r,n,s,o;i.d(t,{MarkLocation:()=>r,HAlign:()=>n,LineStyle:()=>o}),function(e){e.AboveBar="AboveBar",e.BelowBar="BelowBar",e.Top="Top",e.Bottom="Bottom",e.Right="Right",e.Left="Left",e.Absolute="Absolute",e.AbsoluteUp="AbsoluteUp",e.AbsoluteDown="AbsoluteDown"}(r||(r={})),function(e){e.Left="left",e.Center="center",e.Right="right"}(n||(n={})),function(e){e.Top="top",e.Middle="middle",e.Bottom="bottom"}(s||(s={})),function(e){e[e.Solid=0]="Solid",e[e.Dotted=1]="Dotted",e[e.Dashed=2]="Dashed"}(o||(o={}))},6342:(e,t,i)=>{i.d(t,{areEqualSymbols:()=>n,symbolSameAsCurrent:()=>o});const r=i(11688).enabled("uppercase_instrument_names");function n(e,t){return void 0===e?void 0===t:void 0!==t&&(r?e.toUpperCase()===t.toUpperCase():e===t)}function s(e,t){return e.some(e=>n(t,e))}function o(e,t,i){if(n(t,e))return!0;if(i){if(n(i.full_name,e)||n(i.pro_name,e))return!0;if(n(i.ticker,e))return!0;if(i.aliases&&s(i.aliases,e))return!0;if(i.alternatives&&s(i.alternatives,e))return!0;if(0===e.indexOf("FRA:")&&n(i.pro_name,e.replace("FRA:","FWB:")))return!0}return!1}},42053:(e,t,i)=>{i.d(t,{TimeAxisView:()=>o});var r=i(21386),n=i(24112);class s{constructor(){this._data=null}setData(e){this._data=e}draw(e,t,i){if(null===this._data||!this._data.visible||0===this._data.text.length)return;const r=this._data;e.font=t.font;const s=Math.round(t.widthCache.measureText(e,r.text));if(s<=0)return;e.save();const o=t.paddingHorizontal,l=s+2*o,a=l/2;let c=r.coordinate,h=Math.floor(c-a)+.5;if(r.alwaysInViewPort){const e=r.width;h<0?(c+=Math.abs(0-h),h=Math.floor(c-a)+.5):h+l>e&&(c-=Math.abs(e-(h+l)),h=Math.floor(c-a)+.5)}
const u=h+l,d=Math.ceil(0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize+t.paddingBottom);e.fillStyle=r.background;const p=Math.round(h*i),_=Math.round(0*i),P=Math.round(u*i),g=Math.round(d*i),v=Math.round(2*i);e.beginPath(),e.moveTo(p,_),e.lineTo(p,g-v),e.arcTo(p,g,p+v,g,v),e.lineTo(P-v,g),e.arcTo(P,g,P,g-v,v),e.lineTo(P,_),e.fill();const m=0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize/2;e.textAlign="left",e.textBaseline="middle",e.fillStyle=r.color;const f=t.widthCache.yMidCorrection(e,"Apr0");e.translate((h+o)*i,(m+f)*i),(0,n.drawScaled)(e,i,()=>e.fillText(r.text,0,0)),e.restore()}}class o{constructor(e){this._renderer=new s,this._rendererData={background:"",color:"",coordinate:0,text:"",visible:!1,width:0,alwaysInViewPort:!0},this._invalidated=!0,this._model=e,this._renderer.setData(this._rendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}coordinate(){return this._rendererData.coordinate}_getAlwaysInViewPort(){return!0}_updateImpl(){const e=this._rendererData;if(e.visible=!1,this._model.timeScale().isEmpty())return;const t=this._getIndex();if(null===t)return;e.visible=!0,e.width=this._model.timeScale().width(),e.background=this._getBgColor(),e.color=(0,r.colorFromBackground)(e.background),e.coordinate=this._model.timeScale().indexToCoordinate(t),e.alwaysInViewPort=this._getAlwaysInViewPort();const i=this._model.timeScale().indexToUserTime(t);e.text=null!==i?this._model.dateTimeFormatter().format(i):"",this._invalidated=!1}}},76745:(e,t,i)=>{i.d(t,{INVALID_TIME_POINT_INDEX:()=>r});const r=-2e6},8214:(e,t,i)=>{function r(e,t,i,r){return`${r?r+" ":""}${i?i+" ":""}${e}px ${t}`}i.d(t,{makeFont:()=>r,parseFont:()=>s});const n=/(bold )?(italic )?(\d+)(px|pt) (.*)$/;function s(e){const t=n.exec(e);return null===t?null:{family:t[5],size:parseInt(t[3])*("pt"===t[4]?.75:1),bold:Boolean(t[1]),italic:Boolean(t[2])}}},33156:(e,t,i)=>{i.d(t,{getTwemojiUrl:()=>n});var r=i(18438);function n(e,t){let i="";return r.default.parse(e,e=>(i=r.default.base+("svg"===t?`svg/${e}.svg`:`72x72/${e}.png`),!1)),i}},64894:(e,t,i)=>{i.d(t,{registerService:()=>o,unregisterService:()=>l,hasService:()=>a,service:()=>c,waitServiceRegistered:()=>h});var r=i(79917);const n={},s=new Map;function o(e,t){if(a(e))throw new Error("Service already registered");n[e.id]=t;const i=s.get(e.id);void 0!==i&&(s.delete(e.id),i.resolve(t))}function l(e){if(!a(e))throw new Error("Service not found");n[e.id]=void 0}function a(e){return void 0!==n[e.id]}function c(e){const t=n[e.id];if(void 0===t)throw new Error("ServiceLocator: Service "+e.id+" not found");return t}function h(e){if(a(e))return Promise.resolve(c(e));let t=s.get(e.id);return void 0===t&&(t=(0,r.createDeferredPromise)(),s.set(e.id,t)),t.promise}}}]);