"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[40968],{90997:(e,t,i)=>{function s(e,t,i){const s=e.get(t);return void 0!==s?s:(e.set(t,i),i)}function r(e,t,i){const s=e.get(t);if(void 0!==s)return s;const r=i();return e.set(t,r),r}function n(e,t,i,r){const n=s(e,t,new Map);return s(n,i,r)}function a(e,t,i,n){return r(s(e,t,new Map),i,n)}function o(e,t,i,r,n){const a=s(e,t,new Map),o=s(a,i,new Map);return s(o,r,n)}i.d(t,{getDefault2:()=>n,getDefault2Lazy:()=>a,getDefault3:()=>o,AbstractMapContainer:()=>l});class l{constructor(){this._map=new Map,this._size=0}size(){return this._size}clear(){this._map.clear(),this._size=0}}},57380:(e,t,i)=>{i.d(t,{WatchedObject:()=>o});var s=i(62325),r=i.n(s),n=i(70617);function a(e,t){return(0,n.deepEquals)(e,t)[0]}class o extends(r()){constructor(e,t=a){super(e),this._comparator=t}setValue(e,t){!1===this._comparator(this.value(),e)&&super.setValue(e,t)}}},96365:(e,t,i)=>{i.d(t,{MarketStatusModel:()=>h});var s=i(62325),r=i.n(s),n=i(97753),a=i(93987);function o(){const e=window.ChartApiInstance.serverTimeOffset();return Date.now()/1e3+e}function l(e,t,i){return e<=i?t<=i?1/0:t/1e3:Math.min(e,t)/1e3}class h{constructor(e,t){this._marketStatus=new(r())(null),this._lastMarketStatus=null,this._sessionsSpec=null,this._nextSessionEdgeInternal=null,this._nextSessionEdge=new(r())(null),this._recalcNextSessionEdgeTimerId=null,this._quotesProvider=e,e.quotesUpdate().subscribe(this,this._update.bind(this)),e.quoteSymbolChanged().subscribe(this,()=>{this._nextSessionEdgeInternal=null,this._recalculateNextSessionEdge()}),this._resetSubscription=t,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.quoteSymbolChanged().unsubscribeAll(this),this._resetSubscription.unsubscribeAll(this),null!==this._recalcNextSessionEdgeTimerId&&clearTimeout(this._recalcNextSessionEdgeTimerId)}setSymbolInfo(e){var t,i,s,r,a;if(this._nextSessionEdgeInternal=null,null===e)return void(this._sessionsSpec=null);const o=new n.SessionSpec(e.timezone,null!==(t=e.session_display)&&void 0!==t?t:e.session,e.session_holidays,e.corrections);let l,h;const d=null===(i=e.subsessions)||void 0===i?void 0:i.find(e=>"premarket"===e.id),u=null===(s=e.subsessions)||void 0===s?void 0:s.find(e=>"postmarket"===e.id);void 0!==d&&(l=new n.SessionSpec(e.timezone,null!==(r=d["session-display"])&&void 0!==r?r:d.session,e.session_holidays,d["session-correction"])),void 0!==u&&(h=new n.SessionSpec(e.timezone,null!==(a=u["session-display"])&&void 0!==a?a:u.session,e.session_holidays,u["session-correction"])),this._sessionsSpec={general:o,preMarket:l,postMarket:h},this._recalculateNextSessionEdge()}status(){return this._marketStatus}nextSessionEdge(){return this._nextSessionEdge}_resetStatus(){this._marketStatus.setValue(null)}_update(e){void 0!==e&&void 0!==e.values.current_session&&(this._lastMarketStatus=e.values.current_session),
null!==this._lastMarketStatus?this._marketStatus.setValue(this._lastMarketStatus):this._resetStatus()}_getNextSessionEdgeInternal(){var e;if(null===this._sessionsSpec||"24x7"===this._sessionsSpec.general.spec())return null;const t=1e3*o();if(null===this._nextSessionEdgeInternal||(null!==(e=this._nextSessionEdgeInternal.timestamp)&&void 0!==e?e:1/0)<=t/1e3){const{general:e,preMarket:i,postMarket:s}=this._sessionsSpec,r=(0,a.get_timezone)(e.timezone()),n=(0,a.utc_to_cal)(r,t),o=l((0,a.cal_to_utc)(r,e.alignToNearestSessionStart(n,1)),(0,a.cal_to_utc)(r,e.alignToNearestSessionEnd(n,1)),t),h=l(void 0!==i?(0,a.cal_to_utc)(r,i.alignToNearestSessionStart(n,1)):1/0,void 0!==i?(0,a.cal_to_utc)(r,i.alignToNearestSessionEnd(n,1)):1/0,t),d=l(void 0!==s?(0,a.cal_to_utc)(r,s.alignToNearestSessionStart(n,1)):1/0,void 0!==s?(0,a.cal_to_utc)(r,s.alignToNearestSessionEnd(n,1)):1/0,t),u=Math.min(o,h,d);u===1/0&&(this._nextSessionEdgeInternal={timestamp:null}),this._nextSessionEdgeInternal=u===d?{timestamp:u,status:"post_market"}:u===h?{timestamp:u,status:"pre_market"}:{timestamp:u}}return this._nextSessionEdgeInternal}_recalculateNextSessionEdge(){const e=this._getNextSessionEdgeInternal();if(null===e||null===e.timestamp)return void this._nextSessionEdge.setValue(null);const t={status:e.status,remainingSeconds:Math.max(0,e.timestamp-o())};if(null===this._recalcNextSessionEdgeTimerId){let e=Math.ceil(t.remainingSeconds%60);0===e&&(e+=60),this._recalcNextSessionEdgeTimerId=setTimeout(()=>this._recalculateNextSessionEdgeByTimer(),1e3*e)}this._nextSessionEdge.setValue(t)}_recalculateNextSessionEdgeByTimer(){this._recalcNextSessionEdgeTimerId=null,this._recalculateNextSessionEdge()}}},81967:(e,t,i)=>{i.d(t,{isBats:()=>c,firstReplacedByBatsExchange:()=>_,isEod:()=>p,isDelay:()=>m,witoutRealtime:()=>y,isTickByTick:()=>f,isDelayForGuest:()=>g,isDelayWithoutMarketAgreement:()=>S,getExchange:()=>b});var s=i(88537),r=i(66437),n=i.n(r),a=i(33813),o=i(60507),l=i(95048);const h=["DJ","CBOE","JSE"],d=["NZX"],u=["ICESG"];function c(e){return n().hasBatsSymbols(e.full_name)}function _(e){const t=n().getExchanges(e.pro_name),i=n().getExchanges(e.full_name);for(let e=0;e<i.length;++e)if("BATS"===i[e].toUpperCase())return t[e];return null}function p(e,t){return n().hasEodSymbols(e.full_name)||t===l.STATUS_EOD}function m(e){return void 0!==e&&e>0}function y(e){return"index"===e.type&&h.includes(e.listed_exchange)||"futures"===e.type&&d.includes(e.listed_exchange)}function f(e,t){return!((0,o.enabled)(a.ProductFeatures.TICK_BY_TICK_PUSH_DATA)||m(e.delay)||p(e,t)||function(e){return"bitcoin"===e.type||"crypto"===e.type}(e))}function g(e,t){return t.listed_exchange===e&&!window.is_authenticated}function S(e){return u.includes(e.listed_exchange)}async function b(e){{const t=(0,s.ensureDefined)(window.pro);await new Promise(e=>{t.runOrUpdate(e)});const i=t.getProduct(function(e){return"exchange-"+e.pro_perm}(e)),r=function(e){let t;{if(!window.pro)throw new Error("Pro module not defined");const i=window.pro.getProductsByType(window.pro.PRODUCT_TYPES.exchange)
;t=i.find(t=>Boolean(t.included_exchanges&&t.included_exchanges.includes(e)))}return t||null}(i.exchange||"");return r&&"cme-full"===r.exchange?i:r||i}}},45455:(e,t,i)=>{i.d(t,{TextImageCachesContainer:()=>a});var s=i(88537),r=i(90997),n=i(67151);class a extends r.AbstractMapContainer{constructor(e){super(),this._maxSize=e,this._keysQueue=[]}get(e){const{fontSize:t,text:i,align:s,lineSpacing:a=0}=e;if(!i||!t||!s)return null;const o=(0,r.getDefault3)(this._map,a,s,t,new Map);let l=o.get(i);return void 0!==l||(this._size>=this._maxSize?this._deleteFirstKey():++this._size,this._keysQueue.push([t,s,a,i]),l=new n.TextImageCache(i,e.bold,e.italic,e.font,t,s,a),o.set(i,l)),l}_deleteFirstKey(){const e=this._keysQueue.shift(),[t,i,r,n]=e,a=(0,s.ensureDefined)(this._map.get(r)),o=(0,s.ensureDefined)(a.get(i)),l=(0,s.ensureDefined)(o.get(t));l.delete(n),0===l.size&&o.delete(t),0===o.size&&a.delete(i),0===a.size&&this._map.delete(r)}}},67151:(e,t,i)=>{i.d(t,{HorizontalAlign:()=>s,VerticalAlign:()=>r,TextImageCache:()=>h});var s,r,n=i(88537),a=i(8214),o=i(24112);!function(e){e.Left="left",e.Right="right",e.Center="center"}(s||(s={})),function(e){e.Top="top",e.Bottom="bottom",e.Middle="middle"}(r||(r={}));const l=(0,o.createDisconnectedCanvas)(document,new o.Size(0,0),1);class h{constructor(e,t,i,s,r,o="center",h=0){this._lines=e.split(/[^\S\r\n]*(?:\r\n|\r|\n)/),this._font=function(e,t,i,s){return(0,a.makeFont)(s,i,`${e?"bold ":""}${t?"italic ":""}`)}(t,i,s,r),this._fontSize=r,this._verticalPadding=~~(r/6),this._textAlign=o,this._lineSpacing=h;const d=(0,n.ensureNotNull)(l.getContext("2d"));d.font=this._font,d.textBaseline="top";let u=0;for(let e=0;e<this._lines.length;++e){const t=this._lines[e],i=d.measureText(t).width;u=Math.max(u,i)}this.textImageWidth=u+1,this.textImageHeight=this._lines.length*r+(this._lines.length-1)*this._lineSpacing+this._verticalPadding}paintTo(e,t,i,s,r,n,a){e.save();const l=t.pixelRatio;let h;switch(e.translate(Math.round(function(e,t,i){let s=e;switch(t){case"left":break;case"right":s-=i;break;case"center":s-=i/2}return Math.round(s)}(s,n,this.textImageWidth)*l),Math.round(function(e,t,i){let s=e;switch(t){case"top":break;case"bottom":s-=i;break;case"middle":s-=i/2}return Math.round(s)}(r,a,this.textImageHeight)*l)),e.textBaseline="top",e.font=this._font,e.fillStyle=i,this._textAlign){case"left":h=0,e.textAlign="left";break;case"right":h=this.textImageWidth-1,e.textAlign="right";break;default:h=this.textImageWidth/2,e.textAlign="center"}let d=this._verticalPadding;(0,o.drawScaled)(e,l,()=>{for(const t of this._lines)e.fillText(t,h,d),d+=this._fontSize,d+=this._lineSpacing}),e.restore()}}},94766:(e,t,i)=>{i.d(t,{createTimeToBarTimeAligner:()=>o});i(93987);var s=i(11688),r=(i(73044),i(74200)),n=i(66190);new r.SessionInfo("Etc/UTC","0000-0000:1234567");function a(){return!s.enabled("disable_resolution_rebuild")}function o(e,t){if(!a())return e=>e;const i=new r.SessionInfo(t.timezone,t.session,t.session_holidays,t.corrections),s=(0,n.newBarBuilder)(e,i,i,!1);return e=>s.alignTimeIfPossible(e)}},
66190:(e,t,i)=>{i.d(t,{SessionInfo:()=>a.SessionInfo,newBarBuilder:()=>S});var s=i(93987),r=i(73044),n=i(66915),a=i(74200),o=i(70062);class l extends a.BarBuilderBase{constructor(e,t){super(),this._sessionStartMs=-Number.MAX_VALUE,this._sessionEndMs=-Number.MAX_VALUE,this._periodSec=e,this._session=t}alignTimeIfPossible(e){const t=this.alignTime(e);return isNaN(t)?e:t}indexOfBar(e){return e<this._sessionStartMs?o.SessionStage.PRE_SESSION:e>=this._sessionEndMs?o.SessionStage.POST_SESSION:(0,n.toInt)(s.time_seconds_diff(e,this._sessionStartMs)/this._periodSec)}startOfBar(e){if(e===o.SessionStage.PRE_SESSION){const e=s.get_cal_from_unix_timestamp_ms(this._session.timezone,this._sessionStartMs-1),t=this._session.spec.alignToNearestSessionEnd(e,-1);return s.cal_to_utc(this._session.timezone,t)}if(e===o.SessionStage.POST_SESSION)return this._sessionEndMs;if(e<0)throw new Error("Negative offset is not supported");return this._sessionStartMs+s.time_seconds(this._periodSec*e)}endOfBar(e){if(e<0)throw new Error("Index cannot be negative");const t=this.startOfBar(e)+1e3*this._periodSec;return t>this._sessionEndMs?this._sessionEndMs:t}isLastBar(e,t){return t>=this._sessionStartMs+s.time_seconds(this._periodSec*(e+1)-1)}moveTo(e){const t=this._session.timezone,i=s.utc_to_cal(t,e),r=this._session.spec.alignToSessionStart(i);this._sessionStartMs=s.cal_to_utc(t,i),s.add_minutes(i,r),this._sessionEndMs=s.cal_to_utc(t,i)}indexOfLastBarInSession(){return(0,n.toInt)((this._sessionEndMs-1-this._sessionStartMs)/1e3/this._periodSec)}moveNext(){this.moveTo(this._sessionEndMs)}}var h=i(12666);function d(e,t){const i=s.clone(t),r=e.businessDaysToCalendarDays(i,1);r>1&&s.add_date(i,r-1);const n=e.leftBorderOfDailyBar(i);if(null===n)throw new Error("Cannot calculate left border of daily bar");return s.cal_to_utc(s.get_timezone(e.timezone()),n)}class u extends a.BarBuilderBase{constructor(e,t,i,s,r=!1){super(),this._periodStart=-Number.MAX_VALUE,this._periodEnd=-Number.MAX_VALUE,this._periodLastBarStart=-Number.MAX_VALUE,this._periodStartDay=new h.BusinessDay(0,0,0),this._periodEndDay=new h.BusinessDay(0,0,0),this._period=i,this._sessionTgt=e,this._builder=s,this._useBusinessDays=r,this._sessionSrc=r?new a.SessionInfo("Etc/UTC","24x7"):t||e}builder(){return this._builder}alignTimeIfPossible(e){return this.tradingDayToSessionStart(e)}tradingDayToSessionStart(e){return this.moveTo(e),this.startOfBar(0)}indexOfBar(e){if(this._useBusinessDays){const t=h.BusinessDay.fromCalendar(s.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e));return t.before(this._periodStartDay)?o.SessionStage.PRE_SESSION:this._periodEndDay.before(t)?o.SessionStage.POST_SESSION:0}return e<this._periodStart?o.SessionStage.PRE_SESSION:e>=this._periodEnd?o.SessionStage.POST_SESSION:0}startOfBar(e){if(e===o.SessionStage.PRE_SESSION){const e=s.get_cal_from_unix_timestamp_ms(this._sessionTgt.timezone,this._periodStart-1),t=this._sessionTgt.spec.alignToNearestSessionEnd(e,-1);return s.cal_to_utc(this._sessionTgt.timezone,t)-1}
return e===o.SessionStage.POST_SESSION||e>0?this._periodEnd:e===o.SessionStage.LASTBAR_SESSION?this._periodLastBarStart:this._periodStart}moveTo(e){const t=s.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e);this._sessionSrc.spec.correctTradingDay(t);const i=s.get_year(t),r=this._indexOfPeriodInYear(t),n=r+this._period,a=this._sessionTgt.spec,o=this._sessionTgt.timezone,l=this._builder.startOfPeriod(o,r,i);this._periodStart=d(a,l);const u=s.clone(l),c=a.businessDaysToCalendarDays(u,1);c>1&&s.add_date(u,c-1),this._periodStartDay=h.BusinessDay.fromCalendar(u);const _=this._builder.startOfPeriod(o,n,i);this._periodEnd=d(a,_);const p=s.clone(_);for(s.add_date(p,-1);a.isCalWeekEnd(p);)s.add_date(p,-1);this._periodEndDay=h.BusinessDay.fromCalendar(p),s.add_date(_,-1),function(e,t){for(;e.isCalWeekEnd(t);)s.add_date(t,-1)}(this._sessionTgt.spec,_),this._periodLastBarStart=d(a,_),(this._periodLastBarStart<this._periodStart||this._periodLastBarStart===this._periodEnd)&&(this._periodLastBarStart=this._periodStart)}endOfBar(e){if(0!==e)throw new Error("index should be 0");return this._periodEnd}isLastBar(e,t){if(0!==e)throw new Error("index should be 0");return t>=this._periodLastBarStart}currentRange(){return{from:this._periodStartDay,to:this._periodEndDay}}indexOfBarInYear(e){const t=s.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e),i=s.get_year(t),r=this._builder.indexOfPeriod(t),a=this._sessionTgt.timezone;let o=this._builder.startOfPeriod(a,r,i),l=d(this._sessionTgt.spec,o);return o=s.get_cal_from_unix_timestamp_ms(s.get_timezone("Etc/UTC"),l),i<s.get_year(o)?(o=this._builder.startOfPeriod(a,r-1,i),l=d(this._sessionTgt.spec,o),{index:(r-1)/this._period,time:l}):{index:(0,n.toInt)(r/this._period),time:l}}sessionSrc(){return this._sessionSrc}_indexOfPeriodInYear(e){const t=this._builder.indexOfPeriod(e);let i=(0,n.toInt)(t/this._period)*this._period;return-1===t&&(i=-this._period),i}}function c(e,t){const i=s.get_day_of_week(t)-e.firstDayOfWeek();return i<0?i+7:i}function _(e,t){const i=s.get_day_of_year(t)-1;let r=c(e,t)-i%7;return 0===r?(0,n.toInt)(i/7):(r>=0&&(r-=7),(0,n.toInt)((r+i)/7))}class p{indexOfPeriod(e){return s.get_day_of_year(e)-1}startOfPeriod(e,t,i){const r=s.days_per_year(i);return s.get_cal(s.get_timezone("Etc/UTC"),i,s.JANUARY,1+Math.min(t,r))}}class m extends p{constructor(e){super(),this._sessionsSpec=e}indexOfPeriod(e){return super.indexOfPeriod(e)-function(e,t){const i=_(e,t),r=s.get_cal(s.get_timezone("Etc/UTC"),s.get_year(t),s.JANUARY,1);s.add_date(r,7*i);const n=i*e.weekEndsCount()+e.holidaysFromYearStart(r),a=s.get_day_of_year(t)-s.get_day_of_year(r);return n+a-e.calendarDaysToBusinessDays(r,a)}(this._sessionsSpec,e)}startOfPeriod(e,t,i){const r=7-this._sessionsSpec.weekEndsCount(),a=Math.max(0,(0,n.toInt)(t/r)-1),o=s.get_cal(s.get_timezone("Etc/UTC"),i,s.JANUARY,1),l=s.get_days_per_year(o);if(s.add_date(o,7*a),(t-=r*a-this._sessionsSpec.holidaysFromYearStart(o))>0){const e=this._sessionsSpec.businessDaysToCalendarDays(o,t);s.add_date(o,e)}let h=s.get_day_of_year(o)-1
;return i<s.get_year(o)&&(h+=l),super.startOfPeriod(e,h,i)}}class y{constructor(e){this._builder=null,this._initialized=!1,this._session=e}indexOfPeriod(e){return this._getBuilder().indexOfPeriod(e)}startOfPeriod(e,t,i){return this._getBuilder().startOfPeriod(e,t,i)}_getBuilder(){return null!==this._builder&&this._initialized||(this._builder=this._session.spec.hasWeekEnds()?new m(this._session.spec):new p,this._initialized=!0),this._builder}}class f{constructor(e){this._session=e}indexOfPeriod(e){let t=_(this._session.spec,e);if(0===t){const i=s.get_timezone(this._session.spec.timezone());e<this.startOfPeriod(i,0,s.get_year(e))&&(t=-1)}return t}startOfPeriod(e,t,i){if(t<0){i--;const r=s.get_cal(s.get_timezone("Etc/UTC"),i,s.DECEMBER,31,23,59,59),a=this.indexOfPeriod(r),o=-1*t,l=(0,n.toInt)(a/o)*o;return this.startOfPeriod(e,l,i)}const r=s.get_cal(s.get_timezone("Etc/UTC"),i,s.JANUARY,1),a=c(this._session.spec,r),o=0===a?7*t:7*(t+1)-a;return o>s.get_days_per_year(r)?this.startOfPeriod(e,0,i+1):(s.add_date(r,o),r)}}class g{indexOfPeriod(e){return s.get_month(e)}startOfPeriod(e,t,i){if(t<0){const e=(0,n.toInt)((11-t)/12);i-=e,t+=12*e}else t>s.DECEMBER&&(i++,t=s.JANUARY);return s.get_cal(s.get_timezone("Etc/UTC"),i,t,1)}}function S(e,t,i,s=!1){const n=r.Interval.parse(e),a=n.multiplier();return n.isMinutes()?new l(60*a,t):n.isSeconds()?new l(a,t):n.isTicks()?new l(1,t):n.isRange()?new l(60*a,t):new u(t,i,a,function(e,t){switch(e){case r.ResolutionKind.Days:return new y(t);case r.ResolutionKind.Weeks:return new f(t);case r.ResolutionKind.Months:return new g}throw new Error("Unknown dwm resolution: "+e)}(n.kind(),t),s)}},53765:(e,t,i)=>{i.d(t,{extrapolateBarsFrontToTime:()=>r,extrapolateBarsFrontByCount:()=>n});var s=i(70062);function r(e,t,i,s,n=!1){if(t>i){const a=r(e,i,t,s,n);return a.count=-a.count,a}return a(e,t,1,(e,t)=>t>i||0!==s&&e>s,n)}function n(e,t,i,s=!1){const r=i<0?-1:1;return a(e,t,r,(e,t)=>e>=i*r,s)}function a(e,t,i,r,n){let a=0,o=t;e.moveTo(o);let l=0,h=Number.MAX_VALUE,d=!1,u=t;const c=[];for(;!r(a,o);){if(l>15)throw new Error("Internal error 0x10 while extrapolating.");const r=e.indexOfBar(o);if(r===s.SessionStage.PRE_SESSION&&1===i)o=e.startOfBar(0),e.moveTo(o);else if(r===s.SessionStage.PRE_SESSION&&-1===i)o=e.startOfBar(s.SessionStage.PRE_SESSION),e.moveTo(o);else if(r===s.SessionStage.POST_SESSION&&1===i)o=e.startOfBar(s.SessionStage.POST_SESSION),e.moveTo(o);else{if(r===s.SessionStage.POST_SESSION&&-1===i)throw new Error("Internal error 0x12 while extrapolating.");{const _=e.startOfBar(r);if(_>t&&i>0||t>_&&i<0){if(d&&h===_)throw new Error("Internal error 0x11 while extrapolating.");d=!0,h=_,l=0,a++,u=_,n&&c.push(u)}if(0===r&&-1===i)o=_-1;else{o=e.startOfBar(r+i);const t=e.startOfBar(s.SessionStage.POST_SESSION);o>t&&(e.moveTo(t),o=e.startOfBar(0))}}}l++}return{time:u,times:c,count:a}}},89627:(e,t,i)=>{var s=i(52280).PlotRowSearchMode,r=i(21386).rgbaFromInteger;function n(){this.backColorers=[]}function a(e){n.call(this),this._series=e}function o(e,t){n.call(this),this._study=e,this._plotIndex=t}
n.prototype.barStyle=function(e,t,i){for(var s={},r=this.backColorers.length-1;r>=0;r--)this.backColorers[r].applyBarStyle(e,t,s,i);return this.applyBarStyle(e,t,s,i),s},n.prototype.pushBackBarColorer=function(e){this.backColorers.push(e)},n.prototype.applyBarStyle=function(e,t,i){throw new Error("This function is supposed to be reimplemented in a subclass")},inherit(a,n),a.upColor=function(e,t){var i=e.style.value();switch(i){case TradingView.Series.STYLE_LINE:return e.lineStyle.color.value();case TradingView.Series.STYLE_AREA:return e.areaStyle.linecolor.value();case TradingView.Series.STYLE_BARS:return e.barStyle.upColor.value();case TradingView.Series.STYLE_CANDLES:return e.candleStyle.upColor.value();case TradingView.Series.STYLE_HOLLOW_CANDLES:return e.hollowCandleStyle.upColor.value();case TradingView.Series.STYLE_HEIKEN_ASHI:return e.haStyle.upColor.value();case TradingView.Series.STYLE_BASELINE:return e.baselineStyle.topLineColor.value();case TradingView.Series.STYLE_HILO:return e.hiloStyle.color.value()}switch(i){case TradingView.Series.STYLE_RENKO:return t?e.renkoStyle.upColorProjection.value():e.renkoStyle.upColor.value();case TradingView.Series.STYLE_PB:return t?e.pbStyle.upColorProjection.value():e.pbStyle.upColor.value();case TradingView.Series.STYLE_KAGI:return t?e.kagiStyle.upColorProjection.value():e.kagiStyle.upColor.value();case TradingView.Series.STYLE_PNF:return t?e.pnfStyle.upColorProjection.value():e.pnfStyle.upColor.value()}if(TradingView.Series.STYLE_RANGE===i)return t?e.rangeStyle.upColorProjection.value():e.rangeStyle.upColor.value();throw new Error("Unknown series style")},a.downColor=function(e,t){var i=e.style.value();switch(i){case TradingView.Series.STYLE_LINE:return e.lineStyle.color.value();case TradingView.Series.STYLE_AREA:return e.areaStyle.linecolor.value();case TradingView.Series.STYLE_BARS:return e.barStyle.downColor.value();case TradingView.Series.STYLE_CANDLES:return e.candleStyle.downColor.value();case TradingView.Series.STYLE_HOLLOW_CANDLES:return e.hollowCandleStyle.downColor.value();case TradingView.Series.STYLE_HEIKEN_ASHI:return e.haStyle.downColor.value();case TradingView.Series.STYLE_BASELINE:return e.baselineStyle.bottomLineColor.value();case TradingView.Series.STYLE_HILO:return e.hiloStyle.color.value()}switch(i){case TradingView.Series.STYLE_RENKO:return t?e.renkoStyle.downColorProjection.value():e.renkoStyle.downColor.value();case TradingView.Series.STYLE_PB:return t?e.pbStyle.downColorProjection.value():e.pbStyle.downColor.value();case TradingView.Series.STYLE_KAGI:return t?e.kagiStyle.downColorProjection.value():e.kagiStyle.downColor.value();case TradingView.Series.STYLE_PNF:return t?e.pnfStyle.downColorProjection.value():e.pnfStyle.downColor.value()}if(TradingView.Series.STYLE_RANGE===i)return t?e.rangeStyle.downColorProjection.value():e.rangeStyle.downColor.value();throw new Error("Unknown series style")},a.prototype._applyLineStyle=function(e,t,i,s,r){i.barColor=a.upColor(r)},a.prototype._applyAreaStyle=function(e,t,i,s,r){i.barColor=a.upColor(r)},
a.prototype._applyBarStyle=function(e,t,i,s,r){var n=a.upColor(r),o=a.downColor(r),l=this.findBar(e,!1,s);if(r.barStyle.barColorsOnPrevClose.value()){var h=this.findPrevBar(e,!1,s);i.barColor=h[TradingView.CLOSE_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o,i.barBorderColor=h[TradingView.CLOSE_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o}else i.barColor=l[TradingView.OPEN_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o,i.barBorderColor=l[TradingView.OPEN_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o},a.prototype._applyRangeStyle=function(e,t,i,s,r){var n=a.upColor(r,t),o=a.downColor(r,t),l=this.findBar(e,!1,s);i.barColor=l[TradingView.OPEN_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o,i.barBorderColor=i.barColor},a.prototype._applyCandleStyle=function(e,t,i,s,r){var n,o=a.upColor(r,t),l=a.downColor(r,t),h=r.candleStyle.borderUpColor?r.candleStyle.borderUpColor.value():r.candleStyle.borderColor.value(),d=r.candleStyle.borderDownColor?r.candleStyle.borderDownColor.value():r.candleStyle.borderColor.value(),u=r.candleStyle.wickUpColor?r.candleStyle.wickUpColor.value():r.candleStyle.wickColor.value(),c=r.candleStyle.wickDownColor?r.candleStyle.wickDownColor.value():r.candleStyle.wickColor.value(),_=this.findBar(e,!1,s);r.candleStyle.barColorsOnPrevClose.value()&&this._series.data().first().index!==e?n=this.findPrevBar(e,!1,s)[TradingView.CLOSE_PLOT]<=_[TradingView.CLOSE_PLOT]:n=_[TradingView.OPEN_PLOT]<=_[TradingView.CLOSE_PLOT];i.barColor=n?o:l,i.barBorderColor=n?h:d,i.barWickColor=n?u:c},a.prototype._applyHollowCandleStyle=function(e,t,i,s,r){var n,o=a.upColor(r,t),l=a.downColor(r,t),h=r.hollowCandleStyle.borderUpColor?r.hollowCandleStyle.borderUpColor.value():r.hollowCandleStyle.borderColor.value(),d=r.hollowCandleStyle.borderDownColor?r.hollowCandleStyle.borderDownColor.value():r.hollowCandleStyle.borderColor.value(),u=r.hollowCandleStyle.wickUpColor?r.hollowCandleStyle.wickUpColor.value():r.hollowCandleStyle.wickColor.value(),c=r.hollowCandleStyle.wickDownColor?r.hollowCandleStyle.wickDownColor.value():r.hollowCandleStyle.wickColor.value(),_=this.findBar(e,!1,s),p=this.findPrevBar(e,!1,s);n=this._series.data().first().index!==e?p[TradingView.CLOSE_PLOT]<=_[TradingView.CLOSE_PLOT]:_[TradingView.OPEN_PLOT]<=_[TradingView.CLOSE_PLOT],i.barColor=n?o:l,i.barBorderColor=n?h:d,i.barWickColor=n?u:c,i.isBarHollow=_[TradingView.OPEN_PLOT]<=_[TradingView.CLOSE_PLOT]},a.prototype._applyHAStyle=function(e,t,i,s,r){var n,o=a.upColor(r,t),l=a.downColor(r,t),h=r.haStyle.borderUpColor.value(),d=r.haStyle.borderDownColor.value(),u=r.haStyle.wickUpColor.value(),c=r.haStyle.wickDownColor.value(),_=this.findBar(e,t,s);r.haStyle.barColorsOnPrevClose.value()?n=this.findPrevBar(e,t,s)[TradingView.CLOSE_PLOT]<=_[TradingView.CLOSE_PLOT]:n=_[TradingView.OPEN_PLOT]<=_[TradingView.CLOSE_PLOT];i.barColor=n?o:l,i.barBorderColor=n?h:d,i.barWickColor=n?u:c},a.prototype._applyRenkoStyle=function(e,t,i,s,r){
var n=this.findBar(e,t,s),o=n[TradingView.OPEN_PLOT]<=n[TradingView.CLOSE_PLOT],l=a.upColor(r,t),h=a.downColor(r,t),d=t?r.renkoStyle.borderUpColorProjection.value():r.renkoStyle.borderUpColor.value(),u=t?r.renkoStyle.borderDownColorProjection.value():r.renkoStyle.borderDownColor.value(),c=r.renkoStyle.wickUpColor.value(),_=r.renkoStyle.wickDownColor.value();i.barColor=o?l:h,i.barBorderColor=o?d:u,i.barWickColor=o?c:_,i.isBarUp=o},a.prototype._applyPBStyle=function(e,t,i,s,r){i.barColor=a.upColor(r);var n=this.findBar(e,t,s),o=n[TradingView.OPEN_PLOT]<=n[TradingView.CLOSE_PLOT],l=a.upColor(r,t),h=a.downColor(r,t),d=t?r.pbStyle.borderUpColorProjection.value():r.pbStyle.borderUpColor.value(),u=t?r.pbStyle.borderDownColorProjection.value():r.pbStyle.borderDownColor.value();i.barColor=o?l:h,i.barBorderColor=o?d:u,i.isBarUp=o},a.prototype._applyKagiStyle=function(e,t,i,s,r){i.upColor=a.upColor(r,t),i.downColor=a.downColor(r,t);var n=null,o=this.findBar(e,t,s);o[TradingView.LOW_PLOT]<o[TradingView.ADT_PLOT]&&o[TradingView.ADT_PLOT]<o[TradingView.HIGH_PLOT]?(n=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT],i.isTwoColorBar=!0):(n=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT]?o[TradingView.OPEN_PLOT]===o[TradingView.ADT_PLOT]:o[TradingView.OPEN_PLOT]!==o[TradingView.ADT_PLOT],i.isTwoColorBar=!1),i.barColor=n?i.upColor:i.downColor,i.isBarUp=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT]},a.prototype._applyPnfStyle=function(e,t,i,s,r){var n=this.findBar(e,t,s)[TradingView.ADT_PLOT],o=n>0,l=a.upColor(r,t),h=a.downColor(r,t);i.isBarUp=o,i.isMergedBar=2===Math.abs(n),i.upColor=l,i.downColor=h,i.barColor=o?l:h},a.prototype._applyBaseLineStyle=function(e,t,i,s,r){var n=this.findBar(e,t,s),o=r.baselineStyle,l=this._series.priceScale(),h=Math.round(l.height()*(Math.abs(100-o.baseLevelPercentage.value())/100)),d=this._series.firstValue(),u=l.coordinateToPrice(h,d);n[TradingView.CLOSE_PLOT]>u?i.barColor=a.upColor(r,t):i.barColor=a.downColor(r,t)},a.prototype._applyHiLoStyle=function(e,t,i,s,r){i.barColor=a.upColor(r,t),i.barBorderColor=r.hiloStyle.borderColor.value()},a.prototype.applyBarStyle=function(e,t,i,s){i||(i={}),i.barColor=null,i.barBorderColor=null,i.barWickColor=null,i.isBarHollow=null,i.isBarUp=null,i.upColor=null,i.downColor=null,i.isTwoColorBar=null,i.isMergedBar=null;var r=this._series.properties(),n=r.style.value();switch(n){case TradingView.Series.STYLE_LINE:this._applyLineStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_AREA:this._applyAreaStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_BARS:this._applyBarStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_CANDLES:this._applyCandleStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_HOLLOW_CANDLES:this._applyHollowCandleStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_HEIKEN_ASHI:this._applyHAStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_BASELINE:this._applyBaseLineStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_HILO:this._applyHiLoStyle(e,t,i,s,r)}switch(n){case TradingView.Series.STYLE_RENKO:this._applyRenkoStyle(e,t,i,s,r)
;break;case TradingView.Series.STYLE_PB:this._applyPBStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_KAGI:this._applyKagiStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_PNF:this._applyPnfStyle(e,t,i,s,r)}return TradingView.Series.STYLE_RANGE===n&&this._applyRangeStyle(e,t,i,s,r),i},a.prototype.getSeriesBars=function(e){return e?this._series.nsBars():this._series.bars()},a.prototype._findBarFieldValue=function(e,t,i){var s=this.getSeriesBars(i).valueAt(e);if(null!==s)return s[t]},a.prototype.findBar=function(e,t,i){return i?i.value:this.getSeriesBars(t).valueAt(e)||[]},a.prototype.findPrevBar=function(e,t,i){if(i&&i.previousValue)return i.previousValue;var r=this._series.bars().search(e-1,s.NearestLeft,TradingView.CLOSE_PLOT);return null!==r?r.value:[]},inherit(o,n),o.prototype.getBars=function(){return this._study.series().bars()},o.prototype.firstColoredBar=function(e){for(var t=e,i=0;i<this.backColorers.length;i++)t=Math.min(t,this.backColorers[i].firstColoredBar(e));var s=this.getOffset(this._plotIndex);t=Math.min(t,e+s);var r=this.getBars().firstIndex();return Math.max(t,r)},o.prototype.getOffset=function(){var e=this._study.metaInfo().plots[this._plotIndex];return this._study.offset(e.id)},o.prototype.applyBarStyle=function(e,t,i){if(i||(i={}),t)return i;var s=this._study.properties();if(!s.visible.value())return i;var n=this._study.metaInfo(),a=this._study.data();if(!a||0===a.size())return i;var o=n.plots[this._plotIndex],l=this.getOffset();if(this._study.getMinFirstBarIndexForPlot(o.id)>e+l)return i;var h=s.styles[o.id];if(h.visible&&!h.visible.value())return i;var d=a.valueAt(e-l);if(null===d)return i;var u=d[this._plotIndex+1];if(null==u)return i;if(u=Math.round(u),n.isRGB)i.barColor=r(u),i.upColor=i.barColor,i.downColor=i.barColor;else{var c=n.plots[this._plotIndex].palette,_=s.palettes[c],p=n.palettes[c].valToIndex?n.palettes[c].valToIndex[u]:u,m=_.colors[p].color.value();i.barColor=m,i.upColor=m.color,i.downColor=m.color}return i},t.SeriesBarColorer=a,t.StudyBarColorer=o},12826:(e,t,i)=>{i.d(t,{BarsRange:()=>r});var s=i(88537);class r{constructor(e,t){(0,s.assert)(e<=t,"The last bar in the bars range should be greater than or equal to the first bar"),this._firstBar=e,this._lastBar=t}firstBar(){return this._firstBar}lastBar(){return this._lastBar}count(){return this._lastBar-this._firstBar+1}contains(e){return this._firstBar<=e&&e<=this._lastBar}equals(e){return this._firstBar===e.firstBar()&&this._lastBar===e.lastBar()}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}},38627:(e,t,i)=>{i.d(t,{currencyUnitVisibilityProperty:()=>a,currencyUnitVisibilityOptions:()=>o,migrateShowCurrencyAndShowUnitProperties:()=>h});var s=i(11239),r=i(62802),n=i.n(r);const{property:a,availableValues:o}=(0,s.createVisibilityController)("PriceAxisCurrencyAndUnit.visibility");let l=!1;function h(e,t){l||(l=!0,void 0===n().getValue("PriceAxisCurrencyAndUnit.visibility")&&a().setValue(e||t?"alwaysOn":"alwaysOff"))}},36643:(e,t,i)=>{i.d(t,{getDataVendorString:()=>r});var s=i(11688);function r(e){
return null==e||s.enabled("bovespa_widget")?null:"QUANDL"===e.exchange?"Quandl.com":["BMFBOVESPA","BME","NAG","TSE","TFX","NZX","BCBA","TWSE","TASE","EURONEXT","TOCOM","BMV","SIX","SGX","GPW","SWB","BCS","WB","SZSE","BELEX","BAHRAIN","EGX","TADAWUL","BVL","LUXSE","DFM","BVC","NSENG","IDX","HSI","QSE","OSE"].includes(e.exchange)?"ICE Data Services":null}},34906:(e,t,i)=>{i.d(t,{DataWindowItem:()=>s,DataWindowView:()=>r});class s{constructor(e,t,i=!1){this._visible=!0,this._title=e,this._value=t,this._unimportant=i}title(){return this._title}setTitle(e){this._title=e}text(){return this._value}value(){return this._value}setValue(e){this._value=e}visible(){return this._visible}setVisible(e){this._visible=e}color(){return this._color}setColor(e){this._color=e}unimportant(){return this._unimportant}}class r{constructor(){this._items=[],this._header="",this._title=""}header(){return this._header}title(){return this._title}items(){return this._items}update(){}}},50979:(e,t,i)=>{i.d(t,{FutureBarsPaneView:()=>l});var s=i(88537),r=i(80047),n=i(3653);const a={0:{background:"rgba(255, 158, 171, 0.3)",line:"#7E202F"},1:{background:"rgba(244, 255, 158, 0.3)",line:"#EBFF3F"},2:{background:"rgba(195, 255, 160, 0.3)",line:"#308020"}};class o extends r.ScaledPaneRenderer{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(){return null}_drawImpl(e,t){if(null===this._data)return;const i=a[this._data.predictionCode];e.fillStyle=i.background,e.fillRect(Math.max(0,this._data.startX),0,t.cssWidth,t.cssHeight),e.strokeStyle=i.line,e.beginPath(),e.lineWidth=1;const s=Math.round(this._data.startX);e.moveTo(s,0),e.lineTo(s,t.cssHeight),e.stroke()}}class l{constructor(e,t,i,s){this._renderer=new o,this._startX=0,this._series=t,this._timeScale=e,this._lastKnownBarIndex=i,this._direction=s}update(){this._startX=this._timeScale.indexToCoordinate(this._lastKnownBarIndex)+.5*this._timeScale.barSpacing()+1}renderer(){const e=(0,n.barFunction)("close"),t=this._series.data().bars(),i=e((0,s.ensureNotNull)(t.valueAt(this._lastKnownBarIndex))),r=e((0,s.ensureNotNull)(t.last()).value);let a=0;r>i?a=1:r<i&&(a=2);let o=1;return 0!==this._direction&&(o=this._direction===a?2:0),this._renderer.setData({startX:this._startX,predictionCode:o}),this._renderer}}},76809:(e,t,i)=>{i.d(t,{shouldBeFormattedAsPercent:()=>a,getPriceValueFormatterForSource:()=>o});var s=i(49473),r=i(92179);const n=(0,i(25226).isFeatureEnabled)("percentage_values_for_percentage_scale");function a(e){if(!n)return!1;const t=e.priceScale();return!(null===t||!t.isPercentage())&&(!(0,r.isSymbolSource)(e)||(0,s.isPriceSourceStyle)(e.style()))}function o(e){const t=e.priceScale();if(a(e)&&null!==t)return i=>{var s;return t.formatPricePercentage(i,null!==(s=e.firstValue())&&void 0!==s?s:100)};const i=e.formatter();return i.format.bind(i)}},50985:(e,t,i)=>{i.d(t,{HorizontalLinePaneView:()=>n});var s=i(37689),r=i(45185);class n{constructor(){this._lineRendererData={y:0,color:"rgba(0, 0, 0, 0)",linewidth:1,linestyle:r.LINESTYLE_SOLID,visible:!1},
this._lineRenderer=new s.HorizontalLineRenderer,this._invalidated=!0,this._lineRenderer.setData(this._lineRendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._lineRenderer}}},92179:(e,t,i)=>{function s(e){return e.symbolSource&&e.symbolSource()===e}i.d(t,{isSymbolSource:()=>s})},39804:(e,t,i)=>{var s,r=i(88537).ensureNotNull,n=i(86441).Point,a=i(59447).SelectionRenderer,o=i(18718).HitTestResult,l=i(90210).PaneRendererRenkoPB,h=i(17617).PaneRendererKagi,d=i(49582).PaneRendererPnF,u=i(7152).PaneRendererBars,c=i(17611).CompositeRenderer,_=i(46037).SelectionIndexes,p=i(11905).getLogger("Chart.JapaneseSeriesPaneView"),m=i(11688);function y(e,t){this.m_series=e,this.m_model=t,this.m_bars=[],this._invalidated=!0,this._isMarkersEnabled=m.enabled("source_selection_markers"),this._selectionIndexer=new _(t.timeScale())}function f(e,t){y.call(this,e,t)}function g(e,t){y.call(this,e,t)}function S(e,t){f.call(this,e,t)}function b(e,t){g.call(this,e,t)}function v(e,t){f.call(this,e,t)}function w(e,t){g.call(this,e,t)}function P(e,t){f.call(this,e,t)}function x(e,t){g.call(this,e,t)}function I(e,t){f.call(this,e,t)}function C(e,t){g.call(this,e,t)}y.prototype.bars=function(){throw new Error("unimplemented")},y.prototype.isProjection=function(){throw new Error("unimplemented")},y.prototype.update=function(){this._invalidated=!0},y.prototype.nearestIndex=function(e,t){if(TradingView.isInteger(e)){var i=this.bars().search(e,t);return null!==i?i.index:void 0}p.logDebug("incorrect logicalPoint")},y.prototype._updateImpl=function(){var e=this;if((this.m_bars.length=0,this.m_series.properties().style.value()!==TradingView.Series.STYLE_PNF||this.m_series.data().boxSize)&&(!this.m_model.timeScale().isEmpty()&&!this.m_series.priceScale().isEmpty()&&null!==(a=this.m_series.getRealVisibleRange())&&0!==this.bars().size()&&!e.m_series.data().bars().isEmpty())){for(var t=a.firstBar(),i=a.lastBar(),s=this.m_series.data().search(t).value[TradingView.CLOSE_PLOT];t<=i;t++){if(null!==this.bars().valueAt(t))break}if(!(t>i)){var a=this.bars().range(t,i),l=this.m_series.priceScale(),h=this.m_series.barColorer(),d={},u=e.m_series.properties().style.value(),c=u===TradingView.Series.STYLE_KAGI||u===TradingView.Series.STYLE_PNF,_=e.isProjection(),p=r(e.m_series.data().bars().lastIndex());if(a.each((function(t,i){if(void 0!==i[TradingView.OPEN_PLOT]&&void 0!==i[TradingView.HIGH_PLOT]&&void 0!==i[TradingView.LOW_PLOT]&&void 0!==i[TradingView.CLOSE_PLOT]){var s={},r={O:i[TradingView.OPEN_PLOT],H:i[TradingView.HIGH_PLOT],L:i[TradingView.LOW_PLOT],C:i[TradingView.CLOSE_PLOT],Adt:c?i[TradingView.ADT_PLOT]:void 0};s.time=Math.round(t),s.open=r.O,s.high=r.H,s.low=r.L,s.close=r.C,d.value=i;var n=h.barStyle(t,_,d);switch(d.previousValue=i,s.color=n.barColor,s.borderColor=n.barBorderColor,s.isUp=n.isBarUp,s.wickColor=n.barWickColor,u){case TradingView.Series.STYLE_PNF:s.low-=.5*e.m_series.data().boxSize,s.high+=.5*e.m_series.data().boxSize,s.upColor=n.upColor,s.downColor=n.downColor,
s.isMergedBar=n.isMergedBar,s.additionalNum=Math.round(1+(i[TradingView.HIGH_PLOT]-i[TradingView.LOW_PLOT])/e.m_series.data().boxSize);break;case TradingView.Series.STYLE_KAGI:if(s.upColor=n.upColor,s.downColor=n.downColor,s.isTwoColorBar=n.isTwoColorBar,!isNumber(r.Adt))break;s.additionalPrice=r.Adt,_&&s.time===p&&(s.combinedWithProjection=!0)}e.m_bars.push(s)}}),this),u===TradingView.Series.STYLE_PNF&&(this.blockSize=(l.priceToCoordinate(0,s)-l.priceToCoordinate(500,s))/500*this.m_series.data().boxSize),l.barPricesToCoordinates(this.m_bars,s),this.m_model.timeScale().barIndexesToCoordinates(this.m_bars),this.m_model.selection().isSelected(this.m_series)){var m=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0};var y=this.m_model.paneForSource(this.m_series).height();this._selectionData.hittestResult=o.REGULAR;for(var f=0;f<m.length;f++){var g=m[f],S=this.m_series.bars().valueAt(g);if(null!==S){var b=.5*(S[TradingView.OPEN_PLOT]+S[TradingView.CLOSE_PLOT]),v=this.m_model.timeScale().indexToCoordinate(g),w=this.m_series.priceScale().priceToCoordinate(b,s);this._selectionData.points.push(new n(v,w)),this._selectionData.bgColors.push(this.m_model.backgroundColorAtYPercentFromTop(w/y))}}}else this._selectionIndexer.clear()}}},y.prototype.items=function(){return this.m_bars},inherit(f,y),f.prototype.bars=function(){return this.m_series.bars()},f.prototype.isProjection=function(){return!1},inherit(g,y),g.prototype.bars=function(){return this.m_series.nsBars()},g.prototype.isProjection=function(){return!0},inherit(S,f),S.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing();var t=new c;return t.append(new l(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new a(this._selectionData)),t},inherit(b,g),b.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};return e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing(),new l(e)},s=function(e,t){g.call(this,e,t)},inherit(s,g),s.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};return e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing(),e.thinBars=this.m_series.properties().rangeStyle.thinBars.value(),new u(e)},inherit(v,f),v.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.barSpacing=.9*this.m_model.timeScale().barSpacing();var t=new c;return t.append(new l(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new a(this._selectionData)),t},inherit(w,g),w.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};return e.bars=this.m_bars,e.barSpacing=.9*this.m_model.timeScale().barSpacing(),new l(e)},inherit(P,f),P.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={}
;e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing();var t=new c;return t.append(new h(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new a(this._selectionData)),t},inherit(x,g),x.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};return e.bars=this.m_bars,e.upColor=this.upColor,e.downColor=this.downColor,e.barSpacing=this.m_model.timeScale().barSpacing(),new h(e)},inherit(I,f),I.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.blockSize=this.blockSize,e.barSpacing=this.m_model.timeScale().barSpacing();var t=new c;return t.append(new d(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new a(this._selectionData)),t},inherit(C,g),C.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};return e.bars=this.m_bars,e.blockSize=this.blockSize,e.barSpacing=this.m_model.timeScale().barSpacing(),new d(e)},t.SeriesRenkoPaneView=S,t.SeriesProjectionRenkoPaneView=b,t.SeriesPriceBreakPaneView=v,t.SeriesProjectionPriceBreakPaneView=w,t.SeriesKagiPaneView=P,t.SeriesProjectionKagiPaneView=x,t.SeriesPnFPaneView=I,t.SeriesProjectionPnFPaneView=C,t.SeriesProjectionRangePaneView=s},40968:(e,t,i)=>{i.r(t),i.d(t,{cloneLineTool:()=>De,createLineTool:()=>xe,createLineToolProperties:()=>Ce,createStudyLineToolProperties:()=>Te,getNewToolProperties:()=>Pe,isLineDrawnWithPressedButton:()=>fe.isLineDrawnWithPressedButton,isLineTool:()=>Ae,isLineToolName:()=>fe.isLineToolName,isStudyLineTool:()=>Me,isStudyLineToolName:()=>fe.isStudyLineToolName,isTrading:()=>Le,lineToolByLinkKey:()=>Ee,prepareLineToolPropertiesByOwnerSource:()=>Ie,setNewToolProperties:()=>ve,supportsPhantomMode:()=>Ve,tryFindStudyLineToolNameByStudyId:()=>Re,unsetNewToolProperties:()=>we});var s={};i.r(s),i.d(s,{LineStudyMtpAnalysis:()=>J,LineStudyMtpDecisionPoint:()=>Z,LineStudyMtpDownWave1OrA:()=>ne,LineStudyMtpDownWave2OrB:()=>ae,LineStudyMtpDownWave3:()=>oe,LineStudyMtpDownWave4:()=>le,LineStudyMtpDownWave5:()=>he,LineStudyMtpDownWaveC:()=>de,LineStudyMtpElliotWaveMain:()=>te,LineStudyMtpElliotWaveMajor:()=>ie,LineStudyMtpElliotWaveMinor:()=>se,LineStudyMtpRiskReward:()=>Q,LineStudyMtpUpWave1OrA:()=>ue,LineStudyMtpUpWave2OrB:()=>ce,LineStudyMtpUpWave3:()=>_e,LineStudyMtpUpWave4:()=>pe,LineStudyMtpUpWave5:()=>me,LineStudyMtpUpWaveC:()=>ye});var r=i(88537),n=i(86441),a=i(78823),o=i(24145),l=i(3573),h=i.t(l,2),d=i(76745),u=i(44276),c=i(70028),_=i.n(c),p=i(48874),m=i(24146),y=i(70617),f=i(46090);const g=(0,u.studyIdString)("RegressionTrend","tv-basicstudies");function S(e){return void 0!==e.startPrice&&void 0!==e.endPrice}class b extends a.StudyLineDataSource{constructor(e,t,s,n,a){s=null!=s?s:(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:g}));super(e,s,"linreg_",null!=t?t:b.createProperties(e),n,a),this.version=2,this._trendData=null,
Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,91338)).then(e=>{this._setPaneViews([new e.RegressionTrendPaneView(this,this._model)])})}formatter(){throw new Error("This method should never be called")}pointsCount(){return 2}clearData(){this._trendData=null,super.clearData()}state(e){var t;const i=super.state(e);return e?{...i,nonseriesdata:null!==(t=this._trendData)&&void 0!==t?t:void 0}:i}restoreData(e){var t;super.restoreData(e),this._trendData=null!==(t=e.nonseriesdata)&&void 0!==t?t:null}startIndex(){if(null===this._trendData||null===this._indexes)return null;const e=this._indexes[this._trendData.startIndex];return e!==d.INVALID_TIME_POINT_INDEX?e:null}endIndex(){if(null===this._trendData||null===this._indexes)return null;const e=this._indexes[this._trendData.endIndex];return e!==d.INVALID_TIME_POINT_INDEX?e:null}baseLine(){return null===this._trendData?null:this._trendData.baseLine}downLine(){return null===this._trendData?null:this._trendData.downLine}upLine(){return null===this._trendData?null:this._trendData.upLine}pearsons(){return null===this._trendData?null:this._trendData.pearsons}recalcStudyIfNeeded(){this._onStudyInputsMayChange()}cloneable(){return!1}static createProperties(e,t){const i=_().getStudyPropertyRootNameById(g),s=(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:g})),n=(0,f.createDefaultsState)(!0,i,[],e.studyVersioning());return Te("LineToolRegressionTrend",s,s,(0,y.merge)((0,y.clone)(n),null!=t?t:{}),e.studyVersioning())}static createRegressionTrendPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,null,s);return b._configureProperties(r),r}static studyId(){return g}_studyInputs(e){(0,r.assert)(2===e.length,"all the line tool points should be defined");const[t,i]=e;if(t.index===i.index)return null;const s=this._getPointTime(t.index<=i.index?t:i,!0),n=this._getPointTime(i.index>=t.index?i:t,!0);return null===s||null===n?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),"first bar time":1e3*s,"last bar time":1e3*n}}_onDataUpdated(e,t,i){null!==t&&(t.indexes_replace||(this._trendData=t.data),"nochange"!==i&&(this._indexes=i),super._onDataUpdated(e,t,i))}_isReady(){return null!==this._trendData&&void 0!==this._trendData.startIndex&&void 0!==this._trendData.endIndex&&S(this._trendData.upLine)&&S(this._trendData.baseLine)&&S(this._trendData.downLine)}_updateAnchorsPrice(){if(!this._trendData||(0,y.isNaN)(this._trendData.baseLine.startPrice)||(0,y.isNaN)(this._trendData.baseLine.endPrice))return;const{startPrice:e,endPrice:t}=this._trendData.baseLine;2===this._points.length&&(this._points[0].price=(0,r.ensureDefined)(e),this._points[1].price=(0,r.ensureDefined)(t),this._timePoint[0].price=(0,r.ensureDefined)(e),this._timePoint[1].price=(0,r.ensureDefined)(t))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(60607)]).then(i.bind(i,40647))).RegressionTrendDefinitionsViewModel}static _configureProperties(e){
a.StudyLineDataSource._configureProperties(e);const t=e.childs().styles.childs(),i=[t.upLine.childs().linewidth,t.downLine.childs().linewidth,t.baseLine.childs().linewidth];e.addChild("linesWidths",new m.LineToolWidthsProperty(i))}}var v=i(67791);const w=(0,u.studyIdString)("VbPFixed","tv-basicstudies");class P extends v.LineToolVbPFixed{constructor(e,t,i,s,r,n){const a=i||e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:w});super(e,t,a,s,r,n)}calcIsActualSymbol(){a.StudyLineDataSource.prototype.calcIsActualSymbol.apply(this)}boundToSymbol(){return!0}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}static studyId(){return w}static createProperties(e,t){const i=_().getStudyPropertyRootNameById(w),s=(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:w})),n=(0,f.createDefaultsState)(!0,i,[],e.studyVersioning());return Te("LineToolFixedRangeVolumeProfile",s,s,(0,y.merge)((0,y.clone)(n),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,null,s);return P._configureProperties(r),r}}var x=i(11688),I=i(44265),C=i(62145),T=i(49692),V=i(32567),A=i.n(V),M=i(59270),L=i(52280),R=i(98424);class D extends R.PriceAxisView{constructor(e){super(),this._model=e.model(),this._source=e}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const s=this._source.model(),r=this._source.priceScale();if(null===r)return;if(!s.isPriceScaleVisible(r))return;const n=this._source.lastValueData("",!1);n.noData||(i.background=n.color,i.textColor=this.generateTextColor(n.color),i.coordinate=n.coordinate,i.floatCoordinate=n.floatCoordinate,this._showAxisLabel()&&(e.text=n.text,e.visible=!0))}_showAxisLabel(){return this._source.properties().childs().axisLabelVisible.value()}}var E=i(27641),B=i(54471),k=i(7127);class O extends B.StudyPlotPaneView{constructor(e,t,i,s){super(e,t,i,s),this._line=e}_updateImpl(){if(super._updateImpl(),window.TradingView.printing||!this._line.hasAlert.value()||this._model.readOnly()||this._model.isInReplay())return;const e=this._items;if(!this._renderer.isEmpty()&&e.length>0){const t=e[e.length-1],i=this._model.timeScale().width();if(t.x<0||e[0].x>i)return;const s=Math.min(i-5,t.x);let r=t.y;if(t.x>s){let i=e.length-2;for(;i>=0;){const n=e[i];if(n.x<=s){const e=(s-n.x)/(t.x-n.x);r=n.y+(t.y-n.y)*e;break}i-=1}}const a=new n.Point(s,r);this._renderer.append(new k.PaneRendererClockIcon({points:[a],color:this._line.getAlertIsActive()?this._lineColor:E.Constants.DrawingIconColor,horzMargin:-16}))}}}var N=i(11905),F=i(96396),W=i(51975),H=i(94755);const U=(0,N.getLogger)("Chart.AnchoredVWAP"),z=(0,u.studyIdString)("AnchoredVWAP","tv-basicstudies");function G(e,t,i,s){return"calculate_stDev"in(0,r.ensureDefined)(e.inputs)||void 0===s.inputs.find(e=>"calculate_stDev"===e.id)||((0,r.ensureDefined)(t.inputs).calculate_stDev=!1),t}class j extends a.StudyLineDataSource{constructor(e,t,i,s,n){i=i||(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({
type:"java",studyId:z}));const a=null!=t?t:j.createProperties(e);super(e,i,"anchoredvwap",a,s,n);const[o,l,h]=this.metaInfo().plots,d=e.mainSeries(),u=[new O(this,d,e,o.id)];l&&h&&(u.push(new B.StudyPlotPaneView(this,d,e,l.id)),u.push(new B.StudyPlotPaneView(this,d,e,h.id))),this._properties.childs().areaBackground&&u.splice(0,0,new W.AreaBackgroundPaneView(this,e)),this._lastValuePriceAxisView=new D(this),this._anchorPriceCalculated=!1,this._onInputsReadyCallbacks=[],this._setPaneViews(u),e.properties().childs().scalesProperties.childs().showStudyLastValue.subscribe(this,this._onShowStudyLastValueChanged),a.onRestoreFactoryDefaults().subscribe(this,this._onRestoreFactoryDefaults)}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribeAll(this),this.model().properties().childs().scalesProperties.childs().showStudyLastValue.unsubscribeAll(this),this._onInputsReadyCallbacks=[],super.destroy()}canHasAlert(){return!0}pointsCount(){return 1}priceAxisViews(e,t){if(t!==this.priceScale()||this.isSourceHidden())return null;const i=super.priceAxisViews(e,t);return null===i?[this._lastValuePriceAxisView]:[...i,this._lastValuePriceAxisView]}updateAllViews(){super.updateAllViews(),this._lastValuePriceAxisView.update()}offset(e){return 0}firstValue(){return this._model.mainSeries().firstValue()}getMinFirstBarIndexForPlot(){return-1/0}priceRange(e,t){if(!this._isReady()||this.isSourceHidden())return null;const i=this.plots().minMaxOnRangeCached(e,t,[{name:this.metaInfo().plots[0].id,offset:0}]);if(null===i)return null;const s=(0,r.ensureNotNull)(this.priceScale());return s.isLog()?new M.PriceRange(s.priceToLogical(i.min),s.priceToLogical(i.max)):new M.PriceRange(i.min,i.max)}isIncludedInAutoScale(){return!0}lastValueData(e,t,i){const s={noData:!0},n=this.priceScale();if(this._model.timeScale().isEmpty()||null===this.priceScale()||null===n||n.isEmpty()||this.plots().isEmpty())return s;const a=this._model.timeScale().visibleBarsStrictRange();if(null===a)return s;if(!this.properties().childs().visible.value())return s;const o=this.plots().search(a.lastBar(),L.PlotRowSearchMode.NearestLeft,1);if(null===o)return s;const l=a.contains(o.index),h=!t&&l?o:(0,r.ensureNotNull)(this.plots().last());if(!h||!(0,y.isNumber)(h.value[1]))return s;const d=h.value[1],u=this.properties().childs().styles.childs().VWAP,c=(0,r.ensureNotNull)(this.firstValue()),_=n.priceToCoordinate(d,c);return{...n.getFormattedValues(d,c),noData:!1,price:d,color:u.childs().color.value(),coordinate:_,floatCoordinate:_,index:h.index}}restoreData(e){super.restoreData(e),void 0!==e.data&&(this._anchorPriceCalculated=!0)}properties(){return super.properties()}sourceId(){return(0,r.ensureNotNull)(this._studyId())}hasStateForAlert(){return x.enabled("alerts")&&null!==this._inputs}alertCreationAvailable(){return!this.hasAlert.value()&&this.hasStateForAlert()}stateForAlert(){const e=this.metaInfo(),t=(0,T.plotsForAlert)(e,this.offset.bind(this),["VWAP"]),i=(0,
T.collectDepsForAlert)([this],this.id()),s=i.idForAlert,r=i.studyDependencies,n=i.inputsForAlert,a=(this.priceScale()||this.model().mainSeries().priceScale()).formatter(),o=a?C.FormattersSerializer.serialize(a):null;return{id:s,uniqueId:s,type:F.StateForAlertType.StudyLineTool,title:(0,H.clean)(this.title(),!0),shortTitle:(0,H.clean)(this.title(),!0),shortDescription:(0,H.clean)(e.shortDescription||"Study",!0),interval:this._model.mainSeries().interval(),fullId:e.fullId,isTVScript:Boolean(e.isTVScript),isTVScriptStrategy:Boolean(e.isTVScriptStrategy),isTVLibrary:Boolean(e.isTVLibrary),hasAlertFunction:Boolean(e.hasAlertFunction),plots:t,inputs:n,alerts:e.alerts,scriptIdPart:e.scriptIdPart,scriptVersion:e.pine?e.pine.version:"-1",callStudyDependencies:(0,I.formatCallstudyArg)((0,T.dependenciesForAlerts)([],this._model.studyMetaInfoRepository())),studyDependencies:r,formatter:o}}inputsForAlertState(){null===this._inputs&&U.logError("Could not get inputsForAlertState if VWAP has no inputs");const{start_time:e,source:t}=this.inputs();return{start_time:e,source:t}}inputs(){return(0,r.ensureNotNull)(this._inputs)}idForAlert(){return(0,T.collectDepsForAlert)([this],this.id()).idForAlert}defaultPlotIdForAlert(){return this.metaInfo().plots[0].id}static createProperties(e,t){const i=_().getStudyPropertyRootNameById(z),s=(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:z})),n=(0,f.createDefaultsState)(!0,i,[],e.studyVersioning());return Te("LineToolAnchoredVWAP",s,s,(0,y.merge)((0,y.clone)(n),null!=t?t:{}),e.studyVersioning())}static studyId(){return z}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,null,s,G);return j._configureProperties(r),r}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._onStudyInputsMayChange()}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=e[0],i=this._getPointTime(t,!1);return null===i?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(["start_time"]),start_time:1e3*i}}_isReady(){return super._isReady()&&(null!==this._inputs||this._anchorPriceCalculated)&&this.model().lineBeingEdited()!==this}_onDataCleared(){super._onDataCleared(),this._anchorPriceCalculated=!1}_onInputsChanged(){if(super._onInputsChanged(),null!==this._inputs){for(const e of this._onInputsReadyCallbacks)try{e(this._inputs)}catch(e){U.logError(e.stack||e.message)}this._onInputsReadyCallbacks=[]}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(18537)]).then(i.bind(i,73109))).AnchoredVWAPDefinitionsViewModel}_updateAnchorsPrice(e){if(!e&&(this._anchorPriceCalculated||!this.isActualSymbol()))return;const t=this.firstValue(),i=this.points();if(null===t||0===i.length)return;const s=i[0].index,r=this.plots().valueAt(s);if(null===r)return;const n=r[1];null!=n&&(this._points[0].price=n,this._timePoint[0].price=n,this._anchorPriceCalculated=!0)}_synchronizeAlert(e){
this._onInputsReady(()=>super._synchronizeAlert(e))}static _configureProperties(e){a.StudyLineDataSource._configureProperties(e),e.hasChild("axisLabelVisible")||e.addChild("axisLabelVisible",new(A())(!0));const t=e.childs().styles.childs().VWAP.childs().linewidth,i=e.childs().styles.childs().VWAP.childs().color;e.addChild("linesWidths",new m.LineToolWidthsProperty([t])),e.addChild("linesColors",new m.LineToolColorsProperty([i]))}_onInputsReady(e){null!==this._inputs?e(this._inputs):this._onInputsReadyCallbacks.push(e)}_onShowStudyLastValueChanged(){this._lastValuePriceAxisView.update(),this.model().updateSource(this)}_onRestoreFactoryDefaults(){this.properties().childs().axisLabelVisible.setValue(!0)}}var Y=i(4703),q=i(74316),X=i(91419);function K(e){return(0,u.studyIdString)(e,"mtp-mtpredictor")}class $ extends a.StudyLineDataSource{constructor(e,t,i,s){const r=K(s),n=i||e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:r}),a=t||$._createPropertiesFromStudyMetaInfo(n,e.studyVersioning());super(e,n,s,a),this._formatter=new X.VolumeFormatter,(0,q.createGraphicsPaneViews)(this,e).then(this._setPaneViews.bind(this))}formatter(){return this._formatter}series(){return this._ownerSource instanceof Y.Series?this._ownerSource:this._model.mainSeries()}static _createPropertiesFromMtpStudyShortIdAndState(e,t){return super._createPropertiesFromStudyIdAndState(K(e),t)}static _createPropertiesFromStudyMetaInfo(e,t){const i=(0,p.prepareStudyProperties)(e,null,null,t);return a.StudyLineDataSource._configureProperties(i),i}}class J extends ${constructor(e,t,i){super(e,t,i,"mtp_tsanalysis")}pointsCount(){return 1}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_tsanalysis",e)}static studyId(){return K("mtp_tsanalysis")}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0);return null===t?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*t}}}class Z extends ${constructor(e,t,i){super(e,t,i,"mtp_decisionpoint"),this._symbolIntervalChanged=!1,this._model.mainSeries().onSymbolIntervalChanged().subscribe(this,this._onSymbolIntervalChanged)}destroy(){this._model.mainSeries().onSymbolIntervalChanged().unsubscribeAll(this),super.destroy()}pointsCount(){return 1}onData(e){super.onData(e),this._symbolIntervalChanged=!1}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_decisionpoint",e)}static studyId(){return K("mtp_decisionpoint")}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0);return null===t?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),symbolIntervalChanged:this._symbolIntervalChanged,bar:1e3*t}}_onSymbolIntervalChanged(){this._symbolIntervalChanged=!0}}class Q extends ${constructor(e,t,i){super(e,t,i,"mtp_riskreward")}pointsCount(){return 3}static createProperties(e){
return super._createPropertiesFromMtpStudyShortIdAndState("mtp_riskreward",e)}static getTooltipText(e){return e&&0!==e._points.length?1===e._points.length?"Select Stop Bar":2===e._points.length?"Select Target Point":null:"Select Entry Setup Bar"}static studyId(){return K("mtp_riskreward")}_studyInputs(e){(0,r.assert)(3===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0),i=this._getPointTime(e[1],!0),s=this._getPointTime(e[2],!0);return null===t||null===i||null===s?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),entry_bar:1e3*t,stop_bar:1e3*i,target_bar:1e3*s,target_price:e[2].price}}}class ee extends ${pointsCount(){return 1}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0);return null===t?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*t}}}class te extends ee{constructor(e,t,i){super(e,t,i,"mtp_ew_main")}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_ew_main",e)}static studyId(){return K("mtp_ew_main")}}class ie extends ee{constructor(e,t,i){super(e,t,i,"mtp_ew_major")}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_ew_major",e)}static studyId(){return K("mtp_ew_major")}}class se extends ee{constructor(e,t,i){super(e,t,i,"mtp_ew_minor")}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_ew_minor",e)}static studyId(){return K("mtp_ew_minor")}}class re extends ${_studyInputs(e){(0,r.assert)(e.length===this.pointsCount(),"all the line tool points should be defined");const t={...this.properties().childs().inputs.state()};for(let i=0;i<this.pointsCount();++i){const s=this._getPointTime(e[i],!0);if(null===s)return this._subscribeApplyInputsOnSeriesCompleted(),null;t["bar"+i]=1e3*s}return t}}class ne extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_down1ora")}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_down1ora",e)}static getTooltipText(e){return"Down Wave 1 or A: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_down1ora")}}class ae extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_down2orb")}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_down2orb",e)}static getTooltipText(e){return"Down Wave 2 or B: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_down2orb")}}class oe extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_down3")}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_down3",e)}static getTooltipText(e){return"Down Wave 3: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_down3")}}class le extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_down4")}pointsCount(){return 2}
static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_down4",e)}static getTooltipText(e){return"Down Wave 4: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_down4")}}class he extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_down5")}pointsCount(){return 5}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_down5",e)}static getTooltipText(e){return"Down Wave 5: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_down5")}}class de extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_downc")}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_downc",e)}static getTooltipText(e){return"Down Wave C: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_downc")}}class ue extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_up1ora")}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_up1ora",e)}static getTooltipText(e){return"Up Wave 1 or A: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_up1ora")}}class ce extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_up2orb")}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_up2orb",e)}static getTooltipText(e){return"Up Wave 2 or B: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_up2orb")}}class _e extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_up3")}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_up3",e)}static getTooltipText(e){return"Up Wave 3: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_up3")}}class pe extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_up4")}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_up4",e)}static getTooltipText(e){return"Up Wave 4: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_up4")}}class me extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_up5")}pointsCount(){return 5}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_up5",e)}static getTooltipText(e){return"Up Wave 5: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_up5")}}class ye extends re{constructor(e,t,i){super(e,t,i,"mtp_wpt_upc")}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState("mtp_wpt_upc",e)}static getTooltipText(e){return"Up Wave C: Select Point "+((e?e._points.length:0)+1)}static studyId(){return K("mtp_wpt_upc")}}var fe=i(29084),ge=i(57759);function Se(e){for(const t of Object.keys(e))TradingView[t]=e[t]}Se(h),Se({LineToolRegressionTrend:b,LineToolVbPFixed:v.LineToolVbPFixed,LineToolFixedRangeVolumeProfile:P}),Se({LineToolAnchoredVWAP:j}),Se(s);let be=null
;function ve(e,t,i){return null!==be&&be.tool===e&&be.toolData===t||(be={properties:Ce(e,void 0,i),tool:e,toolData:t}),be.properties}function we(){be=null}function Pe(e){return null!==be&&be.tool===e?be.properties:null}function xe(e,t,i,n,a,o){let l;if((0,r.assert)((0,fe.isLineToolName)(e),"Unknown line tool: "+e),a||i||(i=Pe(e)||void 0),"LineToolVbPFixed"===e)l=new v.LineToolVbPFixed(t,i,(0,r.ensureDefined)(n),t.mainSeries());else if("LineToolFixedRangeVolumeProfile"===e)l=new P(t,i,(0,r.ensureDefined)(n),t.mainSeries());else if("LineToolRegressionTrend"===e)l=new b(t,i,(0,r.ensureDefined)(n));else if("LineToolAnchoredVWAP"===e)l=new j(t,i,(0,r.ensureDefined)(n));else if(e in s){l=new((0,r.ensureDefined)(s[e]))(t,i,(0,r.ensureDefined)(n))}else{l=new((0,r.ensureDefined)(h[e]))(t,i,a,o)}return l.toolname=e,we(),l}function Ie(e,t){const i=(0,r.ensureNotNull)(t.symbolSource());e.childs().symbol.setValue(i.symbol()),i.model().currencyConversionEnabled()&&e.childs().currencyId.setValue(i.currency()),i.model().unitConversionEnabled()&&e.childs().unitId.setValue(i.unit()),e.childs().symbolStateVersion.setValue(2),e.childs().zOrderVersion.setValue(2)}function Ce(e,t,i){if((0,r.assert)((0,fe.isLineToolName)(e),e+" should be name of the line tool"),"LineToolVbPFixed"===e)return v.LineToolVbPFixed.createProperties(i,t);if("LineToolFixedRangeVolumeProfile"===e)return P.createProperties(i,t);if("LineToolRegressionTrend"===e)return b.createProperties(i,t);if("LineToolAnchoredVWAP"===e)return j.createProperties(i,t);if(e in s){return(0,r.ensureDefined)(s[e]).createProperties(t)}return(0,r.ensureDefined)(h[e]).createProperties(t)}function Te(e,t,i,n,a){if((0,r.assert)((0,fe.isStudyLineToolName)(e),e+" should be name of the study line tool"),"LineToolVbPFixed"===e)return v.LineToolVbPFixed.createPropertiesFromStudyMetaInfoAndState(t,i,n,a);if("LineToolFixedRangeVolumeProfile"===e)return P.createPropertiesFromStudyMetaInfoAndState(t,i,n,a);if("LineToolRegressionTrend"===e)return b.createRegressionTrendPropertiesFromStudyMetaInfoAndState(t,i,n,a);if("LineToolAnchoredVWAP"===e)return j.createPropertiesFromStudyMetaInfoAndState(t,i,n,a);if(e in s){return(0,r.ensureDefined)(s[e]).createPropertiesFromStudyMetaInfoAndState(t,i,n,a)}throw new Error("Property creation is not implemented for study line tool "+e)}function Ve(e){(0,r.assert)((0,fe.isLineToolName)(e),e+" should be name of the line tool");const t=h[e];return void 0!==t&&Boolean(t.supportPhantomMode)}function Ae(e){return e instanceof o.LineDataSource}function Me(e){return e instanceof a.StudyLineDataSource}function Le(e){return e instanceof ge.LineToolTrading}function Re(e){let t=null;if(e===b.studyId()?t="LineToolRegressionTrend":e===v.LineToolVbPFixed.studyId()?t="LineToolVbPFixed":e===P.studyId()&&(t="LineToolFixedRangeVolumeProfile"),null===t)for(const t in s)if(s[t].studyId()===e)return t;return t}function De(e,t,i,s){const a=t.toolname,o=Ce(t.toolname,t.properties().state(),e);o.childs().visible.setValue(!0);const l=(0,r.ensureNotNull)(t.ownerSource()),h=xe(a,e,o)
;void 0!==s&&h.setId(s),h.setOwnerSource(l),h.toolname=a;const d=h.clonePositionOffset(),u=t.fixedPoints();(i?u.map(e=>e.add(new n.Point(d.xCoordOffset,d.yCoordOffset))):u).forEach(e=>h.addFixedPoint(e));const c=t.normalizedPoints(),_=i?function(e,t,i){const s=(0,r.ensureNotNull)(t.priceScale()),n=(0,r.ensureNotNull)(t.firstValue());return e.map(e=>{const t=e.price,r=s.priceToCoordinate(t,n)+i.yCoordOffset,a=s.coordinateToPrice(r,n);return{time_t:e.time_t,price:a,offset:e.offset+i.barOffset}})}(c,l,d):c,p=t.points();return h.restorePoints(_,p),h.cloneData&&h.cloneData(t),h.checkAlert&&h.checkAlert(),h}function Ee(e,t){var i;return null!==(i=e.dataSources().find(e=>Ae(e)&&e.linkKey().value()===t))&&void 0!==i?i:null}},78823:(e,t,i)=>{i.d(t,{StudyLineDataSource:()=>f});var s=i(88537),r=i(70617),n=i(52280),a=i(24145),o=i(46090),l=i(70028),h=i.n(l),d=i(74316),u=i(24635),c=i(12270),_=i(23083),p=i(48874),m=i(93987),y=i(94766);class f extends a.LineDataSource{constructor(e,t,s,r,n,a){super(e,r,n,a),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._alignerCache=null,Promise.all([Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,36644)),Promise.all([i.e(93987),i.e(51583)]).then(i.bind(i,1550))]).then(t=>{const{LineToolBeingCreatedPaneView:i}=t[0],{StudyLineDataSourceAnchorsPaneView:s}=t[1];this._beingCreatedPaneView=new i(this,e),this._anchorsPaneView=new s(this,this.model()),this._model.lightUpdate()}),this._metaInfo=t,this._dataSource=new c.StudyDataSource(e.chartApi(),e.mainSeries().seriesSource(),s,t),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated)}destroy(){this._dataSource.dataUpdated().unsubscribe(this,this._onDataUpdated),this._dataSource.dataCleared().unsubscribe(this,this._onDataCleared),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._isDestroyed||(this._dataSource.stop(),this.clearData())}start(){super.start(),this._isDestroyed||null===this._inputs||this._dataSource.start()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(e,t,i){super.setPoint(e,this._preparePoint(t,i))}move(e){}clearData(){this._clearAllDataExceptPointsetPoints(),this._pointsetPoints=null,this.updateAllViews()}data(){return this.plots()}plots(){return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}firstValue(){return this._model.mainSeries().firstValue()}state(e){const t=super.state(e);let i
;this.metaInfo()instanceof h()?i=this.metaInfo().state():(i=(0,r.clone)(this.metaInfo()),i.id=h().parseIdString(i.id+(i.version?"-"+i.version:"")).fullId);const s={...t,metaInfo:i};return e&&(s.data=this.plots().state(),s.nonseriesindexes=this._indexes,s.graphics=(0,d.saveStudyGraphics)(this.graphics())),s}restoreData(e){var t;void 0!==e.data&&(this._loadedPlots=new n.PlotList((0,_.studyPlotFunctionMap)(this._metaInfo),_.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(e.data)),this._indexes=null!==(t=e.nonseriesindexes)&&void 0!==t?t:this._indexes,this._loadedGraphics=e.graphics?(0,d.loadStudyGraphics)(e.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then(e=>null===e||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new e(this._model.undoModel(),this)),this._definitionsViewModel)):Promise.resolve(this._definitionsViewModel)}paneViews(e){let t=[];if(this.isSourceHidden())return t;if(this._isReady()&&this._changeStatesStack.isEmpty()){const i=super.paneViews(e);null!==i&&(t=t.concat(i))}else null!==this._beingCreatedPaneView&&t.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&t.push(this._anchorsPaneView),t}propertiesChanged(e){super.propertiesChanged(e),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(e,t){const i=super.endChanging(e,t);return i.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),i}moveData(e){this._dataSource.moveData(e)}restorePoints(e,t,i){super.restorePoints(e,t,i),this._updateAnchorsPrice(!0)}realign(){super.realign(),null===this._model.mainSeries().symbolInfo()&&(this._alignerCache=null)}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,null,s);return f._configureProperties(r),r}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(){var e,t;super._updateAllPaneViews(),null===(e=this._beingCreatedPaneView)||void 0===e||e.update(),null===(t=this._anchorsPaneView)||void 0===t||t.update()}_getPointTime(e,t){const i=e.index,s=this._model.timeScale().indexToTimePoint(i);if(null!==s)return s;if(t||void 0===e.time)return null;const r=this._model.mainSeries().symbolInfo();if(null===r)return null;let n=this._model.properties().childs().timezone.value();"exchange"===n&&(n=r.timezone);const a=(0,m.cal_to_utc)((0,m.get_timezone)(n),e.time);return this._getStartBarAligner()(a)/1e3}_updateAnchorsPrice(e){}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._pointsetPoints=this._points.map(e=>({price:e.price,index:e.index,time:e.time})),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews(),this._model.updateSource(this)}_onDataUpdated(e,t,i){this._updateAnchorsPrice(),this.updateAllViews(),this._model.updateSource(this)}_onStudyInputsMayChange(){let e=null
;if(null!==this._pointsetPoints&&this._pointsetPoints.length===this.pointsCount()&&(e=this._studyInputs(this._pointsetPoints),null===e&&(this._clearAllDataExceptPointsetPoints(),this.updateAllViews())),null!==e){const t=this.metaInfo().inputs.map(e=>e.id),i=Object.keys(e);for(const s of i)t.includes(s)||delete e[s]}this._areInputsEqual(this._inputs,e)||this._applyStudyInputs(e)}_preparePoint(e,t){return super._preparePoint(this._alignPointToRangeOfActualData(e),t)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,()=>this._onStudyInputsMayChange(),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){this.hasAlert.value()&&(this._localAndServerAlertsMismatch=!0)}static _createPropertiesFromStudyIdAndState(e,t){const i=h().getStudyPropertyRootNameById(e),s=new o.DefaultProperty(i,t);return f._configureProperties(s),s}static _configureProperties(e){a.LineDataSource._configureProperties(e),e.removeExclusion("intervalsVisibilities")}_areInputsEqual(e,t){return null===t?null===e:null!==e&&(0,u.areStudyInputsEqual)(this._metaInfo.inputs,e,t)}_applyStudyInputs(e){const t=this._inputs;this._inputs=e,null!==e&&(this._unsubscribeApplyInputsOnSeriesCompleted(),this._dataSource.setInputs(e),null===t&&this.isStarted()&&!this._dataSource.isStarted()&&this._dataSource.start()),this._onInputsChanged()}_clearAllDataExceptPointsetPoints(){this._inputs=null,this._dataSource.clearData(),this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null}_getStartBarAligner(){const e=this._model.mainSeries().interval();return null!==this._alignerCache&&this._alignerCache.resolution===this._model.mainSeries().interval()||(this._alignerCache={resolution:e,aligner:(0,y.createTimeToBarTimeAligner)(e,(0,s.ensureNotNull)(this._model.mainSeries().symbolInfo()))}),this._alignerCache.aligner}}},67791:(e,t,i)=>{i.d(t,{LineToolVbPFixed:()=>y});var s=i(77973),r=i(88537),n=i(44276),a=i(70028),o=i.n(a),l=i(78823),h=i(74316),d=i(54471),u=i(70617),c=i(46090),_=i(40968),p=i(48874);const m=(0,n.studyIdString)("VbPFixed","tv-volumebyprice");class y extends l.StudyLineDataSource{constructor(e,t,i,s,r,n){const a=i||e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:m}),o=null!=t?t:y.createProperties(e);super(e,a,"vbpfixed_",o,r,n),(0,h.createGraphicsPaneViews)(this,e).then(t=>{if(s=e.mainSeries(),a.plots.length>0){const i=new d.StudyPlotPaneView(this,s,e,a.plots[0].id);t.push(i)}if(a.plots.length>1){const i=new d.StudyPlotPaneView(this,s,e,a.plots[1].id);t.push(i)}if(a.plots.length>2){const i=new d.StudyPlotPaneView(this,s,e,a.plots[2].id);t.push(i)}this._setPaneViews(t)}),this.clearData()}pointsCount(){return 2}boundToSymbol(){return!1}offset(e){return 0}getMinFirstBarIndexForPlot(){return-1/0}calcIsActualSymbol(){this._isActualSymbol=!0,this._isActualCurrency=!0,this._isActualUnit=!0,
this.calcIsActualInterval()}cloneable(){return!1}isSynchronizable(){return!1}static createProperties(e,t){const i=o().getStudyPropertyRootNameById(m),s=(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:m})),n=(0,c.createDefaultsState)(!0,i,[],e.studyVersioning());return(0,_.createStudyLineToolProperties)("LineToolVbPFixed",s,s,(0,u.merge)((0,u.clone)(n),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,null,s);return y._configureProperties(r),r}static studyId(){return m}_studyInputs(e){(0,r.assert)(2===e.length,"all the line tool points should be defined");const[t,i]=e,s=Math.max(t.index,i.index),n=this._model.mainSeries().bars().lastIndex(),a=this._getPointTime(t.index<=i.index?t:i,!0),o=this._getPointTime(i.index>=t.index?i:t,!0);if(null===a||null===o)return this._subscribeApplyInputsOnSeriesCompleted(),null;return{...this.properties().childs().inputs.state(),first_bar_time:1e3*a,last_bar_time:1e3*o,subscribeRealtime:n===s}}_isReady(){return!(0,h.isStudyGraphicsEmpty)(this.graphics())}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(73455),i.e(38493),i.e(60607)]).then(i.bind(i,1173))).StudyLineDataSourceDefinitionsViewModel}_onDataUpdated(){this._updateAnchors(),this.updateAllViews(),this._model.updateSource(this)}_updateAnchors(){const e=this._calculateAnchors();if(!e)return;const[{index:t,price:i},{index:s,price:r}]=e;if(this._timePoint.length&&(this._timePoint[0].price=i,this._timePoint[1].price=r),this._points.length){const e=this.model().timeScale(),n=e.indexToTimePoint(t),a=e.indexToTimePoint(t);this._points[0]={index:t,price:i,time:(0,u.isNumber)(n)?new Date(1e3*n):void 0},this._points[1]={index:s,price:r,time:(0,u.isNumber)(a)?new Date(1e3*a):void 0}}}_calculateAnchors(){let e=null,t=null,i=null,r=null;if(this.graphics().hhists().forEach(s=>{s.forEach(s=>{const{priceLow:n,priceHigh:a,firstBarTime:o,lastBarTime:l}=s;(!e||n<e)&&(e=n),(!t||a>t)&&(t=a),(!i||o<i)&&(i=o),(!r||l>r)&&(r=l)})}),!((0,s.default)(e)||(0,s.default)(t)||(0,s.default)(r)||(0,s.default)(i)))return[{price:t,index:i},{price:e,index:r}]}_updateAnchorsPrice(){const e=this._calculateAnchors();if(!e)return;const[{price:t},{price:i}]=e;this._timePoint.length&&(this._timePoint[0].price=t,this._timePoint[1].price=i),this._points.length&&(this._points[0].price=t,this._points[1].price=i)}}},13648:(e,t,i)=>{i.d(t,{PanePriceAxisView:()=>n});var s=i(5222);class r{constructor(e){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._width=0,this._height=0,this._textWidthCache=e}setParams(e,t,i,s,r){this._priceAxisViewRenderer=e,this._rendererOptions=t,this._width=i,this._height=s,this._align=r}draw(e,t){null!==this._rendererOptions&&null!==this._priceAxisViewRenderer&&this._priceAxisViewRenderer.draw(e,this._rendererOptions,this._textWidthCache,this._width,this._height,this._align,t.pixelRatio)}hitTest(e){var t,i
;return void 0===(null===(t=this._priceAxisViewRenderer)||void 0===t?void 0:t.hitTest)?null:null===(i=this._priceAxisViewRenderer)||void 0===i?void 0:i.hitTest(e,this._width,this._align)}}class n{constructor(e,t,i){this._renderer=null,this._invalidated=!0,this._priceAxisView=e,this._textWidthCache=new s.TextWidthCache(100),this._dataSource=t,this._chartModel=i,this._fontSize=-1,this._panePriceAxisViewRenderer=new r(this._textWidthCache)}update(){this._invalidated=!0}renderer(e,t){return this._invalidated&&this._updateImpl(e,t),this._renderer}_updateImpl(e,t){this._renderer=null;const i=this._chartModel.crossHairSource(),s=this._dataSource===i?i.pane:this._chartModel.paneForSource(this._dataSource);if(null===s)return;const r=this._priceScale();if(null===r)return;let n=s.priceScalePosition(r);if("overlay"===n&&(n=s.priceScalePosition(s.defaultPriceScale())),"overlay"===n)return;const a=this._chartModel.priceAxisRendererOptions();a.fontSize!==this._fontSize&&(this._fontSize=a.fontSize,this._textWidthCache.reset()),this._panePriceAxisViewRenderer.setParams(this._priceAxisView.paneRenderer(),a,t,e,n),this._renderer=this._panePriceAxisViewRenderer,this._invalidated=!1}_priceScale(){return this._dataSource.priceScale()}}},96949:(e,t,i)=>{i.d(t,{PaneRendererArea:()=>o});var s=i(88537),r=i(29828),n=i(72461),a=i(1132);class o extends r.PaneRendererLine{constructor(e){e.forceLineColor=!1,super(e)}draw(e,t){var i;const r=this._data;if(0===r.items.length)return;let o=0;for(;o<r.items.length&&!(0,a.coordinateIsValid)(r.items[o].y);)o++;let l=r.items.length-1;for(;l>=0&&!(0,a.coordinateIsValid)(r.items[l].y);)l--;if(o>l)return;e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.lineCap="butt",e.strokeStyle=r.lineColor,e.lineWidth=r.lineWidth,(0,n.setLineStyle)(e,r.lineStyle),e.lineWidth=1;const h={},d=r.items;for(let e=o;e<=l;e++){const t=d[e];let i;if(i=t.style?t.style.color:r.lineColor,e<l&&d[e+1].style){const r=(0,s.ensureDefined)(d[e+1].style).color;if(i!==r){const e=h[r]||[];e.push(t),h[r]=e}}const n=h[i]||[];n.push(t),h[i]=n}for(const t of Object.keys(h)){const s=h[t];e.beginPath();let n=0;for(let a=0;a<s.length;a++)s[a].style&&(null===(i=s[a].style)||void 0===i?void 0:i.color)!==t&&(e.moveTo(Math.round(s[n].x),r.bottom),this._walkLine(e,s.slice(n,a),!0,r.bottom),n=a);if(e.moveTo(Math.round(s[n].x),r.bottom),this._walkLine(e,s.slice(n,s.length),!0,r.bottom),e.closePath(),r.isSeries){const t=e.createLinearGradient(0,0,0,r.bottom);t.addColorStop(0,r.color1),t.addColorStop(1,r.color2),e.fillStyle=t,r.simpleMode=!0}else e.fillStyle=t;e.fill()}e.lineWidth=r.lineWidth,e.restore(),super.draw(e,t)}}},7127:(e,t,i)=>{i.d(t,{PaneRendererClockIcon:()=>a});var s=i(18718),r=i(80047);const n=Math.sqrt(3);class a extends r.ScaledPaneRenderer{constructor(e){super(),this.update(e)}update(e){var t;const i=e.points[0],s=null!==(t=e.points[1])&&void 0!==t?t:e.points[0],r=i.x-s.x,a=i.y-s.y;let o=e.horzMargin;void 0===o&&(o=r>0?10:-25),this._x=i.x+o,this._y=i.y+(0!==a&&Math.abs(r)*n<=Math.abs(a)?-7:a>0?-25:11),this._color=e.color}hitTest(e){
return e.x<this._x||e.x>this._x+16||e.y<this._y||e.y>this._y+16?null:new s.HitTestResult(s.HitTestResult.REGULAR)}_drawImpl(e){e.save(),e.translate(this._x-.5,this._y-.5),e.beginPath(),e.arc(8,9,6,0,2*Math.PI,!0),e.closePath(),e.moveTo(8,9),e.arc(8.5,5.5,.5,Math.PI,0),e.lineTo(9,10),e.arc(5.5,9.5,.5,.5*Math.PI,1.5*Math.PI),e.closePath(),e.moveTo(1.71,5.93),e.bezierCurveTo(-.61,2.83,3.86,-.76,6.39,2.18),e.bezierCurveTo(4.35,2.67,2.63,4.04,1.71,5.93),e.closePath(),e.moveTo(14.29,5.93),e.bezierCurveTo(16.61,2.83,12.14,-.76,9.61,2.18),e.bezierCurveTo(11.65,2.67,13.37,4.04,14.29,5.93),e.fillStyle=this._color,e.fill(),e.restore()}}},17611:(e,t,i)=>{i.d(t,{CompositeRenderer:()=>s});class s{constructor(){this._renderers=[],this._globalAlpha=1}setGlobalAlpha(e){this._globalAlpha=e}append(e){this._renderers.push(e)}insert(e,t){this._renderers.splice(t,0,e)}clear(){this._renderers.length=0}isEmpty(){return 0===this._renderers.length}draw(e,t){for(let i=0;i<this._renderers.length;i++)e.save(),e.globalAlpha=this._globalAlpha,this._renderers[i].draw(e,t),e.restore()}drawBackground(e,t){e.save(),e.globalAlpha=this._globalAlpha;for(let i=0;i<this._renderers.length;i++){const s=this._renderers[i];s.drawBackground&&s.drawBackground(e,t)}e.restore()}hitTest(e,t){let i=null;for(let s=this._renderers.length-1;s>=0;s--){const r=this._renderers[s].hitTest(e,t);null!==r&&(null===i||r.result()>i.result())&&(i=r)}return i}doesIntersectWithBox(e){return this._renderers.some(t=>!!t.doesIntersectWithBox&&t.doesIntersectWithBox(e))}}},37689:(e,t,i)=>{i.d(t,{HorizontalLineRenderer:()=>o});var s=i(18718),r=i(72461),n=i(64149),a=i(1132);class o{constructor(){this._data=null,this._hitTest=new s.HitTestResult(s.HitTestResult.REGULAR)}setData(e){this._data=e}setHitTest(e){this._hitTest=e}hitTest(e){if(null===this._data||!1===this._data.visible||null===this._hitTest)return null;const t=(0,a.interactionTolerance)().line,i=Math.abs(e.y-this._data.y)<=t+this._data.linewidth/2,s=void 0===this._data.left||this._data.left-e.x<=t,r=void 0===this._data.right||e.x-this._data.right<=t;return i&&s&&r?this._hitTest:null}draw(e,t){if(null===this._data)return;if(!1===this._data.visible)return;if(this._data.y<-this._data.linewidth/2||this._data.y>t.cssHeight+this._data.linewidth/2)return;const i=t.pixelRatio;e.lineCap="butt",e.strokeStyle=this._data.color,e.lineWidth=Math.max(1,Math.floor(this._data.linewidth*i)),void 0!==this._data.linestyle&&(0,r.setLineStyle)(e,this._data.linestyle);const s=void 0!==this._data.left?Math.max(this._data.left,0):0,a=void 0!==this._data.right?Math.min(this._data.right,t.cssWidth):t.cssWidth,o=Math.round(this._data.y*i),l=Math.floor(s*i),h=Math.ceil(a*i);(0,n.drawHorizontalLine)(e,o,l,h)}}},29828:(e,t,i)=>{i.d(t,{PaneRendererLine:()=>l});var s=i(86441),r=i(4652),n=i(18718),a=i(72461),o=i(1132);class l{constructor(e){this._data=e}hitTest(e,t){const i=(0,o.interactionTolerance)().series+this._data.lineWidth/2;let a=0,l=this._data.items.length-1;for(;l-a>2;){const t=Math.round((l+a)/2);this._data.items[t].x<=e.x?a=t:l=t}a=Math.max(1,a-1),
l=Math.min(this._data.items.length-1,l+1);for(let t=a;t<=l;++t){const a=this._data.items[t-1],o=this._data.items[t],l=a.x,h=o.x;if((0,r.distanceToSegment)(new s.Point(l,a.y),new s.Point(h,o.y),new s.Point(e.x,e.y)).distance<=i)return this._data.hittest?this._data.hittest:new n.HitTestResult(n.HitTestResult.REGULAR)}return null}draw(e,t){e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.lineCap="square",e.lineJoin="round",e.strokeStyle=this._data.lineColor,e.fillStyle=this._data.lineColor,e.lineWidth=this._data.lineWidth,(0,a.setLineStyle)(e,this._data.lineStyle),(0,o.setValidLineStyle)(e,this._data.lineStyle),this._data.simpleMode?this._drawSimpleMode(e,t.pixelRatio):this._drawLines(e),e.restore()}_drawSimpleMode(e,t){if(e.beginPath(),this._walkLine(e,this._data.items,!1,NaN),e.stroke(),this._data.withMarkers){e.save(),e.scale(1/t,1/t);const i=Math.max(1,Math.floor(t))%2/2,s=(this._data.lineWidth+2)*t+i,r=2*Math.PI;e.beginPath();for(let n=this._data.items.length;n--;){const a=this._data.items[n];if(a){const n=Math.round(a.x*t)+i,o=a.y*t;e.moveTo(n,o),e.arc(n,o,s,0,r)}}e.fill(),e.restore()}}_walkLine(e,t,i,s){if(!t)return;const r=.25*this._data.barSpacing;let n,a,l,h,d;const u=o.coordinateIsValid;for(let e=0;e<t.length;e++){const i=t[e];if(u(i.y)){a=i,n=e;break}}if(void 0!==n&&void 0!==a)for(let a=n;a<t.length;a++){h=t[a],d=t[a+1]||{};const o=Math.round(h.x);if(u(h.y))if(l&&u(l.y))e.lineTo(o,h.y),i&&!u(d.y)&&e.lineTo(o,s);else if(d&&u(d.y))i?(a!==n&&e.lineTo(o,s),e.lineTo(o,h.y)):e.moveTo(o,h.y);else if(i){if(0===a)continue;a!==n&&e.lineTo(o-r,s),e.lineTo(o-r,h.y),e.lineTo(o+r,h.y),e.lineTo(o+r,s)}else e.moveTo(o-r,h.y),e.lineTo(o+r,h.y);l=h}}_drawLines(e){if(!this._data.items.length)return;let t,i,s;const r=.25*this._data.barSpacing,n=o.coordinateIsValid;e.beginPath();const a=this._data.items[0];a&&e.moveTo(a.x,a.y);let l,h=e.strokeStyle,d=e.lineWidth;for(let a=1;a<this._data.items.length;++a){let p,m,y;t=this._data.items[a-1],i=this._data.items[a],s=this._data.items[a+1],i.style&&!this._data.forceLineColor?(p=i.style.color,m=i.style.width,y=i.style.style):(p=this._data.lineColor,m=this._data.lineWidth,y=this._data.lineStyle),this._data.ignorePaletteLineWidth&&(m=this._data.lineWidth);(p!==h||m!==d||y!==l)&&(h=p,d=m,l=y,e.stroke(),e.beginPath(),e.strokeStyle=p,e.lineWidth=m,(0,o.setValidLineStyle)(e,y),e.moveTo(t.x,t.y)),u=t,_=s,n((c=i).y)&&(n(u.y)?e.lineTo(c.x,c.y):_&&n(_.y)?e.moveTo(c.x,c.y):(e.moveTo(c.x-r,c.y),e.lineTo(c.x+r,c.y)))}var u,c,_;e.stroke()}}},80047:(e,t,i)=>{i.d(t,{ScaledPaneRenderer:()=>s,ScaledPaneRendererWrapper:()=>r});class s{draw(e,t){e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.translate(.5,.5),this._drawImpl(e,{...t,pixelRatio:1}),e.restore()}drawBackground(e,t){e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.translate(.5,.5),this._drawBackgroundImpl(e,{...t,pixelRatio:1}),e.restore()}_drawBackgroundImpl(e,t){}}class r{constructor(e){this._base=e}hitTest(e,t){return this._base.hitTest(e,t)}draw(e,t){e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.translate(.5,.5),this._base.draw(e,{...t,pixelRatio:1
}),e.restore()}drawBackground(e,t){e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.translate(.5,.5),this._base.drawBackground&&this._base.drawBackground(e,{...t,pixelRatio:1}),e.restore()}}},65736:(e,t,i)=>{i.d(t,{PaneRendererBaseline:()=>d});var s=i(86441),r=i(5531),n=i(4652),a=i(1132),o=i(77884),l=i(80047),h=i(18718);class d extends l.ScaledPaneRenderer{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(e){if(null===this._data)return null;const{items:t,topLineWidth:i,bottomLineWidth:r}=this._data,l=(0,a.interactionTolerance)().series+(i+r)/4,d=(0,o.lowerbound)(t,e,(e,t)=>e.x<=t.x),u=Math.max(1,d-1),c=Math.min(t.length-1,d+1);for(let i=u;i<=c;++i){const r=t[i-1],a=t[i],{distance:o}=(0,n.distanceToSegment)(new s.Point(r.x,r.y),new s.Point(a.x,a.y),new s.Point(e.x,e.y));if(o<=l)return new h.HitTestResult(h.HitTestResult.REGULAR)}return null}_drawImpl(e){if(null===this._data)return;const{items:t,baseLevelCoordinate:i,bottom:n,bottomFillColor1:o,bottomFillColor2:l,topFillColor1:h,topFillColor2:d,topLineColor:u,bottomLineColor:c,topLineWidth:_,bottomLineWidth:p}=this._data;if(!function(e){if(0===e.length)return!1;const t=e.findIndex(e=>(0,a.coordinateIsValid)(e.y));if(-1===t)return!1;let i=e.length-1;for(;i>t&&!(0,a.coordinateIsValid)(e[i].y);)i--;return!(t>i)}(t))return;const{topItems:m,bottomItems:y}=function(e,t){const i=[],n=[];let o=null;for(let l=0;l<e.length;l++){let h=e[l];const d=e[l+1]||{};if((0,a.coordinateIsValid)(h.y))h.y<=t&&i.push(h),h.y>=t&&n.push(h),o=h;else{if(null===o)continue;h=o}if((0,a.coordinateIsValid)(d.y)&&(h.y>t&&d.y<t||h.y<t&&d.y>t))if(Math.abs(h.x-d.x)<1){const e=new s.Point(h.x,t);i.push(e),n.push(e)}else{const e=(0,r.intersectLineSegments)(h,d,new s.Point(h.x,t),new s.Point(d.x,t));if(null!==e){const t=h.add(d.subtract(h).scaled(e));i.push(t),n.push(t)}}}return{topItems:i,bottomItems:n}}(t,i);e.lineCap="round",e.lineJoin="round",0!==m.length&&(e.beginPath(),e.moveTo(m[0].x,i),this._makeLine(e,m,!0,0),e.closePath(),e.fillStyle=this._makeLinearGradient(e,h,d,i-n,i),e.fill(),e.beginPath(),this._makeLine(e,m,!1,0),e.lineWidth=_,e.strokeStyle=u,e.stroke()),0!==y.length&&(e.beginPath(),e.moveTo(y[0].x,i),this._makeLine(e,y,!0,1),e.closePath(),e.fillStyle=this._makeLinearGradient(e,o,l,i,i+n),e.fill(),e.beginPath(),this._makeLine(e,y,!1,1),e.lineWidth=p,e.strokeStyle=c,e.stroke())}_makeLine(e,t,i,s){if(null===this._data)return;const r=t.findIndex(e=>(0,a.coordinateIsValid)(e.y));if(-1===r)return;const{barSpacing:n,baseLevelCoordinate:o}=this._data,l=.25*n;let h;const d=t.length;for(let n=r;n<d;n++){const d=t[n],u=t[n+1]||{};if((0,a.coordinateIsValid)(d.y)){if(0===s){if(h&&h.y>=o&&d.y>=o){e.moveTo(d.x,d.y);continue}}else if(h&&h.y<=o&&d.y<=o){e.moveTo(d.x,d.y);continue}if(h&&(0,a.coordinateIsValid)(h.y))e.lineTo(d.x,d.y),i&&!(0,a.coordinateIsValid)(u.y)&&e.lineTo(d.x,o);else if(u&&(0,a.coordinateIsValid)(u.y))i?(n!==r&&e.lineTo(d.x,o),e.lineTo(d.x,d.y)):e.moveTo(d.x,d.y);else if(i){if(0===n)continue;n!==r&&e.lineTo(d.x-l,o),e.lineTo(d.x-l,d.y),e.lineTo(d.x+l,d.y),
e.lineTo(d.x+l,o)}else e.moveTo(d.x-l,d.y),e.lineTo(d.x+l,d.y);h=d}}}_makeLinearGradient(e,t,i,s,r){const n=e.createLinearGradient(0,s,0,r);return n.addColorStop(0,t),n.addColorStop(1,i),n}}},68226:(e,t,i)=>{i.d(t,{StepLineDecoration:()=>s,PaneRendererStepLine:()=>y});var s,r=i(4652),n=i(18718),a=i(86441),o=i(72461),l=i(77884),h=i(1132),d=i(64149),u=i(21386);!function(e){e[e.None=0]="None",e[e.Diamonds=1]="Diamonds"}(s||(s={}));class c{initialize(e,t,i,s){var r,n,a,l;const h=e.lineStyle;t.lineCap="butt",t.lineJoin="round";const d=Math.max(Math.floor(null!==(n=null===(r=s.style)||void 0===r?void 0:r.width)&&void 0!==n?n:e.lineWidth*i.pixelRatio));void 0!==h&&(0,o.setLineStyle)(t,h);const u=d%2?.5:0;t.moveTo(Math.round(s.x*i.pixelRatio)+u,Math.round(s.y*i.pixelRatio)+u),t.strokeStyle=null!==(l=null===(a=s.style)||void 0===a?void 0:a.color)&&void 0!==l?l:e.lineColor,t.lineWidth=d}finishFragment(e){e.stroke()}hitTest(e,t,i,s,n){var o,l;const d=Math.round((i.x+s.x)/2),u=new a.Point(d,i.y),c=new a.Point(d,s.y),_=null!==(l=null===(o=i.style)||void 0===o?void 0:o.width)&&void 0!==l?l:e.lineWidth,p=(0,h.interactionTolerance)().series+_/2;return Math.min((0,r.distanceToSegment)(i,u,n).distance,(0,r.distanceToSegment)(u,c,n).distance,(0,r.distanceToSegment)(c,s,n).distance)<=p}applyColor(e,t){e.strokeStyle=t}applyLineWidth(e,t){e.lineWidth=t}drawItem(e,t,i,s){e.lineTo(i.x,i.y),void 0!==s&&(e.lineTo(s.x,i.y),e.lineTo(s.x,s.y))}}class _{constructor(){this._lineWidth=1}initialize(e,t,i,s){var r,n,a,o;this.applyColor(t,null!==(n=null===(r=s.style)||void 0===r?void 0:r.color)&&void 0!==n?n:e.lineColor),this._lineWidth=Math.max(Math.floor(null!==(o=null===(a=s.style)||void 0===a?void 0:a.width)&&void 0!==o?o:e.lineWidth*i.pixelRatio))}finishFragment(e){e.fill()}drawItem(e,t,i,s,r){if(r&&void 0!==s&&!Number.isNaN(s.y)){e.save(),e.translate(s.x,s.y),e.rotate(Math.PI/4);const i=this._scaleByLineWidth(this._lineWidth);e.scale(i,i),this._drawItemRotatedAndTranslated(e,t),e.restore()}}applyLineWidth(e,t){this._lineWidth=t}hitTest(e,t,i,s,r){var n,o;if(!s.valIsNotSameAsPrev)return!1;const l=Math.round((i.x+s.x)/2),h=new a.Point(l,s.y),d=r.subtract(h),u=Math.max(Math.floor(null!==(o=null===(n=i.style)||void 0===n?void 0:n.width)&&void 0!==o?o:e.lineWidth*t.pixelRatio));return this._hitTestTranslated(d,u)}_scaleByLineWidth(e){return Math.sqrt(e)}}class p extends _{applyColor(e,t){e.fillStyle=t}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<8*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e,t){(0,d.drawRoundRect)(e,-4,-4,8,8,2,!0)}}class m extends _{applyColor(e,t){e.fillStyle=(0,u.applyTransparency)(t,85)}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<21*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e,t){(0,d.drawRoundRect)(e,-10.5,-10.5,21,21,5,!0)}}class y{constructor(){this._data=null}setData(e){this._data=e}hitTest(e,t){var i;const r=this._data;if(null===r||0===r.items.length)return null;const a=r.items,o=(0,
l.lowerbound)(a,e,(e,t)=>e.x<=t.x),h=Math.max(0,o-1),d=Math.min(a.length-1,o+1),u=function(e){switch(e){case s.Diamonds:return[new c,new m];default:return[new c]}}(null===(i=this._data)||void 0===i?void 0:i.decoration);for(let i=h;i<d;i++){const s=a[i],o=a[i+1];if(o&&u.some(i=>i.hitTest(r,t,s,o,e)))return new n.HitTestResult(n.HitTestResult.REGULAR)}return null}draw(e,t){if(null===this._data||0===this._data.items.length)return;e.save();(function(e){switch(e){case s.Diamonds:return[new c,new p,new m];default:return[new c]}})(this._data.decoration).forEach(i=>this._drawImpl(e,t,i)),e.restore()}_drawImpl(e,t,i){var s,r,n,o,l,h,d,u,c,_;if(null===this._data||0===this._data.items.length)return;const{lineWidth:p,lineColor:m,items:y}=this._data,f=y.length,g=t.pixelRatio;let S=Math.max(Math.floor(null!==(r=null===(s=y[0].style)||void 0===s?void 0:s.width)&&void 0!==r?r:p*g)),b=S%2?.5:0;i.initialize(this._data,e,t,y[0]),e.beginPath();for(let s=0;s<f;s++){const r=y[s],f=y[s+1],v=Math.round(r.x*g)+b,w=Math.round(r.y*g)+b;if(!f){i.drawItem(e,t,(0,a.point)(v,w));continue}const P=Math.round((r.x+f.x)/2*g)+b,x=Math.round(f.y*g)+b;i.drawItem(e,t,(0,a.point)(v,w),(0,a.point)(P,x),f.valIsNotSameAsPrev);const I=null!==(o=null===(n=r.style)||void 0===n?void 0:n.color)&&void 0!==o?o:m,C=null!==(h=null===(l=r.style)||void 0===l?void 0:l.width)&&void 0!==h?h:p,T=null!==(u=null===(d=f.style)||void 0===d?void 0:d.color)&&void 0!==u?u:m,V=null!==(_=null===(c=f.style)||void 0===c?void 0:c.width)&&void 0!==_?_:p,A=I!==T,M=C!==V;(A||M)&&(i.finishFragment(e),A&&i.applyColor(e,T),M&&(S=Math.max(1,Math.floor(V*g)),b=S%2?.5:0,i.applyLineWidth(e,S)),e.beginPath(),e.moveTo(P,x))}i.finishFragment(e)}}},2899:(e,t,i)=>{i.d(t,{isPriceDataSource:()=>o,PriceDataSource:()=>l});var s=i(62949),r=i(97639),n=i.n(r),a=i(92179);function o(e){return e instanceof l}class l extends s.DataSource{constructor(e,t){super(t),this._formatterChanged=new(n()),this._priceStepChanged=new(n()),this._currencyChanged=new(n()),this._unitChanged=new(n()),this._priceRangeReadyChanged=new(n()),this._priceStep=null,this._priceRangeReady=!0,this._model=e}barColorer(){return null}base(){return 0}model(){return this._model}currencyChanged(){return this._currencyChanged}isCurrencySource(){return!0}unitChanged(){return this._unitChanged}isUnitSource(){return!0}priceRange(e,t){return null}isDraggable(){return!0}priceLineColor(e){return e}formatterChanged(){return this._formatterChanged}priceStep(e){return this._priceStep}priceStepChanged(){return this._priceStepChanged}isIncludedInAutoScale(){return!0}correctScaleMargins(e){return e}priceRangeReady(){return this._priceRangeReady}priceRangeReadyChanged(){return this._priceRangeReadyChanged}disablePriceRangeReady(){const e=this.priceScale();null===e||e.isAutoScale()||e.mainSource()!==this||(this._priceRangeReady=!1,e.recalculatePriceRangeOnce()),this._priceRangeReadyChanged.fire(!1)}statusView(){return null}legendView(){return null}marketStatusModel(){return null}dataUpdatedModeModel(){return null}dataProblemModel(){return null}
_enablePriceRangeReady(){this._priceRangeReady=!0,this._priceRangeReadyChanged.fire(!0)}_onSourceCurrencyChanged(){(0,a.isSymbolSource)(this)||this._currencyChanged.fire()}_onSourceUnitChanged(){(0,a.isSymbolSource)(this)||this._unitChanged.fire()}_onSourcePriceRangeReadyChanged(e){(0,a.isSymbolSource)(this)||e||this.disablePriceRangeReady()}}},42141:(e,t,i)=>{i.d(t,{PriceLineAxisRenderer:()=>o});var s=i(88537),r=i(72461),n=i(45185),a=i(64149);class o{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,o,l,h,d){var u;if(!this._data.visible)return;const c=null!==(u=this._commonData.fixedCoordinate)&&void 0!==u?u:this._commonData.coordinate;e.lineWidth=Math.max(1,Math.floor((0,s.ensureDefined)(this._data.linewidth)*d)),e.lineCap="butt",(0,r.setLineStyle)(e,void 0===this._data.linestyle?n.LINESTYLE_DOTTED:this._data.linestyle),e.strokeStyle=this._commonData.textColor,(0,a.drawHorizontalLine)(e,Math.round(c*d),0,Math.ceil(o*d))}height(e){return 0}}},67850:(e,t,i)=>{i.d(t,{PriceLineAxisView:()=>a,SeriesPriceLineAxisView:()=>o,StudyPriceLineAxisView:()=>l});var s=i(98424),r=i(42141),n=i(45185);class a extends s.PriceAxisView{constructor(e){super(e||r.PriceLineAxisRenderer)}ignoreAlignment(){return!0}_updateRendererData(e,t,i){if(t.visible=!1,e.visible=!1,!this._isVisible())return;const s=this._value();s.noData||(i.background="",i.textColor=this._priceLineColor(s.color),i.coordinate=s.coordinate,i.floatCoordinate=s.floatCoordinate,e.linewidth=this._lineWidth(),e.linestyle=this._lineStyle(),e.backgroundAreaVisible=this._backgroundAreaVisible(),e.backgroundAreaColor=this._backgroundAreaColor(),e.backgroundAreaHeight=this._backgroundAreaHeight(),e.visible=!0)}_lineStyle(){return n.LINESTYLE_DOTTED}_backgroundAreaVisible(){return!1}_backgroundAreaColor(){return""}_backgroundAreaHeight(){return 0}}class o extends a{constructor(e){super(),this._series=e}_value(){return this._series.lastValueData(void 0,!0)}_priceLineColor(e){return this._series.priceLineColor(e)}_lineWidth(){return this._series.properties().childs().priceLineWidth.value()}_isVisible(){const e=this._series.model().properties().childs().scalesProperties.childs().showSeriesLastValue.value();return this._series.properties().childs().showPriceLine.value()&&e}}class l extends a{constructor(e,t){super(),this._study=e,this._plotname=t}_value(){return this._study.lastValueData(this._plotname,!0)}_lineWidth(){return this._study.properties().styles[this._plotname].linewidth.value()}_lineStyle(){return n.LINESTYLE_DOTTED}_priceLineColor(e){return e}_isVisible(){const e=this._study.model().properties().childs().scalesProperties.childs().showStudyLastValue.value();return this._study.properties().styles[this._plotname].trackPrice.value()&&e}}},43615:(e,t,i)=>{i.r(t),i.d(t,{fromPercent:()=>a,toPercent:()=>o,toPercentRange:()=>l,fromIndexedTo100:()=>h,toIndexedTo100:()=>d,toIndexedTo100Range:()=>u,toLog:()=>c,fromLog:()=>_,logFormulaForPriceRange:()=>p,logFormulasAreSame:()=>m,getCurrentModePriceText:()=>y,getOppositeModePriceText:()=>f})
;var s=i(59270),r=i(66915);const n={logicalOffset:4,coordOffset:1e-4};function a(e,t){return t<0&&(e=-e),e/100*t+t}function o(e,t){const i=100*(e-t)/t;return t<0?-i:i}function l(e,t){const i=o(e.minValue(),t),r=o(e.maxValue(),t);return new s.PriceRange(i,r)}function h(e,t){return t<0&&(e=-e),(e-=100)/100*t+t}function d(e,t){const i=100*(e-t)/t+100;return t<0?-i:i}function u(e,t){const i=d(e.minValue(),t),r=d(e.maxValue(),t);return new s.PriceRange(i,r)}function c(e,t){const i=Math.abs(e);if(i<1e-15)return 0;const s=(0,r.log10)(i+t.coordOffset)+t.logicalOffset;return e<0?-s:s}function _(e,t){const i=Math.abs(e);if(i<1e-15)return 0;const s=Math.pow(10,i-t.logicalOffset)-t.coordOffset;return e<0?-s:s}function p(e){if(null===e)return n;const t=Math.abs(e.maxValue()-e.minValue());if(t>=1||t<1e-15)return n;const i=Math.ceil(Math.abs(Math.log10(t))),s=n.logicalOffset+i;return{logicalOffset:s,coordOffset:1/Math.pow(10,s)}}function m(e,t){return e.logicalOffset===t.logicalOffset&&e.coordOffset===t.coordOffset}function y(e,t){return e.isPercentage()?t.formattedPricePercentage:e.isIndexedTo100()?t.formattedPriceIndexedTo100:t.formattedPriceAbsolute}function f(e,t){return e.isPercentage()||e.isIndexedTo100()?t.formattedPriceAbsolute:t.formattedPricePercentage}},14729:(e,t,i)=>{i.d(t,{combineProperty:()=>o,createWVFromGetterAndSubscription:()=>s.createWVFromGetterAndSubscription,createWVFromGetterAndSubscriptions:()=>r.createWVFromGetterAndSubscriptions,createWVFromProperty:()=>n});var s=i(41926),r=i(60674);function n(e){return(0,s.createWVFromGetterAndSubscription)(()=>e.value(),e)}i(32567);var a=i(60949);function o(e,...t){const i=()=>e(...t.map(e=>e.value())),s=(0,a.createPrimitiveProperty)(i()),r=()=>s.setValue(i()),n={};for(const e of t)e.subscribe(n,r);return s.destroy=()=>{t.forEach(e=>e.unsubscribeAll(n))},s}},41926:(e,t,i)=>{i.d(t,{createWVFromGetterAndSubscription:()=>n});var s=i(62325),r=i.n(s);function n(e,t){const i=new(r())(e()),s={};t.subscribe(s,()=>{i.setValue(e())});return i.readonly().spawn(()=>t.unsubscribeAll(s))}},60674:(e,t,i)=>{i.d(t,{createWVFromGetterAndSubscriptions:()=>n});var s=i(62325),r=i.n(s);function n(e,t){const i=new(r())(e()),s={};t.forEach(t=>t.subscribe(s,()=>{i.setValue(e())}));return i.readonly().spawn(()=>t.forEach(e=>e.unsubscribeAll(s)))}},46037:(e,t,i)=>{i.d(t,{SelectionIndexes:()=>r});var s=i(88537);class r{constructor(e){this._baseIndex=null,this._offsetInBar=null,this._offsetInTime=null,this._barsBetweenPoints=null,this._timescale=e}indexes(){const e=this._timescale.visibleBarsStrictRange();if(null===e)return[];const t=e.firstBar(),i=e.lastBar();if(null===this._offsetInTime||null===this._barsBetweenPoints){const e=this._timescale.barSpacing();this._barsBetweenPoints=Math.floor(120/e),this._offsetInBar=i%this._barsBetweenPoints,this._offsetInTime=this._timescale.indexToTimePoint(this._offsetInBar),this._baseIndex=this._timescale.baseIndex()}const r=this._timescale.baseIndex();this._baseIndex!==r&&(this._baseIndex=r,this._offsetInBar=(0,
s.ensureNotNull)(this._timescale.timePointToIndex(this._offsetInTime)));const n=(0,s.ensureNotNull)(this._offsetInBar),a=[];let o=Math.floor((t-n)/this._barsBetweenPoints);const l=Math.floor((i-n)/this._barsBetweenPoints);for(;o<=l;o++)a.push(n+o*this._barsBetweenPoints);return a}clear(){this._offsetInBar=null,this._offsetInTime=null,this._baseIndex=null,this._barsBetweenPoints=null}}},59447:(e,t,i)=>{i.d(t,{SelectionRenderer:()=>l});var s=i(34026),r=i(91055),n=i(18718),a=i(87511);const o=r.colorsPalette["color-tv-blue-600"];class l{constructor(e){this._data=e||null}setData(e){this._data=e}draw(e,t){if(null===this._data||!this._data.visible)return;const i=t.pixelRatio;e.strokeStyle=void 0!==this._data.color?this._data.color:o,e.lineCap="butt";const s=Math.max(1,Math.floor(i));e.lineWidth=s;const r=this._data.vertOffset||0;for(let t=0;t<this._data.points.length;++t){const a=this._data.points[t];(n=a,Number.isFinite(n.x)&&Number.isFinite(n.y))&&(e.fillStyle=this._data.bgColors[t],this._drawMarker(e,a,r,s,i))}var n}hitTest(e){if(!this._data||!this._data.visible)return null;for(let t=0;t<this._data.points.length;t++){const i=this._data.points[t];if(i.subtract(e).length()<=5.5){const e=void 0!==this._data.pointsCursorType?this._data.pointsCursorType[t]:a.PaneCursorType.Default;return new n.HitTestResult(this._data.hittestResult,{pointIndex:i.data,cursorType:e})}}return null}doesIntersectWithBox(e){return!!this._data&&this._data.points.some(t=>(0,s.pointInBox)(t,e))}_drawMarker(e,t,i,s,r){let n=Math.round(3.5*r*2);n%2!=s%2&&(n+=1);let a=Math.round(n+2*(.5*s+.75*r));a%2!=s%2&&(a+=1);const o=Math.round(t.x*r),l=Math.round((t.y+i)*r),h=s%2/2;e.beginPath(),e.arc(o+h,l+h,a/2,0,2*Math.PI,!0),e.closePath(),e.fill(),e.beginPath(),e.arc(o+h,l+h,n/2,0,2*Math.PI,!0),e.closePath(),e.stroke()}}},46111:(e,t,i)=>{i.d(t,{SeriesBase:()=>ht});var s=i(88537),r=i(38456),n=i(45848),a=i(51954),o=i(11905),l=i(2899),h=i(52280),d=i(3653),u=i(32567),c=i.n(u),_=i(49473),p=i(89765),m=i(95048),y=i(92139),f=i(87236),g=i(11688),S=i(13324),b=i(5073),v=i(2105);const w=(0,f.t)("Symbol Error"),P=(0,r.onWidget)(),x=g.enabled("hide_unresolved_symbols_in_legend");class I extends b.StatusProviderBase{constructor(e,t,i,s){super(t),this._series=e,this._statusViewProperties=i,this._options=s||{}}text(){return(0,v.generateTitleForGui)(this._getTitleGenerationOptions())}getSplitTitle(){return(0,v.generateSplitTitleForGui)(this._getTitleGenerationOptions())}bold(){return!1}size(){return this._statusViewProperties.childs().fontSize.value()+"px"}errorStatus(){const e=this._series.seriesErrorMessage();return null!==e?{error:e,title:w}:null}_getTitleGenerationOptions(){const e=this._series.symbolInfo(),t=this._statusViewProperties.childs(),i=this._series.symbolTextSourceProxyProperty().value();return{description:"ticker"===i?e&&e.name||void 0:(0,S.getTranslatedSymbolDescription)({pro_name:e&&e.pro_name||void 0,short_name:e&&e.name||void 0,description:e&&e.description||void 0,short_description:e&&e.short_description||void 0,
local_description:e&&e.local_description||void 0,language:e&&e.language||void 0}),exchange:t.showExchange.value()?P||"forex"===(null==e?void 0:e.type)?null==e?void 0:e.exchange:null==e?void 0:e.listed_exchange:void 0,symbol:x&&null===e?"":this._series.symbol(),interval:t.showInterval.value()&&!this._options.hideResolution?this._series.interval():void 0,style:this._series.properties().childs().style.value(),inputs:this._series.getInputsProperties().state(),boxSize:this._series.data().boxSize,reversalAmount:this._series.data().reversalAmount,ticker:"ticker-and-description"===i?e&&e.name||void 0:"",branding:this._options.branding}}}class C extends y.StatusView{constructor(e,t,i,s){super(new I(e,t,i,s)),this._invalidated=!0,this._series=e,this._series.onRestarted().subscribe(this,this.update),this._series.dataEvents().symbolResolved().subscribe(this,this.update),this._series.dataEvents().completed().subscribe(this,this.update),this._series.boxSizeValue().subscribe(this.update.bind(this)),i.childs().symbolTextSource.listeners().subscribe(this,this.update)}getSeriesPrecision(){let e=4;const t=this._series.symbolInfo();return t&&t.pricescale&&(e=Math.round(Math.log(t.pricescale)/Math.log(10))),e}round(e){const t=this.getSeriesPrecision(),i=Math.round(e*Math.pow(10,t))/Math.pow(10,t);return i?i.toString():""}update(){this._invalidated=!0}text(){return this._updateImpl(),super.text()}color(){return this._updateImpl(),super.color()}bold(){return this._updateImpl(),super.bold()}size(){return this._updateImpl(),super.size()}getSplitTitle(){return this._updateImpl(),this._statusProvider.getSplitTitle()}_updateImpl(){this._invalidated&&(this._bold=this._statusProvider.bold(),this._size=this._statusProvider.size(),this._text=this._statusProvider.text(),this._invalidated=!1)}}var T=i(34906),V=i(73547),A=i(8170),M=i(94683),L=i(40968);const R=r.CheckMobile.any(),D=g.enabled("hide_resolution_in_legend");class E extends T.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._series=e,this._model=t,this._valuesProvider=this._createValuesProvider(e,t),this._items=this._valuesProvider.getItems().map(e=>new T.DataWindowItem(e.title,"",e.unimportant)),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}series(){return this._series}_updateImpl(){const e=this._series.symbolInfo();if(e){const t=[e.name];D||t.push((0,V.translatedIntervalString)(this._series.interval())),t.push((0,r.onWidget)()||"forex"===e.type?e.exchange:e.listed_exchange),this._header=t.join(", "),this._title=e.description}else this._header=this._series.symbol();const t=this._model.crossHairSource().appliedIndex(),i=this._valuesProvider.getValues(t);for(let e=0;e<i.length;++e){const t=i[e],s=this._items[e];s.setValue(t.value),s.setVisible(t.visible),s.setColor(t.color)}}_createValuesProvider(e,t){return new M.SeriesValuesProvider(e,t)}_showLastPriceAndChangeOnly(){return R&&(null===this._model.crossHairSource().pane||(0,
L.isLineToolName)(A.tool.value())||null!==this._model.lineBeingEdited())}}const B={open:(0,f.t)("O",{context:"in_legend"}),high:(0,f.t)("H",{context:"in_legend"}),low:(0,f.t)("L",{context:"in_legend"}),close:(0,f.t)("C",{context:"in_legend"}),hl2:(0,f.t)("HL2",{context:"in_legend"}),hlc3:(0,f.t)("HLC3",{context:"in_legend"}),ohlc4:(0,f.t)("OHLC4",{context:"in_legend"})};class k extends M.SeriesValuesProvider{constructor(e,t){super(e,t);const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._showBarChange=i.showBarChange,this._showSeriesOHLC=i.showSeriesOHLC,this._showVolume=i.showVolume,this._seriesStyle=e.properties().childs().style;const s=this._emptyValues[0],r=this._emptyValues[1],n=this._emptyValues[2];s.title=B.open,r.title=B.high,n.title=B.low,s.unimportant=!0,r.unimportant=!0,n.unimportant=!0,this._emptyValues[3].title=B.close,this._emptyValues[6].title="",this._emptyValues[4].title=""}getValues(e){const t=super.getValues(e),i=this._showSeriesOHLC.value(),s=this._showBarChange.value(),r=12===this._series.style(),n=t[6];n.visible=n.visible&&s&&!r;const a=t[7];if(a.visible=a.visible&&this._showVolume.value(),this._showLastPriceAndChangeOnly()){const e=t[5];return e.visible=e.visible&&i,t}const o=(0,_.isPriceSourceStyle)(this._seriesStyle.value()),l=i&&!o,h=i&&o;return t[0].visible=l&&!r,t[1].visible=l,t[2].visible=l,t[3].visible=l&&!r,t[4].visible=h,t}}var O=i(14729);const N=(0,f.t)("At close");class F extends E{constructor(e,t){super(e,t),this._backgroundColorSpawn=t.backgroundTopColor().spawn(),this._backgroundColorSpawn.subscribe(this.update.bind(this));const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._visibilityProperty=(0,O.combineProperty)((e,t,i)=>e||t||i,i.showBarChange,i.showSeriesOHLC,i.showVolume),this._visibilityProperty.subscribe(this,this.update)}areValuesVisible(){return this._visibilityProperty.value()}additional(){const e=this._series.dataPoweredBy();return null!==e&&e.length>0?(0,f.t)("Data Provided by")+" "+e:null}marketTitle(){const e=this._series.marketStatusModel().status().value();return this._showLastPriceAndChangeOnly()&&("pre_market"===e||"post_market"===e)?N+":":""}destroy(){this._backgroundColorSpawn.destroy(),this._visibilityProperty.destroy()}_createValuesProvider(e,t){return new k(e,t)}}var W=i(96365),H=i(38627),U=i(73044),z=i(66190),G=i(53765),j=i(95935);let Y=0;class q{constructor(e,t){this._extrapolatedData=[],this._cacheForFuture=!1,this._modelId=Y++,this._builderCache=null,this._uniqueId=(0,j.randomHashN)(6),this._resolution=t,this._symbolInfo=e,this._valid=Boolean(e.timezone)&&Boolean(e.session),this._session=new z.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections)}syncSourceTarget(){return{uniqueId:this._uniqueId,resolution:this._resolution,symbolInfo:this._symbolInfo,session:this._session.state()}}getSymbolInfo(){return this._symbolInfo}getSession(){return this._session}getResolution(){return this._resolution}uniqueId(){return this._modelId}distance(e,t){if(!this.isValid())return{
success:!1};if(e>t)return{success:!1};if(e===t)return{success:!0,result:0};let i=this._extrapolatedData.length,s=0!==i?this._extrapolatedData[0]:null,r=null!==s?this._extrapolatedData[i-1]:null;const n=e<t;if(1e3*e===s&&this._cacheForFuture===n||(this._extrapolatedData=[1e3*e],i=1,s=null,r=null),null===s||null!==r&&1e3*t>r){const s=(0,G.extrapolateBarsFrontToTime)(this._barBuilder(),r||1e3*e,1e3*t,2e3,!0);this._extrapolatedData=this._extrapolatedData.concat(s.times),i=this._extrapolatedData.length,this._cacheForFuture=n}if(r=this._extrapolatedData[i-1],r<1e3*t)return{success:!1};const a=this._extrapolatedData.indexOf(1e3*t);return-1===a?{success:!1}:{success:!0,result:a}}projectTime(e,t){if(!this.isValid())return e;let i=this._extrapolatedData.length,s=i>0?this._extrapolatedData[0]:null,r=null!==s?this._extrapolatedData[i-1]:null;const n=t>=0;1e3*e===s&&this._cacheForFuture===n||(this._extrapolatedData=[1e3*e],i=1,s=null,r=null);const a=Math.abs(t);if(null===s||a>=i){const s=(0,G.extrapolateBarsFrontByCount)(this._barBuilder(),r||1e3*e,Math.sign(t)*(a-i+1),!0);this._extrapolatedData=this._extrapolatedData.concat(s.times),i=this._extrapolatedData.length,this._cacheForFuture=n}return i<a?e:this._extrapolatedData[a]/1e3}isValid(){return this._valid}dataSize(){return this._extrapolatedData.length}createNewModelWithResolution(e){return new q(this._symbolInfo,e)}_barBuilder(){return null===this._builderCache&&(this._builderCache=(0,z.newBarBuilder)(this._resolution,this._session,this._session)),this._builderCache}}var X=i(62325),K=i.n(X),$=i(41926),J=i(81967),Z=i(99177);const Q=(0,o.getLogger)("Chart.Definitions.Series");function ee(e,t){const i=[];return(0,J.isDelay)(e.delay)?function(e){const t=[];return(0,J.witoutRealtime)(e)?t.push("DelayNoRealtime"):(0,J.isDelayForGuest)("MOEX",e)?t.push("MOEXDelayForGuest"):(0,J.isDelayForGuest)("TFEX",e)?t.push("TFEXDelayForGuest"):(0,J.isDelayForGuest)("CHIXAU",e)?t.push("CHIXAuDelayForGuest"):(0,J.isDelayForGuest)("NGM",e)?t.push("NGMDelayForGuest"):(0,J.isDelayForGuest)("ICESG",e)?t.push("ICESGDelayForGuest"):["BER","DUS","HAM","HAN","MUN"].some(t=>(0,J.isDelayForGuest)(t,e))?t.push("DEForGuest"):["LSE","LSIN","MIL"].some(t=>(0,J.isDelayForGuest)(t,e))?t.push("LSEDelayForGuest"):(0,J.isDelayWithoutMarketAgreement)(e)?t.push("DelayWithoutMarketAgreement"):t.push("DelayToRealtime"),t}(e):(0,J.isEod)(e,t)?(i.push("EOD"),i):((0,J.isTickByTick)(e,t)&&i.push("TickByTick"),(0,J.isBats)(e)&&i.push("BATSToRealtime"),i)}class te{constructor(e,t,i){this._dataUpdatedModeStatus=new(K())(null),this._symbolInfo=(0,$.createWVFromGetterAndSubscription)(e.getter,e.onChange),this._status=(0,$.createWVFromGetterAndSubscription)(t.getter,t.onChange),this._symbolInfo.subscribe(this._update.bind(this)),this._status.subscribe(this._update.bind(this)),this._resetSubscription=i,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._symbolInfo.destroy(),this._status.destroy(),this._resetSubscription.unsubscribeAll(this)}status(){return this._dataUpdatedModeStatus.readonly()}symbolName(){
const e=this._symbolInfo.value();return null!==e?e.name:""}time(){const e=this._symbolInfo.value(),t=null!==e&&e.delay&&e.delay>0?e.delay:900;return Math.round(t/60)}listedExchange(){const e=this._symbolInfo.value();return null!==e?e.listed_exchange:""}async description(){const e=this._symbolInfo.value();if(null===e)return"";let t={};try{t=(0,s.ensureNotNull)(await(0,J.getExchange)(e))}catch(e){Q.logWarn("Cannot get exchange "+(0,Z.errorToString)(e))}return t.description||e.listed_exchange}exchange(){const e=this._symbolInfo.value();return null!==e?e.exchange:""}firstReplacedByBatsExchange(){const e=this._symbolInfo.value();return e&&(0,J.firstReplacedByBatsExchange)(e)}_resetStatus(){this._dataUpdatedModeStatus.setValue(null)}_update(){const e=this._symbolInfo.value();if(null===e)return void this._dataUpdatedModeStatus.setValue(null);const t=this._status.value();if("string"==typeof t)return void this._dataUpdatedModeStatus.setValue(null);if(t===m.STATUS_LOADING||t===m.STATUS_RESOLVING)return;const i=ee(e,t);0!==i.length?this._dataUpdatedModeStatus.setValue(i):this._dataUpdatedModeStatus.setValue(null)}}var ie=i(57380),se=i(70617);class re{constructor(e,t){this._dataProblem=new ie.WatchedObject(null),this._quotesProvider=e,this._quotesProvider.quotesUpdate().subscribe(this,this._update.bind(this)),this._resetSubscription=t,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._resetSubscription.unsubscribeAll(this)}status(){return this._dataProblem}_resetStatus(){this._dataProblem.setValue(null)}_update(e){void 0===e.values||void 0===e.values.data_problem?this._resetStatus():this._dataProblem.setValue((0,se.clone)(e.values.data_problem))}}var ne=i(56074),ae=i(21386),oe=i(98424),le=i(26281),he=i(93987);function de(e){return e<10?"0"+e:e.toString()}function ue(e,t=Date.now()/1e3){let i=Math.ceil(e-t);if(i<=0)return"";if(i<3600){const e=Math.floor(i/60),t=Math.ceil(i%60);return`${de(e)}:${de(t)}`}if(i<86400){const e=Math.floor(i/3600);i%=3600;const t=Math.floor(i/60);i%=60;const s=Math.ceil(i);return`${de(e)}:${de(t)}:${de(s)}`}{const s=new Date(1e3*e),r=new Date(1e3*t),n=he.get_year(s),a=he.get_year(r),o=he.get_month(s),l=he.get_month(r),h=he.get_day_of_month(r),d=ce(s)-ce(r)>=0?0:-1;let u=12*(n-a)+(o-l)+d;if(u>0){const t=he.get_days_in_month(l,a);!function(e,t){const i=he.get_day_of_month(e);e.setUTCMonth(he.get_month(e)+t),he.get_day_of_month(e)!==i&&e.setUTCDate(0)}(r,u);const i=he.get_days_in_month(he.get_month(r),he.get_year(r)),s=h!==t&&i===he.get_day_of_month(r)?t-h:0;let n=Math.ceil((e-r.getTime()/1e3)/86400)+s;return n>=i&&(u++,n=0),`${u}M ${n}d`}if(-1===d){if(he.get_days_in_month(l,a)-i/86400<1/24)return"1M 0d"}let c=Math.floor(i/86400);i%=86400;let _=Math.ceil(i/3600);return 24===_&&(_=0,c+=1),c===he.get_days_in_month(o,n)?"1M 0d":`${c}d ${_}h`}}function ce(e){return 86400*e.getUTCDate()+3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()}var _e=i(43615);const pe=[0,1,2,3,9,8,10],me=g.enabled("force_exchange_as_title"),ye={
alwaysShowGlobalLast:!1,visibleOnHistoryOnly:!1,showCountdown:!0,showSymbolLabel:!0};class fe extends oe.PriceAxisView{constructor(e,t,i){super(),this._previousCountdown="",this._source=e,this._model=t,this._options={...ye,...i}}updateCountdown(){this._countdownText()!==this._previousCountdown&&(this.update(),this._model.updateSourcePriceScale(this._source))}_getSource(){return this._source}_getModel(){return this._model}_isCountdownEnabled(){return this._options.showCountdown}_countdownText(){{const e=this._source.barCloseTime();return null===e?"":ue(e,this._currentTime()/1e3)}}_updateRendererData(e,t,i){if(e.visible=!1,t.visible=!1,!this._source.isVisible())return;const s=this._source.properties().childs();if(12===s.style.value())return;const r=this._model.timeScale().visibleBarsStrictRange(),n=this._source.data().last();if(null===r||null===n)return;if(this._options.visibleOnHistoryOnly&&r.contains(n.index))return;const a=this._model.properties().childs().scalesProperties.childs();let o=a.showSeriesLastValue.value(),l=this._isCountdownEnabled()&&-1!==pe.indexOf(s.style.value())&&s.showCountdown.value()&&(this._options.alwaysShowGlobalLast||r.contains(n.index)),h=this._options.showSymbolLabel&&a.showSymbolLabels.value();const d=a.seriesLastValueMode.value()===le.PriceAxisLastValueMode.LastPriceAndPercentageValue,u=this._source.lastValueData(void 0,this._options.alwaysShowGlobalLast);if(u.noData)return;const c=8===s.style.value();if((o||l||h)&&c&&s.haStyle.childs().showRealLastPrice.value()){const e=this._source.lastValueData(void 0,!1),t=this._source.lastValueData(void 0,!0);e.noData||t.noData||e.index!==t.index||(o=!1,l=!1,h=!1)}if(o||l){const t=this._axisFirstLineText(u,o);e.text=t,i.textColor=this.generateTextColor(i.background),e.textColor=i.textColor;const s=o&&d?(0,_e.getOppositeModePriceText)(this._source.priceScale(),u):"";e.secondLine=s,i.secondLineTextColor=i.textColor;const r=l?this._countdownText():"";this._previousCountdown=r,e.thirdLine=r,i.thirdLineTextColor=(0,ae.generateColor)(i.textColor,25),0===t.length&&0===s.length&&0===r.length||(e.visible=!0)}h&&(t.text=this._paneText(h),t.visible=t.text.length>0),i.background=this._source.priceLineColor(u.color),i.coordinate=u.coordinate,i.floatCoordinate=u.floatCoordinate}_paneText(e){let t="";const i=this._source.symbolInfo();return me?t=(0,_.displayedSymbolExchange)(i):e&&(t=(0,_.displayedSymbolName)(i)),t}_axisFirstLineText(e,t){return t?(0,_e.getCurrentModePriceText)(this._source.priceScale(),e):""}_currentTime(){return Date.now()+1e3*this._source.serverTimeOffset()}}var ge=i(36643),Se=i(25226),be=i(75203);class ve extends oe.PriceAxisView{constructor(e,t){super(),this._source=e,this._model=t}_updateRendererData(e,t,i){e.visible=!1;const s=this._source;if(!this._model.properties().childs().scalesProperties.childs().showSeriesPrevCloseValue.value())return;if(s.isDWM())return;const r=s.prevClose();if(null===r)return;const n=this._source.properties().childs().prevClosePriceLineColor.value();i.background=n,i.textColor=this.generateTextColor(n),
i.coordinate=r.coordinate,e.text=(0,_e.getCurrentModePriceText)(s.priceScale(),r),e.visible=!0}}var we=i(6059),Pe=i(45185);class xe extends we.SeriesHorizontalLinePaneView{constructor(e){super(e),this._lineRendererData.linestyle=Pe.LINESTYLE_DOTTED}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.properties().childs();if(!e.showPrevClosePriceLine.value())return;if(this._series.isDWM())return;const t=this._series.prevClose();null!==t&&(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=e.prevClosePriceLineColor.value(),this._lineRendererData.linewidth=e.prevClosePriceLineWidth.value())}}var Ie=i(67850);class Ce extends fe{lastPrice(){return this._getSource().data().lastProjectionPrice}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._getModel(),n=this._getSource(),a=n.priceScale(),o=r.timeScale(),l=this.lastPrice();if(o.isEmpty()||a.isEmpty()||void 0===l)return;const d=o.visibleBarsStrictRange();if(null===d)return;const u=d.firstBar(),c=d.lastBar(),_=n.data(),p=_.search(c,h.PlotRowSearchMode.NearestLeft);if(null===p)return;const m=n.nearestIndex(u,h.PlotRowSearchMode.NearestRight);if(void 0===m)return;const y=n.model().properties().childs().scalesProperties.childs(),f=(0,s.ensureNotNull)(_.valueAt(m))[4];let g=i.background,S=y.showSeriesLastValue.value(),b=!1,v=!1,w=!1;const P=n.lastValueData(4,!1),x=n.properties().childs();if(8===x.style.value()&&x.haStyle.childs().showRealLastPrice.value()){const e=n.lastValueData(4,!0);if(e.noData||e.color===i.background||(g=e.color),!e.noData&&!P.noData){const t=e.index===P.index;b=t&&y.showSymbolLabels.value(),v=y.seriesLastValueMode.value()===le.PriceAxisLastValueMode.LastPriceAndPercentageValue,S=S&&t,w=t&&this._isCountdownEnabled()&&x.showCountdown.value()}}else{g=n.barColorer().barStyle(p.index,!0).barColor}if(i.background=g,i.textColor=this.generateTextColor(g),i.secondLineTextColor=i.textColor,i.thirdLineTextColor=(0,ae.generateColor)(i.textColor,25),i.coordinate=a.priceToCoordinate(l,f),e.visible=S||w,!P.noData){const i=n.priceScale().isPercentage();P.formattedPriceAbsolute=a.formatPriceAbsolute(l),P.formattedPricePercentage=a.formatPricePercentage(l,f,!0),P.text=i?P.formattedPricePercentage:P.formattedPriceAbsolute,e.text=this._axisFirstLineText(P,S),e.secondLine=S&&v?i?P.formattedPriceAbsolute:P.formattedPricePercentage:"",e.thirdLine=w?this._countdownText():"",t.text=this._paneText(b)}t.visible=b}}var Te=i(13648),Ve=i(50985),Ae=i(91055);const Me={light:{lineStyle:Pe.LINESTYLE_DOTTED,lineWidth:1,textColor:Ae.colorsPalette["color-cold-gray-900"],backgroundColor:Ae.colorsPalette["color-tv-blue-50"],lineColor:Ae.colorsPalette["color-cold-gray-500"]},dark:{lineStyle:Pe.LINESTYLE_DOTTED,lineWidth:1,textColor:Ae.colorsPalette["color-white"],backgroundColor:Ae.colorsPalette["color-tv-blue-a800"],lineColor:Ae.colorsPalette["color-cold-gray-500"]}};function Le(e){return e?Me.dark:Me.light}class Re extends Ve.HorizontalLinePaneView{constructor(e,t,i){super(),this._model=e,this._isVisible=t,
this._getValue=i}_updateImpl(){const e=this._lineRendererData;if(e.visible=!1,!this._isVisible.value())return;const t=this._model.mainSeries(),i=t.priceScale(),s=t.firstValue(),r=this._getValue();if(null===s||null===r)return;const n=Le(this._model.isDark());e.visible=!0,e.y=i.priceToCoordinate(r,s),e.linestyle=n.lineStyle,e.linewidth=n.lineWidth,e.color=n.lineColor}}class De extends oe.PriceAxisView{constructor(e,t,i,s){super(),this._model=e,this._label=t,this._isVisible=i,this._getValue=s}_updateRendererData(e,t,i){if(e.visible=!1,t.visible=!1,!this._isVisible.value())return;const s=this._model.mainSeries(),r=s.priceScale(),n=s.firstValue(),a=this._getValue();if(null===n||null===a)return;const o=Le(this._model.isDark());e.visible=!0,t.visible=!0,e.text=r.formatPriceAbsolute(a),t.text=this._label,i.coordinate=r.priceToCoordinate(a,n),i.background=o.backgroundColor,i.textColor=o.textColor}}class Ee extends Ie.PriceLineAxisView{constructor(e,t,i){super(),this._model=e,this._isLineVisible=t,this._getValue=i}_isVisible(){return this._isLineVisible.value()}_lineWidth(){return Le(this._model.isDark()).lineWidth}_lineStyle(){return Le(this._model.isDark()).lineStyle}_priceLineColor(e){return Le(this._model.isDark()).lineColor}_value(){const e=this._model.mainSeries(),t=e.priceScale(),i=e.firstValue(),s=this._getValue();if(null===i||null===s)return{noData:!0};const r=t.priceToCoordinate(s,i);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",formattedPriceIndexedTo100:"",text:"",index:0}}}const Be=(0,Se.isFeatureEnabled)("remove_average_label_and_line"),ke=(0,f.t)("High"),Oe=(0,f.t)("Low"),Ne=(0,f.t)("Avg");function Fe(e,t,i,s,r,n){const a=new Re(e,r,n),o=new De(e,i,s,n);return{paneView:a,panePriceAxisView:new Te.PanePriceAxisView(o,t,e),priceAxisView:o,priceLineAxisView:new Ee(e,r,n)}}var We=i(97639),He=i.n(We),Ue=i(6342),ze=i(15693),Ge=i(86441);class je{constructor(){this._data=null}setData(e){this._data=e}data(){return this._data}draw(e,t){const i=this._data;if(null===i)return;const s=t.pixelRatio;e.save();const r=Math.max(1,Math.floor(s)),n=r%2/2,a=Math.round(i.center.x*s)+n,o=i.center.y*s;e.fillStyle=i.seriesLineColor,e.beginPath();const l=Math.max(2,1.5*i.seriesLineWidth)*s;e.arc(a,o,l,0,2*Math.PI,!1),e.fill(),e.fillStyle=i.fillColor,e.beginPath(),e.arc(a,o,i.radius*s,0,2*Math.PI,!1),e.fill(),e.lineWidth=r,e.strokeStyle=i.strokeColor,e.beginPath(),e.arc(a,o,i.radius*s+r/2,0,2*Math.PI,!1),e.stroke(),e.restore()}hitTest(e,t){return null}}function Ye(e){return e}const qe=[{start:0,end:.25,startRadius:4,endRadius:10,startFillAlpha:.25,endFillAlpha:0,startStrokeAlpha:.4,endStrokeAlpha:.8,easing:Ye},{start:.25,end:.525,startRadius:10,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:.8,endStrokeAlpha:0,easing:Ye},{start:.525,end:1,startRadius:14,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:0,endStrokeAlpha:0,easing:Ye}];function Xe(e,t,i,s){const r=i+(s-i)*t;return(0,ae.applyTransparency)(e,(0,ae.alphaToTransparency)(r))}
function Ke(e,t){const i=e%2600/2600;let s;for(const e of qe)if(i>=e.start&&i<=e.end){s=e;break}if(void 0===s)throw new Error("Last price animation internal logic error");const r=s.easing((i-s.start)/(s.end-s.start));return{fillColor:Xe(t,r,s.startFillAlpha,s.endFillAlpha),strokeColor:Xe(t,r,s.startStrokeAlpha,s.endStrokeAlpha),radius:(n=r,a=s.startRadius,o=s.endRadius,a+(o-a)*n)};var n,a,o}class $e{constructor(e){this._renderer=new je,this._invalidated=!0,this._stageInvalidated=!0,this._startTime=performance.now(),this._endTime=this._startTime-1,this._series=e}update(e){if(this._invalidated=!0,e){const e=performance.now(),t=this._endTime-e;if(t>0)return void(t<650&&(this._endTime+=2600));this._startTime=e,this._endTime=e+2600}}invalidateStage(){this._stageInvalidated=!0}animationActive(){return performance.now()<=this._endTime}stopAnimation(){this._endTime=this._startTime-1}renderer(e,t){return this._invalidated?(this._updateImpl(e,t),this._invalidated=!1,this._stageInvalidated=!1):this._stageInvalidated&&(this._updateRendererDataStage(),this._stageInvalidated=!1),this._renderer}_updateImpl(e,t){this._renderer.setData(null);const i=this._series.model().timeScale(),s=i.visibleBarsStrictRange(),r=this._series.firstValue(),n=this._series.lastValueData(void 0,!0,!0);if(null===s||null===r||void 0===n.index||void 0===n.price||!s.contains(n.index))return;const a=new Ge.Point(i.indexToCoordinate(n.index),this._series.priceScale().priceToCoordinate(n.price,r)),o=n.color,l=this._series.properties().childs();let h;switch(this._series.style()){case 3:h=l.areaStyle.childs().linewidth.value();break;case 10:const t=l.baselineStyle,i=Math.round(e*(Math.abs(100-t.childs().baseLevelPercentage.value())/100));h=a.y<=i?t.childs().topLineWidth.value():t.childs().bottomLineWidth.value();break;default:h=l.lineStyle.childs().linewidth.value()}const d=Ke(this._duration(),o);this._renderer.setData({seriesLineColor:o,seriesLineWidth:h,fillColor:d.fillColor,strokeColor:d.strokeColor,radius:d.radius,center:a})}_updateRendererDataStage(){const e=this._renderer.data();if(null!==e){const t=Ke(this._duration(),e.seriesLineColor);e.fillColor=t.fillColor,e.strokeColor=t.strokeColor,e.radius=t.radius}}_duration(){return this.animationActive()?performance.now()-this._startTime:2599}}var Je=i(88230),Ze=i(80372),Qe=i(8803),et=i(64019);const tt=g.enabled("price_scale_always_last_bar_value"),it=g.enabled("display_data_mode"),st=r.CheckMobile.any(),rt=!(0,r.onWidget)()&&(0,Se.isFeatureEnabled)("legend_branding"),nt=!g.enabled("hide_series_legend_item"),at=g.enabled("hide_price_scale_global_last_bar_value"),ot=(0,o.getLogger)("Chart.Series"),lt={countdownEnabled:!0,lastPriceAnimationEnabled:!0};class ht extends l.PriceDataSource{constructor(e,t,i,r){super(e,"_seriesId"),this.chartWidgetInitialized=new(He()),this.requestingIntradayWhenNotSupported=new(He()),this.requestingResolutionWhenNotSupported=new(He()),this.requestingStyleIsNotSupported=new(He()),this.requestingStyleSupportRecovered=new(He()),this._paneView=null,this._priceStep=null,
this._symbolInfo=null,this._prevSymbolInfo=null,this._isPrePostMarketPricesAvailableProperty=new(c())(!1),this._isBackAdjustmentForbiddenProperty=new(c())(!0),this._isSettlementAsCloseForbiddenProperty=new(c())(!0),this._highLowAvgPriceCache=new Map,this._prevClosePriceAxisView=null,this._priceScaleChanged=new(He()),this._priceScaleAboutToBeChanged=new(He()),this._onRestarted=new(He()),this._onStatusChanged=new(He()),this._extendedHoursChanged=new(He()),this._tagsChanged=new(He()),this._intervalChanged=new(He()),this._sessionIdChanged=new(He()),this._currency=null,this._unit=null,this._endOfData=!1,this._lineStyleLastPriceCirclePaneView=new $e(this),this._prevClosePriceLineView=null,this._dataPoweredBy=null,this._loading=!0,this._seriesLoaded=!1,this._status=0,this._symbolResolvingActive=new(K())(!1),this._predictBars=0,this._syncModel=null,this._data=null,this._haStyle={studyId:(0,s.ensureNotNull)((0,_.chartStyleStudyId)(8,!0))},this._renkoStyle={studyId:(0,s.ensureNotNull)((0,_.chartStyleStudyId)(4,!0))},this._pbStyle={studyId:(0,s.ensureNotNull)((0,_.chartStyleStudyId)(7,!0))},this._kagiStyle={studyId:(0,s.ensureNotNull)((0,_.chartStyleStudyId)(5,!0))},this._pnfStyle={studyId:(0,s.ensureNotNull)((0,_.chartStyleStudyId)(6,!0))},this._rangeStyle={studyId:(0,s.ensureNotNull)((0,_.chartStyleStudyId)(11,!0))},this._boxSizeValue=new(K()),this._base=100,this._pointValue=1,this._formatter=new p.PriceFormatter(this._base),this._ignoreMinMoveFormatter=new p.PriceFormatter(this._base),this._ignoreMinMovePriceStep=null,this._lastBarCloseTime=null,this._onSessionIdPropertyChangedBound=this._onSessionIdPropertyChanged.bind(this),this._ignoreSessionIdProxyPropertyChanges=!1,this._textSourceIsAlwaysTickerRestrictionEnabled=!1,this._lastPriceAnimationActive=!1,this._currentSession="out_of_session",this._onStyleChanged=new(He()),this._preventRestartOnChartStyleChange=!1,this._intervalObj=null,this._obsoleteZOrder=0,this._seriesErrorMessage=null,this._seriesAlwaysFalseHibernatedVW=new(K())(!1),this._styleToRecover=null,this._seriesSource=new Ze.SeriesDataSource(e.chartApi(),"s",r);const n=this._seriesSource.dataEvents();n.symbolResolved().subscribe(this,this._onSymbolResolved),n.symbolError().subscribe(this,this._onSymbolError),n.seriesTimeFrame().subscribe(this,this._onSeriesTimeFrame),n.seriesError().subscribe(this,this._onSeriesError),n.loading().subscribe(this,this._onSeriesLoading),n.completed().subscribe(this,this._onSeriesCompleted),n.dataUpdated().subscribe(this,this._onDataUpdated),n.barReceived().subscribe(this,this._onBarReceived),this._quotesProvider=new ne.QuotesProvider,this._quotesProvider.quotesUpdate().subscribe(this,this._onQuotesUpdate);const a=t.childs();if(t.hasChild("extendedHours")){(0,s.ensureDefined)(a.extendedHours).value()&&!t.hasChild("sessionId")&&t.addChild("sessionId",new(c())("extended")),t.removeProperty("extendedHours")}t.hasChild("sessionId")||t.addChild("sessionId",new(c())("regular")),this._setProperties(t),this._sessionIdProxyProperty=new(c())(a.sessionId.value()),
a.sessionId.subscribe(this,()=>this._updateSessionIdProxyProperty()),this._sessionIdProxyProperty.subscribe(this,this._onSessionIdProxyPropertyChanged),this._symbolTextSourceProxyProperty=new(c()),this._recalcSymbolTextSourceProxyProperty(),a.statusViewStyle.childs().symbolTextSource.subscribe(this,this._recalcSymbolTextSourceProxyProperty),this._symbolTextSourceProxyProperty.subscribe(this,()=>e.lightUpdate()),this._options=(0,se.merge)((0,se.clone)(lt),i),this._prevChartStyle=a.style.value(),this._priceAxisView=new fe(this,e,{alwaysShowGlobalLast:!at,showCountdown:i.countdownEnabled});let o=null;tt||at||(o=new fe(this,e,{visibleOnHistoryOnly:!0,showSymbolLabel:!1,showCountdown:!1,alwaysShowGlobalLast:!1})),this._priceLinePriceAxisView=new Ie.SeriesPriceLineAxisView(this),this._priceLineAxisViews=[this._priceLinePriceAxisView];const l=new Ce(this,e,{showCountdown:i.countdownEnabled});this._priceAxisViews=[this._priceAxisView,l],null!==o&&this._priceAxisViews.push(o),this._prevClosePriceAxisView=new ve(this,e),this._priceAxisViews.unshift(this._prevClosePriceAxisView),this._prevClosePriceLineView=new xe(this),this._panePriceAxisView=new Te.PanePriceAxisView(this._priceAxisView,this,e),this._historyPricePanePriceAxisView=null!==o?new Te.PanePriceAxisView(o,this,e):null,this._projectionPriceAxisView=new Te.PanePriceAxisView(l,this,e),this._labelPaneViews=[this._panePriceAxisView,this._projectionPriceAxisView],null!==this._historyPricePanePriceAxisView&&this._labelPaneViews.push(this._historyPricePanePriceAxisView),this._highLowAvgPaneViews=[],this._createHighLowAvgViews(),this._subscribeRestartToSessionIdChange(),a.visible.subscribe(this,this._updateLastPriceAnimationActive),this._updateLastPriceAnimationActive(),this._dataWindowView=new E(this,e),this._legendView=new F(this,e);const h={branding:rt};this._statusView=new C(this,this._model.properties().childs().scalesProperties.childs().textColor,a.statusViewStyle,h),this._marketStatusModel=new W.MarketStatusModel(this._quotesProvider,a.symbol.listeners()),this._dataUpdatedModeModel=it?new te({getter:this.symbolInfo.bind(this),onChange:n.symbolResolved()},{getter:this.status.bind(this),onChange:this._onStatusChanged},a.symbol.listeners()):null,this._dataProblemModel=new re(this._quotesProvider,a.symbol.listeners()),a.backAdjustment.subscribe(this,()=>{this.isStarted()&&this.restart()}),a.settlementAsClose.subscribe(this,()=>{this.isDWM()&&this.isStarted()&&this.restart()}),this._symbolResolvingActive.subscribe(()=>e.realignLineTools()),this._intervalChanged.subscribe(this,()=>e.realignLineTools())}seriesErrorMessage(){return this._seriesErrorMessage}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._model.timeScale().visibleBarsStrictRangeChanged().unsubscribeAll(this),this._unsubscribeRestartToSessionIdChange()}properties(){return this._properties}zorder(){return 0}quotesProvider(){return this._quotesProvider}currentSession(){return this._currentSession}syncModel(){if(!this._syncModel){const e=this.symbolInfo(),t=this.interval()
;if(!e||!t)return null;this._syncModel=new q(e,t)}return this._syncModel}labelPaneViews(){return this._labelPaneViews}topPaneViews(){if(this._lastPriceAnimationActive){const e=this._lineStyleLastPriceCirclePaneView;return e.animationActive()&&setTimeout(()=>this._model.invalidate(Je.InvalidationMask.cursor()),0),e.invalidateStage(),[e]}return null}priceAxisViews(e,t){return e.findTargetPriceAxisViews(this,t,this._priceAxisViews,this._priceLineAxisViews)}clearHighLowAvgPriceCache(){this._highLowAvgPriceCache.clear()}priceScaleChanged(){return this._priceScaleChanged}priceScaleAboutToBeChanged(){return this._priceScaleAboutToBeChanged}disconnect(){this._seriesSource.stop(),this.m_symbol=void 0,this._predictBars=0,this._status=0,this._model.isSnapshot()||(this._prevSymbolInfo=null,this._symbolInfo=null)}isStatusBad(){return 12===this.status()||4===this.status()||10===this.status()}isStatusError(){return 12===this.status()}actualSymbol(){return(0,_.actualSymbol)(this.symbolInfo(),this.symbol())}proSymbol(){return(0,_.proSymbol)(this.symbolInfo(),this.symbol())}onStyleChanged(){return this._onStyleChanged}style(){return this.properties().childs().style.value()}setStyle(e){this.setSymbolParams({style:e})}symbolSameAsCurrent(e){return(0,Ue.symbolSameAsCurrent)(e,this.m_symbol,this.symbolInfo())}status(){return this._status}symbolInfo(){return this._symbolInfo}symbolResolved(){return this.dataEvents().symbolResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._seriesAlwaysFalseHibernatedVW}formatter(e=!0){return e?this._formatter:this._ignoreMinMoveFormatter}priceStep(e=!0){return e?this._priceStep:this._ignoreMinMovePriceStep}interval(){return this.properties().childs().interval.value()}setInterval(e){this.setSymbolParams({interval:e})}intervalObj(){const e=this.interval();if(null!==this._intervalObj&&this._intervalObj.resolutionString===e)return this._intervalObj.interval;const t=U.Interval.parse(e);return this._intervalObj={resolutionString:e,interval:t},t}prevClose(){const e=this.priceScale();if(e.isEmpty()||this.data().isEmpty())return null;const t=this.quotes(),i=this.firstValue();if(null===t||null===i)return null;const s=t.prev_close_price;return void 0===s?null:{coordinate:e.priceToCoordinate(s,i),floatCoordinate:e.priceToCoordinate(s,i),formattedPricePercentage:e.formatPricePercentage(s,i,!0),formattedPriceAbsolute:e.formatPriceAbsolute(s),formattedPriceIndexedTo100:e.formatPriceIndexedTo100(s,i)}}hasClosePrice(){return 12!==this.properties().childs().style.value()}lastValueData(e,t,i){const s={noData:!0},r=this.priceScale();if(this.model().timeScale().isEmpty()||r.isEmpty()||this.data().isEmpty())return s;const n=this.model().timeScale().visibleBarsStrictRange(),a=this.firstValue();if(null===n||null===a)return s;let o,l;if(t){const e=this.data().bars().last();if(null===e)return s;o=e.value,l=e.index}else{const e=this.data().bars().search(n.lastBar(),h.PlotRowSearchMode.NearestLeft);if(null===e)return s;o=e.value,l=e.index}
const d=void 0!==e?o[e]:this._barFunction(o),u=this.barColorer().barStyle(l,!1),c=r.priceToCoordinate(d,a),_={...r.getFormattedValues(d,a,!0),noData:!1,color:u.barColor,floatCoordinate:c,coordinate:c,index:l};return i&&(_.price=d),_}isDWM(){return this.intervalObj().isDWM()}data(){var e;return null!==(e=this._data)&&void 0!==e?e:this._seriesSource.data()}clearData(){(0,s.assert)(null===this._data,"Cannot clear loaded data"),this._seriesSource.clearData()}nearestValue(e,t,i){const s=this.nearestData(e,i);return s?s.value[t]:void 0}onIntervalChanged(){return this._intervalChanged}onStatusChanged(){return this._onStatusChanged}onRestarted(){return this._onRestarted}onExtendedHoursChanged(){return this._extendedHoursChanged}sessionId(){return this.properties().childs().sessionId.value()}sessionIdChanged(){return this._sessionIdChanged}autoScaleInfo(e,t){const i=this.priceRange(e,t);if(null===this._paneView)return{range:i};const s=this._paneView;return{range:i,topPixelMargin:s.topPixelMargin?s.topPixelMargin():void 0,bottomPixelMargin:s.bottomPixelMargin?s.bottomPixelMargin():void 0}}onChartStyleChanged(){var e;this._updateBarFunction(),!this._preventRestartOnChartStyleChange&&this.isNeedRestart()&&(this.data().clear(),this.model().timeScale().scrollToRealtime(!1),this.isInReplay()&&!this.isStyleSupportedForReplay(this.style())&&this._removeReplaySubscriber(),this.restart());const t=this.properties();this._prevChartStyle=t.childs().style.value(),this._onStyleChanged.fire(t.childs().style.value()),this.invalidateBarStylesCache(),this._updateLastPriceAnimationActive(),(null===(e=this._styleToRecover)||void 0===e?void 0:e.originalStyle)!==this.style()&&(this._styleToRecover=null)}setChartStyleWithIntervalIfNeeded(e,t){const i=this.interval(),s=null!=t?t:(0,et.getResolutionByChartStyle)(e,i,this._model.defaultResolutions()),r=U.Interval.isEqual(s,i);this.setSymbolParams({interval:r?void 0:s,style:e})}styleStudyInfos(){return{haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle}}sessionIdProxyProperty(){return this._sessionIdProxyProperty}symbolTextSourceProxyProperty(){return this._symbolTextSourceProxyProperty}setTextSourceIsAlwaysTickerRestrictionEnabled(e){this._textSourceIsAlwaysTickerRestrictionEnabled=e,this._recalcSymbolTextSourceProxyProperty()}isPrePostMarketPricesAvailableProperty(){return this._isPrePostMarketPricesAvailableProperty}isSettlementAsCloseForbiddenProperty(){return this._isSettlementAsCloseForbiddenProperty}isBackAdjustmentForbiddenProperty(){return this._isBackAdjustmentForbiddenProperty}dataWindowView(){return this._dataWindowView}statusView(){return nt?this._statusView:null}legendView(){return this._legendView}marketStatusModel(){return this._marketStatusModel}dataUpdatedModeModel(){return this._dataUpdatedModeModel}dataProblemModel(){return this._dataProblemModel}quotes(){return this.data().isEmpty()?null:this._quotesProvider.quotes()}base(){return this._base}pointValue(){return this._pointValue}
barCloseTime(){return this._lastBarCloseTime}barFunction(){return this._barFunction}setSymbolParams(e){const{symbol:t,interval:i,currency:s,unit:r,style:n}=e,a=this.properties().childs(),o=void 0!==t&&t!==a.symbol.value(),l=void 0!==s&&s!==a.currencyId.value(),h=void 0!==r&&r!==a.unitId.value(),d=void 0!==i&&i!==a.interval.value(),u=void 0!==n&&n!==a.style.value();o&&a.symbol.setValueSilently(t),l&&a.currencyId.setValueSilently(s),h&&a.unitId.setValueSilently(r),d&&a.interval.setValueSilently(i),u&&a.style.setValueSilently(n),o&&a.symbol.listeners().fire(a.symbol),l&&a.currencyId.listeners().fire(a.currencyId),h&&a.unitId.listeners().fire(a.unitId),d&&a.interval.listeners().fire(a.interval),u&&(o||l||h||d?(this._preventRestartOnChartStyleChange=!0,a.style.listeners().fire(a.style),this._preventRestartOnChartStyleChange=!1):a.style.listeners().fire(a.style))}setSymbol(e){this.setSymbolParams({symbol:e})}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,_.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,_.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}symbolSource(){return this}title(){return this.symbolTitle()}name(){return this.symbolTitle()}symbolTitle(e,t,i="exchange"){let s=this.properties().childs().symbol.value();const r=this.symbolInfo();if(null!==r){const{type:t}=r;s=(0,_.symbolTitle)(r,e,"forex"===t?"exchange":i)}return t?s:`${s}, ${(0,V.translatedIntervalString)(this.properties().childs().interval.value())}`}setObsoleteZOrder(e){this._obsoleteZOrder=e}obsoleteZOrder(){return this._obsoleteZOrder}valuesProvider(){return new k(this,this.model())}statusProvider(e){return new I(this,this._model.properties().childs().scalesProperties.childs().textColor,this.properties().childs().statusViewStyle,e)}open(e){const t=this.data().valueAt(e);return t&&t[1]}high(e){const t=this.data().valueAt(e);return t&&t[2]}low(e){const t=this.data().valueAt(e);return t&&t[3]}close(e){const t=this.data().valueAt(e);return t&&t[4]}moveItem(e,t,i){if(10===this.style()&&0===t){const t=this.priceScale(),i=this.properties().childs().baselineStyle,s=t.height(),r=100-e.y/s*100,n=r<0?0:Math.round(10*r)/10;i.childs().baseLevelPercentage.setValue(Math.max(Math.min(n,100),0))}}endOfData(){return this._endOfData}dataPoweredBy(){return this._dataPoweredBy}boxSizeValue(){return this._boxSizeValue}isUserDeletable(){return!1}changeSymbol(){this.setSymbolIntervalCurrencyDelayed(),this.model().checkLineToolSelection()}changeInterval(){this.setSymbolIntervalCurrencyDelayed()}changeTimeFrame(){(0,n.trackEvent)("GUI","Change timeframe")}onTagsChanged(){return this._tagsChanged}_updateBarFunction(){if(12===this.properties().childs().style.value())this._barFunction=(0,d.barFunction)("low");else{const e=this.priceSource()||"close";this._barFunction=(0,d.barFunction)(e)}}
_setProperties(e){e.hasChild("timeframe")||e.merge({timeframe:""}),e.hasChild("shortName")||e.merge({shortName:""}),e.hasChild("currencyId")||e.addChild("currencyId",new(c())(null)),e.hasChild("unitId")||e.addChild("unitId",new(c())(null)),this._properties=e;const t=e.childs();t.symbol.listeners().subscribe(this,this.changeSymbol),t.interval.listeners().subscribe(this,this.changeInterval),t.currencyId.listeners().subscribe(this,this._changeCurrency),t.unitId.listeners().subscribe(this,this._changeUnit),t.timeframe.listeners().subscribe(this,this.changeTimeFrame),e.subscribe(this,this._onPropertiesChanged)}_updateSessionIdProxyProperty(e){const t=this._properties.childs().sessionId.value();let i=t;if(e){const e=this.symbolInfo();null!==e&&(i=e.subsession_id||t)}this._ignoreSessionIdProxyPropertyChanges=!0,this._sessionIdProxyProperty.setValue(i),this._ignoreSessionIdProxyPropertyChanges=!1}_onSessionIdProxyPropertyChanged(){this._ignoreSessionIdProxyPropertyChanges||this._properties.childs().sessionId.setValue(this._sessionIdProxyProperty.value()),this._updateLastPriceAnimationActive()}_onSymbolResolved(e){this._seriesErrorMessage=null,this._updateSymbolInfo(e,!1),this._model.updateSource(this),this._model.onWidget()||((0,n.trackEvent)("Symbol",e.listed_exchange,e.name),(0,n.trackEvent)("Symbol Type",e.type,e.listed_exchange));const t=e.minmov/e.pricescale,i=this.properties().childs();4===i.style.value()&&i.renkoStyle.childs().inputs.childs().boxSize.value()<t?i.renkoStyle.childs().inputs.merge({boxSize:t}):6===i.style.value()&&i.pnfStyle.childs().inputs.childs().boxSize.value()<t?i.pnfStyle.childs().inputs.merge({boxSize:t}):5===i.style.value()&&i.kagiStyle.childs().inputs.childs().reversalAmount.value()<t&&i.kagiStyle.childs().inputs.merge({reversalAmount:t}),this._checkInterval(),this._checkChartStyle()}_onSymbolError(e){this._setStatus(4),this._loading=!1,this._properties.childs().shortName.setValue(this._properties.childs().symbol.value()),this._model.clearAllStudies(),this.updateAllViews(),this._model.updateSource(this),e!==Qe.permissionDenied&&this._model.resetTimeScale(),this._sendTelemetryCounter("symbol_error",this._getTelemetryAdditionalData(e,!1)),this._symbolResolvingActive.setValue(!1)}_sendTelemetryCounter(e,t){void 0===t&&(t=this._getTelemetryAdditionalData());const i=Object.assign({count:1},{additional:t});be.telemetry.sendChartReport(e,i)}_getTelemetryAdditionalData(e,t){t=void 0===t||t;const i={symbol:this.actualSymbol()};return t&&(i.resolution=this.interval()),void 0!==e&&(i.reason=e),i}_onSeriesLoading(e){this._loading=!0,this._setStatus(2)}_onDataUpdated(e,t){if(this.hasDelayedSymbolIntervalChange()){if(this._willSymbolIntervalCurrencyChanged())return void ot.logNormal("command comes during symbol/interval changing");ot.logNormal("data_update comes when symbol interval delay present but symbol/interval should not be changed")}t?this._endOfData=!1:this._lastPriceAnimationActive&&this._seriesLoaded&&this._lineStyleLastPriceCirclePaneView.update(!0),this._lastBarCloseTime=e&&e.closeTime||null,
this._boxSizeValue.setValue(this.data().boxSize),this._statusView.update(),this.clearHighLowAvgPriceCache();const i=this.model(),r=(0,s.ensureNotNull)(i.paneForSource(this));i.recalculatePane(r),i.updateSource(this)}_setStatus(e){this._status=e,this._statusView.update(),this.model().updateSource(this),this._onStatusChanged.fire()}_willSymbolIntervalCurrencyChanged(){const e=this.properties().childs(),t=this._checkIntervalWillChanged(e.interval.value()),i=this._checkSymbolWillChanged(e.symbol.value()),s=this._checkCurrencyWillChanged(e.currencyId.value()),r=this._checkUnitWillChanged(e.unitId.value());return i||t||s||r}_checkSymbolWillChanged(e){return!this.symbolSameAsCurrent(e)}_checkIntervalWillChanged(e){return!U.Interval.isEqual(this.m_interval,e)}_recreateFormatter(){this._formatter=(0,_.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value()),this._ignoreMinMoveFormatter=(0,_.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value(),!0),this.priceScale()&&this.priceScale().updateFormatter(),this._formatterChanged.fire()}_recreatePriceStep(){const{minMove:e,priceScale:t}=(0,_.getSeriesPriceFormattingState)(this.symbolInfo()),i=e/t;this._ignoreMinMovePriceStep=1/t,this._priceStep!==i&&(this._priceStep=i,this._priceStepChanged.fire())}_recreatePriceFormattingDependencies(){this._recreateFormatter(),this._recreatePriceStep()}_onQuotesUpdate(e,t){if(st){const e=void 0!==t.values.change||void 0!==t.values.change_percent;e&&this._legendView.update();const i=void 0!==t.values.prev_close_price;i&&((0,s.ensureNotNull)(this._prevClosePriceLineView).update(),(0,s.ensureNotNull)(this._prevClosePriceAxisView).update()),(e||i)&&this.model().updateSource(this)}void 0!==e.values.current_session&&e.values.current_session!==this._currentSession&&(this._currentSession=e.values.current_session,this._updateLastPriceAnimationActive())}_updateIsPrePostMarketPricesForbiddenProperty(){const e=(0,_.symbolHasPreOrPostMarket)(this._symbolInfo)&&(this.isDWM()||(0,_.isRegularSessionId)(this.sessionIdProxyProperty().value()));this._isPrePostMarketPricesAvailableProperty.setValue(e)}_updateSettlementAsCloseForbiddenProperty(){var e;const t=this.isDWM()&&Boolean(null===(e=this._symbolInfo)||void 0===e?void 0:e.has_settlement);this._isSettlementAsCloseForbiddenProperty.setValue(!t)}_updateBackAdjustmentForbiddenProperty(){var e;const t=Boolean(null===(e=this._symbolInfo)||void 0===e?void 0:e.has_backadjustment);this._isBackAdjustmentForbiddenProperty.setValue(!t)}_getSymbolForApi(){return(0,_.symbolForApi)(this.symbolInfo()||this._prevSymbolInfo,this.symbol())}_getSymbolObject(){const e=this._getExtendedSymbolObject();if(m.SYMBOL_STRING_DATA.hasOwnProperty(this.properties().childs().style.value())){return{symbol:e,type:this.styleStudyInfo(this.getStyleShortName()+"Style").studyId+"!",inputs:this.getInputsProperties().state()}}return e}_getExtendedSymbolObject(){const e={symbol:this._getSymbolForApi()};null!==this.currency()&&(e["currency-id"]=this.currency());const t=this.unit()
;this._model.unitConversionEnabled()&&null!==t&&(e["unit-id"]=t);{const t=this.properties().childs();e.adjustment=t.dividendsAdjustment.value()?"dividends":"splits",this.isDWM()||(e.session=t.sessionId.value()),t.backAdjustment.value()&&(e.backadjustment="default"),t.settlementAsClose.value()||(e["settlement-as-close"]=!1)}return e}_changeCurrency(){this.setSymbolIntervalCurrencyDelayed(),this.model().checkLineToolSelection(),this._currencyChanged.fire()}_changeUnit(){this._model.unitConversionEnabled()&&(this.setSymbolIntervalCurrencyDelayed(),this.model().checkLineToolSelection()),this._unitChanged.fire()}_checkCurrencyWillChanged(e){return this._currency!==e}_checkUnitWillChanged(e){return this._model.unitConversionEnabled()&&this._unit!==e}_checkInterval(){if(this._symbolInfo&&(U.Interval.isIntraday(this.interval())&&!this._symbolInfo.has_intraday&&this.requestingIntradayWhenNotSupported.fire(),this._symbolInfo.hasOwnProperty("supported_resolutions"))){const e=U.Interval.normalize(this._properties.childs().interval.value());null!==e&&-1===this._symbolInfo.supported_resolutions.indexOf(e)&&this.requestingResolutionWhenNotSupported.fire(this._symbolInfo.supported_resolutions[0])}}_checkChartStyle(){const e=this.style();(0,_.isCloseBasedSymbol)(this.symbolInfo())?(0,_.isSingleValueBasedStyle)(e)||(this.requestingStyleIsNotSupported.fire(),this._styleToRecover={correctedStyle:this.style(),originalStyle:e}):null!==this._styleToRecover&&(this.requestingStyleSupportRecovered.fire(this._styleToRecover.originalStyle),this._styleToRecover=null)}_updateSymbolInfo(e,t){var i;if(this._prevSymbolInfo=t?this._symbolInfo:null,this._symbolInfo=e,e){const t=this._properties.childs();t.shortName.setValue(e.name);const s=(0,_.extractSymbolNameFromSymbolInfo)(e,null!==(i=this.m_symbol)&&void 0!==i?i:null);s&&t.symbol.setValue(s),this._currency=(0,_.symbolCurrency)(e),this._unit=(0,_.symbolUnit)(e,this._model.unitConversionEnabled()),"alwaysOff"===(0,H.currencyUnitVisibilityProperty)().value()||this._currency===t.currencyId.value()&&this._unit===t.unitId.value()||this._model.fullUpdate(),t.currencyId.setValue(this._currency),t.unitId.setValue(this._unit),this._updateSessionIdProxyProperty(!0)}this._base=e?e.pricescale/e.minmov:100,this._pointValue=e&&e.pointvalue||1;const s=(0,ze.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getExtendedSymbolObject());this._quotesProvider.setQuotesSessionSymbol(s),this._marketStatusModel.setSymbolInfo(e),e&&this._recreatePriceFormattingDependencies(),this._statusView.update(),this.priceScale().updateFormatter(),this._symbolResolvingActive.setValue(!e),this._dataPoweredBy=(0,ge.getDataVendorString)(e),this._updateIsPrePostMarketPricesForbiddenProperty(),this._updateBackAdjustmentForbiddenProperty(),this._updateSettlementAsCloseForbiddenProperty()}_createHighLowAvgViews(){const e=this.properties().childs().highLowAvgPrice,t=this._getHighLowAvgPrice.bind(this),i=function(e,t,i,s){const r=i.childs(),n=(0,
O.combineProperty)((e,t)=>e||t,r.highLowPriceLabelsVisible,Be?new(c())(!1):r.averageClosePriceLabelVisible),a=(0,O.combineProperty)((e,t)=>e||t,r.highLowPriceLinesVisible,Be?new(c())(!1):r.averageClosePriceLineVisible),o=Fe(e,t,ke,n,a,()=>s(0)),l=Fe(e,t,Oe,n,a,()=>s(1));if(Be)return{paneViews:[o.paneView,l.paneView],panePriceAxisViews:[o.panePriceAxisView,l.panePriceAxisView],priceAxisViews:[o.priceAxisView,l.priceAxisView],priceLineAxisViews:[o.priceLineAxisView,l.priceLineAxisView]};const h=Fe(e,t,Ne,n,a,()=>s(2));return{paneViews:[o.paneView,l.paneView,h.paneView],panePriceAxisViews:[o.panePriceAxisView,l.panePriceAxisView,h.panePriceAxisView],priceAxisViews:[o.priceAxisView,l.priceAxisView,h.priceAxisView],priceLineAxisViews:[o.priceLineAxisView,l.priceLineAxisView,h.priceLineAxisView]}}(this._model,this,e,t);this._highLowAvgPaneViews.push(...i.paneViews),this._labelPaneViews.push(...i.panePriceAxisViews),this._priceAxisViews.push(...i.priceAxisViews),this._priceLineAxisViews.push(...i.priceLineAxisViews)}_getHighLowAvgPrice(e){if(!this._highLowAvgPriceCache.has(e)){const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return null;const i=this._model.mainSeries().bars(),s=t.firstBar(),r=t.lastBar();if(2===e){const e=function(e,t,i){const s=(0,d.barFunction)("close");let r=0,n=0;for(let a=t;a<=i;a++){const t=e.valueAt(a);null!==t&&(r+=s(t),n++)}return n?r/n:null}(i,s,r);if(null===e)return null;this._highLowAvgPriceCache.set(2,e)}else{const e=function(e,t,i){return e.minMaxOnRangeCached(t,i,[{name:"low",offset:0},{name:"high",offset:0}])}(i,s,r);if(null===e)return null;this._highLowAvgPriceCache.set(1,e.min),this._highLowAvgPriceCache.set(0,e.max)}}return this._highLowAvgPriceCache.get(e)}_onSessionIdPropertyChanged(){this._sessionIdChanged.fire(),this.isDWM()||(this.restart(),this._updateLastPriceAnimationActive())}_subscribeRestartToSessionIdChange(){this.properties().childs().sessionId.subscribe(this,this._onSessionIdPropertyChangedBound)}_unsubscribeRestartToSessionIdChange(){this.properties().childs().sessionId.unsubscribe(this,this._onSessionIdPropertyChangedBound)}_updateLastPriceAnimationActive(){if(!this._options.lastPriceAnimationEnabled)return;const e=this._lastPriceAnimationActive,t=this.properties().childs(),i=t.style.value();if(this._model.isSnapshot()||!t.visible.value()||3!==i&&10!==i&&2!==i)this._lastPriceAnimationActive=!1;else{const e=this.currentSession(),t=!(0,_.isRegularSessionId)(this.sessionIdProxyProperty().value())&&!this.isDWM();this._lastPriceAnimationActive="market"===e||t&&("pre_market"===e||"post_market"===e)}this._lastPriceAnimationActive&&e!==this._lastPriceAnimationActive&&this.model().invalidate(Je.InvalidationMask.cursor())}_onPropertiesChanged(e){const t=this._properties.childs();e!==t.symbol&&e!==t.interval&&e!==t.timeframe&&(this._tagsChanged.fire(),this.createPaneView(),this.updateAllViews(),this.model().updateSource(this),(0,a.emit)("series_properties_changed",this._id))}_recalcSymbolTextSourceProxyProperty(){
this._textSourceIsAlwaysTickerRestrictionEnabled?this._symbolTextSourceProxyProperty.setValue("ticker"):this._symbolTextSourceProxyProperty.setValue(this._properties.childs().statusViewStyle.childs().symbolTextSource.value())}}},4703:(e,t,i)=>{var s=i(97639),r=i(32567),n=i(59270).PriceRange;TradingView.DEFAULT_BAR_COUNT=300,TradingView.TIME_PLOT=0,TradingView.OPEN_PLOT=1,TradingView.HIGH_PLOT=2,TradingView.LOW_PLOT=3,TradingView.CLOSE_PLOT=4,TradingView.ADT_PLOT=6,TradingView.STYLE_PLOT=7;var a=i(88537).ensureNotNull,o=i(46111).SeriesBase,l=i(74715),h=l.SeriesAreaPaneView,d=l.SeriesLinePaneView,u=l.SeriesHollowCandlesPaneView,c=l.SeriesCandlesPaneView,_=l.SeriesBarsPaneView,p=l.SeriesHeikenAshiPaneView,m=l.SeriesBaselinePaneView,y=i(30347).SeriesHiLoPaneView,f=i(56776).SeriesWaterlinePaneView,g=i(11688),S=i(39804),b=S.SeriesRenkoPaneView,v=S.SeriesProjectionRenkoPaneView,w=S.SeriesPriceBreakPaneView,P=S.SeriesProjectionPriceBreakPaneView,x=S.SeriesKagiPaneView,I=S.SeriesProjectionKagiPaneView,C=S.SeriesPnFPaneView,T=S.SeriesProjectionPnFPaneView,V=S.SeriesProjectionRangePaneView,A=!1,{hash:M}=i(90557),L=i(62145).FormattersSerializer,R=i(50979).FutureBarsPaneView,D=i(96159).getSeriesDangerReason,E=i(47527).translateSessionExtendedDescription,B=i(12826).BarsRange,k=i(89627).SeriesBarColorer,O=i(3653).SeriesData,N=i(52280),F=N.PlotRowSearchMode,W=N.mergeMinMax,H=i(45848).trackEvent,U=i(11905).getLogger("Chart.Series"),z=i(95048),G=i(49473),j=i(64019).getServerInterval,Y=i(73044).Interval,q=i(21579).SeriesHorizontalBaseLinePaneView,X=i(50754).SeriesPriceLinePaneView,K=i(98796).deepExtend,$=i(15693).encodeExtendedSymbolOrGetSimpleSymbolString,J=i(51954),Z=i(85055).TIMEFRAMETYPE,Q=i(88230).InvalidationMask,ee=i(49473).isSingleValueBasedStyle;class te extends o{constructor(e,t,i,r){t.removeProperty("currencyId"),super(e,t,i,r),this._symbolIntervalChanged=new s,this.requestingIntradayWhenNotSupported=new s,this.requestingResolutionWhenNotSupported=new s,this._onInReplayStateChanged=new s,this._replayExitedDueUnsupportedInterval=new s,this._replayExitedDueUnavailableForUserInterval=new s,this._onTimeFrameApplied=new s,this._chartApi=e._chartApi,this.createPaneView(),this._replaySubscriber=null,this._isReplayResolutionAvailableForUser=null,this._properties.addExclusion&&(this._properties.addExclusion("visible"),this._properties.addExclusion("currencyId")),this._futureBarsPaneView=null,this.properties().minTick.listeners().subscribe(this,te.prototype._recreateFormatter);var n=this;this.properties().minTick.listeners().subscribe(null,(function(){n._model.fullUpdate()})),this._priceLineView=null,this._baseHorizontalLineView=new q(this),this._gotoDateResultCleared=!1,this._gotoDateView=null,this.bindStyleChange(),this.bindJapChartsInputs(),this._createIsDWMProperty(),this.createDividendsAdjustmentProperty(),this.dividendsAdjustment.listeners().subscribe(this,(function(){this.restart()})),this._dataPoweredBy=null,this._symbolIntervalChanged.subscribe(this,this._checkInterval),
this.properties().showCountdown.listeners().subscribe(this,te.prototype._onChangeShowCountdown),this._onChangeShowCountdown(this.properties().showCountdown),this._recreatePriceFormattingDependencies(),this.properties().lineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().areaStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().baselineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this._updateBarFunction()}isLoading(){return this._loading}isSymbolInvalid(){return this._status===te.STATUS_INVALID_SYMBOL}styleStudyInfo(e){return this.styleStudyInfos()[e]}priceLineColor(e){return this.properties().priceLineColor.value()||e}serverTimeOffset(){return this._chartApi.serverTimeOffset()}_onChangeShowCountdown(e){var t=this;e.value()?this._countdownUpdateTimer=this._model.setInterval((function(){t._priceAxisView.updateCountdown()}),500):(this._model.clearInterval(this._countdownUpdateTimer),delete this._countdownUpdateTimer)}_createIsDWMProperty(){this._isDWMProperty=new r(this.isDWM()),this._onRestarted.subscribe(this,(function(){this._isDWMProperty.setValue(this.isDWM())}))}isDWMProperty(){return this._isDWMProperty}fixLastBar(e){this._futureBarsPaneView||(this._futureBarsPaneView=new R(this.model().timeScale(),this,this.bars().lastIndex(),e))}isPulse(){return this._symbolInfo&&this._symbolInfo.resolutions.length>0}onSymbolIntervalChanged(){return this._symbolIntervalChanged}createPaneView(){this._paneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=this.hasClosePrice()?new X(this):null;var e=this._properties.style.value();switch(e){case te.STYLE_BARS:this._paneView=new _(this,this._model);break;case te.STYLE_CANDLES:this._paneView=new c(this,this._model);break;case te.STYLE_LINE:this._paneView=new d(this,this._model);break;case te.STYLE_AREA:this._paneView=new h(this,this._model);break;case te.STYLE_HEIKEN_ASHI:this._paneView=new p(this,this._model);break;case te.STYLE_HOLLOW_CANDLES:this._paneView=new u(this,this._model);break;case te.STYLE_BASELINE:{this._paneView=new m(this,this._model);const e=this._properties.childs().baselineStyle.childs();this._waterlineView=new f({paneHeight:()=>this.priceScale().height(),color:()=>e.baselineColor.value(),baseLevelPercentage:()=>e.baseLevelPercentage.value()});break}case te.STYLE_HILO:this._paneView=new y(this,this._model)}switch(e){case te.STYLE_RENKO:this._paneView=new b(this,this._model),this._projectionBarsPaneView=new v(this,this._model);break;case te.STYLE_PB:this._paneView=new w(this,this._model),this._projectionBarsPaneView=new P(this,this._model);break;case te.STYLE_KAGI:this._paneView=new x(this,this._model),this._projectionBarsPaneView=new I(this,this._model);break;case te.STYLE_PNF:this._paneView=new C(this,this._model),this._projectionBarsPaneView=new T(this,this._model)}if(e===te.STYLE_RANGE&&(this._paneView=new _(this,this._model),this._projectionBarsPaneView=new V(this,this._model)),
null===this._paneView)throw Error("Unknown chart style assigned: "+e)}_clearStylePlot(e,t){if(0!==e.size()){var i=t||a(e.firstIndex()),s=a(e.lastIndex())+1;e.range(i,s).each((function(e,t){t[TradingView.STYLE_PLOT]=null}))}}invalidateBarStylesCache(e){U.logDebug("Invalidate style cache starting from "+e),this._clearStylePlot(this.bars(),e),this._clearStylePlot(this.nsBars())}invalidateBarColorerCache(){delete this._barColorerCache,this.invalidateBarStylesCache()}barColorer(){if(this._barColorerCache)return this._barColorerCache;for(var e=null,t=this._model.dataSources(),i=t.length-1;i>=0;i--){var s=t[i];if(s.metaInfo&&TradingView.isInherited(s.constructor,TradingView.Study)&&s.hasBarColorer()&&!s.isSourceHidden()){var r=s.barColorer();null===e?e=r:e.pushBackBarColorer(r)}}return null===e?e=new k(this):e.pushBackBarColorer(new k(this)),this._barColorerCache=e,this._barColorerCache}_barsState(e){var t=e.state();return t.data.forEach((function(e){e.value.splice(7,1)})),t}state(e){var t=this===this._model.mainSeries()?"MainSeries":TradingView.className(this.constructor);const i=this.obsoleteZOrder();var s={type:t,id:this.id(),state:this.properties().state(),zorder:i,haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle};return this._symbolInfo&&this._symbolInfo.ticker&&(s.state.symbol=this._symbolInfo.ticker),e&&(s.bars=this._barsState(this.bars()),s.nsBars=this._barsState(this.nsBars()),s.symbolInfo=this._symbolInfo,s.rtPrice=this.data().lastProjectionPrice),s.boxSize=this.data().boxSize,s.reversalAmount=this.data().reversalAmount,this._model.unitConversionEnabled()||delete s.state.unitId,s}restoreState(e,t){t&&this._setStatus(te.STATUS_SNAPSHOT),!this._model.unitConversionEnabled()&&e.state&&delete e.state.unitId,this._properties.mergeAndFire(e.state),this._properties.hasChild("esdBreaksStyle")&&this._properties.removeProperty("esdBreaksStyle"),this._prevChartStyle=this.properties().style.value(),this.createPaneView(),t&&this.restoreData(e.bars,e.nsBars,e.symbolInfo,e.rtPrice,e.boxSize,e.reversalAmount)}alertCreationAvailable(){const e=this.symbolInfo();return this.hasStateForAlert()&&e&&!G.isEconomicsSymbol(e)}hasStateForAlert(){return g.enabled("alerts")}stateForAlert(){var e,t=this===this._model.mainSeries()?"MainSeries":TradingView.className(this.constructor),i=this.idForAlert(),s=this.formatter();s=s?L.serialize(s):null;var r=this.isDWM()?"regular":this.sessionIdProxyProperty().value();if(this._symbolInfo&&this._symbolInfo.subsessions&&this._symbolInfo.subsessions.length>1){var n=this._symbolInfo.subsessions.find((function(e){return e.id===r}));n&&(e=E(n.description))}var a={id:i,uniqueId:i,type:t,proSymbol:this.proSymbol(),actualSymbol:this.actualSymbol(),symbolString:this.getSymbolString(),interval:this.interval(),style:this.properties().style.value(),styleInputs:this.getInputsProperties().state(),sessionId:r,sessionDescription:e,dividendsAdjustment:this.properties().dividendsAdjustment.value(),
backAdjustment:this.properties().backAdjustment.value()&&!this.isBackAdjustmentForbiddenProperty().value(),settlementAsClose:this.properties().settlementAsClose.value()&&!this.isSettlementAsCloseForbiddenProperty().value(),boxSize:this.data().boxSize,reversalAmount:this.data().reversalAmount,isSpread:this.isSpread(),formatter:s},o=D(this);return o&&(a.dangerReason=o),a}idForAlert(){return M(this.getSymbolString()+Y.normalize(this.interval())).toString()}restoreData(e,t,i,s,r,n){this._status=te.STATUS_SNAPSHOT,this._data=new O,this._data.m_bars.restoreState(e),this._data.m_nsBars.restoreState(t),this._updateSymbolInfo(i,!1),this._data.lastProjectionPrice=s,this._data.boxSize=r,r||(this.properties().style.value()===te.STYLE_PNF?this._data.boxSize=this.properties().pnfStyle.inputs.boxSize.value():this.properties().style.value()===te.STYLE_RENKO&&(this._data.boxSize=this.properties().renkoStyle.inputs.boxSize.value())),this._data.reversalAmount=n,n||this.properties().style.value()===te.STYLE_KAGI&&(this._data.reversalAmount=this.properties().kagiStyle.inputs.reversalAmount.value()),this._loading=!1}seriesSource(){return this._seriesSource}_onSeriesTimeFrame(e,t,i,s,r){var n=ee(this.style())?e+.5:e,a=t;if(void 0===r)null!==i&&i.type!==Z.PeriodBack||(a+=this._model.studyAwareDefaultRightOffset());else if(r.applyDefaultRightMargin)a+=this._model.studyAwareDefaultRightOffset();else if(r.percentRightMargin){var o=t-n+1,l=Math.max(0,Math.min(.99,r.percentRightMargin/100));a+=l*o/(1-l)}this._model.setTimeViewport(n,a)}_onSeriesError(e){this._loading=!1;var t=e.error;if(e.ctx){var i={};Object.entries(e.ctx).forEach((function(e,t){i[e]=t.toString()})),t=t.format(i)}g.enabled("charting_library_debug_mode")&&U.logNormal("Error reason: "+t),this._seriesErrorMessage=t;const s=g.enabled("no_bars_status")&&this._symbolInfo?te.STATUS_NO_BARS:te.STATUS_INVALID_SYMBOL;this._setStatus(s),this._seriesLoaded=!0,this._sendTelemetryCounter("series_error",this._getTelemetryAdditionalData(t)),this._enablePriceRangeReady()}_onSeriesCompleted(e,t){if(this._setSymbolIntervalDelay){if(this._willSymbolIntervalCurrencyChanged())return void U.logNormal("command comes during symbol/interval changing");U.logNormal("series_completed comes when symbol interval delay present but symbol/interval should not be changed")}this._sendTelemetryCounter("series_loaded",this._getTelemetryAdditionalData()),this._loading=!1,this._seriesErrorMessage=null;var s=e;switch("pulsed"===s&&(s="delayed"),s){case"streaming":this._setStatus(te.STATUS_READY);break;case"endofday":this._setStatus(te.STATUS_EOD);break;case"delayed":this._setStatus(te.STATUS_DELAYED);break;case"pulsed":this._setStatus(te.STATUS_PULSE);break;case"replay":this._setStatus(te.STATUS_REPLAY)}s.match(/delayed_streaming/)&&this._setStatus(te.STATUS_DELAYED_STREAMING);var r=this._model.paneForSource(this);r.recalculatePriceScale(this.priceScale());var n=Q.full();(null!==this._model.appliedTimeFrame().value()&&n.lockVisibleTimeRangeOnResize(),this._model.invalidate(n),
this.model().recalcVisibleRangeStudies(!0),this.model().recalcStudyBasedLineTools(),!this.m_priceScale.isLockScale()||this.model().timeScale().isEmpty()||this._seriesLoaded||(this.model().timeScale()._correctOffset(),this.model().timeScale().correctBarSpacing(),this.model().resetPriceScale(r,this.priceScale())),this._seriesLoaded=!0,A)||(A=!0,(0,i(75420).trackTiming)("Chart","Time to series",window.performance.now()));this.requestMoreData(),this._enablePriceRangeReady()}_onBarReceived(e){this.model().recalcVisibleRangeStudies(!0)}isStarted(){return this._seriesSource.isStarted()}restart(){if(this._status!==te.STATUS_SNAPSHOT){this._loading=!0,this._onRestarted.fire(),this._setStatus(te.STATUS_RESOLVING),this._updateSymbolInfo(null,!0);var e=this._properties.interval.value();this._checkIntervalWillChanged(e)&&this._notifyIntervalChanged(e);var t=null;this._pendingTimeRange&&(t=this._pendingTimeRange,delete this._pendingTimeRange),this._removeReplaySubscriber(),this._onBeforeModifySeries(this.getSymbolString(),e),this._onTimeFrameApplied.fire(t),e=j(e),this._data=null,this._seriesSource.modifySeries(this._getResolvingSymbolObject(),e,t),this._seriesSource.isStarted()||this._seriesSource.start(),this.m_symbol=this._properties.symbol.value(),this._currency=this._properties.currencyId.value(),this._unit=this._properties.unitId.value(),this.m_interval=this._properties.interval.value()}}hasDelayedSymbolIntervalChange(){return!!this._setSymbolIntervalDelay}setSymbolIntervalCurrencyDelayed(){this._willSymbolIntervalCurrencyChanged()&&(this._setSymbolIntervalDelay&&(U.logNormal("Clear timeout to change symbol/interval #"+this._setSymbolIntervalDelay),clearTimeout(this._setSymbolIntervalDelay)),this._setSymbolIntervalDelay=setTimeout(function(){const e=this._properties;U.logNormal("Timeout #"+this._setSymbolIntervalDelay+' fired, new symbol will be "'+e.symbol.value()+'"'),delete this._setSymbolIntervalDelay,this._setSymbolInterval(e.symbol.value(),e.interval.value(),e.currencyId.value(),e.unitId.value())}.bind(this),30),U.logNormal("Started timeout #"+this._setSymbolIntervalDelay+' to change symbol/interval from "'+this.m_symbol+'" to "'+this._properties.symbol.value()+'"'))}rerequestData(){this._setSymbolInterval(this.m_symbol,this.m_interval,this._currency,this._unit,!0)}_notifyIntervalChanged(e){var t={timeframe:this._pendingTimeRange};this._intervalChanged.fire(e,t),this._pendingTimeRange=t.timeframe}_setSymbolInterval(e,t,i,s,r){this.clearGotoDateResult();var n=Y.isRange(t);n&&this._properties.rangeStyle.inputs.range.setValue(Y.parse(t).multiplier());var a=this._checkSymbolWillChanged(e),o=this._checkIntervalWillChanged(t),l=o&&Y.parse(this.m_interval).isDWM()!==Y.parse(t).isDWM(),h=this._checkCurrencyWillChanged(i),d=this._checkUnitWillChanged(s);if(a||o||h||d||r){if((null!==i&&h||null!==s&&d)&&this.isInReplay()){const e=this.symbolInfo();null!==e&&e.original_currency_id===i||this._removeReplaySubscriber()}if(this._syncModel=null,this.m_symbol=e,this.m_interval=t,this._currency=i,this._unit=s,
this._status!==te.STATUS_SNAPSHOT&&(!this._seriesSource.isStarted()||a||h||d||l)&&this._updateSymbolInfo(null,!a&&(h||d)),this.isInReplay()){var u=function(){this._removeReplaySubscriber()}.bind(this);a?u():o&&(n?u():this._isReplayResolutionAvailableForUser(t)?this.isIntervalSupported(t)||(u(),this._replayExitedDueUnsupportedInterval.fire()):(u(),this._replayExitedDueUnavailableForUserInterval.fire()))}if(this._status!==te.STATUS_SNAPSHOT){this._loading=!0,this._setStatus(te.STATUS_RESOLVING),this._updateIsPrePostMarketPricesForbiddenProperty(),this._updateBackAdjustmentForbiddenProperty(),this._updateSettlementAsCloseForbiddenProperty(),this._symbolIntervalChanged.fire(),o&&this._notifyIntervalChanged(this.m_interval),this._onRestarted.fire(),this._seriesLoaded=!1,this._lineStyleLastPriceCirclePaneView.stopAnimation();var c=null;this._pendingTimeRange&&(c=this._pendingTimeRange,delete this._pendingTimeRange),this._onTimeFrameApplied.fire(c),this._onBeforeModifySeries(this.getSymbolString(),t),this._data=null,this._seriesSource.modifySeries(this._getResolvingSymbolObject(),j(t),c,r),this._seriesSource.isStarted()||(this._predictBars=0,this._seriesSource.start()),(a||h||d)&&this.disablePriceRangeReady()}else this._model.realignLineTools()}else this._model.realignLineTools()}setDefaultTimeframe(e){this._pendingTimeRange=e}symbol(){return this.properties().symbol.value()}bars(){return this.data().m_bars}nsBars(){return this.data().m_nsBars}hl2(e){return(this.high(e)+this.low(e))/2}hlc3(e){return(this.high(e)+this.low(e)+this.close(e))/3}ohlc4(e){return(this.open(e)+this.high(e)+this.low(e)+this.close(e))/4}priceRange(e,t){if(!TradingView.isInteger(e))return U.logDebug("Series.priceRange: incorrect startBar"),null;if(!TradingView.isInteger(t))return U.logDebug("Series.priceRange: incorrect endBar"),null;if(this.data().isEmpty())return null;if(this.m_priceScale.isLockScale()){var i=this._model.mainSeriesScaleRatio();if(null!==i){var s=this.priceScale().internalHeight()/(this.model().timeScale().barSpacing()/i),r=this.data().search(t,F.NearestLeft),a=(r.value[TradingView.HIGH_PLOT]+r.value[TradingView.LOW_PLOT])/2;return new n(a-.5*s,a+.5*s)}}var o=this.priceSource();if(null!==o)var l=this.data().bars().minMaxOnRangeCached(e,t,[{name:o,offset:0}]),h=this.data().nsBars().minMaxOnRangeCached(e,t,[{name:o,offset:0}]);else l=this.data().bars().minMaxOnRangeCached(e,t,[{name:"low",offset:0},{name:"high",offset:0}]),h=this.data().nsBars().minMaxOnRange(e,t,[{name:"low",offset:0},{name:"high",offset:0}]);var d=null!==(l=W(l,h))?l.min===l.max?new n(l.min-.5,l.max+.5):new n(l.min,l.max):new n(-.5,.5);return this.priceScale().isLog()?new n(this.priceScale().priceToLogical(d.minValue()),this.priceScale().priceToLogical(d.maxValue())):d}nearestData(e,t){if(TradingView.isInteger(e)){var i=this.data().search(e,t);return null!==i?i:void 0}U.logDebug("Series.nearestData: incorrect logicalPoint")}nearestIndex(e,t){var i=this.nearestData(e,t);return i?i.index:void 0}paneViews(){if(!this.properties().visible.value())return null
;var e=[this._baseHorizontalLineView,this._paneView];return this._futureBarsPaneView&&e.push(this._futureBarsPaneView),this._projectionBarsPaneView&&e.push(this._projectionBarsPaneView),null!==this._waterlineView&&e.push(this._waterlineView),e.push(this._prevClosePriceLineView),null!==this._priceLineView&&e.push(this._priceLineView),null!==this._gotoDateView&&e.push(this._gotoDateView),e.push(...this._highLowAvgPaneViews),e}purgeSymbolInfo(){this._symbolInfo=null}updateAllViews(){this._paneView.update(),this._dataWindowView.update(),this._legendView.update(),this._statusView.update(),this._highLowAvgPaneViews.forEach(e=>e.update()),this._labelPaneViews.forEach(e=>e.update()),this._priceAxisViews.forEach(e=>e.update()),this._priceLineAxisViews.forEach(e=>e.update()),this._futureBarsPaneView&&this._futureBarsPaneView.update(),this._projectionBarsPaneView&&this._projectionBarsPaneView.update(),null!==this._waterlineView&&this._waterlineView.update(),this._prevClosePriceLineView.update(),null!==this._priceLineView&&this._priceLineView.update(),null!==this._gotoDateView&&this._gotoDateView.update(),this._baseHorizontalLineView.update();var e=this._model.activeStrategySource().value();null!==e&&e.updateAllViews(),this._lineStyleLastPriceCirclePaneView.update()}requestMoreData(e){if((this._status===te.STATUS_READY||this._status===te.STATUS_PULSE||this._status===te.STATUS_DELAYED||this._status===te.STATUS_DELAYED_STREAMING||this._status===te.STATUS_EOD||this._status===te.STATUS_REPLAY)&&!this._model.timeScale().isEmpty()){var t=this._model.timeScale().visibleBarsStrictRange();if(null!==t&&0!==this.bars().size()){var i=t.lastBar()-a(this.data().last()).index;if(this._predictBars<i&&(this._predictBars=i,this._seriesSource.requestMoreTickmarks(i)),!this._endOfData){var s=a(this.bars().firstIndex()),r=e||s-t.firstBar();r<=0||(Number.isFinite(r)?(this._endOfData=!0,this._loading=!0,this._seriesSource.requestMoreData(r),this._setStatus(te.STATUS_LOADING)):U.logWarn("requestMoreData: invalid bar count: "+r+", visible bars: ["+t.firstBar()+", "+t.lastBar()+"], last index: "+a(this.data().last()).index+", predicted bars: "+this._predictBars+", required bars:"+e))}}}}bindStyleChange(){var e=this;Object.keys(te.STYLE_SHORT_NAMES).map((function(e){return te.STYLE_SHORT_NAMES[e]+"Style"})).forEach((function(t){e._properties[t].listeners().subscribe(e,te.prototype.invalidateBarStylesCache)}))}bindJapChartsInputs(){this._properties.style.listeners().subscribe(this,this.onChartStyleChanged),this._properties.renkoStyle.inputs.boxSize.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.wicks.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.sources.listeners().subscribe(this,this.onInputChanged),this._properties.pbStyle.inputs.lb.listeners().subscribe(this,this.onInputChanged),
this._properties.kagiStyle.inputs.reversalAmount.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.boxSize.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.reversalAmount.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.sources.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.oneStepBackBuilding.listeners().subscribe(this,this.onInputChanged),this._properties.rangeStyle.inputs.phantomBars.listeners().subscribe(this,this.onInputChanged)}createDividendsAdjustmentProperty(){var e=this;e.dividendsAdjustment=new r;var t=function(){var t=e._properties.dividendsAdjustment.value();e.dividendsAdjustment.setValue(t),H("Dividends adjust",!0===t?"On":"Off")};e._properties.dividendsAdjustment.listeners().subscribe(null,t),t()}dividendsAdjustmentProperty(){return this._properties.dividendsAdjustment}isNeedRestart(e){return this._status!==te.STATUS_SNAPSHOT&&(void 0===e&&(e=this.properties().style.value()),!G.isRangeStyle(this._prevChartStyle)&&!G.isRangeStyle(e)&&!(this._prevChartStyle===e||!G.isRequiringRestartSeriesStyles(this._prevChartStyle)&&!G.isRequiringRestartSeriesStyles(e)))}applyPreferences(e){var t=K({},e);this.m_priceScale.setMode({autoScale:t.priceAxisProperties.autoScale,percentage:t.priceAxisProperties.percentage,log:t.priceAxisProperties.log,lockScale:t.priceAxisProperties.lockScale}),this.setChartStyleWithIntervalIfNeeded(t.style),delete t.style,delete t.interval,this._properties.mergePreferences(t),this._properties.saveDefaults(),this.createPaneView(),this.invalidateBarStylesCache()}priceSource(){var e=null;switch(this._properties.style.value()){case te.STYLE_LINE:e=this._properties.lineStyle.priceSource.value();break;case te.STYLE_AREA:e=this._properties.areaStyle.priceSource.value();break;case te.STYLE_BASELINE:e=this._properties.baselineStyle.priceSource.value()}return e}isRangeBasedStyle(){return G.isRangeBasedStyle(this.style())}onInputChanged(){this.restart()}getSymbolString(){return $(this._getSymbolObject())}_getResolvingSymbolObject(){var e=this._getSymbolObject();return this._replaySubscriber&&(e=this._replaySubscriber.generateReplaySymbol(e)),e}getStyleShortName(){var e=this._properties.style.value();if(te.STYLE_SHORT_NAMES.hasOwnProperty(e))return te.STYLE_SHORT_NAMES[e];throw new Error("Missed short name for style "+e)}getStyleProperties(){return this._properties[this.getStyleShortName()+"Style"]}getInputsProperties(){return this.getStyleProperties().inputs||new r}getInputsInfoProperties(){return this.getStyleProperties().inputInfo||new r}getRealVisibleRange(){var e=this.model().timeScale().visibleBarsStrictRange()
;if(null===e)return null;var t=this.data().search(e.firstBar(),F.NearestRight),i=this.data().search(e.lastBar(),F.NearestLeft);return null===t||null===i?null:new B(t.index,i.index)}firstValue(){var e=this.firstBar();return null===e?null:this._barFunction(e)}firstBar(){var e=this.model().timeScale().visibleBarsStrictRange();if(null===e)return null;var t=e.firstBar(),i=this.data().search(t,F.NearestRight);return null!==i?i.value:null}isSpread(){return null!==this._symbolInfo&&"spread"===this._symbolInfo.type}getSymbolName(){return this._symbolInfo?this._symbolInfo.name:""}loadDataTo(e){var t=this._properties.interval.value();this._onTimeFrameApplied.fire(e),this._seriesSource.modifySeries(this._getResolvingSymbolObject(),j(t),e)}priceScale(){return this.m_priceScale}setPriceScale(e){this.m_priceScale!==e&&(this._priceScaleAboutToBeChanged.fire(),this.m_priceScale=e,this._properties.removeProperty("priceAxisProperties"),this._properties.addChild("priceAxisProperties",e.properties()),this._properties.priceAxisProperties.childChanged(),J.emit("series_event","price_scale_changed"),this._priceScaleChanged.fire(e))}setGotoDateResult(e){this._gotoDateResultCleared=!1,i.e(4079).then(i.t.bind(i,68242,19)).then(({GotoDateView:t})=>{this._gotoDateResultCleared||(this._gotoDateView=new t(this,e),this._model.updateSource(this))})}clearGotoDateResult(e){this._gotoDateView=null,this._gotoDateResultCleared=!0}getSourceIcon(){return{type:"loadSvg",svgId:"series."+this.properties().style.value()}}isStyleSupported(e){return!this.isInReplay()||this.isStyleSupportedForReplay(e)}isIntervalSupported(e){return!this.isInReplay()||this._replaySubscriber.canChangeResolution(e)}isStyleSupportedForReplay(e){return G.isTimeBasedStyle(e)}isInReplay(){return null!==this._replaySubscriber}onTimeFrameApplied(){return this._onTimeFrameApplied}onInReplayStateChanged(){return this._onInReplayStateChanged}replayExitedDueUnsupportedInterval(){return this._replayExitedDueUnsupportedInterval}replayExitedDueUnavailableForUserInterval(){return this._replayExitedDueUnavailableForUserInterval}switchToReplay(e,t){this._replaySubscriber=e,this._isReplayResolutionAvailableForUser=t,this._onInReplayStateChanged.fire(),this._replaySubscriber.modifySeries(this.getSymbolString(),this._properties.interval.value()),this.rerequestData()}switchToRealtime(){this.isInReplay()&&(this._removeReplaySubscriber(),this.rerequestData())}_removeReplaySubscriber(){if(this.isInReplay()){var e=this._replaySubscriber;this._replaySubscriber=null,this._isReplayResolutionAvailableForUser=null,this._onInReplayStateChanged.fire(),e.destroy()}}_onBeforeModifySeries(e,t){this._replaySubscriber&&this._replaySubscriber.modifySeries(e,t)}destroy(){this._replayExitedDueUnsupportedInterval.destroy(),this._replayExitedDueUnavailableForUserInterval.destroy(),this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),this.clearGotoDateResult(),this._legendView.destroy(),this._marketStatusModel.destroy(),
null!==this._dataUpdatedModeModel&&this._dataUpdatedModeModel.destroy(),this._dataProblemModel.destroy(),this._paneView&&this._paneView.destroy&&this._paneView.destroy(),this._onTimeFrameApplied.destroy(),this._seriesSource.destroy(),super.destroy()}dataEvents(){return this._seriesSource.dataEvents()}moveData(e){return this._seriesSource.moveData(e)}}Object.assign(te,z),TradingView.Series=te,t.Series=te,t.isSeries=function(e){return e instanceof te}},2052:(e,t,i)=>{function s(e,t){return 100*(t-e)/Math.abs(e)}i.d(t,{barPercentChange:()=>s})},7152:(e,t,i)=>{i.d(t,{PaneRendererBars:()=>n});var s=i(1132),r=i(44077);class n extends r.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._dontDrawOpen=e.dontDrawOpen,this._thinBars=e.thinBars}draw(e,t){e.save();const i=t.pixelRatio;if(this._barWidth=this._calcBarWidth(i),this._barWidth>=2){Math.max(1,Math.floor(i))%2!=this._barWidth%2&&this._barWidth--}this._barLineWidth=this._thinBars?Math.min(this._barWidth,Math.floor(i)):this._barWidth;let s=null;const r=this._barLineWidth<=this._barWidth&&this._barSpacing>=Math.floor(1.5*t.pixelRatio);for(const t of this._bars){s!==t.color&&(e.fillStyle=t.color,s=t.color);const n=Math.floor(.5*this._barLineWidth),a=Math.round(t.time*i),o=a-n,l=this._barLineWidth,h=o+l-1,d=Math.min(t.high,t.low),u=Math.max(t.high,t.low),c=Math.round(d*i)-n,_=Math.round(u*i)+n,p=Math.max(_-c,this._barLineWidth);e.fillRect(o,c,l,p);const m=Math.ceil(1.5*this._barWidth);if(r){const s=a-m,r=a+m,d=Math.min(o-s,r-h);if(!this._dontDrawOpen){let r=Math.max(c,Math.round(t.open*i)-n),a=r+l-1;a>c+p-1&&(a=c+p-1,r=a-l+1),e.fillRect(s,r,d,a-r+1)}let u=Math.max(c,Math.round(t.close*i)-n),_=u+l-1;_>c+p-1&&(_=c+p-1,u=_-l+1),e.fillRect(h+1,u,d,_-u+1)}}e.restore()}_getTolerance(){const e=this._calcBarWidth(1),t=this._thinBars?Math.min(e,1):e;return(0,s.interactionTolerance)().series+t/2}_getBarSpacing(){return this._barSpacing}_calcBarWidth(e){const t=Math.floor(e);return Math.max(t,Math.floor((0,s.optimalBarWidth)(this._barSpacing,e)))}}},56776:(e,t,i)=>{i.d(t,{SeriesWaterlinePaneView:()=>o});var s=i(50985),r=i(87511),n=i(18718),a=i(45185);class o extends s.HorizontalLinePaneView{constructor(e){super(),this._getters=e;const t={cursorType:r.PaneCursorType.VerticalResize,activeItem:0,areaName:n.AreaName.SourceItemMove};this._lineRenderer.setHitTest(new n.HitTestResult(n.HitTestResult.MOVEPOINT,t)),this._lineRendererData.visible=!0,this._lineRendererData.linestyle=a.LINESTYLE_SPARSE_DOTTED}_updateImpl(){const{baseLevelPercentage:e,paneHeight:t,color:i}=this._getters,s=Math.abs(100-e());this._lineRendererData.y=Math.round(t()*(s/100)),this._lineRendererData.color=i()}}},44077:(e,t,i)=>{i.d(t,{PaneRendererSeriesBase:()=>r});var s=i(18718);class r{constructor(){this._bars=[]}hitTest(e){const t=this._bars,i=this._getBarSpacing(),s=i/2;if(0===t.length)return null;const r=this._getTolerance(),n=t[0],a=t[t.length-1];if(e.x<n.time-s-r)return null;if(e.x>a.time+s+r)return null;let o=0,l=t.length-1,h=-1;for(;o<=l;){
const i=Math.floor((o+l)/2),d=t[i];let u=s;if(d!==n&&d!==a||(u+=r),Math.abs(d.time-e.x)<=u){h=i;break}e.x-d.time>s?o=i+1:l=i-1}if(-1!==h){const n=Math.ceil(r/i);if(0!==n){const i=Math.max(0,h-n),a=Math.min(t.length-1,h+n);for(let n=i;n<=a;n++)if(Math.abs(e.x-t[n].time)<=s+r&&this._isPointAtBar(t[n],e.y,r))return this._getHitTest()}else if(this._isPointAtBar(t[h],e.y,r))return this._getHitTest()}return null}_getHitTest(){return new s.HitTestResult(s.HitTestResult.REGULAR)}_isPointAtBar(e,t,i){const s=Math.min(e.high,e.low),r=Math.max(e.high,e.low);return s-i<=t&&t<=r+i}}},80446:(e,t,i)=>{i.d(t,{PaneRendererCandles:()=>l});var s=i(88537),r=i(18718),n=i(64149),a=i(1132),o=i(44077);class l extends o.PaneRendererSeriesBase{constructor(e){super(),this._barSpacing=1,this._barWidth=1,this._borderVisible=!1,this._barBorderWidth=1,this._wickVisible=!1,this._bodyVisible=!0,this._borderColor=void 0,this._wickColor=void 0,this._hittest=void 0,this._isPriceScaleInverted=!1,e&&this.setData(e)}setData(e){this._bars=e.bars,this._barSpacing=e.barSpacing,this._borderVisible=e.borderVisible,this._bodyVisible=e.bodyVisible,this._wickVisible=e.wickVisible,this._borderColor=e.borderColor,this._wickColor=e.wickColor,this._hittest=e.hittest,this._isPriceScaleInverted=e.isPriceScaleInverted}hitTest(e){return this._wickVisible||this._borderVisible||this._bodyVisible?super.hitTest(e):null}draw(e,t){if(0===this._bars.length)return;const i=t.pixelRatio;if(this._barWidth=(0,a.optimalCandlestickWidth)(this._barSpacing,i),this._barWidth>=2){Math.floor(i)%2!=this._barWidth%2&&this._barWidth--}this._wickVisible&&this._drawWicks(e,i),this._borderVisible&&this._drawBorder(e,i),this._bodyVisible&&this._drawCandles(e,i)}_getTolerance(){return(0,a.interactionTolerance)().series+this._barBorderWidth/2}_getBarSpacing(){return this._barSpacing}_getHitTest(){return this._hittest||new r.HitTestResult(r.HitTestResult.REGULAR)}_isPointAtBar(e,t,i){const s=this._bodyVisible||this._borderVisible,r=this._wickVisible;if(!s&&!r)return!1;if(s){const s=r?Math.min(e.high,e.low):Math.min(e.open,e.close),n=r?Math.max(e.high,e.low):Math.max(e.open,e.close);return s-i<=t&&t<=n+i}{const s=Math.min(e.open,e.close),r=Math.max(e.open,e.close);return e.high-i<=t&&t<=s+i||r-i<=t&&t<=e.low+i}}_drawWicks(e,t){const i=this._bars;let r="",n=Math.min(Math.floor(t),Math.floor(this._barSpacing*t));n=Math.max(Math.floor(t),Math.min(n,this._barWidth));const a=Math.floor(.5*n);let o=null;for(const l of i){const i=l.wickColor?l.wickColor:(0,s.ensureDefined)(this._wickColor);i!==r&&(e.fillStyle=i,r=i);let h=Math.round(Math.min(l.open,l.close)*t),d=Math.round(Math.max(l.open,l.close)*t);this._isPriceScaleInverted&&([d,h]=[h,d]);const u=Math.round(l.high*t),c=Math.round(l.low*t);let _=Math.round(t*l.time)-a;const p=_+n-1;null!==o&&(_=Math.max(o+1,_),_=Math.min(_,p));const m=p-_+1;e.fillRect(_,u,m,h-u),e.fillRect(_,d+1,m,c-d-1),o=p}}_calculateBorderWidth(e){let t=Math.floor(1*e);this._barWidth<=2*t&&(t=Math.floor(.5*(this._barWidth-1)));const i=Math.max(Math.floor(e),t)
;return this._barWidth<=2*i?Math.max(Math.floor(e),Math.floor(1*e)):i}_drawBorder(e,t){let i="";const r=this._calculateBorderWidth(t);let a=null;for(const o of this._bars){if(o.borderColor!==i&&(e.fillStyle=o.borderColor?o.borderColor:(0,s.ensureDefined)(this._borderColor),i=o.borderColor),this._bodyVisible&&o.hollow)continue;let l=Math.round(o.time*t)-Math.floor(.5*this._barWidth);const h=l+this._barWidth-1,d=Math.round(Math.min(o.open,o.close)*t),u=Math.round(Math.max(o.open,o.close)*t);if(null!==a&&(l=Math.max(a+1,l),l=Math.min(l,h)),this._barSpacing*t>2*r)(0,n.fillRectInnerBorder)(e,l,d,h-l+1,u-d+1,r);else{const t=h-l+1;e.fillRect(l,d,t,u-d+1)}a=h}}_drawCandles(e,t){let i="";const s=this._calculateBorderWidth(t);for(const r of this._bars){if(this._borderVisible&&this._barWidth<=2*s&&!r.hollow)continue;let a=Math.round(Math.min(r.open,r.close)*t),o=Math.round(Math.max(r.open,r.close)*t),l=Math.round(r.time*t)-Math.floor(.5*this._barWidth),h=l+this._barWidth-1;if(r.color!==i){const t=r.color;e.fillStyle=t,i=t}if(r.hollow)e.fillStyle=r.color,(0,n.fillRectInnerBorder)(e,l,a,h-l+1,o-a+1,s);else{if(this._borderVisible&&(l+=s,a+=s,h-=s,o-=s),a>o)continue;e.fillRect(l,a,h-l+1,o-a+1)}}}}},30347:(e,t,i)=>{i.d(t,{SeriesHiLoPaneView:()=>f});var s=i(88537),r=i(8214),n=i(74715),a=i(77884),o=i(1132),l=i(18718),h=i(80047);class d extends h.ScaledPaneRenderer{constructor(){super(...arguments),this._data=null,this._barWidth=null}setData(e){this._data=e,this._barWidth=Math.max(1,Math.round((0,o.optimalHiLoWidth)(e.barSpacing)))}hitTest(e){if(null===this._data||null===this._barWidth)return null;const t=this._data.bars,i=.5*this._data.barSpacing;if(0===t.length)return null;if(e.x<t[0].time-i)return null;if(e.x>t[t.length-1].time+i)return null;const s=t[(0,a.lowerbound)(t,e.x-i,(e,t)=>e.time<t)];if(e.x<s.time-i||e.x>s.time+i)return null;const r=(0,o.interactionTolerance)().series+this._barWidth/2,n=Math.min(s.high,s.low),h=Math.max(s.high,s.low),d=this._data.fontSize;return n-r-d<=e.y&&e.y<=n+r||h-r<=e.y&&e.y<=h+r+d?new l.HitTestResult(l.HitTestResult.REGULAR):null}_drawImpl(e){if(null===this._data||null===this._barWidth)return;e.save(),e.translate(.5,.5),e.textAlign="center",e.fillStyle=this._data.labelColor,e.font=(0,r.makeFont)(this._data.fontSize,this._data.font);const t=this._data.bars,i=this._data.inverted;for(let s=0;s<t.length;++s){const r=t[s],n=Math.min(r.high,r.low),a=Math.max(r.high,r.low);e.fillText(i?r.lowLabel:r.highLabel,r.time,n-this._data.labelsPadding),e.fillText(i?r.highLabel:r.lowLabel,r.time,a+this._data.labelsPadding+this._data.fontSize)}e.restore()}}var u=i(80446),c=i(17611),_=i(59447),p=i(5222),m=i(88427);function y(e){return null!=e}class f extends n.SeriesBarCandlesPaneView{constructor(e,t){super(e,t),this._widthsCache=new p.TextWidthCache,this._labelsRenderer=new d,this._candlesRenderer=new u.PaneRendererCandles,this._canvas=document.createElement("canvas"),this._context=(0,s.ensureNotNull)(this._canvas.getContext("2d"));const i=e.properties().childs();this._context.font=(0,
r.makeFont)(i.hiloStyle.childs().fontSize.value(),m.CHART_FONT_FAMILY)}renderer(e,t,i){if(this._invalidated){const e=this._series().formatter(),t=this._needLabels();this._updateImpl(this._barUpdater.bind(this,e,t)),this._invalidated=!1}const s=this._series().properties().childs().hiloStyle.childs(),r=this._model().timeScale().barSpacing(),n=this._needLabels()&&this._bars().every(e=>e.highLabelWidth<=r&&e.lowLabelWidth<=r),a={bars:this._bars(),wickVisible:!1,bodyVisible:s.drawBody.value(),barSpacing:r,borderVisible:s.showBorders.value(),barWidth:(0,o.optimalHiLoWidth)(r),font:m.CHART_FONT_FAMILY,fontSize:s.fontSize.value(),labelColor:s.labelColor.value(),inverted:this._series().priceScale().isInverted(),labelsPadding:3},l=new c.CompositeRenderer;return this._candlesRenderer.setData(a),l.append(this._candlesRenderer),n&&(this._labelsRenderer.setData(a),l.append(this._labelsRenderer)),this._model().selection().isSelected(this._series())&&this._isMarkersEnabled&&l.append(new _.SelectionRenderer(this._selectionData)),l}topPixelMargin(){return this._margin()}bottomPixelMargin(){return this._margin()}_margin(){const e=this._series().properties().childs().hiloStyle.childs();return e.showLabels.value()?e.fontSize.value()+6:0}_barUpdater(e,t,i,s){const r=i[2],n=i[3];return!(!y(r)||!y(n))&&(s.high=s.open=r,s.low=s.close=n,t&&(s.highLabel=e.format(r),s.highLabelWidth=this._getLabelWidth(s.highLabel),s.lowLabel=e.format(n),s.lowLabelWidth=this._getLabelWidth(s.lowLabel)),!0)}_needLabels(){const e=this._model().timeScale().barSpacing();return this._series().properties().childs().hiloStyle.childs().showLabels.value()&&e>5}_getLabelWidth(e){return this._widthsCache.measureText(this._context,e)}}},17617:(e,t,i)=>{i.d(t,{PaneRendererKagi:()=>n});var s=i(1132),r=i(44077);class n extends r.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._barLineWidth=Math.max(1,(0,s.optimalBarWidth)(e.barSpacing,1))}draw(e,t){let i,s,r;e.save(),e.lineCap="square";const n=Math.floor(t.pixelRatio)%2?1:0;for(const a of this._bars){const o=Math.round(t.pixelRatio*this._barLineWidth*.5),l=Math.round(t.pixelRatio*a.exactTime-o),h=void 0===s||a.isUp?Math.round(t.pixelRatio*a.high-o):s,d=2*o;let u;if(a.isTwoColorBar){const s=Math.round(t.pixelRatio*a.additionalPrice-t.pixelRatio*a.high+o),r=h+s,c=Math.round(t.pixelRatio*a.low-t.pixelRatio*a.additionalPrice+o),_=void 0!==i&&a.isUp?i:r+c;e.fillStyle=a.upColor,e.fillRect(l,h,d+n,s),e.fillStyle=a.downColor,e.fillRect(l,r,d+n,_+o-r+1),u=_}else{const s=Math.round(t.pixelRatio*a.low-t.pixelRatio*a.high+o),r=void 0!==i&&a.isUp?i:h+s;e.fillStyle=a.color,e.fillRect(l,h,d+n,r+o-h+1),u=r}if(!a.combinedWithProjection){a.isTwoColorBar?e.fillStyle=a.isUp?a.downColor:a.upColor:e.fillStyle=a.color;const i=void 0===r?Math.round((a.exactTime-this._barSpacing)*t.pixelRatio+o):r+2*o,l=Math.round(a.exactTime*t.pixelRatio-o)-i+1,h=2*o+n;if(a.isUp)e.fillRect(i,u-o+1-n,l,h);else{const r=void 0===s?Math.round(a.open*t.pixelRatio-o):s;e.fillRect(i,r,l,h)}}r=l,i=u,s=h}e.restore()}
_getTolerance(){return(0,s.interactionTolerance)().series+this._barLineWidth/4}_getBarSpacing(){return this._barLineWidth}}},49582:(e,t,i)=>{i.d(t,{PaneRendererPnF:()=>a});var s,r=i(1132),n=i(44077);!function(e){e[e.EllipseWidth=.9]="EllipseWidth",e[e.EllipseRadius=.95]="EllipseRadius",e[e.SimplifiedEllipseWidth=.86]="SimplifiedEllipseWidth"}(s||(s={}));class a extends n.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._barWidth=e.barSpacing}draw(e,t){if(0===this._bars.length)return;e.save();const i=this._bars.reduce((e,t)=>Math.max(e,(t.low-t.high)/t.additionalNum),0);this._barSpacing>1&&i>=1?this._drawFillSigns(e,t):this._drawSimplified(e,t),e.restore()}_drawImpl(e){}_getTolerance(){return(0,r.interactionTolerance)().series+this._barWidth/8}_getBarSpacing(){return this._barSpacing}_drawBarCross(e,t,i,s){!function(e,t,i,s,r){e.moveTo(t,i),e.lineTo(t+s,i+r),e.moveTo(t+s,i),e.lineTo(t,i+r)}(e,t.time-.5*this._barWidth,t.high+s*i,this._barWidth,i)}_drawBarEllipse(e,t,i,r){!function(e,t,i,r,n){e.save(),e.translate(t+r/2,i+n/2),e.scale(r/2,n/2),e.moveTo(1,0),e.arc(0,0,s.EllipseRadius,0,2*Math.PI,!1),e.restore()}(e,t.time-this._barWidth*s.EllipseWidth*.5,t.high+r*i,this._barWidth*s.EllipseWidth,i)}_drawFillSigns(e,t){e.scale(t.pixelRatio,t.pixelRatio),e.lineCap="butt",e.lineWidth=1;for(const t of this._bars){const i=(t.low-t.high)/t.additionalNum;if(t.isMergedBar&&(e.beginPath(),t.isUp?this._drawBarEllipse(e,t,i,t.additionalNum-1):this._drawBarCross(e,t,i,0),e.strokeStyle=t.isUp?t.downColor:t.upColor,e.stroke()),e.beginPath(),t.isUp)for(let s=t.additionalNum-1-(t.isMergedBar?1:0);s>-1;s--)this._drawBarCross(e,t,i,s);else for(let s=t.isMergedBar?1:0;s<t.additionalNum;s++)this._drawBarEllipse(e,t,i,s);e.strokeStyle=t.color,e.stroke()}}_drawSimplified(e,t){for(const i of this._bars){const r=i.isUp?1:s.SimplifiedEllipseWidth,n=(i.time-.5*this._barWidth*r)*t.pixelRatio,a=(i.time+.5*this._barWidth*r)*t.pixelRatio,o=Math.max(1,a-n);let l=i.high*t.pixelRatio;const h=i.low*t.pixelRatio,d=i.high*t.pixelRatio;let u=Math.max(1,h-d);if(i.isMergedBar){e.fillStyle=i.isUp?i.downColor:i.upColor;const t=(i.low-i.high)/i.additionalNum,s=Math.max(1,Math.round(t));i.isUp?(e.fillRect(n,l,o,s),l+=s):(e.fillRect(n,l+o-s,o,s),u-=s)}e.fillStyle=i.color,e.fillRect(n,l,o,u)}}}},90210:(e,t,i)=>{i.d(t,{PaneRendererRenkoPB:()=>n});var s=i(1132),r=i(44077);class n extends r.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barWidth=e.barSpacing}draw(e,t){e.save();const i=Math.round(t.pixelRatio*this._barWidth/2);let s=null;for(let r=0;r<this._bars.length;++r){const n=this._bars[r],a=Math.round(n.exactTime*t.pixelRatio),o=null===s?Math.round(a-i):s+1,l=(r<this._bars.length-1?Math.round(this._bars[r+1].exactTime*t.pixelRatio):a+2*i)-i-o,h=Math.round(Math.min(n.close,n.open)*t.pixelRatio),d=Math.round(Math.max(n.close,n.open)*t.pixelRatio)-h+1;e.fillStyle=n.borderColor,e.fillRect(o,h,l,d),e.fillRect(a,Math.round(n.high*t.pixelRatio),1,Math.round((n.low-n.high)*t.pixelRatio)),
e.fillStyle=n.color,e.fillRect(o+1,h+1,l-2,d-2),s=o+l-1}e.restore()}_getTolerance(){return(0,s.interactionTolerance)().series+.5}_getBarSpacing(){return this._barWidth}}},21579:(e,t,i)=>{i.d(t,{SeriesHorizontalBaseLinePaneView:()=>r});var s=i(6059);class r extends s.SeriesHorizontalLinePaneView{constructor(e){super(e)}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.priceScale().mode();if(!e.percentage&&!e.indexedTo100)return;const t=this._series.firstValue();null!==t&&(this._lineRendererData.visible=!0,this._lineRendererData.y=this._series.priceScale().priceToCoordinate(t,t),this._lineRendererData.color=this._series.properties().childs().baseLineColor.value())}}},6059:(e,t,i)=>{i.d(t,{SeriesHorizontalLinePaneView:()=>r});var s=i(50985);class r extends s.HorizontalLinePaneView{constructor(e){super(),this._series=e,this._model=e.model()}}},50754:(e,t,i)=>{i.d(t,{SeriesPriceLinePaneView:()=>n});var s=i(6059),r=i(45185);class n extends s.SeriesHorizontalLinePaneView{constructor(e){super(e),this._lineRendererData.linestyle=r.LINESTYLE_DOTTED}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.properties().childs();if(!e.showPriceLine.value())return;if(12===e.style.value())return;const t=this._series.lastValueData(void 0,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=this._series.priceLineColor(t.color),this._lineRendererData.linewidth=e.priceLineWidth.value())}}},94683:(e,t,i)=>{i.d(t,{calculateColor:()=>x,SeriesValuesProvider:()=>I});var s=i(88537),r=i(93751),n=i(24377),a=i(87236),o=i(38456),l=i(21386),h=i(43498),d=i(52280),u=i(40968),c=i(8170),_=i(65513),p=i(91419),m=i(89627),y=i(2052),f=i(76809);const g=o.CheckMobile.any(),S=g&&!1,b=new _.PercentageFormatter,v=new p.VolumeFormatter(2),w=(0,a.t)("n/a"),P=`${w} (${w}%)`;function x(e,t){const i=(0,n.parseRgb)(t),s=(0,n.parseRgb)(e);return(0,n.distanceRgb)(i,s)<70?(0,n.rgbToHexString)((0,n.invertRgb)(i)):t}class I{constructor(e,t){this._series=e,this._model=t,this._emptyValues=[{title:(0,a.t)("Open"),visible:!1,value:"",index:0,id:""},{title:(0,a.t)("High"),visible:!1,value:"",index:1,id:""},{title:(0,a.t)("Low"),visible:!1,value:"",index:2,id:""},{title:(0,a.t)("Close"),visible:!1,value:"",index:3,id:""},{title:"",visible:!1,value:"",index:4,id:""},{title:"",visible:!1,value:"",index:5,id:""},{title:(0,a.t)("Change"),visible:!1,value:"",index:6,id:""},{title:(0,a.t)("Vol"),visible:!1,value:"",index:7,id:""}]}getItems(){return this._emptyValues}getValues(e){const t=this._showLastPriceAndChangeOnly(),i=this._emptyValues.map(e=>({...e,visible:!t}));i[0].value=w,i[1].value=w,i[2].value=w,i[3].value=w,i[6].value=P,i[7].value=w,i[5].visible=!1;const n=i[4];if(n.value=w,n.visible=!1,this._model.timeScale().isEmpty()||0===this._series.bars().size()||this._series.priceScale().isEmpty())return i;(0,r.isNumber)(e)||(e=(0,s.ensureNotNull)(this._series.data().last()).index);const a=this._series.nearestIndex(e,d.PlotRowSearchMode.NearestLeft);if(void 0===a)return i
;const o=this._series.data().valueAt(a),u=this._model.backgroundTopColor().value();if(null===o)return i;const c=o[1],_=o[2],p=o[3],y=o[4],{values:g}=this._changesData(y,a,t),I=(0,f.getPriceValueFormatterForSource)(this._series);if((0,f.shouldBeFormattedAsPercent)(this._series))i[6].value="";else if(void 0!==g){const e=this._series.formatter();i[6].value=(0,h.forceLTRStr)(`${e.format(g.change,!0)} (${b.format(g.percentChange,!0)})`)}if(t)i[5].value=null==y?w:I(y),i[5].visible=!0,i[6].visible=!0;else{i[0].value=null==c?w:I(c),i[1].value=null==_?w:I(_),i[2].value=null==p?w:I(p),i[3].value=null==y?w:I(y),i[4].value=I(this._series.barFunction()(o));const e=o[5];(0,r.isNumber)(e)?i[7].value=v.format(e):i[7].visible=!1}let C=null;if(t&&!S)C=void 0===g||g.change>=0?m.SeriesBarColorer.upColor(this._series.properties()):m.SeriesBarColorer.downColor(this._series.properties());else{const e=this._series.barColorer().barStyle(a,!1);C=x(u,null!=e.barBorderColor?e.barBorderColor:e.barColor)}C=(0,l.resetTransparency)(x(u,C));for(const e of i)e.color=C;return i}_showLastPriceAndChangeOnly(){return g&&(null===this._model.crossHairSource().pane||(0,u.isLineToolName)(c.tool.value())||null!==this._model.lineBeingEdited())}_changesData(e,t,i){var s;if(i&&!S){const e=this._series.quotes();if(null!==e)return{values:{change:e.change,percentChange:e.change_percent}}}else{const i=this._series.data().search(t-1,d.PlotRowSearchMode.NearestLeft),r=null!==(s=null==i?void 0:i.value[4])&&void 0!==s?s:null;if(null!==r&&null!=e)return{values:{change:e-r,percentChange:(0,y.barPercentChange)(r,e)}}}return{}}}},74715:(e,t,i)=>{var s=i(86441).Point,r=i(59447).SelectionRenderer,n=i(18718).HitTestResult,a=i(7152).PaneRendererBars,o=i(29828).PaneRendererLine,l=i(68226).PaneRendererStepLine,h=i(96949).PaneRendererArea,d=i(80446).PaneRendererCandles,u=i(65736).PaneRendererBaseline,c=i(17611).CompositeRenderer,_=i(21386),p=i(52280).PlotRowSearchMode,m=i(11688),y=i(1132),f=i(46037).SelectionIndexes;function g(e,t){this.m_series=e,this.m_model=t,this.m_bars=[],this._invalidated=!0,this._isMarkersEnabled=m.enabled("source_selection_markers"),this._selectionData=null,this._selectionIndexer=new f(t.timeScale())}function S(e,t){return void 0!==e[TradingView.OPEN_PLOT]&&void 0!==e[TradingView.HIGH_PLOT]&&void 0!==e[TradingView.LOW_PLOT]&&void 0!==e[TradingView.CLOSE_PLOT]&&(t.open=e[TradingView.OPEN_PLOT],t.high=e[TradingView.HIGH_PLOT],t.low=e[TradingView.LOW_PLOT],t.close=e[TradingView.CLOSE_PLOT],!0)}function b(e,t){g.call(this,e,t)}function v(e,t){g.call(this,e,t)}function w(e,t){g.call(this,e,t)}function P(e,t){g.call(this,e,t)}function x(e,t){this.m_series=e,this.m_model=t,this.m_items=[],this._isMarkersEnabled=m.enabled("source_selection_markers"),this._selectionIndexer=new f(t.timeScale())}function I(e,t){x.call(this,e,t),this._invaidated=!0}function C(e,t){x.call(this,e,t),this._invaidated=!0}function T(e,t){x.call(this,e,t),this._invaidated=!0,this._renderer=new u}g.prototype._series=function(){return this.m_series},g.prototype._model=function(){
return this.m_model},g.prototype._bars=function(){return this.m_bars},g.prototype.update=function(){this._invalidated=!0},g.prototype._updateImpl=function(e){var t=this;if((e=e||S,this.m_bars=[],!this.m_model.timeScale().isEmpty()&&!this.m_series.priceScale().isEmpty())&&(null!==(o=this.m_model.timeScale().visibleBarsStrictRange())&&0!==this.m_series.bars().size())){for(var i=this.m_series.nearestIndex(o.firstBar(),p.NearestRight),r=this.m_series.nearestIndex(o.lastBar(),p.NearestLeft);i<=r;i++){if(null!==this.m_series.bars().valueAt(i))break}if(!(i>r)){var a,o=this.m_series.bars().range(i,r),l=this.m_series.priceScale(),h=this.m_series.barColorer(),d={};if(o.each((function(i,s){var r,n={};(n.time=Math.round(i),e(s,n))&&(d.value=s,r=s[TradingView.STYLE_PLOT]?s[TradingView.STYLE_PLOT]:h.barStyle(i,!1,d),s[TradingView.STYLE_PLOT]=r,d.previousValue=s,n.color=r.barColor,n.borderColor=r.barBorderColor,n.wickColor=r.barWickColor,n.hollow=r.isBarHollow,t.m_bars.push(n))}),this),0!==this.m_bars.length&&(a=this.m_series.firstValue(),l.barPricesToCoordinates(this.m_bars,a)),this.m_model.timeScale().barIndexesToCoordinates(this.m_bars),this.m_model.selection().isSelected(this.m_series)){var u=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0};var c=this.m_model.paneForSource(this.m_series).height();this._selectionData.hittestResult=n.REGULAR;for(var _=0;_<u.length;_++){var m=u[_],y=this.m_series.bars().valueAt(m);if(null!==y){var f=.5*(y[TradingView.OPEN_PLOT]+y[TradingView.CLOSE_PLOT]),g=this.m_model.timeScale().indexToCoordinate(m),b=this.m_series.priceScale().priceToCoordinate(f,a);this._selectionData.points.push(new s(g,b)),this._selectionData.bgColors.push(this.m_model.backgroundColorAtYPercentFromTop(b/c))}}}else this._selectionIndexer.clear()}}},g.prototype.items=function(){return this.m_bars},inherit(b,g),b.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing();var t=this.m_series.properties();e.dontDrawOpen=t.barStyle.dontDrawOpen.value(),e.thinBars=t.style.value()===TradingView.Series.STYLE_RANGE?t.rangeStyle.thinBars.value():t.barStyle.thinBars.value();var i=new c;return i.append(new a(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&i.append(new r(this._selectionData)),i},inherit(v,g),v.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing(),e.wickVisible=this.m_series.properties().candleStyle.drawWick.value(),e.bodyVisible=this.m_series.properties().candleStyle.drawBody.value(),e.borderVisible=this.m_series.properties().candleStyle.drawBorder.value(),e.borderColor=this.m_series.properties().candleStyle.borderColor.value(),e.wickColor=this.m_series.properties().candleStyle.wickColor.value(),e.barWidth=y.optimalBarWidth(e.barSpacing),e.isPriceScaleInverted=this.m_series.priceScale().isInverted();var t=new c
;return t.append(new d(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new r(this._selectionData)),t},inherit(w,g),w.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing(),e.wickVisible=this.m_series.properties().haStyle.drawWick.value(),e.bodyVisible=this.m_series.properties().haStyle.drawBody.value(),e.borderVisible=this.m_series.properties().haStyle.drawBorder.value(),e.borderColor=this.m_series.properties().haStyle.borderColor.value(),e.wickColor=this.m_series.properties().haStyle.wickColor.value(),e.barWidth=y.optimalBarWidth(e.barSpacing),e.isPriceScaleInverted=this.m_series.priceScale().isInverted();var t=new c;return t.append(new d(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new r(this._selectionData)),t},inherit(P,g),P.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);var e={};e.bars=this.m_bars,e.barSpacing=this.m_model.timeScale().barSpacing(),e.wickVisible=this.m_series.properties().hollowCandleStyle.drawWick.value(),e.bodyVisible=this.m_series.properties().hollowCandleStyle.drawBody.value(),e.borderVisible=this.m_series.properties().hollowCandleStyle.drawBorder.value(),e.borderColor=this.m_series.properties().hollowCandleStyle.borderColor.value(),e.wickColor=this.m_series.properties().hollowCandleStyle.wickColor.value(),e.barWidth=y.optimalBarWidth(e.barSpacing),e.isPriceScaleInverted=this.m_series.priceScale().isInverted();var t=new c;return t.append(new d(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&t.append(new r(this._selectionData)),t},x.prototype.update=function(){if(this.m_items=[],this.m_model.timeScale().isEmpty()||!this.m_series.priceScale()||this.m_series.priceScale().isEmpty())return;const e=this.m_model.timeScale().visibleBarsStrictRange();if(null===e)return;if(0===this.m_series.bars().size())return;var t=this.m_series.nearestIndex(e.firstBar()-1,p.NearestLeft),i=this.m_series.nearestIndex(e.lastBar()+1,p.NearestRight);const r=this.m_series.bars().range(t,i);var a=this.m_series.priceScale(),o={color:this.m_series.properties().lineStyle.color.value()},l=this.m_series.barFunction();let h;if(r.each(function(t,i){var r=l(i);if(null==r)return!1;void 0===h&&e.contains(t)&&(h=r);var n=new s(t,r);return n.style=o,this.m_items.push(n),!1}.bind(this)),a.pointsArrayToCoordinates(this.m_items,h),this.m_model.timeScale().timedValuesToCoordinates(this.m_items),this.m_model.selection().isSelected(this.m_series)){var d=this._selectionIndexer.indexes();this._selectionData={points:[],isDark:this.m_model.isDark(),bgColors:[],visible:!0};var u=this.m_model.paneForSource(this.m_series).height();this._selectionData.hittestResult=n.REGULAR;for(var c=0;c<d.length;c++){var _=d[c],m=this.m_series.data().valueAt(_);if(null!==m){var y=l(m),f=this.m_model.timeScale().indexToCoordinate(_),g=this.m_series.priceScale().priceToCoordinate(y,h)
;this._selectionData.points.push(new s(f,g)),this._selectionData.bgColors.push(this.m_model.backgroundColorAtYPercentFromTop(g/u))}}}else this._selectionIndexer.clear()},inherit(I,x),I.prototype.update=function(){this._invalidated=!0},I.prototype.renderer=function(){this._invalidated&&(x.prototype.update.call(this),this._invalidated=!1);var e,t,i=this.m_series.properties().lineStyle,s={barSpacing:this.m_model.timeScale().barSpacing(),items:this.m_items,lineColor:i.color.value(),lineStyle:i.linestyle.value(),withMarkers:i.styleType.value()===TradingView.Series.STYLE_LINE_TYPE_MARKERS,lineWidth:i.linewidth.value(),simpleMode:!0};return i.styleType.value()===TradingView.Series.STYLE_LINE_TYPE_STEP?(e=new l).setData(s):e=new o(s),this.m_model.selection().isSelected(this.m_series)?((t=new c).append(e),this._isMarkersEnabled&&t.append(new r(this._selectionData))):t=e,t},inherit(C,x),C.prototype.update=function(){this._invalidated=!0},C.prototype.renderer=function(){this._invalidated&&(x.prototype.update.call(this),this._invalidated=!1);var e={simpleMode:!1};e.barSpacing=this.m_model.timeScale().barSpacing(),e.items=this.m_items,e.lineColor=this.m_series.properties().areaStyle.linecolor.value(),e.lineStyle=this.m_series.properties().areaStyle.linestyle.value(),e.lineWidth=this.m_series.properties().areaStyle.linewidth.value();var t=this.m_series.properties().areaStyle.transparency.value();e.isSeries=!0,e.color1=_.generateColor(this.m_series.properties().areaStyle.color1.value(),t),e.color2=_.generateColor(this.m_series.properties().areaStyle.color2.value(),t),e.bottom=this.m_series.priceScale().height();var i=new c;return i.append(new h(e)),this.m_model.selection().isSelected(this.m_series)&&this._isMarkersEnabled&&i.append(new r(this._selectionData)),i},inherit(T,x),T.prototype.update=function(){this._invalidated=!0},T.prototype._updateImpl=function(){x.prototype.update.call(this);var e=this.m_series.properties().baselineStyle,t=e.transparency.value();this._topFillColor1=_.generateColor(e.topFillColor1.value(),t),this._topFillColor2=_.generateColor(e.topFillColor2.value(),t),this._bottomFillColor1=_.generateColor(e.bottomFillColor1.value(),t),this._bottomFillColor2=_.generateColor(e.bottomFillColor2.value(),t),this._topLineColor=e.topLineColor.value(),this._bottomLineColor=e.bottomLineColor.value(),this._topLineWidth=e.topLineWidth.value(),this._bottomLineWidth=e.bottomLineWidth.value(),this._barSpacing=this.m_model.timeScale().barSpacing(),this._bottom=this.m_series.priceScale().height(),this._baseLevelCoordinate=Math.round(this._bottom*(Math.abs(100-e.baseLevelPercentage.value())/100))},T.prototype.renderer=function(){this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer.setData({items:this.m_items,topFillColor1:this._topFillColor1,topFillColor2:this._topFillColor2,bottomFillColor1:this._bottomFillColor1,bottomFillColor2:this._bottomFillColor2,topLineColor:this._topLineColor,bottomLineColor:this._bottomLineColor,topLineWidth:this._topLineWidth,bottomLineWidth:this._bottomLineWidth,
lineStyle:CanvasEx.LINESTYLE_SOLID,barSpacing:this._barSpacing,baseLevelCoordinate:this._baseLevelCoordinate,bottom:this._bottom});var e=new c;return e.append(this._renderer),this.m_model.selection().isSelected(this.m_series)&&e.append(new r(this._selectionData)),e},t.SeriesBarsPaneView=b,t.SeriesCandlesPaneView=v,t.SeriesHollowCandlesPaneView=P,t.SeriesLinePaneView=I,t.SeriesAreaPaneView=C,t.SeriesHeikenAshiPaneView=w,t.SeriesBaselinePaneView=T,t.SeriesBarCandlesPaneView=g},5073:(e,t,i)=>{i.d(t,{StatusProviderBase:()=>s});class s{constructor(e){this._colorProperty=e}size(){return"13px"}bold(){return!1}color(){return this._colorProperty.value()}}},92139:(e,t,i)=>{i.d(t,{StatusView:()=>s});class s{constructor(e){this._text="",this._color="",this._size="13px",this._bold=!1,this._statusProvider=e}text(){return this._text}getSplitTitle(){return[this._text]}color(){return this._statusProvider.color()}bold(){return this._bold}size(){return this._size}}},8484:(e,t,i)=>{i.d(t,{AbstractFilledAreaPaneView:()=>m});var s=i(88537),r=i(21386),n=i(80047);class a{constructor(){this._items=[],this._actualLength=0,this._invalidations=0}push(e){this._items.length===this._actualLength?this._items.push(e):this._items[this._actualLength]!==e&&(this._items[this._actualLength]=e),this._actualLength+=1}newItem(){const e=this._items.length>this._actualLength?this._items[this._actualLength]:null;return null!==e&&Boolean(e.invalidateCache)&&e.invalidateCache(),e}invalidateCache(){this._invalidations+=1,3e3===this._invalidations&&(this._items.splice(this._actualLength),this._invalidations=0),this._actualLength=0}at(e){return this._items[e]}data(){return this._items}length(){return this._actualLength}}class o{constructor(){this._map=new Map,this._usedKeys=new Set,this._invalidations=0}invalidateCache(){this._invalidations+=1,50===this._invalidations&&(this._deleteUnused(),this._invalidations=0),this._usedKeys.clear(),this._map.forEach((e,t)=>e.invalidateCache())}get(e){const t=this._map.get(e);return void 0!==t&&this._usedKeys.add(e),t}set(e,t){this._usedKeys.add(e),this._map.set(e,t)}forEach(e){this._map.forEach((t,i)=>{this._usedKeys.has(i)&&e(t,i)})}delete(e){const t=this._map.get(e);void 0!==t&&t.invalidateCache(),this._usedKeys.delete(e)}_deleteUnused(){const e=[];this._map.forEach((t,i)=>{this._usedKeys.has(i)||e.push(i)});for(const t of e)this._map.delete(t)}}class l extends a{constructor(){super(),this.points1=new a,this.points2=new a,this.push(this.points1),this.push(this.points2)}addPoints1Point(e,t){let i=this.points1.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points1.push(i)}addPoints2Point(e,t){let i=this.points2.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points2.push(i)}invalidateCache(){this.points1.invalidateCache(),this.points2.invalidateCache()}}class h extends n.ScaledPaneRenderer{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(e,t){return null}_drawImpl(e,t){if(null===this._data)return;const i=.25*this._data.barSpacing,s=this._data.transparency
;this._data.colorAreas.forEach((t,n)=>{e.beginPath();for(let s=0;s<t.length();s++){const r=t.at(s);if(0===r.points1.length()||0===r.points2.length())continue;const n=r.points1.at(0).x,a=r.points1.at(0).y;if(e.moveTo(n,a),1!==r.points1.length()&&1!==r.points2.length()){for(let t=1;t<r.points1.length();t++)e.lineTo(r.points1.at(t).x,r.points1.at(t).y);for(let t=r.points2.length()-1;t>=0;t--)e.lineTo(r.points2.at(t).x,r.points2.at(t).y)}else{const t=r.points2.at(0).x,s=r.points2.at(0).y;e.lineTo(n+i,a),e.lineTo(t+i,s),e.lineTo(t-i,s),e.lineTo(n-i,a)}}e.closePath(),e.fillStyle=(0,r.generateColor)(n,s),e.fill()})}}var d=i(52280),u=i(70617),c=i(1132),_=i(12826);class p extends a{constructor(){super(...arguments),this._startIndex=0}setStartIndex(e){this._startIndex=e}at(e){const t=e-this._startIndex;for(;t>=this._actualLength;){if(this._items.length<=t)this._items.push({plot1Value:void 0,plot2Value:void 0,colorIndex:void 0});else{const e=this._items[this._actualLength];e.plot1Value=void 0,e.plot2Value=void 0,e.colorIndex=void 0}this._actualLength+=1}return this._items[t]}}class m{constructor(e,t,i=!1){this._isHlineFill=!1,this._bandAKey=null,this._bandBKey=null,this._colorPlotIndex=null,this._colorValues=[],this._colors=new a,this._areaRenderer=new h,this._invalidated=!0,this._plIndex1=null,this._plIndex2=null,this._level1=0,this._level2=0,this._studyValuesCache=new p,this._points1=new a,this._points2=new a,this._timePoints=new a,this._colorAreas=new o,this._source=e,this._model=t,this._fillGaps=i}update(){this._invalidated=!0}renderer(e,t){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._areaRenderer}_correctVisibleRange(e){const t=this._source.data(),i=t.search(e.firstBar(),d.PlotRowSearchMode.NearestLeft,this._plotIndex1()),s=t.search(e.firstBar(),d.PlotRowSearchMode.NearestLeft,this._plotIndex2()),r=t.search(e.lastBar(),d.PlotRowSearchMode.NearestRight,this._plotIndex1()),n=t.search(e.lastBar(),d.PlotRowSearchMode.NearestRight,this._plotIndex2()),a=null!==i?i.index:e.firstBar(),o=null!==s?s.index:e.firstBar(),l=null!==r?r.index:e.lastBar(),h=null!==n?n.index:e.lastBar();return[Math.min(a,o),Math.max(l,h)]}_plotNames(){return this._source.metaInfo().plots.map(e=>e.id)}_plotIndex1(){return null===this._plIndex1&&(this._plIndex1=this._plotNames().indexOf(this._plotAId())+1),this._plIndex1}_plotIndex2(){return null===this._plIndex2&&(this._plIndex2=this._plotNames().indexOf(this._plotBId())+1),this._plIndex2}_updateImpl(){var e,t,i;if(this._areaRenderer.setData(null),!this._visible())return;const r=this._source.priceScale(),n=this._model,a=n.timeScale();if(!r||r.isEmpty()||a.isEmpty())return;if(n.mainSeries().bars().isEmpty())return;const o=this._source.firstValue();if(null===o)return;if(this._isHlineFill){const e=this._source.properties().bands[(0,s.ensureNotNull)(this._bandAKey)],t=this._source.properties().bands[(0,s.ensureNotNull)(this._bandBKey)];this._level1=r.priceToCoordinate(e.value.value(),o),this._level2=r.priceToCoordinate(t.value.value(),o)}const l=a.visibleBarsStrictRange()
;if(null===l)return;this._timePoints.invalidateCache(),this._points1.invalidateCache(),this._points2.invalidateCache(),null===(e=this._colors)||void 0===e||e.invalidateCache(),this._colorAreas.invalidateCache();const[h,d]=this._correctVisibleRange(l),c=this._isPerBarColoringSupported()?this._colors:null,p=this._source.offset(this._plotAId()),m=this._source.offset(this._plotBId()),y=Math.min(p,m),f=Math.max(p,m),g=this._plotIndex1(),S=this._plotIndex2(),b=this._source.data();if(b.isEmpty())return;let v,w;const P=(0,s.ensureNotNull)(b.firstIndex()),x=(0,s.ensureNotNull)(b.lastIndex()),I=P-Math.max(0,-y),C=x+Math.max(0,f),T=Math.max(h-1,I),V=Math.min(d+1,C),A=this._studyValuesCache;A.invalidateCache();const M=T-f,L=b.rangeIterator(M,V-y),R=Math.max(l.firstBar()-1,Math.min(M-f-1,M-1+y));A.setStartIndex(R);const D=new _.BarsRange(l.firstBar()-1,l.lastBar()+1);for(;L.hasNext();){const e=L.next(),t=e.index,i=e.value,r=i[g],n=i[S],a=t+p,o=t+m;if(a===o&&D.contains(a)){const e=A.at(a);e.plot1Value=r,e.plot2Value=n}else{if(D.contains(a)){A.at(a).plot1Value=r}if(D.contains(o)){A.at(o).plot2Value=n}}if(null!==c){const e=t-1+y;if(l.contains(e)){const t=i[(0,s.ensureNotNull)(this._colorPlotIndex)+1];A.at(e).colorIndex=t}}}const E=this._timePoints,B=this._points1,k=this._points2;let O=null;const N=R+A.length();for(let e=R;e<=N;e++){if(!this._fillGaps&&(null===v||null===w)){const t=e-1;E.push(t),B.push(NaN),k.push(NaN),null==c||c.push(null)}const s=A.at(e);if(null!==c){const e=s.colorIndex;O=null==e?null:this._getColorByPlotValue(e)}if(this._isHlineFill){E.push(e),null!==c&&c.push(O);continue}const r=null!==(t=s.plot1Value)&&void 0!==t?t:null,n=null!==(i=s.plot2Value)&&void 0!==i?i:null;(null!==r||null!==n||Number.isFinite(v)||Number.isFinite(w))&&(v=r,w=n,B.push(r),k.push(n),E.push(e),null!==c&&c.push(O))}r.pricesArrayToCoordinates(B.data(),o,B.length()),r.pricesArrayToCoordinates(k.data(),o,k.length()),a.indexesToCoordinates(E.data(),E.length());const F=this._transparency();let W=(0,u.isNumber)(F)?F:50;W=Math.min(W,100),W=Math.max(W,0);const H={barSpacing:this._model.timeScale().barSpacing(),transparency:W,colorAreas:this._getFilledAreas(E,B,k,c)};this._areaRenderer.setData(H)}_getFilledAreas(e,t,i,s){const r=this._isHlineFill;if(!r&&(0===t.length()||0===i.length()))return new o;const n=this._colorAreas;let h=null,d=null;const u=this._color();for(let o=0;o<e.length();o++){const _=r?this._level1:t.at(o),p=r?this._level2:i.at(o),m=e.at(o),y=(0,c.coordinateIsValid)(_),f=(0,c.coordinateIsValid)(p);if(this._fillGaps?y||f:y&&f){const e=s?s.at(o)||"":u;if(d!==e||null===h){d=e,null!==h&&(y&&h.addPoints1Point(m,_),f&&h.addPoints2Point(m,p));const t=n.get(e)||new a;h=t.newItem()||new l,t.push(h),n.set(e,t)}y&&h.addPoints1Point(m,_),f&&h.addPoints2Point(m,p)}else this._fillGaps||(d=null,h=null)}return n.delete(""),n}}},51975:(e,t,i)=>{i.d(t,{AreaBackgroundPaneView:()=>n});var s=i(66915),r=i(8484);class n extends r.AbstractFilledAreaPaneView{constructor(e,t){super(e,t)}_plotAId(){return this._source.properties().area[0].name.value()}
_plotBId(){return this._source.properties().area[1].name.value()}_color(){return this._source.properties().areaBackground.backgroundColor.value()}_transparency(){const e=this._source.properties().areaBackground.transparency.value();return(0,s.clamp)(e,0,100)}_visible(){return this._source.properties().areaBackground.fillBackground.value()}_getColorByPlotValue(e){return this._color()}_isPerBarColoringSupported(){return!1}}},71437:(e,t,i)=>{i.d(t,{DwgBoxStyle:()=>s,materializeDwgBox:()=>o,dematerializeDwgBox:()=>l});var s,r,n=i(76745),a=i(95078);function o(e,t){var i;if(e.x1>=t.length||e.x2>=t.length||null===e.y1||null===e.y2)return null;let s=t[e.x1],r=t[e.x2];return s===n.INVALID_TIME_POINT_INDEX&&(s=null),r===n.INVALID_TIME_POINT_INDEX&&(r=null),{left:s,right:r,top:e.y1,bottom:e.y2,borderColorIndex:e.c,backgroundColorIndex:e.bc,extend:e.ex,borderStyle:e.st,borderWidth:e.w,text:e.t,wordWrap:e.tw,horizontalTextAlignment:e.tha,verticalTextAlignment:e.tva,fontSize:e.ts,textColorIndex:null!==(i=e.tc)&&void 0!==i?i:null}}function l(e,t,i){var s,r;return{id:t,x1:(0,a.ensureTimePointIndexIndex)(i.indexOf(null!==(s=e.left)&&void 0!==s?s:n.INVALID_TIME_POINT_INDEX)),x2:(0,a.ensureTimePointIndexIndex)(i.indexOf(null!==(r=e.right)&&void 0!==r?r:n.INVALID_TIME_POINT_INDEX)),y1:e.top,y2:e.bottom,c:e.borderColorIndex,bc:e.backgroundColorIndex,ex:e.extend,st:e.borderStyle,w:e.borderWidth,t:e.text,tw:e.wordWrap,tha:e.horizontalTextAlignment,tva:e.verticalTextAlignment,ts:e.fontSize,tc:e.textColorIndex}}!function(e){e.Solid="sol",e.Dotted="dot",e.Dashed="dsh",e.LeftArrow="al",e.RightArrow="ar",e.BothArrow="ab"}(s||(s={})),function(e){e.Top="top",e.Center="center",e.Bottom="bottom"}(r||(r={}))},34088:(e,t,i)=>{i.d(t,{DwgExtend:()=>s,isExtendInSameDirection:()=>a,convertPointsToScreenDimension:()=>o,doesItemAffectVisibleRange:()=>l});var s,r=i(88537);function n(e,t){return e===s.None?t:t===s.None?e:e===s.Both||t===s.Both?s.Both:e===t?t:s.Both}function a(e,t){return e===s.Both||e===t}function o(e,t,i,a,o,l,h,d,u){let c,_;if(null===e&&null===i){if(o!==s.Right&&o!==s.Both)return null;o=s.Both,c=0,_=d}else null===e?(c=h.indexToCoordinate((0,r.ensureNotNull)(i)-1),o=n(o,s.Left)):c=h.indexToCoordinate(e),null===i?(_=h.indexToCoordinate((0,r.ensureNotNull)(e)-1),o=n(o,s.Right)):_=h.indexToCoordinate(i);return{x1:c,y1:l.priceToCoordinate(t,u),x2:_,y2:l.priceToCoordinate(a,u),extend:o}}function l(e,t,i,r,n){let a=!1;switch(i){case s.Both:a=!0;break;case s.Right:a=null===t||null===e||e<=n;break;case s.Left:a=null===t||t>=r;break;default:null!==e&&null!==t?a=(e>=r||t>=r)&&(e<=n||t<=n):null!==e&&null===t?a=e<=n:null===e&&null!==t&&(a=t>=r)}return a}!function(e){e.None="n",e.Left="l",e.Right="r",e.Both="b"}(s||(s={}))},52256:(e,t,i)=>{i.d(t,{DwgLabelPaneViewConstants:()=>s,calculateLabelHeight:()=>a,calculateDwgLabelsMargins:()=>o});var s,r=i(18458),n=i(56164);function a(e,t,i){let s=i;switch(t){case r.PlotSymbolSize.Tiny:s=.6*e;break;case r.PlotSymbolSize.Small:s=.8*e;break;case r.PlotSymbolSize.Normal:s=e;break;case r.PlotSymbolSize.Large:s=1.5*e
;break;case r.PlotSymbolSize.Huge:s=2*e}return s}function o(e,t,i){const r=e.model().timeScale().barSpacing(),o=Math.round(r*s.AUTO_SIZE_MULT),l=a(s.NORMAL_SIZE,t.size,o)*s.SHAPE_HEIGHT_MULT;switch(t.style){case n.DwgLabelStyle.LabelUp:case n.DwgLabelStyle.LabelLeftUp:case n.DwgLabelStyle.LabelRightUp:return{bottomPixelMargin:l,topPixelMargin:0};case n.DwgLabelStyle.LabelDown:case n.DwgLabelStyle.LabelLeftDown:case n.DwgLabelStyle.LabelRightDown:return{bottomPixelMargin:0,topPixelMargin:l};case n.DwgLabelStyle.LabelLeft:case n.DwgLabelStyle.LabelRight:case n.DwgLabelStyle.LabelCenter:return{bottomPixelMargin:.5*l,topPixelMargin:.5*l}}return{bottomPixelMargin:0,topPixelMargin:0}}!function(e){e.NORMAL_SIZE=50,e.AUTO_SIZE_MULT=1,e.SHAPE_HEIGHT_MULT=.5,e.SHAPE_WIDTH_MULT=.6,e.FONT_SIZE_MULT=.24}(s||(s={}))},56164:(e,t,i)=>{i.d(t,{DwgLabelTextAlign:()=>s,DwgLabelYloc:()=>r,DwgLabelStyle:()=>n,materializeDwgLabel:()=>l,dematerializeDwgLabel:()=>h});var s,r,n,a=i(76745),o=i(95078);function l(e,t){if(e.x>=t.length)return null;const i=t[e.x];return i===a.INVALID_TIME_POINT_INDEX?null:{x:i,y:e.y,yloc:e.yl,text:e.t,style:e.st,size:e.sz,colorIndex:e.ci,textColorIndex:e.tci,textAlign:e.ta||s.Center,tooltip:e.tt||""}}function h(e,t,i){return{id:t,x:(0,o.ensureTimePointIndexIndex)(i.indexOf(e.x)),y:e.y,yl:e.yloc,t:e.text,st:e.style,sz:e.size,ci:e.colorIndex,tci:e.textColorIndex,ta:e.textAlign,tt:e.tooltip}}!function(e){e.Left="left",e.Center="center",e.Right="right"}(s||(s={})),function(e){e.AboveBar="ab",e.BelowBar="bl",e.Price="pr",e.Auto="auto"}(r||(r={})),function(e){e.Xcross="xcr",e.Cross="cr",e.Triangleup="tup",e.Triangledown="tdn",e.Flag="flg",e.Circle="cir",e.Arrowup="aup",e.Arrowdown="adn",e.LabelUp="lup",e.LabelDown="ldn",e.LabelLeft="llf",e.LabelRight="lrg",e.LabelCenter="lcn",e.LabelLeftUp="luplf",e.LabelLeftDown="llwlf",e.LabelRightUp="luprg",e.LabelRightDown="llwrg",e.Square="sq",e.Diamond="dia",e.None="n"}(n||(n={}))},69278:(e,t,i)=>{i.d(t,{materializeDwgLine:()=>a,dematerializeDwgLine:()=>o,getDwgLineDrawPattern:()=>h});var s,r=i(76745),n=i(95078);function a(e,t){if(e.x1>=t.length||e.x2>=t.length||null===e.y1||null===e.y2)return null;let i=t[e.x1],s=t[e.x2];return i===r.INVALID_TIME_POINT_INDEX&&(i=null),s===r.INVALID_TIME_POINT_INDEX&&(s=null),null!==i&&null!==s||e.y1===e.y2?{id:e.id,x1:i,y1:e.y1,x2:s,y2:e.y2,style:e.st,extend:e.ex,width:e.w,colorIndex:e.ci}:null}function o(e,t,i){var s,a;const o=(0,n.ensureTimePointIndexIndex)(i.indexOf(null!==(s=e.x1)&&void 0!==s?s:r.INVALID_TIME_POINT_INDEX)),l=(0,n.ensureTimePointIndexIndex)(i.indexOf(null!==(a=e.x2)&&void 0!==a?a:r.INVALID_TIME_POINT_INDEX));return{id:t,x1:o,y1:e.y1,x2:l,y2:e.y2,st:e.style,ex:e.extend,w:e.width,ci:e.colorIndex}}!function(e){e.Solid="sol",e.Dotted="dot",e.Dashed="dsh",e.LeftArrow="al",e.RightArrow="ar",e.BothArrow="ab"}(s||(s={}));const l=new Map([[s.Solid,{dashPattern:[],drawLeftArrow:!1,drawRightArrow:!1}],[s.Dashed,{dashPattern:[5,6],drawLeftArrow:!1,drawRightArrow:!1}],[s.Dotted,{dashPattern:[1,2],drawLeftArrow:!1,drawRightArrow:!1
}],[s.LeftArrow,{dashPattern:[],drawLeftArrow:!0,drawRightArrow:!1}],[s.RightArrow,{dashPattern:[],drawLeftArrow:!1,drawRightArrow:!0}],[s.BothArrow,{dashPattern:[],drawLeftArrow:!0,drawRightArrow:!0}]]);function h(e){return l.get(e)}},74316:(e,t,i)=>{i.r(t),i.d(t,{LiveStudyGraphics:()=>j,StaticStudyGraphics:()=>N,createGraphicsPaneViews:()=>ee,createGraphicsPriceAxisViews:()=>ie,emptyStudyGraphics:()=>U,isStudyGraphicsEmpty:()=>n,loadStudyGraphics:()=>z,saveStudyGraphics:()=>G});var s=i(11905);const r=["horizlines","vertlines","lines","hlines","textmarks","shapemarks","backgrounds","polygons","trendchannels","hhists","dwglabels","dwglines","dwgboxes","dwgtables","dwgtablecells","dwglinefills"];function n(e){return!r.some(t=>e[t]().size>0)}function a(e){const t=new Map;return e.forEach((e,i)=>{e.forEach(e=>{const s={...e,styleId:i},r=e.firstBarTime;let n=t.get(r);void 0===n&&(n=new Set,t.set(r,n)),n.add(s)})}),t}var o=i(76745),l=i(88537),h=i(95078);function d(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],s=t[e.endIndex];return i===o.INVALID_TIME_POINT_INDEX||s===o.INVALID_TIME_POINT_INDEX?null:((0,l.assert)(i<=s,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:s,level:e.level,extendLeft:e.extendLeft,extendRight:e.extendRight})}function u(e,t,i){const s=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),r=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:s,endIndex:r}}function c(e,t){if(e.index>=t.length)return null;const i=t[e.index];return i===o.INVALID_TIME_POINT_INDEX?null:{startPrice:e.startPrice,endPrice:e.endPrice,index:i,extendTop:e.extendTop,extendBottom:e.extendBottom}}function _(e,t,i){const s=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.index));return{id:t,...e,index:s}}var p=i(59192);function m(e,t){for(const i of e.points){if(i.index>=t.length)return null;if(t[i.index]===o.INVALID_TIME_POINT_INDEX)return null}return{points:e.points.map(e=>({index:t[e.index],offset:e.offset,level:e.level}))}}function y(e,t,i){return{id:t,points:e.points.map(e=>({...e,index:(0,h.ensureTimePointIndexIndex)(i.indexOf(e.index))}))}}function f(e,t){if(e.start>=t.length||e.stop>=t.length)return null;const i=t[e.start],s=t[e.stop];return s===o.INVALID_TIME_POINT_INDEX?null:((0,l.assert)(i===o.INVALID_TIME_POINT_INDEX||i<=s,"start should not exceed stop"),{start:i===o.INVALID_TIME_POINT_INDEX?null:i,stop:s})}function g(e,t,i){return{id:t,start:(0,h.ensureTimePointIndexIndex)(i.indexOf(null!==e.start?e.start:o.INVALID_TIME_POINT_INDEX)),stop:(0,h.ensureTimePointIndexIndex)(i.indexOf(e.stop))}}var S,b=i(32229);function v(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],s=t[e.endIndex];return i===o.INVALID_TIME_POINT_INDEX||s===o.INVALID_TIME_POINT_INDEX?null:((0,l.assert)(i<=s,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:s,startOffset:e.startOffset,endOffset:e.endOffset,startPrice:e.startPrice,endPrice:e.endPrice})}function w(e,t,i){const s=(0,
h.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),r=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:s,endIndex:r}}function P(e,t){if(e.time>=t.length)return null;const i=t[e.time];return i===o.INVALID_TIME_POINT_INDEX?null:{time:i,price:e.price}}function x(e,t,i){const s=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.time));return{id:t,...e,time:s}}!function(e){e.Circle="circle",e.ArrowUp="arrowUp",e.ArrowDown="arrowDown",e.ArrowRight="arrowRight",e.ArrowLeft="arrowLeft",e.Square="square"}(S||(S={}));var I=i(74487);function C(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],s=t[e.endIndex];return i===o.INVALID_TIME_POINT_INDEX||s===o.INVALID_TIME_POINT_INDEX?null:((0,l.assert)(i<=s,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:s,extendLeft:e.extendLeft,extendRight:e.extendRight,startHighPrice:e.startHighPrice,startLowPrice:e.startLowPrice,endHighPrice:e.endHighPrice,transparency:e.transparency})}function T(e,t,i){const s=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),r=(0,h.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:s,endIndex:r}}var V,A=i(56164),M=i(69278),L=i(71437);function R(e,t){return{id:e.id,position:e.pos,rows:e.rows,columns:e.cols,backgroundColorIndex:e.bgc,frameColorIndex:e.frmc,frameWidth:e.frmw,borderColorIndex:e.brdc,borderWidth:e.brdw}}function D(e,t,i){return{id:t,pos:e.position,rows:e.rows,cols:e.columns,bgc:e.backgroundColorIndex,frmc:e.frameColorIndex,frmw:e.frameWidth,brdc:e.borderColorIndex,brdw:e.borderWidth}}function E(e,t){var i,s;return{tableId:e.tid,row:e.row,column:e.col,widthInPercentsOfPaneWidth:e.w,heightInPercentOfPaneHeight:e.h,text:e.t,textColorIndex:e.tc,horizontalTextAlignment:e.tha,verticalTextAlignment:e.tva,fontSize:e.ts,backgroundColorIndex:e.bgc,colSpan:null!==(i=e.colspan)&&void 0!==i?i:1,rowSpan:null!==(s=e.rowspan)&&void 0!==s?s:1,tooltip:e.tt}}function B(e,t,i){return{id:t,tid:e.tableId,row:e.row,col:e.column,w:e.widthInPercentsOfPaneWidth,h:e.heightInPercentOfPaneHeight,t:e.text,tc:e.textColorIndex,tha:e.horizontalTextAlignment,tva:e.verticalTextAlignment,ts:e.fontSize,bgc:e.backgroundColorIndex,colspan:e.colSpan,rowspan:e.rowSpan,tt:e.tooltip}}function k(e){return{id:e.id,line1:e.line1,line2:e.line2,colorIndex:e.ci}}function O(e,t){return{id:t,line1:e.line1,line2:e.line2,ci:e.colorIndex}}!function(e){e.Top="top",e.Center="center",e.Bottom="bottom"}(V||(V={}));class N{constructor(e,t){if(this._indexes=[],this._horizlines=new Map,this._vertlines=new Map,this._lines=new Map,this._hlines=new Map,this._textmarks=new Map,this._shapemarks=new Map,this._backgrounds=new Map,this._polygons=new Map,this._trendchannels=new Map,this._hhists=new Map,this._dwglabels=new Map,this._dwglines=new Map,this._dwgboxes=new Map,this._dwgtables=new Map,this._dwgtablecells=new Map,this._dwglinefills=new Map,"data"===e){const e=t;this._indexes=e.indexes,this._vertlines=F(e.vertlines,this._indexes,c),this._horizlines=F(e.horizlines,this._indexes,d),
this._polygons=F(e.polygons,this._indexes,m),this._hhists=F(e.hhists,this._indexes,p.materializeHHist),this._lines=F(e.lines,this._indexes,v),this._hlines=F(e.hlines,this._indexes,b.materializeLevel),this._textmarks=F(e.textmarks,this._indexes,I.materializeTextMark),this._shapemarks=F(e.shapemarks,this._indexes,P),this._backgrounds=F(e.backgrounds,this._indexes,f),this._trendchannels=F(e.trendchannels,this._indexes,C),this._dwglabels=F(e.dwglabels,this._indexes,A.materializeDwgLabel),this._dwglines=F(e.dwglines,this._indexes,M.materializeDwgLine),this._dwgboxes=F(e.dwgboxes,this._indexes,L.materializeDwgBox),this._dwgtables=F(e.dwgtables,this._indexes,R),this._dwgtablecells=F(e.dwgtablecells,this._indexes,E),this._dwglinefills=F(e.dwglinefills,this._indexes,k)}else if("state"===e){const e=t;this._indexes=e.indexes||[],this._vertlines=W(e.vertlines,this._indexes,c),this._horizlines=W(e.horizlines,this._indexes,d),this._polygons=W(e.polygons,this._indexes,m),this._hhists=W(e.hhists,this._indexes,p.materializeHHist),this._lines=W(e.lines,this._indexes,v),this._hlines=W(e.hlines,this._indexes,b.materializeLevel),this._textmarks=W(e.textmarks,this._indexes,I.materializeTextMark),this._shapemarks=W(e.shapemarks,this._indexes,P),this._backgrounds=W(e.backgrounds,this._indexes,f),this._trendchannels=W(e.trendchannels,this._indexes,C),this._dwglabels=W(e.dwglabels,this._indexes,A.materializeDwgLabel),this._dwglines=W(e.dwglines,this._indexes,M.materializeDwgLine),this._dwgboxes=W(e.dwgboxes,this._indexes,L.materializeDwgBox),this._dwgtables=W(e.dwgtables,this._indexes,R),this._dwgtablecells=W(e.dwgtablecells,this._indexes,E),this._dwglinefills=W(e.dwglinefills,this._indexes,k)}this._hhistsByTimePointIndex=a(this._hhists)}horizlines(){return this._horizlines}vertlines(){return this._vertlines}lines(){return this._lines}hlines(){return this._hlines}textmarks(){return this._textmarks}shapemarks(){return this._shapemarks}backgrounds(){return this._backgrounds}polygons(){return this._polygons}trendchannels(){return this._trendchannels}hhists(){return this._hhists}dwglabels(){return this._dwglabels}dwglines(){return this._dwglines}dwgboxes(){return this._dwgboxes}dwgtables(){return this._dwgtables}dwgtablecells(){return this._dwgtablecells}dwglinefills(){return this._dwglinefills}hhistsByTimePointIndex(){return this._hhistsByTimePointIndex}}function F(e,t,i){const s=new Map;return e.forEach((e,r)=>{const n=s.get(r)||new Set;e.forEach(e=>{const s=i(e,t);null!==s&&n.add(s)}),s.set(r,n)}),s}function W(e,t,i){const s=new Map;if(void 0===e)return s;for(const r of e){const e=r.styleId,n=s.get(e)||new Set;r.data.forEach(e=>{const s=i(e,t);null!==s&&n.add(s)}),s.set(e,n)}return s}function H(e,t,i,s){const r=[];return e.forEach((e,n)=>{e.forEach(e=>{!function(e,t,i){let s=null;for(const i of e)i.styleId===t&&(s=i);null===s&&(s={styleId:t,data:[]},e.push(s)),s.data.push(i)}(r,n,s(e,t(e),i))})}),r.length>0?r:void 0}function U(){return new N}function z(e){return new N("state",e)}function G(e){const t=function(e){const t=new Set
;e.horizlines().forEach((e,i)=>{e.forEach(e=>{t.add(e.startIndex),t.add(e.endIndex)})}),e.vertlines().forEach((e,i)=>{e.forEach(e=>{t.add(e.index)})}),e.lines().forEach((e,i)=>{e.forEach(e=>{t.add(e.startIndex),t.add(e.endIndex)})}),e.textmarks().forEach((e,i)=>{e.forEach(e=>{t.add(e.time)})}),e.shapemarks().forEach((e,i)=>{e.forEach(e=>{t.add(e.time)})}),e.backgrounds().forEach((e,i)=>{e.forEach(e=>{t.add(null!==e.start?e.start:o.INVALID_TIME_POINT_INDEX),t.add(e.stop)})}),e.polygons().forEach((e,i)=>{e.forEach(e=>{e.points.forEach(e=>{t.add(e.index)})})}),e.trendchannels().forEach((e,i)=>{e.forEach(e=>{t.add(e.startIndex),t.add(e.endIndex)})}),e.hhists().forEach((e,i)=>{e.forEach(e=>{t.add(e.firstBarTime),t.add(e.lastBarTime)})}),e.dwglabels().forEach((e,i)=>{e.forEach(e=>{t.add(e.x)})}),e.dwglines().forEach((e,i)=>{e.forEach(e=>{var i,s;t.add(null!==(i=e.x1)&&void 0!==i?i:o.INVALID_TIME_POINT_INDEX),t.add(null!==(s=e.x2)&&void 0!==s?s:o.INVALID_TIME_POINT_INDEX)})}),e.dwgboxes().forEach((e,i)=>{e.forEach(e=>{var i,s;t.add(null!==(i=e.left)&&void 0!==i?i:o.INVALID_TIME_POINT_INDEX),t.add(null!==(s=e.right)&&void 0!==s?s:o.INVALID_TIME_POINT_INDEX)})});const i=Array.from(t);return i.sort((e,t)=>e-t),i}(e),i={indexes:t};let s=0;const r=()=>++s,n=e=>e.id,a=e=>e.id;return i.vertlines=H(e.vertlines(),r,t,_),i.horizlines=H(e.horizlines(),r,t,u),i.polygons=H(e.polygons(),r,t,y),i.hhists=H(e.hhists(),r,t,p.dematerializeHHist),i.lines=H(e.lines(),r,t,w),i.hlines=H(e.hlines(),r,t,b.dematerializeLevel),i.textmarks=H(e.textmarks(),r,t,I.dematerializeTextMark),i.shapemarks=H(e.shapemarks(),r,t,x),i.backgrounds=H(e.backgrounds(),r,t,g),i.trendchannels=H(e.trendchannels(),r,t,T),i.dwglabels=H(e.dwglabels(),r,t,A.dematerializeDwgLabel),i.dwglines=H(e.dwglines(),a,t,M.dematerializeDwgLine),i.dwgboxes=H(e.dwgboxes(),r,t,L.dematerializeDwgBox),i.dwgtables=H(e.dwgtables(),n,t,D),i.dwgtablecells=H(e.dwgtablecells(),r,t,B),i.dwglinefills=H(e.dwglinefills(),r,t,O),i}class j{constructor(){this._indexes=[],this._horizlines=new Map,this._vertlines=new Map,this._lines=new Map,this._hlines=new Map,this._textmarks=new Map,this._shapemarks=new Map,this._backgrounds=new Map,this._polygons=new Map,this._trendchannels=new Map,this._hhists=new Map,this._dwglabels=new Map,this._dwgboxes=new Map,this._dwglines=new Map,this._dwgtables=new Map,this._dwgtablecells=new Map,this._dwglinefills=new Map,this._hhistsByTimePointIndex=new Map}horizlines(){return this._horizlines}vertlines(){return this._vertlines}lines(){return this._lines}hlines(){return this._hlines}textmarks(){return this._textmarks}shapemarks(){return this._shapemarks}backgrounds(){return this._backgrounds}polygons(){return this._polygons}trendchannels(){return this._trendchannels}hhists(){return this._hhists}dwglabels(){return this._dwglabels}dwglines(){return this._dwglines}dwgboxes(){return this._dwgboxes}dwgtables(){return this._dwgtables}dwgtablecells(){return this._dwgtablecells}dwglinefills(){return this._dwglinefills}hhistsByTimePointIndex(){return this._hhistsByTimePointIndex}
clear(){this._indexes=[],this._clearPrimitives()}extract(){const e=e=>e.extract(),t={indexes:this._indexes,horizlines:q(this._horizlines,e),vertlines:q(this._vertlines,e),lines:q(this._lines,e),hlines:q(this._hlines,e),textmarks:q(this._textmarks,e),shapemarks:q(this._shapemarks,e),backgrounds:q(this._backgrounds,e),polygons:q(this._polygons,e),trendchannels:q(this._trendchannels,e),hhists:q(this._hhists,e),dwglabels:q(this._dwglabels,e),dwglines:q(this._dwglines,e),dwgboxes:q(this._dwgboxes,e),dwgtables:q(this._dwgtables,e),dwgtablecells:q(this._dwgtablecells,e),dwglinefills:q(this._dwglinefills,e)};return this._hhistsByTimePointIndex=new Map,new N("data",t)}replaceIndexesTo(e){this._indexes=e;const t=e=>e.replaceIndexesTo(this._indexes);this._horizlines.forEach(t),this._vertlines.forEach(t),this._lines.forEach(t),this._hlines.forEach(t),this._textmarks.forEach(t),this._shapemarks.forEach(t),this._backgrounds.forEach(t),this._polygons.forEach(t),this._trendchannels.forEach(t),this._hhists.forEach(t),this._dwglabels.forEach(t),this._dwgboxes.forEach(t),this._dwglines.forEach(t),this._dwgtables.forEach(t),this._dwgtablecells.forEach(t),this._dwglinefills.forEach(t),this._hhistsByTimePointIndex=a(this._hhists)}processCommands(e,t){void 0!==e.erase&&this._processEraseCommands(e.erase),void 0!==e.create&&this._processCreateCommands(e.create,t)}_processCreateCommands(e,t){for(const i in e){if(!e.hasOwnProperty(i))continue;const s=i;switch((0,l.assert)(s in t,`There is a '${s}' in study response, but it doesn't present in graphics info!`),s){case"horizlines":X(this._horizlines,e[s],t[s],this._indexes,d);break;case"vertlines":X(this._vertlines,e[s],t[s],this._indexes,c);break;case"lines":X(this._lines,e[s],t[s],this._indexes,v);break;case"hlines":X(this._hlines,e[s],t[s],this._indexes,b.materializeLevel);break;case"textmarks":X(this._textmarks,e[s],t[s],this._indexes,I.materializeTextMark);break;case"shapemarks":X(this._shapemarks,e[s],t[s],this._indexes,P);break;case"backgrounds":X(this._backgrounds,e[s],t[s],this._indexes,f);break;case"polygons":X(this._polygons,e[s],t[s],this._indexes,m);break;case"trendchannels":X(this._trendchannels,e[s],t[s],this._indexes,C);break;case"hhists":X(this._hhists,e[s],t[s],this._indexes,p.materializeHHist);break;case"dwglabels":X(this._dwglabels,e[s],t[s],this._indexes,A.materializeDwgLabel);break;case"dwglines":X(this._dwglines,e[s],t[s],this._indexes,M.materializeDwgLine);break;case"dwgboxes":X(this._dwgboxes,e[s],t[s],this._indexes,L.materializeDwgBox);break;case"dwgtables":X(this._dwgtables,e[s],t[s],this._indexes,R);break;case"dwgtablecells":X(this._dwgtablecells,e[s],t[s],this._indexes,E);break;case"dwglinefills":X(this._dwglinefills,e[s],t[s],this._indexes,k)}}this._hhistsByTimePointIndex=a(this._hhists)}_processEraseCommands(e){for(const t of e)if("all"===t.action)this._clearPrimitives();else{const e=e=>e.deleteById(t.id);switch(t.type){case"horizlines":this._horizlines.forEach(e);break;case"vertlines":this._vertlines.forEach(e);break;case"lines":this._lines.forEach(e);break
;case"hlines":this._hlines.forEach(e);break;case"textmarks":this._textmarks.forEach(e);break;case"shapemarks":this._shapemarks.forEach(e);break;case"backgrounds":this._backgrounds.forEach(e);break;case"polygons":this._polygons.forEach(e);break;case"trendchannels":this._trendchannels.forEach(e);break;case"hhists":this._hhists.forEach(e);break;case"dwglabels":this._dwglabels.forEach(e);break;case"dwglines":this._dwglines.forEach(e);break;case"dwgboxes":this._dwgboxes.forEach(e);break;case"dwgtables":this._dwgtables.forEach(e);break;case"dwgtablecells":this._dwgtablecells.forEach(e);break;case"dwglinefills":this._dwglinefills.forEach(e)}}this._hhistsByTimePointIndex=a(this._hhists)}_clearPrimitives(){this._horizlines.clear(),this._vertlines.clear(),this._lines.clear(),this._hlines.clear(),this._textmarks.clear(),this._shapemarks.clear(),this._backgrounds.clear(),this._polygons.clear(),this._trendchannels.clear(),this._hhists.clear(),this._dwglabels.clear(),this._dwgboxes.clear(),this._dwglines.clear(),this._dwgtables.clear(),this._dwgtablecells.clear(),this._dwglinefills.clear(),this._hhistsByTimePointIndex=new Map}}class Y{constructor(e,t){this._primitivesDataById=new Map,this._primitiveById=new Map,this._materializePrimitive=e,this._indexes=t}forEach(e,t){this._primitiveById.forEach(i=>{e.call(t,i,i,this)})}has(e){let t=!1;return this._primitiveById.forEach(i=>{t=t||i===e}),t}get size(){return this._primitiveById.size}[Symbol.iterator](){throw new Error("Not implemented")}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}hasId(e){return this._primitiveById.has(e)}addData(e){this._primitivesDataById.set(e.id,e),this._tryMaterialize(e)}deleteById(e){this._primitiveById.delete(e),this._primitivesDataById.delete(e)}clear(){this._primitivesDataById.clear(),this._primitiveById.clear()}replaceIndexesTo(e){this._indexes=e,this._primitiveById.clear(),this._primitivesDataById.forEach(this._tryMaterialize,this)}extract(){const e=new Set(this._primitivesDataById.values());return this._primitivesDataById=new Map,this._primitiveById.clear(),e}_tryMaterialize(e){const t=this._materializePrimitive(e,this._indexes);null!==t&&((0,l.assert)(!this._primitiveById.has(e.id),"primitive with specified id should not exist"),this._primitiveById.set(e.id,t))}}function q(e,t){const i=new Map;return e.forEach((e,s)=>i.set(s,t(e))),i}function X(e,t,i,s,r){if(void 0!==t)for(const n of t){const t=n.styleId;void 0!==i&&(0,l.assert)(t in i,"Every style used by graphics primitive should be declared in study metainfo");let a=e.get(t);void 0===a&&(a=new Y(r,s),e.set(t,a)),n.data.forEach(a.addData.bind(a))}}var K=i(98424);class $ extends K.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){e.visible=!1;const s=this._source.priceScale(),r=this._source.properties().visible.value();if(!s||s.isEmpty()||!r)return;const n=this._source.properties().graphics[this._data.lineType][this._data.styleId]
;if(!(n.visible&&n.visible.value()&&n.showPrice&&n.showPrice.value()&&this._isLabelVisibleAccordinglyToProperties()))return;const a=this._source.firstValue();if(null===a)return;const o=this._data.line.level,l=n.color.value();i.background=l,i.textColor=this.generateTextColor(l),i.coordinate=s.priceToCoordinate(o,a),e.text=s.formatPrice(o,a,!0),e.visible=!0}_isLabelVisibleAccordinglyToProperties(){const e=this._source.model().properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().showLabelsOnPriceScale.value()}}const J=(0,s.getLogger)("Chart.StudyGraphics"),Z=new Set(["dwgtablecells"]);async function Q(e,t,s,r){switch(e){case"backgrounds":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,20090))).BackgroundPaneView)(t,s,r);case"hlines":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,55551))).LevelPaneView)(t,s,r);case"lines":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,48837))).LinePaneView)(t,s,r);case"shapemarks":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,49629))).ShapeMarkPaneView)(t,s,r);case"textmarks":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,41218))).TextMarkPaneView)(t,s,r);case"trendchannels":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,80662))).TrendChannelPaneView)(t,s,r);case"dwglabels":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,89555))).DwgLabelPaneView)(t,s,r);case"dwglines":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,92001))).DwgLinePaneView)(t,s,r);case"dwgboxes":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,36922))).DwgBoxPaneView)(t,s,r);case"dwgtables":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,22827))).DwgTablePaneView)(t,s,r);case"dwglinefills":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,2548))).DwgLineFillPaneView)(t,s,r)}switch(e){case"hhists":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,11486))).HHistPaneView)(t,s,r);case"horizlines":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,92787))).HorizLinePaneView)(t,s,r);case"vertlines":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,74160))).VertLinePaneView)(t,s,r);case"polygons":return new((await Promise.all([i.e(15517),i.e(46305),i.e(20507)]).then(i.bind(i,56571))).PolygonPaneView)(t,s,r)}return null}async function ee(e,t,i){const s=[],r=Object.keys(e.graphicsInfo());r.sort((e,t)=>te(e)-te(t));for(const n of r){const r=await Q(n,e,t,i);null!==r?s.push(r):Z.has(n)||J.logWarn(n+" is not supported by this build of graphics subsystem, skipping")}return s}function te(e){switch(e){case"polygons":return-100;case"trendchannels":return-90;default:return 0}}function ie(e){
const t=Object.keys(e.graphicsInfo()),i=[];for(const s of t)switch(s){case"hlines":e.graphics().hlines().forEach((t,r)=>{t.forEach(t=>{void 0!==t.level&&i.push(new $(e,{line:{level:t.level},styleId:r,lineType:s}))})});break;case"horizlines":e.graphics().horizlines().forEach((t,r)=>{t.forEach(t=>{void 0!==t.level&&i.push(new $(e,{line:{level:t.level},styleId:r,lineType:s}))})})}return i}},59192:(e,t,i)=>{i.d(t,{HHistDirection:()=>s,HHistLocation:()=>r,materializeHHist:()=>l,dematerializeHHist:()=>h});var s,r,n=i(88537),a=i(76745),o=i(95078);function l(e,t){if(e.firstBarTime>=t.length||e.lastBarTime>=t.length)return null;const i=t[e.firstBarTime],s=t[e.lastBarTime];return i===a.INVALID_TIME_POINT_INDEX||s===a.INVALID_TIME_POINT_INDEX?null:((0,n.assert)(i<=s,"firstBarTime should not exceed lastBarTime"),(0,n.assert)(e.priceLow<=e.priceHigh,"priceLow should not exceed priceHigh"),{firstBarTime:i,lastBarTime:s,rate:e.rate,priceHigh:e.priceHigh,priceLow:e.priceLow})}function h(e,t,i){const s=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.firstBarTime)),r=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.lastBarTime));return{id:t,...e,firstBarTime:s,lastBarTime:r}}!function(e){e.LeftToRight="left_to_right",e.RightToLeft="right_to_left"}(s||(s={})),function(e){e.Relative="relative",e.Absolute="absolute"}(r||(r={}))},32229:(e,t,i)=>{var s;function r(e){return{level:e.level,text:e.text}}function n(e,t,i){return{id:t,...e}}i.d(t,{TextPos:()=>s,materializeLevel:()=>r,dematerializeLevel:()=>n}),function(e){e[e.TopLeft=0]="TopLeft",e[e.TopCenter=1]="TopCenter",e[e.TopRight=2]="TopRight",e[e.MiddleLeft=3]="MiddleLeft",e[e.MiddleCenter=4]="MiddleCenter",e[e.MiddleRight=5]="MiddleRight",e[e.BottomLeft=6]="BottomLeft",e[e.BottomCenter=7]="BottomCenter",e[e.BottomRight=8]="BottomRight"}(s||(s={}))},74487:(e,t,i)=>{i.d(t,{TextMarkType:()=>s,materializeTextMark:()=>o,dematerializeTextMark:()=>l});var s,r,n=i(76745),a=i(95078);function o(e,t){if(e.time>=t.length)return null;const i=t[e.time];return i===n.INVALID_TIME_POINT_INDEX?null:{time:i,offset:e.offset,text:e.text,price:e.price}}function l(e,t,i){const s=(0,a.ensureTimePointIndexIndex)(i.indexOf(e.time));return{id:t,...e,time:s}}!function(e){e.Triangle="triangle",e.Rectangle="rectangle"}(s||(s={})),function(e){e.Verdana="Verdana",e.CourierNew="Courier New",e.TimesNewRoman="Times New Roman",e.Arial="Arial"}(r||(r={}))},76543:(e,t,i)=>{i.d(t,{makeNextSymbolId:()=>r,makeNextStudyId:()=>a});let s=0;function r(){return s++,"ss_"+s}let n=0;function a(){return n++,"st"+n}},81626:(e,t,i)=>{function s(e){e.lineWidth=void 0,e.lineStyle=void 0;for(let t=0;t<e.colors.length;t++)e.colors[t]=void 0;return e}function r(){return{colors:[void 0,void 0,void 0,void 0,void 0,void 0,void 0],lineWidth:void 0,lineStyle:void 0}}i.d(t,{clearStyle:()=>s,createEmptyStyle:()=>r})},54471:(e,t,i)=>{i.d(t,{StudyPlotPaneView:()=>R});var s=i(88537),r=i(86441),n=i(24377),a=i(11688),o=i(66915),l=i(70617),h=i(21386),d=i(46511);function u(e,t){const i=new Map;return function(...s){const r=""+(t?t.apply(null,s):s[0])
;if(!i.has(r)){const t=e.apply(this,s);return i.set(r,t),t}return i.get(r)}}var c=i(18718),_=i(96949),p=i(17611),m=i(29828),y=i(68226),f=i(52280),g=i(46037),S=i(59447),b=i(81626),v=i(1132),w=i(38456);class P{constructor(e){this._data=e}draw(e,t){const i=this._data,s=t.pixelRatio,r=Math.max(1,Math.floor(s))%2?.5:0,n=i.vertOffset||0,a=i.lineColor||i.color,o=i.lineWidth||i.height/2;let h="",d=!1;for(const t of i.items){const i=t.x,u=t.y+n;if((0,l.isNaN)(i)||(0,l.isNaN)(u))continue;let c,_;null!=t.style?(c=t.style.color,_=t.style.width):(c=a,_=o),(c!==h||w.isSafari)&&(h=c,d&&e.fill(),e.beginPath(),e.fillStyle=c);const p=Math.round(i*s)+r,m=Math.round(u*s)+r,y=Math.round(_*s)+r;e.moveTo(p+y,m),e.arc(p,m,y,0,2*Math.PI,!1),d=!0}d&&e.fill()}hitTest(e){const t=this._data,i=t.lineWidth||t.height/2,s=t.vertOffset||0,n=(0,v.interactionTolerance)().series+i;for(const a of t.items){if(!a)continue;if(new r.Point(a.x,a.y+s).subtract(e).length()+i<=n)return new c.HitTestResult(c.HitTestResult.REGULAR)}return null}}class x{constructor(e){this._data=null,this._precalculatedCache=[],this.setData(e)}setData(e){this._data=e,this._precalculatedCache=[]}draw(e,t){if(null===this._data||0===this._data.items.length)return;const i=t.pixelRatio;this._precalculatedCache.length||this._fillPrecalculatedCache(i);const s=Math.max(1,Math.floor(i)),r=Math.round(this._data.histogramBase*i)-Math.floor(s/2),n=r+s,a=this._data.lineColor;for(let t=0;t<this._data.items.length;t++){const o=this._data.items[t],l=this._precalculatedCache[t],h=Math.round(o.y*i),d=o.style?o.style.color:a;let u,c;e.fillStyle=d,h<=r?(u=h,c=n):(u=r,c=h-Math.floor(s/2)+s),e.fillRect(l.left,u,l.right-l.left+1,c-u)}}hitTest(e){if(null===this._data)return null;const t=.5*this._data.barSpacing,i=e.x-t,s=e.x+t;for(const t of this._data.items){const r=t.x;if(r>=i&&r<=s){const i=t.y;if(e.y>=Math.min(i,this._data.histogramBase)&&e.y<=Math.max(i,this._data.histogramBase))return new c.HitTestResult(c.HitTestResult.REGULAR)}}return null}_fillPrecalculatedCache(e){if(null===this._data||0===this._data.items.length)return void(this._precalculatedCache=[]);const t=Math.ceil(this._data.barSpacing*e)<=1?0:Math.max(1,Math.floor(e)),i=Math.round(this._data.barSpacing*e)-t;this._precalculatedCache=new Array(this._data.items.length);for(let t=0;t<this._data.items.length;t++){const s=this._data.items[t],r=Math.round(s.x*e);let n,a;if(i%2){const e=(i-1)/2;n=r-e,a=r+e}else{const e=i/2;n=r-e,a=r+e-1}this._precalculatedCache[t]={left:n,right:a,roundedCenter:r,center:s.x*e,time:s.timePointIndex}}for(let e=1;e<this._data.items.length;e++){const i=this._precalculatedCache[e],s=this._precalculatedCache[e-1];i.time===s.time+1&&(i.left-s.right!==t+1&&(s.roundedCenter>s.center?s.right=i.left-t-1:i.left=s.right+t+1))}let s=Math.ceil(this._data.barSpacing*e);for(let e=0;e<this._data.items.length;e++){const t=this._precalculatedCache[e];t.right<t.left&&(t.right=t.left);const i=t.right-t.left+1;s=Math.min(i,s)}if(t>0&&s<4)for(let e=0;e<this._data.items.length;e++){const t=this._precalculatedCache[e]
;t.right-t.left+1>s&&(t.roundedCenter>t.center?t.right-=1:t.left+=1)}}}var I=i(4652);class C{constructor(e){this._data=e}draw(e,t){var i,s,r,n;const a=t.pixelRatio;let o="",h=!1;for(const t of this._data.items){if((0,l.isNaN)(t.x)||(0,l.isNaN)(t.y))continue;const d=null!==(s=null===(i=t.style)||void 0===i?void 0:i.color)&&void 0!==s?s:this._data.lineColor,u=Math.max(1,Math.floor((null!==(n=null===(r=t.style)||void 0===r?void 0:r.width)&&void 0!==n?n:this._data.lineWidth)*a));(d!==o||w.isSafari)&&(o=d,h&&e.fill(),e.beginPath(),e.fillStyle=d);let c=3*u;c%2!=u%2&&(c+=1);const _=Math.round(Math.round(t.x*a)-c/2),p=Math.round(Math.round(t.y*a)-c/2),m=_+Math.floor(c/2-u/2),y=p+Math.floor(c/2-u/2);e.rect(_,y,c,u),e.rect(m,p,u,c),h=!0}h&&e.fill()}hitTest(e){const t=(0,v.interactionTolerance)().series+this._data.lineWidth/2;let i,s,n,a;for(let o=1;o<this._data.items.length;++o){i=this._data.items[o-1],s=this._data.items[o],n=i.x,a=s.x;if((0,I.distanceToSegment)(new r.Point(n,i.y),new r.Point(a,s.y),new r.Point(e.x,e.y)).distance<=t)return new c.HitTestResult(c.HitTestResult.REGULAR)}return null}}class T{constructor(e){this._data=e}draw(e,t){if(0===this._data.items.length)return;const i=t.pixelRatio;e.fillStyle=this._data.lineColor;const s=Math.max(1,Math.floor(this._data.lineWidth*i)),r=s/2,n=Math.max(1,Math.floor(i)),a=Math.round(this._data.histogramBase*i)-Math.floor(n/2),o=a+n;for(const t of this._data.items){let l=s,h=r;t.style?(e.fillStyle=t.style.color,l=Math.max(1,Math.floor(t.style.width*i)),h=l/2):e.fillStyle=this._data.lineColor;const d=l%2?.5:0,u=Math.round(t.x*i)+d,c=Math.round(t.y*i);let _,p;c<=a?(_=c,p=o):(_=a,p=c-Math.floor(n/2)+n),e.fillRect(Math.floor(u-h),_,l,p-_)}}hitTest(e){const t=(0,v.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const n of this._data.items){const a=n.x,o=n.y;let l=t;n.style&&(i.has(n.style.width)?l=(0,s.ensureDefined)(i.get(n.style.width)):i.set(this._data.lineWidth,l));if((0,I.distanceToSegment)(new r.Point(a,o),new r.Point(a,this._data.histogramBase),new r.Point(e.x,e.y)).distance<=l)return new c.HitTestResult(c.HitTestResult.REGULAR)}return null}}var V=i(18458),A=i(62857);const M=e=>{const t=(0,n.rgbToHsl)((0,n.parseRgb)(e)),i=t[0]+.05;return t[0]=i-Math.floor(i),(0,n.rgbToHexString)((0,n.hslToRgb)(t))},L=u(M);class R{constructor(e,t,i,s){this._histogramBase=null,this._items=[],this._selectionData=null,this._lineColor="",this._lineWidth=1,this._color1="",this._color2="",this._invalidated=!1,this._renderer=new p.CompositeRenderer,this._isMarkersEnabled=a.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=s,this._plotIndex=e.metaInfo().plots.findIndex(e=>e.id===s),this._colorProvider=(0,A.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new g.SelectionIndexes(i.timeScale())}items(){return this._items}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}_getTranspValue(){
const e=this._study.properties(),t=e.styles[this._plotName];let i=0;const s=this._study.metaInfo();return"Volume@tv-basicstudies"===s.id&&s.version<=46&&"transparency"in e?(i=e.transparency.value(),i=(0,l.isNumber)(i)?i:0,i):(t.transparency&&(i=t.transparency.value(),i=(0,l.isNumber)(i)?i:0),i)}_updateImpl(){var e,t,i,n,a;this._renderer.clear();const u=this._study.properties().styles[this._plotName];if(!u.visible.value())return;if(!this._study.priceScale())return;this._histogramBase=null,this._items=[];const p=this._study.priceScale();if(this._model.timeScale().isEmpty()||null===p||p.isEmpty())return;const g=this._model.timeScale().visibleBarsStrictRange();if(null===g)return;let v=null!==(e=this._series.nearestIndex(g.firstBar()-1,f.PlotRowSearchMode.NearestLeft))&&void 0!==e?e:this._series.bars().firstIndex(),w=null!==(t=this._series.nearestIndex(g.lastBar()+1,f.PlotRowSearchMode.NearestRight))&&void 0!==t?t:this._series.bars().lastIndex();if(null===v||null===w)return;const I=this._study.offset(this._plotName);I>0?(v-=I,w+=I):(v+=I,w-=I);const A=this._study.getMinFirstBarIndexForPlot(this._plotName);if(A>w)return;v=Math.max(A,v);const R=u.plottype.value(),D=[V.LineStudyPlotStyle.Line,V.LineStudyPlotStyle.Area,V.LineStudyPlotStyle.Circles,V.LineStudyPlotStyle.Cross].indexOf(R)>=0,E=this._study.data(),B=this._study.firstValue();if(null===B)return;const k=E.rangeIterator(v,w),O=this._study.priceScale();if(null===O)return;const N=(0,o.clamp)(this._getTranspValue(),0,100),F=new Map,W=(e,t)=>{let i=F.get(e);void 0===i&&(i=new Map,F.set(e,i));let s=i.get(t);if(void 0===s){const r=!this._plotName||"vol"!==this._plotName;s=(0,h.generateColor)(e,t,r),i.set(t,s)}return s};let H=NaN,U=NaN;const z=(0,b.createEmptyStyle)();for(;k.hasNext();){const e=k.next();let t=e.index;const a=e.value;t+=I,t=Math.floor(t);let o=a[this._plotIndex+1];const l=null==o;if(o=l?NaN:o,D&&l){U=o;continue}const d=new r.Point(t,(0,s.ensure)(o));d.timePointIndex=t,d.valIsNotSameAsPrev=o!==U;if(this._colorProvider.isColorDefined()&&(d.style={color:W(u.color.value(),100),width:u.linewidth.value(),style:u.linestyle.value()},null!=o)){const e=this._colorProvider.getPlotPointStyle(a,z),t=e.colors[0];void 0!==t&&(d.style.color=(0,h.isHexColor)(t)?W(t,N):t),d.style.width=null!==(i=e.lineWidth)&&void 0!==i?i:d.style.width,d.style.style=null!==(n=e.lineStyle)&&void 0!==n?n:d.style.style}D||isNaN(H)||H===t-1||this._items.push(new r.Point(t-1,NaN)),H=t,U=o,this._items.push(d)}if(O.pointsArrayToCoordinates(this._items,B),this._model.timeScale().timedValuesToCoordinates(this._items),u.histogramBase&&(this._histogramBase=O.priceToCoordinate(u.histogramBase.value(),B)),this._model.selection().isSelected(this._study)){const e=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:c.HitTestResult.REGULAR,barSpacing:this._model.timeScale().barSpacing()};const t=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height();for(let i=0;i<e.length;i++){let s=e[i];const n=this._study.data().valueAt(s);if(s+=I,
null===n)continue;const a=n[this._plotIndex+1];if(null==a)continue;const o=this._model.timeScale().indexToCoordinate(Math.floor(s)),l=O.priceToCoordinate(a,B);this._selectionData.points.push(new r.Point(o,l)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(l/t))}}else this._selectionIndexer.clear();const G=u;this._lineColor=(0,h.generateColor)(G.color.value(),N),this._lineWidth=G.linewidth.value();let j=G.color.value();const Y=this._colorProvider.getDefaultPlotPointStyle();Y&&(j=Y.colors[0],this._lineWidth=null!==(a=Y.lineWidth)&&void 0!==a?a:this._lineWidth,this._lineColor=j?(0,h.generateColor)(j,N):this._lineColor),this._color2=(0,h.generateColor)(j,N);const q=this._study.metaInfo().isRGB?M(j):L(j);this._color1=(0,h.generateColor)(q,N);const X={};X.barSpacing=this._model.timeScale().barSpacing(),X.items=this._items,X.histogramBase=this._histogramBase?this._histogramBase:(0,s.ensureNotNull)(this._study.priceScale()).height(),X.lineIndex=0,X.lineStyle=u.linestyle.value(),X.lineColor=this._lineColor,X.lineWidth=this._lineWidth,X.lineWidth=(0,l.isNumber)(X.lineWidth)?X.lineWidth:1,X.color1=this._color1,X.color2=this._color2,X.bottom=X.histogramBase,X.simpleMode=this._colorProvider.singleColor();const K=this._renderer,$=!!u.joinPoints&&u.joinPoints.value();switch(u.plottype.value()){case V.LineStudyPlotStyle.Line:case V.LineStudyPlotStyle.LineWithBreaks:K.append(new m.PaneRendererLine(X));break;case V.LineStudyPlotStyle.Area:case V.LineStudyPlotStyle.AreaWithBreaks:K.append(new _.PaneRendererArea(X));break;case V.LineStudyPlotStyle.Histogram:K.append(new T(X));break;case V.LineStudyPlotStyle.Columns:K.append(new x(X));break;case V.LineStudyPlotStyle.Cross:if(K.append(new C(X)),$){const e=(0,d.deepCopy)(X);e.lineWidth=1,e.forceLineWidth=!0,K.append(new m.PaneRendererLine(e))}break;case V.LineStudyPlotStyle.Circles:if(K.append(new P(X)),$){const e=(0,d.deepCopy)(X);e.lineWidth=1,e.ignorePaletteLineWidth=!0,K.append(new m.PaneRendererLine(e))}break;case V.LineStudyPlotStyle.StepLine:case V.LineStudyPlotStyle.StepLineWithDiamonds:{X.decoration=G.plottype.value()===V.LineStudyPlotStyle.StepLineWithDiamonds?y.StepLineDecoration.Diamonds:y.StepLineDecoration.None;const e=new y.PaneRendererStepLine;e.setData(X),K.append(e);break}default:K.append(new m.PaneRendererLine(X))}this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&K.append(new S.SelectionRenderer(this._selectionData))}}},60511:(e,t,i)=>{i.d(t,{PaneRendererAbstractShape:()=>c,PaneRendererAbstractStrokeShape:()=>_,PaneRendererAbstractFillStrokeShape:()=>p});var s=i(88537),r=i(86441),n=i(34026),a=i(18718),o=i(45455),l=i(67151),h=i(88427),d=i(24112),u=i(38456);class c{constructor(e,t={skipRenderingOptimizations:!1}){this._items=[],this._barSpacing=0,this._vertOffset=0,this._textCache=t.textCache||new o.TextImageCachesContainer(5e3),this._drawOperation=t.skipRenderingOptimizations?this._drawWithoutOptimizations.bind(this):this._drawWithOptimizations.bind(this),null!==e&&this.setData(e)}draw(e,t){
this._preDrawInit(),this._drawOperation(e,t)}hitTest(e){const t=a.HitTestResult.REGULAR;let i=null;for(const s of this._items){if(!s)continue;const r=this._calcBoundingBox(s);if(r&&(0,n.pointInBox)(e,r)){const e={tooltip:this._getTooltip(s,r)};i=new a.HitTestResult(t,e)}}return i}setData(e){this._height=void 0!==e.height?e.height:e.width,this._width=void 0!==e.width?e.width:e.height,this._color=e.color,this._borderColor=e.borderColor,this._vertOffset=e.vertOffset||0,e.text&&(this._text=e.text,this._fontSize=e.fontSize,this._lineSpacing=e.lineSpacing,this._textColor=e.textColor,this._textAlign=e.textAlign||"center"),void 0!==e.items&&void 0!==e.barSpacing&&this.setItems(e.items,e.barSpacing)}setItems(e,t){this._setBaseData(e,t)}_calcBoundingBox(e){const t=e.vertOffset,i=this._getTextCache(e);if(!i)return;const s=i.textImageWidth,n=i.textImageHeight,a=s/2,o=e.y+t+e.textVertOffset,l=t>0?0:-n,h=t>0?n:0,d=new r.Point(e.x-a,o+l),u=new r.Point(e.x+a,o+h);return(0,r.box)(d,u)}_unionBox(e,t){const i=Math.min(e.min.x,t.min.x),s=Math.max(e.max.x,t.max.x),n=Math.min(e.min.y,t.min.y),a=Math.max(e.max.y,t.max.y),o=new r.Point(i,n),l=new r.Point(s,a);return(0,r.box)(o,l)}_getTooltip(e,t){if(e.tooltip)return{content:{type:"text",data:e.tooltip},tooltipDelay:200,extendMargin:!0,rect:{x:t.min.x,y:t.min.y,w:Math.abs(t.max.x-t.min.x),h:Math.abs(t.max.y-t.min.y)}}}_setBaseData(e,t){this._items.length=0,this._barSpacing=t;for(const t of e){const e=void 0===t.width?(0,s.ensureDefined)(this._width):t.width,i=void 0===t.height?(0,s.ensureDefined)(this._height):t.height,r=void 0===t.vertOffset?this._vertOffset:t.vertOffset,n=r>0?i:-i;this._items.push({width:e,height:i,vertOffset:r,textVertOffset:n,shapeWidth:0,shapeHeight:0,stepX:0,stepY:0,...t})}}_drawItemText(e,t,i){const s=this._getTextCache(i);if(null===s)return;const r=i.x,n=i.vertOffset,a=i.y+n+i.textVertOffset;let o;o=i.style&&void 0!==i.style.textColor?i.style.textColor:this._textColor,s.paintTo(e,t,o,r,a,l.HorizontalAlign.Center,n>0?l.VerticalAlign.Top:l.VerticalAlign.Bottom)}_drawWithOptimizations(e,t){let i,s,r=null,n=!1;for(const a of this._items)a.style&&void 0!==a.style.color?(i=a.style.color||"rgba(0, 0, 0, 0)",s=a.style.borderColor||"rgba(0, 0, 0, 0)"):(i=this._color,s=this._borderColor),(r!==i||u.isSafari)&&(r=i,n&&this._endPath(e),this._startPath(e,t,i,s)),this._drawItemShape(e,t,a),n=!0;n&&this._endPath(e);for(const i of this._items)this._drawItemText(e,t,i)}_drawWithoutOptimizations(e,t){let i,r;for(const n of this._items){const a=(0,s.ensureDefined)(n.style);i=a.color||"rgba(0, 0, 0, 0)",r=a.borderColor||"rgba(0, 0, 0, 0)",this._startPath(e,t,i,r),this._drawItemShape(e,t,n),this._endPath(e),this._drawItemText(e,t,n)}}_drawItemShape(e,t,i){(0,d.drawScaled)(e,t.pixelRatio,()=>this._drawItemShapeUsingCSSPixels(e,i))}_drawItemShapeUsingCSSPixels(e,t){}_preDrawInit(){}_startPath(e,t,i,s){}_endPath(e){}_getTextCache(e){var t;const i=e.text||this._text,s=e.fontSize||this._fontSize,r=null!==(t=e.lineSpacing)&&void 0!==t?t:this._lineSpacing,n=e.textAlign||this._textAlign
;return this._textCache.get({text:i,bold:!1,italic:!1,font:h.CHART_FONT_FAMILY,fontSize:s,lineSpacing:r,align:n})}}class _ extends c{_startPath(e,t,i,s){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.strokeStyle=i}_endPath(e){e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(2*e.pixelRatio))}}class p extends c{_startPath(e,t,i,s){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.fillStyle=i,e.strokeStyle=s}_endPath(e){e.fill(),e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(e.pixelRatio))}}},53864:(e,t,i)=>{i.d(t,{PaneRendererArrowUp:()=>o,PaneRendererArrowDown:()=>l});var s=i(60511),r=i(86441),n=i(66915);class a extends s.PaneRendererAbstractFillStrokeShape{constructor(){super(...arguments),this._sign=0,this._thinArrow=!1,this._thinArrowLineWidth=0,this._headHeight=0,this._arrowWidth=0}setItems(e,t){this._setBaseData(e,t)}_drawItemShape(e,t,i){const s=t.pixelRatio,r=this._lineWidth(t)%2?.5:0,a=this._sign,o=this._arrowWidth,l=this._headHeight,h=Math.abs(i.height),d=Math.round(i.x*s)+r,u=i.vertOffset,c=Math.round((i.y+u+a*h/2)*s)+r,_=(0,n.ceiledEven)(o*s),p=_/2,m=Math.round(h*s),y=Math.round(l*s);e.translate(d,c),this._thinArrow?(e.moveTo(0,0),e.lineTo(-p,-p*a),e.moveTo(0,0),e.lineTo(p,-p*a),e.moveTo(0,0),e.lineTo(0,-m*a),e.moveTo(-p,-m*a),e.lineTo(p,-m*a)):(e.moveTo(0,0),m<y?(e.lineTo(_,-m*a),e.lineTo(-_,-m*a)):(e.lineTo(_,-y*a),e.lineTo(p,-y*a),e.lineTo(p,-m*a),e.lineTo(-p,-m*a),e.lineTo(-p,-y*a),e.lineTo(-_,-y*a)),e.lineTo(0,0)),e.translate(-d,-c)}_preDrawInit(){const e=this._calculateWidth();this._arrowWidth=e,this._sign=this._isUp()?-1:1,this._thinArrow=e<4,this._thinArrowLineWidth=Math.max(e/2,1),this._headHeight=Math.round(e)}_startPath(e,t,i,s){e.beginPath(),e.fillStyle=i,e.strokeStyle=s,e.lineWidth=this._lineWidth(t)}_lineWidth(e){return this._thinArrow?this._thinArrowLineWidth:super._lineWidth(e)}_calcBoundingBox(e){const t=e.vertOffset,i=this._sign,s=this._arrowWidth,n=this._headHeight,a=Math.abs(e.height),o=e.x-s,l=o+2*s,h=e.y+t+i*Math.round(a/2),d=h+(-a-n)*i,u=new r.Point(o,h),c=new r.Point(l,d);let _=(0,r.box)(u,c);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}_calculateWidth(){return Math.round(this._barSpacing/4)}}class o extends a{_isUp(){return!0}}class l extends a{_isUp(){return!1}}},63720:(e,t,i)=>{i.d(t,{PaneRendererCircleShape:()=>a});var s=i(60511),r=i(86441);const n=2*Math.PI;class a extends s.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=Math.max(t.width,t.height)/2,s=t.x,r=t.vertOffset,a=t.y+r;e.moveTo(s+i,a),e.arc(s,a,i,0,n,!1)}_calcBoundingBox(e){const t=Math.max(e.width,e.height)/2,i=e.x,s=e.vertOffset,n=e.y+s,a=i-t,o=i+t,l=n-t,h=n+t,d=new r.Point(a,l),u=new r.Point(o,h);let c=(0,r.box)(d,u);const _=super._calcBoundingBox(e);return _&&(c=this._unionBox(c,_)),c}}},78571:(e,t,i)=>{i.d(t,{PaneRendererCrossShape:()=>n});var s=i(60511),r=i(86441);class n extends s.PaneRendererAbstractStrokeShape{_drawItemShape(e,t,i){
const s=i.width,r=i.height,n=i.x-s/2,a=i.vertOffset,o=i.y-r/2+a,l=t.pixelRatio,h=this._lineWidth(t),d=h%2?.5:0,u=Math.round(n*l);let c=Math.round((n+s)*l);(c-u)%2!=h%2&&(c+=1);const _=Math.floor((u+c)/2)+d,p=Math.round(o*l);let m=Math.round((o+r)*l);(m-p)%2!=h%2&&(m+=1);const y=Math.floor((p+m)/2)+d;e.moveTo(_,p),e.lineTo(_,m),e.moveTo(u,y),e.lineTo(c,y)}_calcBoundingBox(e){const t=e.width,i=e.height,s=e.x-t/2,n=e.vertOffset,a=e.y-i/2+n,o=s,l=s+t,h=a,d=a+i,u=new r.Point(o,h),c=new r.Point(l,d);let _=(0,r.box)(u,c);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}}},71613:(e,t,i)=>{i.d(t,{PaneRendererDiamond:()=>n});var s=i(60511),r=i(86441);class n extends s.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=Math.round(t.height/2),s=t.x,r=t.vertOffset,n=t.y+r;e.moveTo(s,n-i),e.lineTo(s+i,n),e.lineTo(s,n+i),e.lineTo(s-i,n),e.lineTo(s,n-i)}_calcBoundingBox(e){const t=Math.round(e.height/2),i=e.x,s=e.vertOffset,n=e.y+s,a=i-t,o=i+t,l=n-t,h=n+t,d=new r.Point(a,l),u=new r.Point(o,h);let c=(0,r.box)(d,u);const _=super._calcBoundingBox(e);return _&&(c=this._unionBox(c,_)),c}}},8146:(e,t,i)=>{i.d(t,{PaneRendererFlagShape:()=>n});var s=i(60511),r=i(86441);class n extends s.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,s=t.height,r=s/2,n=(i-3)/3,a=t.x-i/2,o=t.vertOffset,l=t.y-r+o;e.moveTo(a,l),e.lineTo(a+3,l),e.bezierCurveTo(a+n,l-n,a+2*n,l+n,a+i,l),e.lineTo(a+i,l+r),e.bezierCurveTo(a+i-n,l+r+n,a+i-2*n,l+r-n,a+3,l+r),e.lineTo(a+3,l+s),e.lineTo(a,l+s),e.lineTo(a,l)}_calcBoundingBox(e){const t=e.width,i=e.height,s=i/2,n=e.x-t/2,a=e.vertOffset,o=e.y-s+a,l=n,h=n+t,d=o,u=o+i,c=new r.Point(l,d),_=new r.Point(h,u);let p=(0,r.box)(c,_);const m=super._calcBoundingBox(e);return m&&(p=this._unionBox(p,m)),p}}},78874:(e,t,i)=>{i.d(t,{PaneRendererLabelBase:()=>o,CornerVectorsClockwise:()=>s});var s,r=i(88537),n=i(60511),a=i(67151);class o extends n.PaneRendererAbstractFillStrokeShape{setItems(e,t){this._setBaseData(e,t);for(const e of this._items){const t=e.height;e.stepX=Math.round(t/2*.65)+.5,e.stepY=e.stepX;const i=e.stepX/2,s=this._getTextCache(e);if(null===s){e.shapeWidth=2*e.stepX,e.shapeHeight=2.5*e.stepY,e.vertOffset=this._calcVertOffset(e);continue}const r=s.textImageWidth,n=s.textImageHeight;e.shapeWidth=r+2*e.stepX,e.shapeHeight=n+2*i+e.stepY,e.vertOffset=this._calcVertOffset(e),e.textHorizOffset=this._getHorizontalTextOffset(e),e.textVertOffset=this._getVerticalTextOffset(e)}}_calcVertOffset(e){return e.vertOffset}_drawCorner(e,t,i,s,r){const n=Math.max(1,Math.floor(2*r));e.lineTo(t-n*s.prevPointSignX,i-n*s.prevPointSignY),e.arcTo(t,i,t+n*s.nextPointSignX,i+n*s.nextPointSignY,n)}_getArrowSize(e){return e.stepX}_getHorizontalTextOffset(e){return 0}_getVerticalTextOffset(e){return 0}_hasText(e){return Boolean(e.text)||Boolean(this._text)}_drawItemText(e,t,i){var s;const n=this._getTextCache(i);if(null===n)return
;const o=i.textHorizOffset||0,l=i.x+o,h=i.vertOffset,d=i.y+h+i.textVertOffset,u=(null===(s=i.style)||void 0===s?void 0:s.textColor)||this._textColor;n.paintTo(e,t,(0,r.ensureDefined)(u),l,d,a.HorizontalAlign.Center,a.VerticalAlign.Middle)}}class l{constructor(e,t,i,s){this.prevPointSignX=e,this.prevPointSignY=t,this.nextPointSignX=i,this.nextPointSignY=s}}!function(e){e.rightUp=new l(1,0,0,1),e.rightDown=new l(0,1,-1,0),e.leftDown=new l(-1,0,0,-1),e.leftUp=new l(0,-1,1,0)}(s||(s={}))},44577:(e,t,i)=>{i.d(t,{PaneRendererLabelUp:()=>n,PaneRendererLabelDown:()=>a,PaneRendererLabelLeft:()=>o,PaneRendererLabelRight:()=>l,PaneRendererLabelCenter:()=>h});var s=i(86441),r=i(78874);class n extends r.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,r=e.y+e.vertOffset,n=e.y+e.shapeHeight+e.vertOffset,a=new s.Point(t,r),o=new s.Point(i,n);return(0,s.box)(a,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,a=Math.max(1,Math.floor(s))%2?.5:0,o=this._getArrowSize(i);let l=Math.round(o*s);(a+l)%1!=n%1&&(l+=.5);let h=Math.round(i.shapeWidth/2*s);(a+h)%1!=n%1&&(h+=.5);const d=Math.round(i.x*s)+a,u=Math.round((i.y+i.vertOffset)*s)+n,c=d-l,_=Math.round((i.y+i.vertOffset+o)*s)+n,p=d+l,m=d+h,y=Math.round((i.y+i.vertOffset+i.shapeHeight)*s)+n,f=d-h;e.moveTo(c,_),e.lineTo(d,u),e.lineTo(p,_),i.shapeWidth<=2*o?(e.lineTo(m,_),this._drawCorner(e,m,y,r.CornerVectorsClockwise.rightDown,s),this._drawCorner(e,f,y,r.CornerVectorsClockwise.leftDown,s),e.lineTo(f,_)):(this._drawCorner(e,m,_,r.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,m,y,r.CornerVectorsClockwise.rightDown,s),this._drawCorner(e,f,y,r.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,f,_,r.CornerVectorsClockwise.leftUp,s)),e.lineTo(c,_)}_getVerticalTextOffset(e){return e.shapeHeight/2+this._getArrowSize(e)/2}_calcVertOffset(e){return Math.sign(e.vertOffset)>=0?e.vertOffset:e.vertOffset-e.shapeHeight}}class a extends r.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,r=e.y-e.shapeHeight+e.vertOffset,n=e.y+e.vertOffset,a=new s.Point(t,r),o=new s.Point(i,n);return(0,s.box)(a,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,a=Math.max(1,Math.floor(s))%2?.5:0,o=this._getArrowSize(i);let l=Math.round(o*s);(a+l)%1!=n%1&&(l+=.5);let h=Math.round(i.shapeWidth/2*s);(a+h)%1!=n%1&&(h+=.5);const d=Math.round(i.x*s)+a,u=Math.round((i.y+i.vertOffset)*s)+n,c=d+l,_=Math.round((i.y+i.vertOffset-o)*s)+n,p=d-l,m=d+h,y=Math.round((i.y+i.vertOffset-i.shapeHeight)*s)+n,f=d-h;e.moveTo(c,_),e.lineTo(d,u),e.lineTo(p,_),i.shapeWidth<=2*o?(e.lineTo(f,_),this._drawCorner(e,f,y,r.CornerVectorsClockwise.leftUp,s),this._drawCorner(e,m,y,r.CornerVectorsClockwise.rightUp,s),e.lineTo(m,_)):(this._drawCorner(e,f,_,r.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,f,y,r.CornerVectorsClockwise.leftUp,s),this._drawCorner(e,m,y,r.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,m,_,r.CornerVectorsClockwise.rightDown,s)),e.lineTo(c,_)}_getVerticalTextOffset(e){
return-e.shapeHeight/2-this._getArrowSize(e)/2}_calcVertOffset(e){return Math.sign(e.vertOffset)<=0?e.vertOffset:e.vertOffset+e.shapeHeight}}class o extends r.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x,i=e.x+e.shapeWidth,r=e.y-e.shapeHeight/2+e.vertOffset,n=e.y+e.shapeHeight/2+e.vertOffset,a=new s.Point(t,r),o=new s.Point(i,n);return(0,s.box)(a,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,a=this._getArrowSize(i),o=this._hasText(i),l=o?i.shapeHeight/2:a,h=Math.round(i.x*s)+n,d=Math.round((i.y+i.vertOffset)*s)+n,u=Math.round((i.x+a)*s)+n,c=Math.round((i.y+i.vertOffset+a)*s)+n,_=Math.round((i.y+i.vertOffset-a)*s)+n,p=Math.round((i.y+i.vertOffset-l)*s)+n,m=Math.round((i.x+i.shapeWidth)*s)+n,y=Math.round((i.y+i.vertOffset+l)*s)+n;e.moveTo(u,c),e.lineTo(h,d),e.lineTo(u,_),o?this._drawCorner(e,u,p,r.CornerVectorsClockwise.leftUp,s):e.lineTo(u,p),this._drawCorner(e,m,p,r.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,m,y,r.CornerVectorsClockwise.rightDown,s),o?this._drawCorner(e,u,y,r.CornerVectorsClockwise.leftDown,s):e.lineTo(u,y),e.lineTo(u,c)}_getHorizontalTextOffset(e){return e.shapeWidth/2+this._getArrowSize(e)/2}}class l extends r.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth,i=e.x,r=e.y-e.shapeHeight/2+e.vertOffset,n=e.y+e.shapeHeight/2+e.vertOffset,a=new s.Point(t,r),o=new s.Point(i,n);return(0,s.box)(a,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,a=this._getArrowSize(i),o=this._hasText(i),l=o?i.shapeHeight/2:a,h=Math.round(i.x*s)+n,d=Math.round((i.y+i.vertOffset)*s)+n,u=Math.round((i.x-a)*s)+n,c=Math.round((i.y+i.vertOffset-a)*s)+n,_=Math.round((i.y+i.vertOffset+a)*s)+n,p=Math.round((i.y+i.vertOffset-l)*s)+n,m=Math.round((i.x-i.shapeWidth)*s)+n,y=Math.round((i.y+i.vertOffset+l)*s)+n;e.moveTo(u,c),e.lineTo(h,d),e.lineTo(u,_),o?this._drawCorner(e,u,y,r.CornerVectorsClockwise.rightDown,s):e.lineTo(u,y),this._drawCorner(e,m,y,r.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,m,p,r.CornerVectorsClockwise.leftUp,s),o?this._drawCorner(e,u,p,r.CornerVectorsClockwise.rightUp,s):e.lineTo(u,p),e.lineTo(u,c)}_getHorizontalTextOffset(e){return-e.shapeWidth/2-this._getArrowSize(e)/2}}class h extends r.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,r=e.y-e.shapeHeight/2+e.vertOffset,n=e.y+e.shapeHeight/2+e.vertOffset,a=new s.Point(t,r),o=new s.Point(i,n);return(0,s.box)(a,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,a=i.shapeHeight/2,o=i.shapeWidth/2,l=Math.round(i.x*s)+n,h=Math.round((i.x-o)*s)+n,d=Math.round((i.x+o)*s)+n,u=Math.round((i.y+i.vertOffset-a)*s)+n,c=Math.round((i.y+i.vertOffset+a)*s)+n;e.moveTo(l,u),this._drawCorner(e,d,u,r.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,d,c,r.CornerVectorsClockwise.rightDown,s),this._drawCorner(e,h,c,r.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,h,u,r.CornerVectorsClockwise.leftUp,s),e.lineTo(l,u)}}},5316:(e,t,i)=>{i.d(t,{PaneRendererSquare:()=>n});var s=i(60511),r=i(86441)
;class n extends s.PaneRendererAbstractFillStrokeShape{_drawItemShape(e,t,i){const s=t.pixelRatio,r=Math.max(1,Math.floor(s))%2?.5:0,n=this._lineWidth(t)%2?.5:0;let a=Math.round(i.height/2*s);(r+a)%1!=n%1&&(a+=.5);const o=Math.round(i.x*s)+r,l=Math.round((i.y+i.vertOffset)*s)+r,h=o-a,d=l-a,u=o+a,c=l+a;e.rect(h,d,u-h,c-d)}_calcBoundingBox(e){const t=e.height,i=Math.round(t/2),s=e.x-i,n=e.vertOffset,a=e.y+n-i,o=s,l=s+t,h=a,d=a+t,u=new r.Point(o,h),c=new r.Point(l,d);let _=(0,r.box)(u,c);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}}},87117:(e,t,i)=>{i.d(t,{PaneRendererTriangleApexUp:()=>a,PaneRendererTriangleApexDown:()=>o});var s=i(60511),r=i(86441);class n extends s.PaneRendererAbstractFillStrokeShape{_calcBoundingBox(e){const t=e.width,i=e.height,s=t/2,n=Math.round(i/3),a=e.x,o=e.vertOffset-2*n,l=e.y+o,h=a-s,d=a+s,u=l,c=l+i,_=new r.Point(h,u),p=new r.Point(d,c);let m=(0,r.box)(_,p);const y=super._calcBoundingBox(e);return y&&(m=this._unionBox(m,y)),m}}class a extends n{_drawItemShape(e,t,i){const s=i.width,r=i.height,n=Math.round(r/3),a=i.vertOffset-2*n,o=t.pixelRatio,l=this._lineWidth(t)%2?.5:0,h=Math.max(1,Math.floor(o)),d=h%2?.5:0;let u=Math.round(s*o);u%2!=h%2&&(u+=1);const c=Math.round(i.x*o)+d,_=Math.round((i.y+a)*o),p=c+u/2,m=Math.round((i.y+a+r)*o)+l,y=c-u/2;e.moveTo(c,_),e.lineTo(p,m),e.lineTo(y,m),e.lineTo(c,_)}}class o extends n{_drawItemShape(e,t,i){const s=i.width,r=i.height,n=Math.round(r/3),a=i.vertOffset-n,o=t.pixelRatio,l=this._lineWidth(t)%2?.5:0,h=Math.max(1,Math.floor(o)),d=h%2?.5:0;let u=Math.round(s*o);u%2!=h%2&&(u+=1);const c=Math.round(i.x*o)+d,_=Math.round((i.y+a)*o)+l,p=c+u/2,m=Math.round((i.y+a+r)*o),y=c-u/2;e.moveTo(y,_),e.lineTo(p,_),e.lineTo(c,m),e.lineTo(y,_)}}},97138:(e,t,i)=>{i.d(t,{PaneRendererXCross:()=>n});var s=i(60511),r=i(86441);class n extends s.PaneRendererAbstractStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,s=t.height,r=t.x-i/2,n=t.vertOffset,a=t.y-s/2+n;e.moveTo(r,a),e.lineTo(r+i,a+s),e.moveTo(r,a+s),e.lineTo(r+i,a)}_calcBoundingBox(e){const t=e.width,i=e.height,s=e.x-t/2,n=e.vertOffset,a=e.y-i/2+n,o=s,l=s+t,h=a,d=a+i,u=new r.Point(o,h),c=new r.Point(l,d);let _=(0,r.box)(u,c);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}}},62857:(e,t,i)=>{i.d(t,{createStudyPlotColorProvider:()=>_});var s=i(18458),r=i(88537),n=i(81626);const a=new Map([[0,"color"],[2,"textColor"],[3,"borderColor"],[4,"wickColor"],[5,"colorup"],[6,"colordown"]]);class o{constructor(e){this._plotStyle=e}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return a.forEach((e,t)=>{this._plotStyle[e]&&(i.colors[t]=this._plotStyle[e].value())}),i.lineWidth=this._plotStyle.linewidth?this._plotStyle.linewidth.value():void 0,i.lineStyle=this._plotStyle.linestyle?this._plotStyle.linestyle.value():void 0,i}isColorDefined(){return!0}singleColor(){return!0}getDefaultPlotPointStyle(){return null}}const l=[0,1,2,3,4,5,6];class h{constructor(e,t,i,s){this._palettesColors=new Map,this._defaultPlotColors=new Map,this._indexes=s
;const n=t.styles[i];if(n)for(const[e,t]of a)this._defaultPlotColors.set(e,n[t]);const o=(0,r.ensureDefined)(e.palettes),l=e.plots;s.forEach((e,i)=>{const s=l[e];if(s&&"palette"in s){const e=o[s.palette],r=t.palettes[s.palette];if(e&&r){const{valToIndex:t}=e,{colors:s}=r,n={...s};t&&Object.keys(t).forEach(e=>{const i=t[e];void 0!==i&&(n[e]=s[i])}),this._palettesColors.set(i,n)}}})}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return l.forEach(t=>{var s,n;if(this._palettesColors.has(t)){const n=e[(0,r.ensureDefined)(this._indexes.get(t))+1];if("number"==typeof n){const e=null===(s=this._palettesColors.get(t))||void 0===s?void 0:s[n];0===t&&e&&(i.lineWidth=e.width.value(),i.lineStyle=e.style.value()),i.colors[t]=null==e?void 0:e.color.value()}else i.colors[t]="transparent"}else i.colors[t]=null===(n=this._defaultPlotColors.get(t))||void 0===n?void 0:n.value()}),i}getDefaultPlotPointStyle(){var e;const t=null===(e=this._palettesColors.get(0))||void 0===e?void 0:e[0];if(void 0!==t){return{colors:[t.color.value(),void 0,void 0,void 0,void 0,void 0,void 0],lineStyle:void 0,lineWidth:t.width.value()}}return null}isColorDefined(){return!!this._palettesColors.size}singleColor(){return!1}}var d=i(21386);class u{constructor(e){this._indexes=e}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return this._indexes.forEach((t,s)=>{const r=e[t+1];if(null!=r){const e=(0,d.rgbaFromInteger)(r);i.colors[s]=e}else i.colors[s]="transparent"}),i}isColorDefined(){return!0}singleColor(){return!1}getDefaultPlotPointStyle(){return null}}const c=new Map([[0,function(e,t){const i=(0,s.isColorerPlot)(t)||(0,s.isOhlcColorerPlot)(t);return"target"in t&&t.target===e&&i}],[2,function(e,t){const i=(0,s.isTextColorerPlot)(t);return"target"in t&&t.target===e&&i}],[1,function(e,t){return(0,s.isBgColorerPlot)(t)&&t.id===e}],[3,function(e,t){const i=(0,s.isCandleBorderColorerPlot)(t);return"target"in t&&t.target===e&&i}],[4,function(e,t){const i=(0,s.isCandleWickColorerPlot)(t);return"target"in t&&t.target===e&&i}],[5,function(e,t){const i=(0,s.isUpColorerPlot)(t);return"target"in t&&t.target===e&&i}],[6,function(e,t){const i=(0,s.isDownColorerPlot)(t);return"target"in t&&t.target===e&&i}]]);function _(e,t,i){const{colorers:s}=function(e,t){const i=e.plots,s=i.findIndex(e=>e.id===t),r=new Map;return i.forEach((e,i)=>{c.forEach((s,n)=>{s(t,e)&&r.set(n,i)})}),{plotIndex:-1===s?null:s,colorers:r}}(e,i);if(s.size)return e.isRGB?new u(s):new h(e,t,i,s);{const e=t.ohlcPlots;if(e&&e[i])return new o(e[i]);const s=t.styles[i];return new o(s)}}},12270:(e,t,i)=>{i.d(t,{StudyDataSource:()=>p});var s=i(88537),r=i(97639),n=i.n(r),a=i(52280),o=i(95078),l=i(76543),h=i(23083),d=i(74316);const u=(0,i(11905).getLogger)("Chart.StudyDataSource");var c,_;!function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(c||(c={})),function(e){e[e.Idle=0]="Idle",e[e.AwaitingConnection=1]="AwaitingConnection",e[e.AwaitingParent=2]="AwaitingParent",
e[e.AwaitingFirstDataUpdate=3]="AwaitingFirstDataUpdate",e[e.Active=4]="Active"}(_||(_={}));class p{constructor(e,t,i,s){this._inputs=null,this._status=_.Idle,this._studyId=null,this._turnaroundCounter=1,this._studyStatus={type:c.Undefined},this._studyStatusChanged=new(n()),this._graphics=new d.LiveStudyGraphics,this._dataCleared=new(n()),this._dataUpdated=new(n()),this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=e,this._metaInfo=s,this._seriesSource=t,this._turnaroundPrefix=i,this._plots=new a.PlotList((0,h.studyPlotFunctionMap)(s),h.studyEmptyPlotValuePredicate),this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged),this._dataUpdated.destroy(),this._dataCleared.destroy(),this._studyStatusChanged.destroy()}metaInfo(){return this._metaInfo}inputs(){return this._inputs}setInputs(e){this._inputs=e,null!==this._studyId&&(this._turnaroundCounter++,this._onStudyStatusChangedTo({type:c.Undefined}),this._gateway.modifyStudy(this._studyId,this._turnaround(),e,this._onMessage.bind(this)),this._status===_.Active&&this._changeStatusTo(_.AwaitingFirstDataUpdate))}isStarted(){return this._status!==_.Idle}isActive(){return this._status===_.Active}start(){this.isStarted()?u.logNormal("start: data source is already started, nothing to do"):((0,s.assert)(null!==this._inputs,"Inputs should be defined when starting a study data source"),this._gateway.isConnected().value()?this._createStudy():this._changeStatusTo(_.AwaitingConnection))}stop(){this.isStarted()?(null!==this._studyId&&(this._gateway.removeStudy(this._studyId),this._studyId=null,this._onStudyStatusChangedTo({type:c.Undefined})),this._changeStatusTo(_.Idle)):u.logNormal("stop: data source is already stopped, nothing to do")}studyId(){return this._studyId}studyStatus(){return this._studyStatus}studyStatusChanged(){return this._studyStatusChanged}plots(){return this._plots}graphics(){return this._graphics}clearData(){this._plots.clear(),this._graphics.clear(),this._dataCleared.fire()}stopAndStealData(){(0,s.assert)(this._status===_.Active,"Couldn't steal data from non-active data source"),this.stop();const e=this._plots,t=this._graphics.extract();return this._plots=new a.PlotList((0,h.studyPlotFunctionMap)(this._metaInfo),h.studyEmptyPlotValuePredicate),{plots:e,graphics:t}}dataCleared(){return this._dataCleared}dataUpdated(){return this._dataUpdated}moveData(e){this._ongoingDataUpdate=this._ongoingDataUpdate.then(()=>{this._plots.move(e)})}_changeStatusTo(e){(0,s.assert)(this._status!==e,"Source and destination status should be distinct"),u.logNormal(`Status changed from ${_[this._status]} to ${_[e]}`),this._status=e}_createStudy(){const e=this._seriesSource.instanceId();null!==e?this._createStudyUsingParentId(e):(this._changeStatusTo(_.AwaitingParent),this._seriesSource.dataEvents().completed().subscribe(this,this._onSeriesCompleted,!0))}
_createStudyUsingParentId(e){(0,s.assert)(this._status!==_.Active,'Status should not be "Active" when creating a study'),(0,s.assert)(this._studyStatus.type===c.Undefined,'Study status should be "Undefined" when creating a study'),(0,s.assert)(null===this._studyId,"Study id should be empty when creating a study"),this._studyId=(0,l.makeNextStudyId)(),this._gateway.createStudy(this._studyId,this._turnaround(),e,this._metaInfo.fullId+("tv-basicstudies"===this._metaInfo.packageId?"":"!"),(0,s.ensureNotNull)(this._inputs),this._onMessage.bind(this)),this._changeStatusTo(_.AwaitingFirstDataUpdate)}_onGatewayIsConnectedChanged(e){e?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===_.AwaitingConnection&&this._createStudy()}_onGatewayDisconnected(){this._status!==_.Idle&&this._status!==_.AwaitingConnection&&(this._studyId=null,this._changeStatusTo(_.AwaitingConnection),this._studyStatus.type!==c.Undefined&&this._onStudyStatusChangedTo({type:c.Undefined})),this._turnaroundCounter=1}_onSeriesCompleted(){this._status===_.AwaitingParent&&this._createStudyUsingParentId((0,s.ensure)(this._seriesSource.instanceId()))}_onStudyStatusChangedTo(e){const t=this._studyStatus;this._studyStatus=e,u.logNormal(`Study status type changed from ${c[t.type]} to ${c[e.type]}`),this._studyStatusChanged.fire(t,e)}_onMessage(e){if("data_update"===e.method){const{customId:t,turnaround:i,plots:r,nonseries:n}=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onDataUpdate(r,(0,s.ensureDefined)(n))}else if("study_loading"===e.method){const[t,i,s]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyLoading(s)}else if("study_completed"===e.method){const[t,i,s]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyCompleted(s)}else if("study_error"===e.method){const[t,i,s,r,n]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyError(s,r,n)}else"clear_data"===e.method&&this._checkTurnaround(e.params.turnaround)&&this.clearData()}_onDataUpdate(e,t){const i=(0,o.unpackNonSeriesData)(t.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then(()=>i,()=>i).then(this._onDataUnpacked.bind(this,e,t.indexes)),this._ongoingDataUpdate}_onDataUnpacked(e,t,i){this._status!==_.Idle&&(this._status===_.AwaitingFirstDataUpdate&&(this._changeStatusTo(_.Active),this.clearData()),this._mergePlots(e),null!==i&&(i.indexes_replace?((0,s.assert)("nochange"!==t),this._graphics.replaceIndexesTo(t)):("nochange"!==t&&this._graphics.replaceIndexesTo(t),void 0!==i.graphicsCmds&&this._graphics.processCommands(i.graphicsCmds,this._metaInfo.graphics))),this._dataUpdated.fire(e,i,t))}_onStudyLoading(e){this._onStudyStatusChangedTo({type:c.Loading,startTime:Date.now()})}_onStudyError(e,t,i){this.clearData();const s="string"==typeof e?{error:e.split(":",2)[0]}:e;this._onStudyStatusChangedTo({type:c.Error,errorDescription:s})}_onStudyCompleted(e){this._onStudyStatusChangedTo({type:c.Completed})}_mergePlots(e){this._plots.merge(e)}_turnaround(){
return`${this._turnaroundPrefix}${this._turnaroundCounter}`}_checkTurnaround(e){const t=this._turnaround();return e===t||e===this._seriesSource.turnaround()||e===`${this._seriesSource.turnaround()}_${t}`}}},49633:(e,t,i)=>{i.d(t,{StudyDataWindowView:()=>n});var s=i(34906),r=i(33485);class n extends s.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._study=e,this._model=t,this._valueProvider=this._createValuesProvider(e,t),this._items=this._valueProvider.getItems().map(e=>new s.DataWindowItem(e.title,"")),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}study(){return this._study}_updateImpl(){this._header=this._study.title(!0),this._title=this._study.title();const e=this._valueProvider.getValues(this._currentIndex());for(let t=0;t<e.length;++t){const i=e[t],s=this._items[t];s.setValue(i.value),s.setVisible(i.visible),s.setColor(i.color)}}_currentIndex(){const e=this._model.crossHairSource().lockedIndex;if(void 0!==e)return e;const t=this._model.crossHairSource().appliedIndex();return isNaN(t)?null:t}_createValuesProvider(e,t){return new r.StudyValuesProvider(e,t)}}},23083:(e,t,i)=>{function s(e){const t=new Map;return e.plots.forEach((e,i)=>{t.set(e.id,e=>e[i+1])}),t}function r(e,t){return null==e[t]}i.d(t,{studyPlotFunctionMap:()=>s,studyEmptyPlotValuePredicate:()=>r})},24635:(e,t,i)=>{function s(e){return["text","integer","float","price","session","resolution"].includes(e.type)&&e.hasOwnProperty("options")}function r(e,t,i){for(const s of e)if(t[s.id]!==i[s.id])return!1;return!0}function n(e){return{from:Math.round(e.first_visible_bar_time/1e3),to:Math.round(e.last_visible_bar_time/1e3)}}function a(e){const t=e.filter(e=>"time"===e.type||"price"===e.type);if(0===t.length)return[];const i=new Map,s=[];t.forEach(e=>{var t;const{group:r,inline:n}=e;if(void 0===n)return void s.push(e);const a=n+(r||"");if(i.has(a))null===(t=i.get(a))||void 0===t||t.push(e);else{const t=[e];i.set(a,t),s.push(t)}});const r=[];for(let e=0;e<s.length;e++){const t=s[e];Array.isArray(t)?2===t.length&&t[0].type!==t[1].type?r.push(t):r.push(...t):r.push(t)}return r}i.d(t,{isStudyInputOptionsInfo:()=>s,areStudyInputsEqual:()=>r,rangeDependentStudyInputsToTimeRange:()=>n,editableStudyInputs:()=>a})},56525:(e,t,i)=>{i.d(t,{StudyLegendValuesProvider:()=>r});var s=i(33485);class r extends s.StudyValuesProvider{constructor(e,t){super(e,t),this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues}getValues(e){const t=super.getValues(e),i=this._study.properties(),s=this._showStudyValues.value()&&i.showLegendValues.value();for(const e of t)e.visible=e.visible&&s;return t}}},20937:(e,t,i)=>{i.d(t,{StudyStatusProviderBase:()=>d});var s=i(5073),r=i(90901),n=i(6096),a=i(87236);const o={NONE:"Default"},l=(0,
a.t)("No volume data"),h=new Map([["Pine cannot determine the referencing length of a series. Try using max_bars_back",r.solutionIds.PINE_CANNOT_DETERMINE],["Memory limits exceeded",r.solutionIds.MEMORY_LIMITS_EXCEEDED]]);class d extends s.StatusProviderBase{constructor(e,t){super(t),this._source=e}getSplitTitle(){return this._source.titleInParts(!0,o,void 0,!0)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(!0,o,void 0,!0)}: ${this.sourceStatusText()}`:`${this._source.title(!0,o,void 0,!0)} ${this.sourceStatusText()}`:this._source.title(!0,o,void 0,!0)}sourceStatusText(){return(0,n.convertStudyStatusToString)(this._source.status(),!0)}sourceStatusSolutionId(){const e=this._source.status();if(e.type===n.StudyStatusType.Error)return e.errorDescription.solution_id?e.errorDescription.solution_id:function(e){for(const t of Array.from(h.keys()))if(e.includes(t))return h.get(t)}(e.errorDescription.error)}errorStatus(){if(!this._source.isActualInterval()||this._source.isSymbolInvalid())return null;return this._source.status().type===n.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:this.sourceStatusSolutionId(),title:this.sourceStatusTitle()}:null}sourceStatusTitle(){const e=this._source.status();if(e.type===n.StudyStatusType.Error)return-1!==e.errorDescription.error.toLowerCase().indexOf("the data vendor doesn't provide volume data for this symbol.")?l:void 0}}},51620:(e,t,i)=>{i.d(t,{StudyStatusProvider:()=>l});var s=i(87236),r=i(6096),n=i(71417),a=i(20937);const o=(0,s.t)("Fundamental studies are no longer available on charts");class l extends a.StudyStatusProviderBase{constructor(e,t){super(e,t),this._study=e}color(){return this._study.isFailed()||this._study.metaInfo&&this._study.metaInfo().isTVScriptStub?"#ff0000":super.color()}sourceStatusText(){if(this._study.status().type===r.StudyStatusType.Error){const e=this._study.metaInfo(),t=(0,n.extractPineId)(e.fullId);if(e.scriptIdPart&&(0,n.isEdgrPineId)(e.scriptIdPart)||t&&(0,n.isEdgrPineId)(t))return o}return super.sourceStatusText()}}},34840:(e,t,i)=>{i.d(t,{StudyStatusView:()=>r});var s=i(92139);class r extends s.StatusView{constructor(e){super(e.statusProvider())}color(){return this._statusProvider.color()}getSplitTitle(){return this._statusProvider.getSplitTitle()}update(){this._text=this._statusProvider.text()}}},6096:(e,t,i)=>{i.r(t),i.d(t,{StudyStatusType:()=>n,convertStudyStatusToString:()=>a});var s=i(87236);const r=(0,s.t)("loading...");var n;function a(e,t){if(e.type===n.Loading)return t?r:"loading...";if(e.type===n.Error){const i=e.errorDescription,r=t?(0,s.t)(i.error):i.error;if(i.ctx){const e={};return Object.entries(i.ctx).forEach(([t,i])=>{e[t]=i.toString()}),r.format(e)}return r}return""}!function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(n||(n={}))},33485:(e,t,i)=>{i.d(t,{StudyValuesProvider:()=>S})
;var s=i(93751),r=i(88537),n=i(87236),a=i(38456),o=i(21386),l=i(11688),h=i(52280),d=i(40968),u=i(8170),c=i(18458),_=i(62857),p=i(76809),m=i(91419);const y=a.CheckMobile.any(),f=(0,n.t)("n/a"),g=l.enabled("hide_last_na_study_output");class S{constructor(e,t){this._emptyValues=[],this._colorProviders=new Map,this._study=e,this._model=t;const i=e.metaInfo().plots;i&&i.forEach((t,i)=>{if((0,c.isPlotWithTechnicalValues)(t))return;const s=t.id;this._emptyValues.push({id:s,index:i,title:this._study.guiPlotName(s),value:"",visible:!1});const r=(0,c.isOhlcPlot)(t)?t.target:t.id;this._colorProviders.set(r,(0,_.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),r))})}getItems(){return this._emptyValues}getValues(e){const t=this._emptyValues.map(e=>({...e}));let i=null;const r=this._study.data().lastIndex();if(null!==r)for(const e of t){if(!this._study.properties().styles[e.id].visible.value())continue;const t=this._study.nearestIndex(r,h.PlotRowSearchMode.NearestLeft,e.index+1);if(void 0===t)continue;const s=t+this._study.offset(e.id);i=null!==i?Math.max(s,i):s}(null===e||null!==i&&e>i)&&(e=i);const n=this._hideValues(),a=this._study.isVisible()&&!n?f:"";for(const e of t)e.value=a;if(n)return t;if(g&&t.length&&(t[t.length-1].value=""),this._study.metaInfo().graphics.hhists)return this._getValuesForHHist(t,e);const l=this._study.priceScale();if(!this._study.isVisible()||null===e||null===l||l.isEmpty()||this._model.timeScale().isEmpty())return t;const d=this._study.metaInfo().plots,u=(0,p.getPriceValueFormatterForSource)(this._study),_={};for(const i of t){let t=i.id;const n=this._study.properties().styles[t].visible.value();if(i.visible=n,!n)continue;const a=i.index,l=e-this._study.offset(t),p=null!==r&&l>r?h.PlotRowSearchMode.NearestLeft:h.PlotRowSearchMode.Exact,m=this._study.nearestIndex(l,p);if(void 0===m)continue;let y=_[t];if(void 0===y&&(y=this._study.getMinFirstBarIndexForPlot(t),Number.isFinite(y)&&(_[t]=y)),y>m)continue;const f=this._study.data().last(),g=this._study.data().valueAt(m)||(null!==f?f.value:null);if(null===g)continue;const S=g[a+1];if(!(0,s.isNumber)(S))continue;const b=S>0;i.value=u(S);const v=this._study.properties().styles[t];let w=v.color.value();const P=d[a];(0,c.isOhlcPlot)(P)?(t=P.target||t,w=this._study.properties().ohlcPlots[t].color.value()):(0,c.isArrowsPlot)(P)&&(w=b?v.colorup.value():v.colordown.value());let x=w;const I=this._colorProviders.get(t),C=I&&I.getPlotPointStyle(g);C&&((0,c.isArrowsPlot)(P)?(b&&void 0!==C.colors[5]&&(x=C.colors[5]),b||void 0===C.colors[6]||(x=C.colors[6])):void 0!==C.colors[0]&&(x=C.colors[0])),"transparent"===x&&(x=w),x=(0,o.resetTransparency)(x),i.color=x}return t}_hideValues(){return y&&(null===this._model.crossHairSource().pane||(0,d.isLineToolName)(u.tool.value())||null!==this._model.lineBeingEdited())}_getValuesForHHist(e,t){e.forEach(e=>{e.visible=this._study.isVisible(),e.value=f});const i=this._study.priceScale(),n=this._model.timeScale();if(null===i||i.isEmpty()||n.isEmpty()||this._hideValues())return e;if(null===t||!isFinite(t)){
const i=this._study.data().last();if(null===i)return e;t=i.index}const a=this._model.crossHairSource(),o=a.price;if(!isFinite(a.y)&&null===(t=function(e,t){var i;const s=null===(i=e.visibleBarsStrictRange())||void 0===i?void 0:i.lastBar();if(!s)return null;const r=t.data().search(s,h.PlotRowSearchMode.NearestLeft);return r?r.index:null}(this._model.timeScale(),this._model.mainSeries())))return e;const l=function(e,t,i,s){if(0===e.size)return null;if(!i){const e=(0,r.ensureNotNull)(s.data().valueAt(t));i=s.barFunction()(e)}const n=function(e,t){let i=null;return e.forEach((e,s)=>{s<=t&&(null===i||s>i)&&(i=s)}),i}(e,t);if(null===n)return null;const a=e.get(n);if(!a||0===a.size)return null;return function(e,t){let i=null;return e.forEach(e=>{e.priceLow<=t&&t<e.priceHigh&&(i=e)}),i}(a,i)}(this._study.graphics().hhistsByTimePointIndex(),t,o,this._model.mainSeries());if(null===l)return e.forEach(e=>{e.value="0"}),e;const d=this._study.metaInfo().graphics.hhists;if(void 0===d)return e;const u=d[l.styleId];if(void 0===u)return e;const c=this._study.properties().child("graphics").child("hhists").child(l.styleId),_=new m.VolumeFormatter;return e.forEach((e,t)=>{if(t<c.colors.childCount())if(t<l.rate.length){const i=l.rate[t];e.title=u.titles[t],e.value=(0,s.isNumber)(i)?_.format(i):"",e.color=c.colors[t].value()}else e.title="",e.value="",e.color=void 0;else{if(l.rate.length>1&&t===c.colors.childCount()){const t=l.rate.reduce((e,t)=>e+t,0);return e.value=_.format(t),void(e.color=c.valuesColor.value())}e.value=""}}),e}}},7555:(e,t,i)=>{i.d(t,{StudyBase:()=>ut});var s=i(88537),r=i(87236),n=i(11905),a=i(38456),o=i(94755),l=i(44265),h=i(86189),d=i(62145),u=i(70369);var c=i(49692),_=i(97639),p=i.n(_),m=i(2899),y=i(59270),f=i(52280),g=i(70028),S=i.n(g),b=i(74316),v=i(31825),w=i(49633),P=i(56525);class x extends w.StudyDataWindowView{constructor(e,t){super(e,t),this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,this._showStudyValues.subscribe(this,this.update),this._study.properties().showLegendValues.subscribe(this,this.update)}areValuesVisible(){return this._showStudyValues.value()}additional(){return null}destroy(){this._showStudyValues.unsubscribeAll(this),this._study.properties().showLegendValues.unsubscribeAll(this)}_createValuesProvider(e,t){return new P.StudyLegendValuesProvider(e,t)}}var I=i(8170),C=i(34840),T=i(15693),V=i(76543),A=i(8803),M=i(51620),L=i(70617),R=i(1336),D=i(18458),E=i(52256);class B{constructor(e,t,i=!1){this.price=t,this.index=e,this.useMainSeriesForPriceRange=i}}var k=i(34088);function O(e,t,i,r){if(e.y1===e.y2)return function(e,t,i){return(0,s.assert)(e.y1===e.y2),(0,k.doesItemAffectVisibleRange)(e.x1,e.x2,e.extend,t,i)?[new B(t,e.y1,!1),new B(i,e.y2,!1)]:[]}(e,i,r);const n=[];return null!==e.x1&&n.push(new B(e.x1,e.y1,!1)),null!==e.x2&&n.push(new B(e.x2,e.y2,!1)),n}function N(e,t,i,s){return(0,k.doesItemAffectVisibleRange)(e.left,e.right,e.extend,i,s)?[new B(i,e.top,!1),new B(s,e.bottom,!1)]:[]}var F=i(56164);function W(e,t,i,s){let r
;const n=e.yloc!==F.DwgLabelYloc.Price&&e.yloc!==F.DwgLabelYloc.Auto;if(n){const i=e.yloc===F.DwgLabelYloc.AboveBar?2:3,s=t.valueAt(e.x);null!==s&&(r=s[i])}else r=e.y;return null==r?null:[new B(e.x,r,n)]}function H(){return{topPixelMargin:0,bottomPixelMargin:0}}class U{constructor(e,t,i,s,r){this._map=e,this._study=t,this._bars=t.series().bars(),this._props=t.properties().graphics[i],this._getPoints=s,this._getMargins=r}groupPriceRange(e,t){let i=null;return this._map.forEach((s,r)=>{this._props[r].visible.value()&&s.forEach(s=>{const r=this._getPoints(s,this._bars,e,t);if(null===r)return;let n=1/0,a=-1/0,o=!1,l=!1,h=!1;for(const i of r){const s=i.index<=t,r=i.index>=e;o=o||s,l=l||r,h=h||s&&r;let d=i.price,u=i.price;if(i.useMainSeriesForPriceRange){const e=this._bars.valueAt(i.index);if(null===e)return;const t=e[2];if(null==t)return;const s=e[3];if(null==s)return;d=s,u=t}d<n&&(n=d),u>a&&(a=u)}if(!(h||o&&l))return;const d=new y.PriceRange(n,a);i=null===i?d:i.merge(d)})}),i}firstValue(e,t){let i=1/0,s=1/0,r=-1/0,n=1/0,a=1/0,o=1/0;return this._map.forEach((l,h)=>{this._props[h].visible.value()&&l.forEach(l=>{const h=this._getPoints(l,this._bars,e,t);if(null!==h)for(const l of h){const h=l.index;h<e&&h>r?(r=h,n=l.price):h>t&&h<a?(a=h,o=l.price):h<i&&(i=h,s=l.price)}})}),{firstVisible:i===1/0?null:new B(i,s),leftClosest:r===-1/0?null:new B(r,n),rightClosest:a===1/0?null:new B(a,o)}}groupPixelMargins(e,t){const i={topPixelMargin:0,bottomPixelMargin:0};if(null===this._study.priceScale())return i;return null===this._study.firstValue()||this._map.forEach((s,r)=>{this._props[r].visible.value()&&s.forEach(s=>{const r=this._getPoints(s,this._bars,e,t);if(null===r)return;if(0===r.filter(i=>{const s=i.index;return s>=e&&s<=t}).length)return;const n=this._getMargins(s,this._bars);i.bottomPixelMargin=Math.max(i.bottomPixelMargin,n.bottomPixelMargin),i.topPixelMargin=Math.max(i.topPixelMargin,n.topPixelMargin)})}),i}}function z(e,t,i){const s=e.graphics(),r=()=>({bottomPixelMargin:0,topPixelMargin:0}),n=s.dwglines(),a=new Map;return n.forEach(e=>{e.forEach(e=>{a.set(e.id,e)})}),[new U(s.dwglabels(),e,"dwglabels",W,E.calculateDwgLabelsMargins.bind(null,e)),new U(n,e,"dwglines",O,r),new U(s.dwgboxes(),e,"dwgboxes",N,r),new U(s.dwglinefills(),e,"dwglinefills",(e,t,i,s)=>function(e,t,i,s,r){const n=e.get(t.line1),a=e.get(t.line2);return void 0!==n&&void 0!==a&&((0,k.doesItemAffectVisibleRange)(n.x1,n.x2,n.extend,s,r)||(0,k.doesItemAffectVisibleRange)(a.x1,a.x2,a.extend,s,r))?[new B(s,n.y1,!1),new B(r,n.y2,!1),new B(s,a.y1,!1),new B(r,a.y2,!1)]:[]}(a,e,0,i,s),H)]}function G(e,t,i){return null===t?e:null===e?t:e.index<t.index?i?t:e:i?e:t}class j{constructor(){this.firstVisible=null,this.leftClosest=null,this.rightClosest=null}improve(e){this.firstVisible=G(this.firstVisible,e.firstVisible,!0),this.leftClosest=G(this.leftClosest,e.leftClosest,!0),this.rightClosest=G(this.rightClosest,e.rightClosest,!1)}bestPrice(){
return null!==this.firstVisible?this.firstVisible.price:null!==this.leftClosest?this.leftClosest.price:null!==this.rightClosest?this.rightClosest.price:null}}var Y=i(24635),q=i(11688),X=i(86441),K=i(21386),$=i(17611);class J{constructor(e){this._data=e}draw(e,t){}drawBackground(e,t){e.save();const i=this._data,s=t.pixelRatio;let r=null;const n=Math.round(this._data.w*s);for(let t=0;t<i.items.length;++t){const a=i.items[t];if(null==a.color){r=null;continue}e.fillStyle=a.color;const o=Math.round(a.x*s);let l=o;if(t>0){i.items[t-1].index===a.index-1&&null!==r&&(l=r+1)}const h=o+n,d=h-l+1;e.fillRect(l,Math.round(i.y*s),d,Math.round(i.h*s)),r=h}e.restore()}hitTest(e){return null}}var Z=i(62857);class Q{constructor(e,t,i,r){this._items=[],this._invalidated=!0,this._isMarkersEnabled=q.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=r;const n=this._study.metaInfo().plots;for(let e=0;e<n.length;e++){const t=n[e];t.id===this._plotName&&(this._plotIndex=e,(0,s.assert)((0,D.isBgColorerPlot)(t),"Plot '"+this._plotName+"' is not a background colorer!"))}this._colorProvider=(0,Z.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),r)}items(){return this._items}update(){this._invalidated=!0}renderer(){if(!this._study.properties().styles[this._plotName].visible)return null;if(!this._study.properties().styles[this._plotName].visible.value())return null;if(!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={items:this._items,y:0,h:(0,s.ensureNotNull)(this._study.priceScale()).height(),w:this._model.timeScale().barSpacing()},t=new $.CompositeRenderer;return t.append(new J(e)),t}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&!e.isEmpty()&&null!==t&&!t.isEmpty()}_getTranspValue(){const e=this._study.properties().styles[this._plotName];let t=0;return e.transparency&&(t=e.transparency.value(),t=(0,L.isNumber)(t)?t:40),t}_updateImpl(){this._items=[],(0,s.assert)(this._scalesReady(),"Scales must be ready!");const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return;const t=this._getTranspValue();let i=(0,s.ensureDefined)(this._series.nearestIndex(e.firstBar(),f.PlotRowSearchMode.NearestRight)),r=(0,s.ensureDefined)(this._series.nearestIndex(e.lastBar(),f.PlotRowSearchMode.NearestLeft));const n=this._study.offset(this._plotName);n>0?(i-=n,r+=n):(i+=n,r-=n);const a=this._study.getMinFirstBarIndexForPlot(this._plotName);if(a>r)return;i=Math.max(a,i);const o=this._study.data().rangeIterator(i,r);for(;o.hasNext();){const e=o.next();let i=e.index;const r=e.value;i+=n;const a=new X.Point(Math.floor(i)-.5,NaN);let l=(0,L.isNumber)(t)?t:50;l=Math.min(l,100),l=Math.max(l,0);const h=this._colorProvider.getPlotPointStyle(r);void 0!==h.colors[1]&&(a.color=(0,K.generateColor)((0,s.ensureDefined)(h.colors[1]),l)),a.index=i,this._items.push(a)}this._model.timeScale().timedValuesToCoordinates(this._items)}}
var ee=i(59447),te=i(96989),ie=i(66915),se=i(18718),re=i(46037),ne=i(3653),ae=i(81626),oe=i(53864),le=i(63720),he=i(78571),de=i(71613),ue=i(8146),ce=i(44577),_e=i(5316),pe=i(87117),me=i(97138);const ye=new Map;ye.set("PaneRendererArrowUp",oe.PaneRendererArrowUp),ye.set("PaneRendererArrowDown",oe.PaneRendererArrowDown),ye.set("PaneRendererCircleShape",le.PaneRendererCircleShape),ye.set("PaneRendererCrossShape",he.PaneRendererCrossShape),ye.set("PaneRendererDiamond",de.PaneRendererDiamond),ye.set("PaneRendererFlagShape",ue.PaneRendererFlagShape),ye.set("PaneRendererLabelUp",ce.PaneRendererLabelUp),ye.set("PaneRendererLabelDown",ce.PaneRendererLabelDown),ye.set("PaneRendererSquare",_e.PaneRendererSquare),ye.set("PaneRendererTriangleApexUp",pe.PaneRendererTriangleApexUp),ye.set("PaneRendererTriangleApexDown",pe.PaneRendererTriangleApexDown),ye.set("PaneRendererXCross",me.PaneRendererXCross);class fe{constructor(e,t,i,s){this._items=[],this._invalidated=!1,this._renderer=null,this._isMarkersEnabled=q.enabled("source_selection_markers"),this._selectionData=null,this._plotIndex=null,this._topCoord=0,this._bottomCoord=0,this._study=e,this._series=t,this._model=i,this._plotName=s;const r=e.metaInfo().plots;for(let e=0;e<r.length;e++)if(r[e].id===this._plotName){this._plotIndex=e;break}this._colorProvider=(0,Z.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new re.SelectionIndexes(i.timeScale())}items(){return this._items}update(){this._invalidated=!0}renderer(){if(!this._study.properties().styles[this._plotName].visible)return null;if(!this._study.properties().styles[this._plotName].visible.value())return null;if(!this._scalesReady())return null;if(this._invalidated){const e=this._study.properties().styles[this._plotName];this._updateRenderer(e),this._invalidated=!1}return this._renderer}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&null!==t&&!e.isEmpty()&&!t.isEmpty()}_updateImpl(){if(this._items=[],!this._scalesReady())return;const e=this._model.timeScale(),t=this._study.priceScale(),i=e.visibleBarsStrictRange();if(null===i||null===t)return;let r=this._series.nearestIndex(i.firstBar(),f.PlotRowSearchMode.NearestRight),n=this._series.nearestIndex(i.lastBar(),f.PlotRowSearchMode.NearestLeft);if(void 0===r||void 0===n)return;const a=this._study.offset(this._plotName);a>0?(r-=a,n+=a):(r+=a,n-=a);const o=this._study.getMinFirstBarIndexForPlot(this._plotName);if(o>n)return;r=Math.max(o,r);const l=this._study.data(),h=this._study.firstValue();if(null===h)return;const d=l.rangeIterator(r,n),u=this._getTranspValue();let c=[];const _=this._model.selection().isSelected(this._study);_?(c=this._selectionIndexer.indexes(),this._selectionData={points:[],hittestResult:se.HitTestResult.REGULAR,vertOffset:0,bgColors:[],barSpacing:e.barSpacing(),visible:!0}):(this._selectionIndexer.clear(),this._selectionData=null);const p=this._series.properties().childs().style.value(),m=2===p?"lineStyle":3===p?"areaStyle":null;let y,g
;m?(y=this._series.properties().childs()[m].childs().priceSource.value(),g=y):(y="high",g="low");const S=t.isInverted(),b=t.coordinateToPrice(t.height()*t.topMargin(),h),v=t.coordinateToPrice(t.height()*(1-t.bottomMargin()),h);this._topCoord=S?v:b,this._bottomCoord=S?b:v;const w=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height(),P=this._study.properties().styles[this._plotName],x=P.color.value(),I=P.textColor?P.textColor.value():void 0,C=x,T=x,V=void 0===I?void 0:I,A=(0,s.ensureNotNull)(this._plotIndex),M=(0,ae.createEmptyStyle)();for(;d.hasNext();){const e=d.next(),t=e.index,i=e.value,s=Math.floor(t+a),r=i[A+1];if(null==r)continue;const n=this._createItem(s,r,y,g);if(null!==n){if(this._colorProvider.isColorDefined()){n.style={color:C,borderColor:T,textColor:V};const e=this._colorProvider.getPlotPointStyle(i,M);this._fillItemWithPointStyle(n,e,u)}_&&-1!==c.indexOf(t)&&null!==this._selectionData&&(this._selectionData.points.push(n),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(n.y/w))),this._items.push(n)}}this._convertItemsToCoordinates()}_fillItemWithPointStyle(e,t,i){const r=(0,s.ensureDefined)(e.style);if(void 0!==t.colors[0]){r.color=(0,K.generateColor)((0,s.ensureDefined)(t.colors[0]),i);const e=i>9?i-10:0;r.borderColor=(0,K.generateColor)(r.color,e)}void 0!==t.colors[2]&&(r.textColor=(0,K.generateColor)((0,s.ensureDefined)(t.colors[2]),i))}_updateRenderer(e){this._updateImpl();const t=this._model.timeScale(),i={},s=this._getTranspValue(),r=t.barSpacing(),n=this._calculateShapeHeight(r),a=this._study.properties().styles[this._plotName].location.value(),o=this._calculateVerticalOffset(a,n+n/2);i.barSpacing=r,i.items=this._items,i.color=(0,K.generateColor)(this._study.properties().styles[this._plotName].color.value(),s),i.height=n,i.vertOffset=o;const l=this._study.properties().styles[this._plotName].plottype.value(),h=te.plotShapesData[l],d=new $.CompositeRenderer;h&&d.append(this._createRenderer(h.paneRendererClass,i)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=o,d.append(new ee.SelectionRenderer(this._selectionData))),this._renderer=d}_createRenderer(e,t){const i=ye.get(e);return new((0,s.ensureDefined)(i))(t)}_getSeriesVal(e,t){const i=(0,ne.barFunction)(e),s=this._series.data().valueAt(t);return null===s?null:i(s)}_getTranspValue(){let e=0;this._study.properties().transparency&&(e=this._study.properties().transparency.value(),e=(0,L.isNumber)(e)?e:50);const t=this._study.properties().styles[this._plotName];return t.transparency&&(e=t.transparency.value(),e=(0,L.isNumber)(e)?e:50),(0,ie.clamp)(e,0,100)}_createItem(e,t,i,r){const n=this._study.properties().styles[this._plotName].location.value();if((null===t||0===t)&&n!==v.MarkLocation.Absolute)return null;let a;switch(n){case v.MarkLocation.AboveBar:const o=this._getSeriesVal(i,e);if(null===o)return null;a=o;break;case v.MarkLocation.BelowBar:const l=this._getSeriesVal(r,e);if(null===l)return null;a=l;break
;case v.MarkLocation.Top:a=this._topCoord;break;case v.MarkLocation.Bottom:a=this._bottomCoord;break;case v.MarkLocation.Absolute:a=(0,s.ensureNotNull)(t);break;default:throw new Error("Bad value: "+n)}return new X.Point(e,a)}_convertItemsToCoordinates(){const e=this._model.timeScale(),t=this._study.priceScale();e.timedValuesToCoordinates(this._items);const i=(0,s.ensureNotNull)(this._study.firstValue());(0,s.ensureNotNull)(t).pointsArrayToCoordinates(this._items,i)}_calculateVerticalOffset(e,t){let i=0;switch(e){case v.MarkLocation.AboveBar:case v.MarkLocation.Bottom:i=-t;break;case v.MarkLocation.BelowBar:case v.MarkLocation.Top:i=t}return(0,s.ensureNotNull)(this._study.priceScale()).isInverted()&&(i*=-1),i}_calculateShapeHeight(e,t){let i=e;switch(t){case D.PlotSymbolSize.Tiny:i=.3*e;break;case D.PlotSymbolSize.Small:i=.6*e;break;case D.PlotSymbolSize.Normal:i=e;break;case D.PlotSymbolSize.Large:i=1.5*e;break;case D.PlotSymbolSize.Huge:i=2*e}return i}}class ge extends fe{renderer(){const e=this._study.properties().styles[this._plotName];return e.visible&&e.visible.value()&&this._scalesReady()?(this._invalidated&&(this._updateRenderer(e),this._invalidated=!1),this._renderer):null}_updateRenderer(e){this._updateImpl();const t=this._model.timeScale(),i={},s=this._getTranspValue(),r=t.barSpacing();let n;if(e.size){const t=e.size.value();n=this._calculateShapeHeight(25,t)}else n=Math.round(r/2);n=Math.max(n,1);const a=e.location.value(),l=(0,K.generateColor)(e.color.value(),s),h=s>19?s-10:0,d=this._calculateVerticalOffset(a,Math.round(1.5*n));i.barSpacing=r,i.items=this.items(),i.color=l,i.borderColor=(0,K.generateColor)(e.color.value(),h),i.height=n,i.vertOffset=d;const u=e.plottype.value(),c=te.plotShapesData[u],_=new $.CompositeRenderer,p=e.text?e.text.value():void 0;if(void 0!==p&&""!==p.trim()){let t=p.trim().replace(/\\n/gm,"\n");t=(0,o.cleanButAmpersand)(t,!0),i.text=t,i.fontSize=12;const r=e.textColor?e.textColor.value():void 0;i.textColor=r?(0,K.generateColor)(r,s):l}_.append(super._createRenderer(c.paneRendererClass,i)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=d,_.append(new ee.SelectionRenderer(this._selectionData))),this._renderer=_}}var Se=i(87795),be=i.n(Se),ve=i(60511),we=i(1132),Pe=i(88427),xe=i(67151);class Ie extends ve.PaneRendererAbstractShape{constructor(e,t){super(null,t),this._fontSizeEnsured=0,this._ch="",this._fontFamily=Pe.CHART_FONT_FAMILY,this._charCache=null,null!==e&&this.setData(e)}setData(e){super.setData(e),this._fontSizeEnsured=(0,s.ensureDefined)(this._height);const t=e.char.slice(0,40);this._ch=be()(t)[0]||" ",this._fontFamily=e.fontFamily||Pe.CHART_FONT_FAMILY}hitTest(e){const t=(0,we.interactionTolerance)().series+this._fontSizeEnsured/2;for(const i of this._items){if(new X.Point(i.x,i.y+i.vertOffset).subtract(e).length()<=t)return new se.HitTestResult(se.HitTestResult.REGULAR)}return null}_drawItemShape(e,t,i){
const s=i.x,r=i.vertOffset>0?1:-1,n=i.y+i.vertOffset-r*Math.round(this._fontSizeEnsured/2);let a;a=i.style&&void 0!==i.style.color?i.style.color:this._color;const o=this._textImageCache(),l=t.pixelRatio;if(this._fontSizeEnsured<=4/l){e.save();const t=Math.max(1,Math.floor(l));let r=Math.max(1,Math.floor(o.textImageWidth*l));r%2!=t%2&&(r+=r>1?-1:1);const h=Math.round(n*l)+(i.vertOffset>=0?0:-r);return e.fillStyle=a,e.fillRect(Math.round(s*l)+(l%2?.5:0)-r/2,h,r,r),void e.restore()}o.paintTo(e,t,a,s,n,xe.HorizontalAlign.Center,i.vertOffset>0?xe.VerticalAlign.Top:xe.VerticalAlign.Bottom)}_startPath(e,t,i,s){}_endPath(e){}_textImageCache(){return null!==this._charCache&&this._charCache.fontFamily===this._fontFamily&&this._charCache.fontSize===this._fontSizeEnsured||(this._charCache={fontSize:this._fontSizeEnsured,fontFamily:this._fontFamily,cache:new xe.TextImageCache(this._ch,!1,!1,this._fontFamily,this._fontSizeEnsured,"center",0)}),this._charCache.cache}}class Ce extends fe{constructor(){super(...arguments),this._compositeRenderer=new $.CompositeRenderer,this._charRenderer=new Ie(null)}renderer(){const e=this._study.properties().styles[this._plotName];return e.visible&&e.visible.value()&&this._scalesReady()?(this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer):null}_updateImpl(){if(this._compositeRenderer.clear(),super._updateImpl(),0===this._items.length)return;const e=this._getTranspValue(),t=this._model.timeScale().barSpacing();let i;const s=this._study.properties().styles[this._plotName];if(s.size){const e=s.size.value();i=this._calculateShapeHeight(50,e)}else i=Math.round(t);const r=s.location.value(),n=(0,K.generateColor)(s.color.value(),e),a=this._calculateVerticalOffset(r,i),l={items:this.items(),barSpacing:t,char:s.char.value(),height:i,vertOffset:a,color:n},h=s.text?s.text.value():void 0;if(void 0!==h&&""!==h.trim()){let t=h.trim().replace(/\\n/gm,"\n");t=(0,o.cleanButAmpersand)(t,!0),l.text=t,l.fontSize=12;const i=s.textColor?s.textColor.value():void 0;l.textColor=i?(0,K.generateColor)(i,e):n}this._charRenderer.setData(l),this._compositeRenderer.append(this._charRenderer),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=a,this._compositeRenderer.append(new ee.SelectionRenderer(this._selectionData)))}}var Te=i(24377);class Ve extends X.Point{constructor(e,t,i,s){super(e,t),this.height=i,this.isUp=s,this.style={}}}function Ae(e){return Math.round(e/4)}function Me(e){return Math.round(e/2)}class Le{constructor(e){this._data=e}draw(e,t){var i;const s=t.pixelRatio,r=this._data,n=Me(r.barSpacing),a=Ae(r.barSpacing),o=n<4,l=Math.max(n/2,1),h=(0,ie.ceiledEven)(n*s),d=h/2,u=Math.round(n*s);e.lineCap="butt",e.lineWidth=Math.max(1,Math.floor(s));const c=e.lineWidth%2?.5:0;for(const t of r.items){const n=t.isUp?-1:1,_=Math.round(Math.abs(t.height)*s),p=Math.round(t.x*s)+c,m=Math.round((t.y-n*a)*s)+c;e.beginPath(),e.translate(p,m)
;const y=null!==(i=t.style&&t.style.color)&&void 0!==i?i:t.isUp?r.colorup:r.colordown;o?(e.moveTo(0,0),e.lineTo(-d,-d*n),e.moveTo(0,0),e.lineTo(d,-d*n),e.moveTo(0,0),e.lineTo(0,-_*n),e.moveTo(-d,-_*n),e.lineTo(d,-_*n),e.lineWidth=l,e.strokeStyle=y,e.stroke()):(e.moveTo(0,0),_<u?(e.lineTo(h,-_*n),e.lineTo(-h,-_*n)):(e.lineTo(h,-u*n),e.lineTo(d,-u*n),e.lineTo(d,-_*n),e.lineTo(-d,-_*n),e.lineTo(-d,-u*n),e.lineTo(-h,-u*n)),e.lineTo(0,0),e.strokeStyle=t.isUp?r.colorBorderUp:r.colorBorderDown,e.stroke(),e.fillStyle=y,e.fill()),e.translate(-p,-m)}}hitTest(e){const t=this._data,i=Me(t.barSpacing),s=Math.round(i/2),r=Math.round(i),n=Ae(t.barSpacing);for(const i of t.items){if(!i)continue;if(!Number.isFinite(i.x)||!Number.isFinite(i.y))continue;const t=Math.abs(i.height),a=i.isUp?-1:1,o=t+r,l=i.y-a*n,h=l-a*o,d=i.x-s,u=i.x+s;if(d<e.x&&e.x<u&&(i.isUp?l<e.y&&e.y<h:h<e.y&&e.y<l))return new se.HitTestResult(se.HitTestResult.REGULAR)}return null}}class Re extends ee.SelectionRenderer{_drawMarker(e,t,i,r,n){const a=(0,s.ensureNotNull)(this._data),o=t.isUp?1:-1;const l=i+o*Ae(a.barSpacing)+o*Me(a.barSpacing);let h=Math.round(3.5*n*2);h%2!=r%2&&(h+=1);const d=r%2/2,u=Math.round(t.x*n)+d,c=Math.round((t.y+l)*n)+d;e.beginPath(),e.arc(u,c,h/2,0,2*Math.PI,!0),e.closePath(),e.fill(),e.stroke()}}class De extends fe{constructor(){super(...arguments),this._maxAbsValue=0}renderer(){if(!this._study.properties().styles[this._plotName].visible)return null;if(!this._study.properties().styles[this._plotName].visible.value())return null;if(!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={},t=(0,ie.clamp)(this._getTranspValue(),0,100),i=this._model.timeScale().barSpacing();e.items=this._items,e.barSpacing=i,e.colorup=(0,K.generateColor)(this._study.properties().styles[this._plotName].colorup.value(),t),e.colordown=(0,K.generateColor)(this._study.properties().styles[this._plotName].colordown.value(),t);const s=(0,Te.parseRgba)(e.colorup),r=s?100*(1-s[3]):0,n=(0,Te.parseRgba)(e.colordown),a=n?100*(1-n[3]):0;e.colorBorderUp=(0,K.generateColor)("#000000",r),e.colorBorderDown=(0,K.generateColor)("#000000",a),e.minHeight=this._study.properties().styles[this._plotName].minHeight.value(),e.maxHeight=this._study.properties().styles[this._plotName].maxHeight.value();const o=new $.CompositeRenderer;if(o.append(new Le(e)),this._model.selection().isSelected(this._study)&&null!==this._selectionData){const e=this._selectionData;e.barSpacing=i,o.append(new Re(e))}return o}_fillItemWithPointStyle(e,t,i){const r=(0,s.ensureDefined)(e.style);e.isUp?void 0!==t.colors[5]?r.color=(0,K.generateColor)((0,s.ensureDefined)(t.colors[5]),i):r.color=(0,K.generateColor)(this._study.properties().styles[this._plotName].colorup.value(),i):void 0!==t.colors[6]?r.color=(0,K.generateColor)((0,s.ensureDefined)(t.colors[6]),i):r.color=(0,K.generateColor)(this._study.properties().styles[this._plotName].colordown.value(),i)}_createItem(e,t,i,s){if(0===t)return null;Math.abs(t)>this._maxAbsValue&&(this._maxAbsValue=Math.abs(t))
;const r=t>0;let n;if(r){const t=this._getSeriesVal(s,e);if(null===t)return null;n=t}else{const t=this._getSeriesVal(i,e);if(null===t)return null;n=t}return new Ve(e,n,t,r)}_convertItemsToCoordinates(){const e=this._model.timeScale(),t=(0,s.ensureNotNull)(this._study.priceScale());e.timedValuesToCoordinates(this._items),t.pointsArrayToCoordinates(this._items,(0,s.ensureNotNull)(this._study.firstValue()));let i=Math.abs(this._study.properties().styles[this._plotName].minHeight.value()),r=Math.abs(this._study.properties().styles[this._plotName].maxHeight.value());if(i>r){const e=i;i=r,r=e}const n=(r-i)/this._maxAbsValue,a=this._items;for(let e=0;e<a.length;e++){const t=a[e],s=Math.abs(t.height);t.height=s*n+i}}}var Ee=i(7152);class Be{constructor(e,t,i,s){this._bars=[],this._invalidated=!1,this._isMarkersEnabled=q.enabled("source_selection_markers"),this._selectionData=null,this._ohlcPlotIndexes=new Map,this._study=e,this._series=t,this._model=i,this._plotName=s,this._isMarkersEnabled=q.enabled("source_selection_markers"),this._colorProvider=(0,Z.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new re.SelectionIndexes(i.timeScale());const r=this._study.metaInfo().plots;for(let e=0;e<r.length;e++){const t=r[e];"target"in t&&(t.target===this._plotName&&((0,D.isOhlcOpenPlot)(t)&&this._ohlcPlotIndexes.set(1,e),(0,D.isOhlcHighPlot)(t)&&this._ohlcPlotIndexes.set(2,e),(0,D.isOhlcLowPlot)(t)&&this._ohlcPlotIndexes.set(3,e),(0,D.isOhlcClosePlot)(t)&&this._ohlcPlotIndexes.set(4,e)))}}update(){this._invalidated=!0}items(){return this._bars}_updateImpl(){this._bars.length=0;const e=this._study.priceScale();if(this._model.timeScale().isEmpty()||null===e||e.isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;let i=this._series.nearestIndex(t.firstBar(),f.PlotRowSearchMode.NearestRight);const r=this._series.nearestIndex(t.lastBar(),f.PlotRowSearchMode.NearestLeft);if(void 0===i||void 0===r)return;const n=this._study.getMinFirstBarIndexForPlot(this._plotName);if(n>r)return;i=Math.max(n,i);const a=this._study.data(),o=this._study.firstValue();if(null===o)return;const l=a.rangeIterator(i,r),h=this._study.properties().ohlcPlots[this._plotName],d=new Map,u=(e,t)=>{const i=e+"@"+t;if(!d.has(i)){const s=(0,K.generateColor)(e,t);return d.set(i,s),s}return d.get(i)},c=(0,ae.createEmptyStyle)();for(;l.hasNext();){const e=l.next();let t=e.index;const i=e.value;t=Math.floor(t);let r=!0;const n=new Map;for(let e=1;e<=4;++e){const t=this._ohlcPlotIndexes.get(e);if(void 0===t){r=!1;break}const s=i[t+1];if(null==s){r=!1;break}n.set(e,s)}if(!r)continue;const a=(0,s.ensureDefined)(n.get(1)),o=(0,s.ensureDefined)(n.get(4)),d=(0,s.ensureDefined)(n.get(2)),_=(0,s.ensureDefined)(n.get(3)),p=Math.max(a,d,_,o),m=Math.min(a,d,_,o);let y=(0,s.ensureDefined)(u(h.color.value(),0));const f=this._colorProvider.getPlotPointStyle(i,c);void 0!==f.colors[0]&&(y=(0,s.ensureDefined)(f.colors[0]));const g={time:Math.round(t),open:a,high:p,low:m,close:o,color:y,wickColor:f.colors[4],
borderColor:f.colors[3],hollow:null};this._bars.push(g)}if(e.barPricesToCoordinates(this._bars,o),this._model.timeScale().barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._study)){const t=this._selectionIndexer.indexes();this._selectionData={points:[],hittestResult:se.HitTestResult.REGULAR,bgColors:[],visible:!0,barSpacing:this._model.timeScale().barSpacing()};const i=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height(),r=(0,s.ensureDefined)(this._ohlcPlotIndexes.get(4));for(let s=0;s<t.length;s++){const n=t[s],a=this._study.data().valueAt(n);if(null===a)continue;const l=a[r+1];if(null==l)continue;const h=this._model.timeScale().indexToCoordinate(Math.floor(n)),d=e.priceToCoordinate(l,o);this._selectionData.points.push(new X.Point(h,d)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(d/i))}}else this._selectionIndexer.clear()}}class ke extends Be{renderer(){if(!this._study.properties().ohlcPlots[this._plotName].visible.value())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={bars:this._bars,barSpacing:this._model.timeScale().barSpacing(),dontDrawOpen:this._series.properties().childs().barStyle.childs().dontDrawOpen.value(),thinBars:this._series.properties().childs().barStyle.childs().thinBars.value()},t=new $.CompositeRenderer;return t.append(new Ee.PaneRendererBars(e)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&t.append(new ee.SelectionRenderer(this._selectionData)),t}}var Oe=i(80446);class Ne extends Be{renderer(){const e=this._study.properties().ohlcPlots[this._plotName];if(!e.visible.value())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const t=this._model.timeScale().barSpacing(),i={bars:this._bars,barSpacing:t,wickVisible:e.drawWick.value(),bodyVisible:!0,borderVisible:e.drawBorder.value(),barWidth:(0,we.optimalBarWidth)(t),borderColor:e.borderColor.value(),wickColor:e.wickColor.value()},s=new $.CompositeRenderer;return s.append(new Oe.PaneRendererCandles(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&s.append(new ee.SelectionRenderer(this._selectionData)),s}}var Fe=i(13648),We=i(54471),He=i(50985),Ue=i(45185);class ze extends He.HorizontalLinePaneView{constructor(e,t){super(),this._lineRendererData.linestyle=Ue.LINESTYLE_DOTTED,this._study=e,this._plotName=t}_updateImpl(){this._lineRendererData.visible=!1;const e=this._study.properties().styles[this._plotName];if(!e.trackPrice.value())return;const t=this._study.lastValueData(this._plotName,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=t.color,this._lineRendererData.linewidth=e.linewidth.value())}}var Ge=i(51975),je=i(8484);class Ye extends je.AbstractFilledAreaPaneView{constructor(e,t,i,r){super(e,t,!!i.fillgaps),this._isHlineFill="hline_hline"===i.type,(0,s.assert)(this._isHlineFill||"plot_plot"===i.type,"Wrong filledArea type: "+i.type),
this._isHlineFill&&this._initBandIndexes(i.objAId,i.objBId),this._fillMetaInfo=i,this._fillStyleProps=r;const n=e.metaInfo();for(let t=0;t<n.plots.length;++t){const r=n.plots[t];if("palette"in r&&r.palette===i.palette){this._colorPlotIndex=t,this._colorsMap=(0,s.ensureDefined)((0,s.ensureDefined)(n.palettes)[i.palette]).valToIndex,this._colorValues=e.properties().palettes[i.palette].colors;break}if(n.isRGB&&"target"in r&&r.target===i.id){this._colorPlotIndex=t;break}}}_getColorByPlotValue(e){if(this._colorsMap){const t=(0,s.ensureDefined)(this._colorsMap)[e];return this._colorValues[(0,s.ensureDefined)(t)].childs().color.value()}return(0,K.rgbaFromInteger)(e)}_isPerBarColoringSupported(){return null!==this._colorPlotIndex}_plotAId(){return this._fillMetaInfo.objAId}_plotBId(){return this._fillMetaInfo.objBId}_color(){return this._fillStyleProps.childs().color.value()}_transparency(){return this._fillStyleProps.childs().transparency.value()}_correctVisibleRange(e){const[t,i]=super._correctVisibleRange(e),s=this._source.getMinFirstBarIndexForPlot(this._fillMetaInfo.id);return[Math.max(s,t),i]}_visible(){return this._fillStyleProps.childs().visible.value()}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;const i=this._source.metaInfo().bands;if(void 0!==i)for(let s=0;s<i.length;++s){const r=i[s];null!==this._bandAKey||r.id!==e?null===this._bandBKey&&r.id===t&&(this._bandBKey=s):this._bandAKey=s}}}var qe=i(37689);class Xe{constructor(e,t){this._invalidated=!0,this._lineRenderer=new qe.HorizontalLineRenderer,this._source=t,this._points=[new X.Point(-1,-1)],this._invalidated=!0,this._properties=e}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={y:this._points[0].y,color:this._properties.childs().color.value(),linewidth:this._properties.childs().linewidth.value(),linestyle:this._properties.childs().linestyle.value()};return this._lineRenderer.setData(e),this._lineRenderer}_updateImpl(){const e=this._source.priceScale();if(!e||e.isEmpty())return void(this._points[0]=new X.Point(-1,-1));const t=this._properties.childs().value.value(),i=this._source.firstValue(),s=(0,L.isNumber)(t)&&null!==i?e.priceToCoordinate(t,i):NaN;this._points[0]=new X.Point(-1,s)}}var Ke=i(80047);class $e extends Ke.ScaledPaneRenderer{constructor(){super(),this._data=null,this._data=null}setData(e=null){this._data=e}hitTest(){return null}_drawImpl(e,t){if(null===this._data||0===this._data.points.length)return;const i=t.cssWidth;e.fillStyle=(0,K.generateColor)(this._data.backcolor,this._data.transparency);const s=Math.min(this._data.points[0],this._data.points[1]),r=Math.max(this._data.points[0],this._data.points[1]);e.fillRect(0,s,i,r-s)}}class Je{constructor(e){this._points=[],this._bandBgRenderer=new $e,this._source=e}update(){if(this._points=[],this._source.properties().bands.length<2)return;if(!this._source.properties().bandsBackground.fillBackground.value())return
;const e=this._source.properties().bands[0],t=this._source.properties().bands[1],i=this._source.priceScale(),s=this._source.firstValue();i&&!i.isEmpty()&&null!==s&&(this._points.push(i.priceToCoordinate(e.value.value(),s)),this._points.push(i.priceToCoordinate(t.value.value(),s)))}renderer(){const e={points:this._points,backcolor:this._source.properties().bandsBackground.backgroundColor.value(),transparency:this._source.properties().bandsBackground.transparency.value()};return this._bandBgRenderer.setData(e),this._bandBgRenderer}}class Ze{constructor(e,t,i){this._points=[],this._bandBgRenderer=new $e,this._bandAKey=null,this._bandBKey=null,this._source=e,(0,s.assert)("hline_hline"===t.type,"Wrong filledArea type: "+t.type),this._initBandIndexes(t.objAId,t.objBId),this._fillStyleProps=i,this._bandBgRenderer=new $e}update(){if(this._points=[],!this._fillStyleProps.childs().visible.value())return;if(null===this._bandAKey||null===this._bandBKey)return;const e=this._source.properties().bands[this._bandAKey],t=this._source.properties().bands[this._bandBKey],i=this._source.priceScale(),s=this._source.firstValue();i&&!i.isEmpty()&&null!==s&&(this._points.push(i.priceToCoordinate(e.value.value(),s)),this._points.push(i.priceToCoordinate(t.value.value(),s)))}renderer(){let e=this._fillStyleProps.childs().transparency.value();e=(0,ie.clamp)(e,0,100);const t={points:this._points,backcolor:(0,K.generateColor)(this._fillStyleProps.childs().color.value(),e),transparency:this._fillStyleProps.childs().transparency.value()};return this._bandBgRenderer.setData(t),this._bandBgRenderer}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;(0,s.ensureDefined)(this._source.metaInfo().bands).forEach((i,s)=>{null===this._bandAKey&&i.id===e&&(this._bandAKey=s),null===this._bandBKey&&i.id===t&&(this._bandBKey=s)})}}var Qe=i(6096),et=i(69415),tt=i(62325),it=i.n(tt);const st=(0,n.getLogger)("Chart.Study"),rt=(0,r.t)("Invalid Symbol");const nt={symbolsForDisplay:!1,symbolsForChartApi:!0,skipHiddenInputs:!1,skipFakeInputs:!1,skipBooleanInputs:q.enabled("dont_show_boolean_study_arguments"),asObject:!0,skippedGroups:[],skippedInputs:[],noExchanges:!1,noResolution:!1,keepOptionalSymbolsEmpty:!1,skipColorInputs:!1,skipTimeInputs:!1,skipOptionalEmptySymbolInputs:!1,skipTextareaInputs:!0,priceInputsForDisplay:!1},at=q.enabled("study_symbol_ticker_description"),ot=q.enabled("hide_main_series_symbol_from_indicator_legend");function lt(e,t){const i=e.plots[t];if(!i||!(0,D.isOhlcPlot)(i))return!1;const s=i.target,r=e.defaults.styles&&e.defaults.styles[s],n=e.defaults.ohlcPlots&&e.defaults.ohlcPlots[s],a=e.ohlcPlots&&e.ohlcPlots[s];return r&&(0,D.isOhlcPlotStyleBars)(r)||n&&(0,D.isOhlcPlotStyleBars)(n)||!!a&&(0,D.isOhlcPlotStyleBars)(a)}function ht(e,t){const i=e.plots[t];if(!i||!(0,D.isOhlcPlot)(i))return!1;const s=i.target,r=e.defaults.styles&&e.defaults.styles[s],n=e.defaults.ohlcPlots&&e.defaults.ohlcPlots[s],a=e.ohlcPlots&&e.ohlcPlots[s];return r&&(0,D.isOhlcPlotStyleCandles)(r)||n&&(0,D.isOhlcPlotStyleCandles)(n)||!!a&&(0,
D.isOhlcPlotStyleCandles)(a)}function dt(e,t){(0,s.assert)(void 0!==e,"zOrder must be defined"),(0,s.assert)(!t.has(e),"zOrder must be unique")}class ut extends m.PriceDataSource{constructor(e,t,i,s){super(e),this.onStart=new(p()),this._onHibernationStateChange=new(p()),this._symbolsResolved=new(p()),this._statusChanged=new(p()),this._paneViews=[],this._priceAxisViews=[],this._inputsAnchorsPaneView=null,this._inputsLinesPaneView=null,this._inputsTimeAxisPaneViews=[],this._inputsPriceAxisPaneViews=[],this._resolvedSymbols={},this._resolvedSymbolsByInput={},this._source=null,this._isChildStudy=!1,this._status={type:Qe.StudyStatusType.Undefined},this._wasCompletedBefore=!1,this._studyId=null,this._isSubscribedToSessionId=!1,this._titleStrCache={},this._titleInPartsCache={},this._children=[],this._numericFormatter=new R.NumericFormatter,this._priceAxisViewsBase=[],this._priceLinesAxisViews=[],this._labelPaneViews=[],this._ownFirstValue=null,this._plotOffsets={},this._formatter=null,this._graphics=new b.LiveStudyGraphics,this._pendingResolveSymbols=new Map,this._onIsActualIntervalChange=new(p()),this._lastNonEmptyPlotRowCache={},this._startMovingPoint=null,this._processHibernateBound=this.processHibernate.bind(this,1),this._maxOffset=new(it())(0),this._chartApi=e.chartApi(),this._properties=t,this._metaInfo=s,this._series=this._model.mainSeries(),this._series.onIntervalChanged().subscribe(this,this._calcIsActualInterval),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments,e.collapsed().subscribe(this._processHibernateBound),i instanceof ut&&(this._source=i,this._isChildStudy=!0,this._source.setChild(this));const r=this.parentSource();r.currencyChanged().subscribe(this,this._onSourceCurrencyChanged),r.unitChanged().subscribe(this,this._onSourceUnitChanged),r.priceRangeReadyChanged().subscribe(this,this._onSourcePriceRangeReadyChanged),r.formatterChanged().subscribe(this,this._onSourceFormatterChanged),r.priceStepChanged().subscribe(this,this._onSourcePriceStepChanged),at&&this._model.mainSeries().properties().childs().statusViewStyle.childs().symbolTextSource.listeners().subscribe(this,()=>{this.invalidateTitleCache(!0)}),this._properties.subscribe(this,this._onPropertiesChanged),this._properties.visible.subscribe(this,this._visibleChanged),this._properties.visible.subscribe(this,this.processHibernate),this._properties.intervalsVisibilities.subscribe(this,this._calcIsActualInterval),this._properties.inputs.listeners().subscribe(this,this._updateMaxOffsetValue),void 0!==this._properties.offsets&&this._properties.offsets.listeners().subscribe(this,this._updateMaxOffsetValue),void 0!==this._properties.offset&&this._properties.offset.listeners().subscribe(this,this._updateMaxOffsetValue),I.hideAllIndicators().subscribe(this,this._visibleChanged);for(let e=0;e<this._metaInfo.plots.length;e++){const t=this._metaInfo.plots[e].id,i=this.properties().styles[t];null!=i&&null!=i.visible&&i.visible.subscribe(this,this.processHibernate)}
for(const e of Object.keys(this._metaInfo.graphics))for(const t of Object.keys(this._metaInfo.graphics[e])){const i=this._properties.graphics[e][t];i.visible&&i.visible.subscribe(this,this.processHibernate)}this._isActualInterval=(0,et.isActualInterval)(this._series.intervalObj(),this.properties().intervalsVisibilities),this._initializeStudyInputsPaneViews()}destroy(){var e;const t=this.parentSource();t.currencyChanged().unsubscribeAll(this),t.unitChanged().unsubscribeAll(this),t.priceRangeReadyChanged().unsubscribeAll(this),t.formatterChanged().unsubscribeAll(this),t.priceStepChanged().unsubscribeAll(this),this._series.properties().childs().statusViewStyle.childs().symbolTextSource.unsubscribeAll(this),this._series.onIntervalChanged().unsubscribeAll(this),this.formatterChanged().unsubscribe(this,this.invalidateTitleCache),I.hideAllIndicators().unsubscribe(this,this._visibleChanged),this._model.collapsed().unsubscribe(this._processHibernateBound),null===(e=this._legendView)||void 0===e||e.destroy()}isDraggable(){return!this._metaInfo.linkedToSeries}lastValueData(e,t,i){const s={noData:!0},r=this.priceScale();if(this._model.timeScale().isEmpty()||null===r||r.isEmpty()||this.data().isEmpty())return s;const n=this._model.timeScale().visibleBarsStrictRange(),a=this.firstValue(!0);if(null===n||null===a)return s;if(!this.properties().visible.value())return s;const o=this.properties().styles,l=this.properties().ohlcPlots;let h,d;if(o&&o[e]&&(h=o[e]),l&&l[e]&&(h=l[e]),!h||!h.visible.value())return s;const u=this.metaInfo().plots;for(d=0;d<u.length;d++){const t=u[d];if(t.id===e||(0,D.isOhlcClosePlot)(t)&&t.target===e)break}const c=d+1,_=this.offset(e),p=this.nearestIndex(n.lastBar()-_,f.PlotRowSearchMode.NearestLeft,c);if(void 0===p)return s;const m=this._lastNonEmptyPlotRow(c),y=null!==m&&n.contains(m.index),g=null!==m?m.value:null,S=t||y?g:this.data().valueAt(p);if(!S||!(0,L.isNumber)(S[c]))return s;const b=S[c],v=(0,Z.createStudyPlotColorProvider)(this.metaInfo(),this.properties(),e).getPlotPointStyle(S).colors[0],w=r.priceToCoordinate(b,a),P={...r.getFormattedValues(b,a),noData:!1,color:v||h.color.value(),floatCoordinate:w,coordinate:w};return i&&(P.price=b),P}isFailed(){return this._status.type===Qe.StudyStatusType.Error}isLoading(){return this._status.type===Qe.StudyStatusType.Loading}isSymbolInvalid(){return this._status.type===Qe.StudyStatusType.Error&&this._status.errorDescription.error===rt}state(e,t){var i;const r=(0,s.ensureNotNull)((0,a.className)(this.constructor)),n=this.metaInfo();let o;n instanceof S()?o=(0,L.clone)(n.state()):(o=(0,L.clone)(this.metaInfo()),o.id=S().parseIdString(o.id+(o.version?"-"+o.version:"")).fullId);const l={type:r,id:this.id(),state:this.properties().state(),zorder:this.zorder(),ownFirstValue:this.isVisible()?null:this._ownFirstValue,metaInfo:o};e&&(l.data=this.data().state(),l.data.symbols=this._resolvedSymbols,l.data.graphics=(0,b.saveStudyGraphics)(this.graphics()),l.data.plotOffsets=this._plotOffsets),
this.ownerSource()&&(l.ownerSource=null===(i=this.ownerSource())||void 0===i?void 0:i.id());for(let e=0;e<n.inputs.length;e++)if("bar_time"===n.inputs[e].type){const t=n.inputs[e].id,i=l.state.inputs[t];if(i<0){const e=this._rightOffsetToUnixTime(-i);l.state.inputs[t]=e&&e>=0?e:0}}var h;return this._isChildStudy&&S().patchChildStudyMetaInfoState(l),t&&(h=l).metaInfo&&h.metaInfo.scriptIdPart&&h.metaInfo.scriptIdPart.startsWith("USER;")&&(function(e){if(!e.metaInfo)return;const t=e.metaInfo.scriptIdPart;if(!t)return;const i=t.split(";")[0],s=e.metaInfo;s.id=(s.id||"").replace(t,i),s.fullId=(s.fullId||"").replace(t,i),s.name=(s.name||"").replace(t,i),s.shortId=(s.shortId||"").replace(t,i),s.scriptIdPart=(s.scriptIdPart||"").replace(t,i),e.state&&(e.state.id=(e.state.id||"").replace(t,i),e.state.fullId=(e.state.fullId||"").replace(t,i),e.state.name=(e.state.name||"").replace(t,i),e.state.shortId=(e.state.shortId||"").replace(t,i),e.state.scriptIdPart=(e.state.scriptIdPart||"").replace(t,i))}(h),function(e){const t=(e.metaInfo&&e.metaInfo.inputs||[]).find(e=>"ILScript"===e.name);t&&(t.defval="",e.state&&e.state.inputs&&(e.state.inputs[t.id]=""),e.metaInfo.defaults.inputs&&(e.metaInfo.defaults.inputs[t.id]=""))}(h)),l}restoreData(e){var t,i;this._invalidateLastNonEmptyPlotRowCache(),this.data().restoreState(e),this._resolvedSymbols=null!==(t=e.symbols)&&void 0!==t?t:{},this._graphics=e.graphics?(0,b.loadStudyGraphics)(e.graphics):(0,b.emptyStudyGraphics)(),this._postProcessGraphics(),this._plotOffsets=null!==(i=e.plotOffsets)&&void 0!==i?i:{},this._setStatus({type:Qe.StudyStatusType.Completed},!0)}hasStateForAlert(){return q.enabled("alerts")&&!this.isFailed()&&(this.metaInfo().isTVScript?this._hasAlertConditions()||this._hasAvailableAlertPlots()||this._hasAlertFunction():this._hasAlertablePlots())}stateForAlert(){const e=this.metaInfo(),t=this._plotsForAlert(),i=this._collectDepsForAlert(),r=i.idForAlert,n=i.studyDependencies,a=i.inputsForAlert,h=(this.priceScale()||this.model().mainSeries().priceScale()).formatter(),c=h?d.FormattersSerializer.serialize(h):null,_={id:r,uniqueId:r,type:(0,s.ensureNotNull)(window.TradingView.className(this.constructor)),title:(0,o.clean)(this._title(!1,{},!1),!0),shortTitle:(0,o.clean)(this._title(!0,{},!1),!0),shortDescription:(0,o.clean)(e.shortDescription||"Study",!0),fullId:e.fullId,isTVScript:Boolean(e.isTVScript),isTVScriptStrategy:Boolean(e.isTVScriptStrategy),isTVLibrary:Boolean(e.isTVLibrary),hasAlertFunction:Boolean(e.hasAlertFunction),plots:t,inputs:a,alerts:e.alerts,scriptIdPart:e.scriptIdPart,scriptVersion:e.pine?e.pine.version:"-1",callStudyDependencies:(0,l.formatCallstudyArg)(this._dependenciesForAlerts()),studyDependencies:n,formatter:c},p=function e(t){const i=t.metaInfo();if(!0===i.historyCalculationMayChange)return u.DataSourceDangerReason.PineRepainting;const s=i.inputs.filter(e=>"symbol"===e.type).map(e=>e.id);for(const e of s){const i=t.properties().inputs[e].value(),s=t.resolvedSymbolInfoBySymbol(i);if(s){if("spread"===s.type)return u.DataSourceDangerReason.Spread
;if("CRYPTOCAP"===s.exchange)return u.DataSourceDangerReason.CryptoCap}}const r=t.ownerSource();return t.isChildStudy()&&r?e(r):null}(this);return p&&(_.dangerReason=p),_}disconnect(){this._studyId=null,this._model.isSnapshot()||(this._resolvedSymbols={},this._resolvedSymbolsByInput={})}isChildStudy(){return this._isChildStudy}hasChildren(){return this._children.length>0}isActualInterval(){return this._isActualInterval}onIsActualIntervalChange(){return this._onIsActualIntervalChange}isVisible(){if(this._model.collapsed().value()||!this.properties().visible.value()||!this.isActualInterval())return!1;const e=this.metaInfo();if(e.plots.length>0)return!0;for(const t of Object.keys(e.graphics))for(const i of Object.keys(e.graphics[t])){const e=this.properties().graphics[t][i];if(!e.visible||e.visible.value())return!0}return!(!e.isTVScriptStrategy&&!e.hasAlertFunction)}inputs(e){const t=(0,L.merge)((0,L.clone)(nt),e||{});return t.skipOptionalEmptySymbolInputs&&(t.keepOptionalSymbolsEmpty=!0),this._buildInputs(t)}metaInfo(){return this._metaInfo}status(){return this._status}name(e){return e?this.metaInfo().shortDescription||this._properties.shortDescription&&this._properties.shortDescription.value()||"Study":this.metaInfo().description||this._properties.description&&this._properties.description.value()||"Study"}title(e,t,i,s){i=void 0===i?!this._showStudyArgumentsProperty.value():i;const r=JSON.stringify([e,t,i,s]);if(this._titleStrCache[r])return this._titleStrCache[r];if(this._titleInPartsCache[r])return this._joinTitlesParts(this._titleInPartsCache[r]);const n=this._title(e,t,i,s);return this._titleStrCache[r]=n,n}titleInParts(e,t,i,s){i=void 0===i?!this._showStudyArgumentsProperty.value():i;const r=JSON.stringify([e,t,i,s]);if(this._titleInPartsCache[r])return this._titleInPartsCache[r];const n=this._titleInParts(e,t,i,s);return this._titleInPartsCache[r]=n,n}invalidateTitleCache(e){if(this._titleStrCache={},this._titleInPartsCache={},!0===e&&this._children)for(let t=0;t<this._children.length;++t)this._children[t].invalidateTitleCache(e)}graphicsInfo(){return this._metaInfo.graphics}setOwnFirstValue(e){this._ownFirstValue=e}firstValue(e){if(!this._isChildStudy&&"Compare@tv-basicstudies"===this._metaInfo.id||!this._metaInfo.is_price_study){const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return null;if(!this.properties().visible.value()||!this.isActualInterval()||null!==this._startMovingPoint)return this._ownFirstValue;const i=t.firstBar(),s=t.lastBar();let r=function(e){const t=e.model().timeScale();if(t.isEmpty())return null;const i=t.visibleBarsStrictRange();if(null===i)return null;const s=i.firstBar(),r=i.lastBar(),n=z(e),a=new j;for(const e of n){const t=e.firstValue(s,r);a.improve(t)}return a.bestPrice()}(this);const n=this._metaInfo.plots||[];if(null===r){const t=this.data().rangeIterator(i,s);for(;t.hasNext();){const i=t.next().value;for(let t=0;t<n.length;++t){if((0,D.isColorerPlot)(n[t]))continue;const s=i[t+1];if(null==s)continue;const a=n[t].id,o=this.properties().styles[a]
;if(o.visible&&o.visible.value()&&!(e&&Math.abs(s)<1e-10)){r=s;break}}if(null!==r)break}}return this._ownFirstValue=r,null!==r?r:this._bandsFirstValue(e)}if(this._isChildStudy){const e=this._getNonPriceParent();if(e&&this.priceScale()===e.priceScale())return null!==e._ownFirstValue?e._ownFirstValue:e.firstValue()}return this._series.firstValue()}priceRange(e,t){let i=null;const s=this._metaInfo,r=this._fillPrecalculatedAutoscaleInfo(e,t);let n=this.data().minMaxOnRangeCached(e,t,r.fields);if(n=(0,f.mergeMinMax)(r.baseValueMinMax,n),r.useMainSeriesRange){const i=[{name:"low",offset:0},{name:"high",offset:0}],s=this.series().data().bars().minMaxOnRangeCached(e,t,i);n=(0,f.mergeMinMax)(n,s)}if(null!==n&&(i=new y.PriceRange(n.min,n.max)),s.bands)for(let e=0;e<s.bands.length;e++)if(this.properties().bands[e].visible.value()){const t=this.properties().bands[e].value.value();if(!(0,L.isNumber)(t))continue;i?i.apply(t,t):i=new y.PriceRange(t,t)}{const s=function(e,t,i){const s=z(e);let r=null;for(const e of s){const s=e.groupPriceRange(t,i);null!==s&&(r=null===r?s:r.merge(s))}return r}(this,e,t);s&&(i=i?i.merge(s):s)}return this._postProcessPriceRange(i)}autoScaleInfo(e,t){const i=this.priceRange(e,t),s=function(e,t,i){const s={topPixelMargin:0,bottomPixelMargin:0},r=z(e);for(const e of r){const r=e.groupPixelMargins(t,i);s.bottomPixelMargin=Math.max(s.bottomPixelMargin,r.bottomPixelMargin),s.topPixelMargin=Math.max(s.topPixelMargin,r.topPixelMargin)}return s}(this,e,t);return{range:i,topPixelMargin:s.topPixelMargin,bottomPixelMargin:s.bottomPixelMargin}}formatter(){return this._formatter||this.parentSource().formatter(!1)}updateAllViews(){var e,t,i,s,r;this._paneViews.forEach(e=>e.update()),this._labelPaneViews.forEach(e=>e.update()),null===(e=this._dataWindowView)||void 0===e||e.update(),null===(t=this._legendView)||void 0===t||t.update(),null===(i=this._statusView)||void 0===i||i.update(),this._priceAxisViews.forEach(e=>e.update()),this._priceLinesAxisViews.forEach(e=>e.update()),null===(s=this._inputsLinesPaneView)||void 0===s||s.update(),null===(r=this._inputsAnchorsPaneView)||void 0===r||r.update(),this._inputsTimeAxisPaneViews.forEach(e=>e.update()),this._inputsPriceAxisPaneViews.forEach(e=>e.update())}isPine(){return void 0!==this._metaInfo.pine}isStandardPine(){return this.isPine()&&S().isStandardPine(this._metaInfo.id)}isLinkedToSeries(){return!0===this._metaInfo.linkedToSeries}defaultPlotIdForAlert(){return this._metaInfo.plots.length?this._metaInfo.plots[0].id:null}resolvedSymbolInfoBySymbol(e){return this._resolvedSymbols&&e&&this._resolvedSymbols[this._getSymbolForResolve(e)]||null}currency(){const e=this.metaInfo();return Boolean(e)&&e.is_price_study?this.parentSource().currency():null}unit(){const e=this.metaInfo();return Boolean(e)&&e.is_price_study?this.parentSource().unit():null}dataWindowView(){return this._dataWindowView}statusView(){return this._statusView}legendView(){return this._legendView}inputsForAlertState(){return this.inputs()}sessionId(){return this.parentSource().sessionId()}
sessionIdChanged(){return this.parentSource().sessionIdChanged()}getSymbolString(e){return""===e?"":(0,T.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(e))}onStatusChanged(){return this._statusChanged}symbolsResolved(){return this._symbolsResolved}onHibernationStateChange(){return this._onHibernationStateChange}valuesProvider(){return new P.StudyLegendValuesProvider(this,this.model())}statusProvider(e){return new M.StudyStatusProvider(this,this._model.properties().childs().scalesProperties.childs().textColor)}correctScaleMargins(e){if("Volume"===this.metaInfo().shortId){const t=this.model().paneForSource(this);return null!==t&&t.isOverlay(this)&&t.containsMainSeries()?{top:.75,bottom:0}:{top:e.top,bottom:0}}return e}canBeHiddenByGlobalFlag(){return!0}isSourceHidden(){return!this.isVisible()||this.canBeHiddenByGlobalFlag()&&I.hideAllIndicators().value()}paneViews(e){if(this.isSourceHidden()||!e.hasPriceDataSource(this))return null;const t=[];return!this._startMovingPoint&&this._wasCompletedBefore&&t.push(...this._paneViews),this._inputsLinesPaneView&&(this._startMovingPoint||this._model.selection().isSelected(this))&&t.push(this._inputsLinesPaneView),this._inputsAnchorsPaneView&&t.push(this._inputsAnchorsPaneView),t}timeAxisViews(){return this._model.selection().isSelected(this)?this._inputsTimeAxisPaneViews:null}priceAxisViews(e,t){if(this.properties().oldShowLastValue&&!this.properties().oldShowLastValue.value())return null;let i=this._priceAxisViews.slice();return this._model.selection().isSelected(this)&&(i=i.concat(this._inputsPriceAxisPaneViews)),e.findTargetPriceAxisViews(this,t,i,this._priceLinesAxisViews)}movable(){return null!==this._inputsAnchorsPaneView}startMoving(e,t,i,s){this._startMovingPoint=e,this.stop()}move(e,t,i,s){if(void 0!==e.logical&&null!==this._startMovingPoint){if(Array.isArray(t)){const i=t;this._updateInputValue(e.logical,i[0]),this._updateInputValue(e.logical,i[1])}else this._updateInputValue(e.logical,t);this.updateAllViews()}}endMoving(e,t){return this._startMovingPoint=null,this.start(),{indexesChanged:!1,pricesChanged:!1}}convertYCoordinateToPriceForMoving(e,t){const i=this.priceScale();if(!t||!i||i.isEmpty())return null;const s=t.firstValue();return null===s?null:i.coordinateToPrice(e,s)}processHibernate(e){const t=this.isVisible();if(!this.isStarted()&&t&&(this._isChildStudy&&(0,s.ensureNotNull)(this._source).processHibernate(),this.start(void 0,void 0,e),this._onHibernationStateChange.fire(!1)),this.isHibernationAllowed()&&this.isStarted()&&!t){for(const e of this._children)e.processHibernate();this.stop(void 0,e),this._onHibernationStateChange.fire(!0)}}isHibernationAllowed(){return!this.metaInfo().historyCalculationMayChange&&(!this.hasChildren()||!!this._model.collapsed().value()&&this._children.every(e=>e.isHibernationAllowed()))}maxOffset(){return this._maxOffset}_updateMaxOffsetValue(){let e=-1/0;for(const t of this._metaInfo.plots)e=Math.max(this.offset(t.id),e);this._maxOffset.setValue(e)}_rightOffsetToUnixTime(e){if(this._series.bars().size()>=e){
const t=(0,s.ensureNotNull)(this._series.bars().lastIndex())-e;return(0,s.ensureNotNull)(this._series.bars().valueAt(t))[0]}return null}_invalidateLastNonEmptyPlotRowCache(){this._lastNonEmptyPlotRowCache={}}_collectDepsForAlert(){const e=[this,...this._getAllOwnerSources().filter(e=>e instanceof ut)];return(0,c.collectDepsForAlert)(e)}isHibernated(){return!this.isVisible()&&!this.isStarted()}_createViews(){var e,t;this._priceAxisViewsBase=[],this._priceLinesAxisViews=[],this._paneViews=[],this._labelPaneViews=[];const i=new Set,r=this.metaInfo(),n=Boolean(r.usePlotsZOrder),a=new Map;if(r.plots)for(let t=0;t<r.plots.length;t++){const o=r.plots[t];let l,h,d,u,c;if((0,D.isNonVisualPlot)(o))continue;let _=r.plots[t].id,p=r.styles;if((0,D.isBgColorerPlot)(o))l=new Q(this,this._series,this._model,_);else if((0,D.isShapesPlot)(o))l=new ge(this,this._series,this._model,_);else if((0,D.isCharsPlot)(o))l=new Ce(this,this._series,this._model,_);else if((0,D.isArrowsPlot)(o))l=new De(this,this._series,this._model,_);else if((0,D.isOhlcPlot)(o)){const e=o.target;if(i.has(e))continue;if(i.add(e),lt(r,t))l=new ke(this,this._series,this._model,e);else{if(!ht(r,t)){st.logError(`plot ${o.id} looks to be invalid`);continue}l=new Ne(this,this._series,this._model,e)}u=this.createPriceAxisView(e),d=new Fe.PanePriceAxisView(u,this,this._model),_=e,p=r.ohlcPlots}else u=this.createPriceAxisView(_),c=this.createPriceLineAxisView(_),l=new We.StudyPlotPaneView(this,this._series,this._model,_),this.properties().styles[_].trackPrice.value()&&(h=new ze(this,_)),d=new Fe.PanePriceAxisView(u,this,this._model);const m=n?(0,s.ensureDefined)(null===(e=null==p?void 0:p[_])||void 0===e?void 0:e.zorder):a.size;dt(m,a);const y={paneViews:[l],labelView:d,priceAxisView:u,priceLineAxisView:c};void 0!==h&&y.paneViews.push(h),a.set(m,y)}(null!==(t=this._metaInfo.bands)&&void 0!==t?t:[]).forEach((e,t)=>{const i=this._properties.bands[t];if(i&&i.visible.value()){const t=new Xe(i,this),r=n?(0,s.ensureDefined)(e.zorder):a.size;dt(r,a),a.set(r,{paneViews:[t]})}}),this._properties.bandsBackground&&((0,s.assert)(!n,"'usePlotsZOrder' flag does not supported"),a.set(a.size,{paneViews:[new Je(this)]}));const o=this._paneViews;(0,b.createGraphicsPaneViews)(this,this.model()).then(e=>{for(let t=0;t<e.length;t++)o.push(e[t]);this._model.lightUpdate()}),this._properties.areaBackground&&((0,s.assert)(!n,"'usePlotsZOrder' flag does not supported"),a.set(a.size,{paneViews:[new Ge.AreaBackgroundPaneView(this,this.model())]}));const l=e=>r.plots.some(t=>(0,D.isColorerPlot)(t)&&t.target===e);if(this._properties.filledAreas&&r.filledAreas)for(let e=0;e<r.filledAreas.length;++e){const t=r.filledAreas[e],i=this._properties.filledAreasStyle[t.id],o=l(t.id);let h;if("plot_plot"===t.type||o?h=new Ye(this,this.model(),t,i):"hline_hline"===t.type?h=new Ze(this,t,i):st.logWarn("Unsupported filledArea type: "+t.type),void 0!==h){const e=n?(0,s.ensureDefined)(t.zorder):a.size;dt(e,a),a.set(e,{paneViews:[h]})}}const h=Array.from(a.keys()).sort((e,t)=>e-t);for(let e=0;e<h.length;e++){
const t=(0,s.ensureDefined)(a.get(h[e]));this._paneViews.push(...t.paneViews),t.labelView&&this._labelPaneViews.push(t.labelView),t.priceAxisView&&this._priceAxisViewsBase.push(t.priceAxisView),t.priceLineAxisView&&this._priceLinesAxisViews.push(t.priceLineAxisView)}this._dataWindowView||(this._dataWindowView=new w.StudyDataWindowView(this,this._model)),this._legendView||(this._legendView=new x(this,this._model)),this._statusView||(this._statusView=new C.StudyStatusView(this)),this._concatPriceAxisViews()}_titleInputs(e,t){return this.inputs(this._titleInputsOptions(e,t))}_titleInputsOptions(e,t){return{symbolsForDisplay:!0,skipHiddenInputs:!0,skipFakeInputs:!1,fakeInputsForDisplay:!0,asObject:!1,skippedGroups:[],noExchanges:e,noResolution:t,skipColorInputs:!0,skipTimeInputs:!0,priceInputsForDisplay:!0,skipOptionalEmptySymbolInputs:ot}}_subscribeToSessionId(){!this._isSubscribedToSessionId&&this.hasSymbolInputs()&&(this.sessionIdChanged().subscribe(this,this._onSessionIdChanged),this._isSubscribedToSessionId=!0)}_unsubscribeToSessionId(){this._isSubscribedToSessionId&&(this.sessionIdChanged().unsubscribe(this,this._onSessionIdChanged),this._isSubscribedToSessionId=!1)}_onSessionIdChanged(){this.restart(!0)}_title(e,t,i,s){const r=this._titleInParts(e,t,i,s);return this._joinTitlesParts(r)}_postProcessPriceRange(e){if(e&&e.minValue()===e.maxValue()&&!this.metaInfo().is_price_study){const t=.005*e.minValue();e=new y.PriceRange(e.minValue()-t,e.maxValue()+t)}const t=this.priceScale();return t&&t.isLog()&&e?new y.PriceRange(t.priceToLogical(e.minValue()),t.priceToLogical(e.maxValue())):e}_joinTitlesParts(e){const t=e[1]?e[1].join(", "):"";return e[0]+(t.length>0?" ("+t+")":"")}_titleInParts(e,t,i,s){var n;const a=this.name(e);t=t||{};const o=[(0,r.t)(a,{context:"study"})];let l=[];if(!i){const i=this._getMTFResolutionInputTitle();null!==i&&i.length>0&&o.push(i);const r=this.metaInfo(),a=this._titleInputs(s,!0)||[];if(a.length>0){const i={};if(this._isChildStudy)for(let t=0;t<r.inputs.length;++t){const a=r.inputs[t];if(!S().isSourceInput(a))continue;const o=a.id,l=this._properties.inputs[o].value();if(l.indexOf("$")>=0&&this._source){const t=this._source.metaInfo(),r=this._source.title(e,{},!0,s);if(1===t.plots.length)i[l]=r;else{const e=l.split("$")[1],s=null===(n=t.plots[parseInt(e)])||void 0===n?void 0:n.id,a=t.styles&&t.styles[s],o=a&&a.title||s;i[l]=r+":"+o}}break}l=a.map(e=>{let s=(0,L.isNumber)(e)?this._numericFormatter.format(e):i&&i[e.toString()]||e.toString();return t&&t[s.toString()]&&(s=t[s.toString()]),s})}}return[o.join("  "),l]}_getMTFResolutionInputTitle(){const e=this.metaInfo();for(let t=0;t<e.inputs.length;t++){const i=e.inputs[t];if("resolution"===i.type&&i.isMTFResolution)return this._properties.inputs[i.id].value()}return null}_hasAvailableAlertPlots(){const e=this.stateForAlert(),t=h.alertBandFactory.create(e).getPlots();return null!=t&&t.length>0}_hasAlertablePlots(){return(this.metaInfo().plots||[]).some(e=>"line"===e.type)}_hasAlertConditions(){
if(this.metaInfo().plots.some(D.isAlertConditionPlot))return!0;const e=this.stateForAlert();return Boolean(e.alerts&&e.alerts.conditions)}_hasAlertFunction(){const e=this.metaInfo();return Boolean(e.hasAlertFunction)}_getSymbolForResolve(e){return this.getSymbolString(this._getSymbolForApi(e))}_allSymbolsAreResolved(){const e=this.metaInfo(),t=[];let i=!1;for(let s=0;s<e.inputs.length;s++)if("symbol"===e.inputs[s].type){const r=e.inputs[s].id,n=this._properties.inputs[r].value(),a=this._getSymbolForResolve(n);if(""!==a)if(this._resolvedSymbols[a])i=!0;else{const e=this._resolveSymbol(a,n);t.push(e)}}if(0===t.length){const e=Promise.resolve();return i?e.then(()=>this._symbolsResolved.fire()):e}return Promise.all(t).catch(e=>(this._setStatus({type:Qe.StudyStatusType.Error,errorDescription:{error:rt}}),this.stop(!0),this._model.updateSource(this),Promise.reject("Invalid symbol, "+e))).then(()=>{null!==this._studyId&&this.stop(!0),this.start(!0),this._symbolsResolved.fire(),this._recheckLineToolsActuality()})}_getSymbolForApi(e){return e}_resolveSymbol(e,t){if(""===e)return Promise.resolve();let i=this._pendingResolveSymbols.get(e);return void 0!==i||(i=new Promise((i,s)=>{this._onSymbolResolvingStart(),this._chartApi.resolveSymbol((0,V.makeNextSymbolId)(),e,r=>{switch(this._pendingResolveSymbols.delete(e),r.method){case"symbol_resolved":this._setStatus({type:Qe.StudyStatusType.Undefined}),this._resolvedSymbols[e]=r.params[1],this._resolvedSymbolsByInput[t]=r.params[1],this._onSymbolResolved(e,t,r.params[1]),this.invalidateTitleCache(!0),i();break;case"symbol_error":if(this._setStatus({type:Qe.StudyStatusType.Error,errorDescription:{error:r.params[1]}}),this._onSymbolError(),r.params[1]===A.permissionDenied&&r.params[2])switch(r.params[2]){case A.SymbolErrorPermissionDeniedReason.Symbol:if(r.params[3])return void this._resolveSymbol(r.params[3],t).then(i);break;default:return void this._resolveSymbol(r.params[2],t).then(i)}this._sendTelemetryCounter("symbol_error",Object.assign(this._getTelemetryAdditionalData(),{symbol:e,reason:r.params[1]})),s()}})}),this._pendingResolveSymbols.set(e,i)),i}_recheckLineToolsActuality(){const e=this._model.paneForSource(this);null!==e&&e.sourcesByGroup().lineSourcesForAllSymbols().forEach(e=>{e.ownerSource()===this&&e.calcIsActualSymbol()})}_getSymbolObject(e){const t={symbol:e};return t.session=this.sessionId(),t}_onSymbolResolved(e,t,i){{const e=(0,s.ensureNotNull)(this._model.alertsWatcher());e.syncSourceAlertLabels(this);const t=this.getAllChildren();for(const i of t)e.syncSourceAlertLabels(i)}}_onSymbolResolvingStart(){}_onSymbolError(){}_setStatus(e,t){var i;this._status=e,e.type===Qe.StudyStatusType.Completed?this._wasCompletedBefore=!0:e.type!==Qe.StudyStatusType.Error&&e.type!==Qe.StudyStatusType.Undefined||(this._wasCompletedBefore=!1),t||(null===(i=this._statusView)||void 0===i||i.update(),this._model.updateSource(this),this._statusChanged.fire(e))}_bandsFirstValue(e){const t=this._metaInfo;if(!t.bands)return null;for(let i=0;i<t.bands.length;i++){
const t=this.properties().childs().bands.childs()[i];if(t.childs().visible.value()){const i=t.childs().value.value();if(e&&0===i)continue;return i}}return null}_prepareInputs(e){(0,s.assert)(!!e,"options not set");const t=this.metaInfo(),i={},r=e.allowedInputTypes?new Set(e.allowedInputTypes):null;for(let s=0;s<t.inputs.length;s++){const n=t.inputs[s];if(null!==r&&!r.has(n.type))continue;if(n.isFake&&e.skipFakeInputs)continue;if(n.isMTFResolution&&e.noResolution)continue;if(n.isHidden&&e.skipHiddenInputs)continue;if("bool"===n.type&&e.skipHiddenInputs&&e.skipBooleanInputs)continue;if("color"===n.type&&e.skipHiddenInputs&&e.skipColorInputs)continue;if("time"===n.type&&e.skipHiddenInputs&&e.skipTimeInputs)continue;if("text_area"===n.type&&e.skipHiddenInputs&&e.skipTextareaInputs)continue;if(void 0!==n.groupId&&-1!==e.skippedGroups.indexOf(n.groupId))continue;if(-1!==e.skippedInputs.indexOf(n.id))continue;const a=this._prepareInput(n,e);"symbol"===n.type&&e.skipOptionalEmptySymbolInputs&&""===a||(i[n.id]=(0,L.clone)(a))}return i}_getAllOwnerSources(){const e=[];let t=this.ownerSource();for(;null!==t;)e.push(t),t=t.ownerSource();return e}_getStudyIdWithLatestVersion(){return S().getStudyIdWithLatestVersion(this.metaInfo())}_lastNonEmptyPlotRow(e){var t;if(!(0,L.isInteger)(e))return st.logDebug("_lastNonEmptyPlotRow: incorrect plotIndex"),null;let i=null!==(t=this._lastNonEmptyPlotRowCache[e])&&void 0!==t?t:null;if(null!==i)return i;return i=this.data().findLast((t,i)=>void 0!==i[e],1e3),null===i?null:(this._lastNonEmptyPlotRowCache[e]=i,i)}_applyPlotToPrecalculatedAutoscaleInfo(e,t,i,s){const r=s.id,n=this.properties().styles[r],a=(0,D.isShapesPlot)(s)||(0,D.isCharsPlot)(s);i.useMainSeriesRange=i.useMainSeriesRange||(0,D.isArrowsPlot)(s);let o=(0,D.isLinePlot)(s)||(0,D.isOhlcPlot)(s);if(a){const e=n.location.value(),t=[v.MarkLocation.Absolute,v.MarkLocation.Top,v.MarkLocation.Bottom].indexOf(e)<0;i.useMainSeriesRange=i.useMainSeriesRange||a&&t,o=o||e===v.MarkLocation.Absolute}if(!o)return i;const l={name:r,offset:this.offset(r)},h=n.plottype.value();if(!this.properties().skipHistogramBaseOnAutoScale&&[D.LineStudyPlotStyle.Histogram,D.LineStudyPlotStyle.Columns,D.LineStudyPlotStyle.Area].indexOf(h)>=0){const s=n.histogramBase.value(),r=this.data().minMaxOnRangeCached(e,t,[l]);return(0,L.isNumber)(s)&&null!==r&&(i.baseValueMinMax=(0,f.mergeMinMax)(i.baseValueMinMax,{min:s,max:s}),i.baseValueMinMax=(0,f.mergeMinMax)(i.baseValueMinMax,r)),i}return i.fields.push(l),i}_fillPrecalculatedAutoscaleInfo(e,t){return this._metaInfo.plots.filter(e=>!(0,D.isPlotWithTechnicalValues)(e)).filter(e=>{const t=e.id;let i;if((0,D.isOhlcPlot)(e)){const t=e.target;i=this.properties().ohlcPlots[t]}else i=this.properties().styles[t];return i.visible.value()}).reduce((i,s)=>this._applyPlotToPrecalculatedAutoscaleInfo(e,t,i,s),{fields:[],useMainSeriesRange:!1,baseValueMinMax:null})}_buildInputs(e){(0,s.assert)(!!e,"options not set");let t={};try{t=this._prepareInputs(e)}catch(e){st.logWarn("Failed to prepare study inputs: "+e)}if(e.asObject){
const e={};return Object.keys(t).forEach(i=>{null!=t[i]&&(e[i]=t[i])}),e}{const e=[];return Object.keys(t).forEach(i=>{null!=t[i]&&e.push(t[i])}),e}}_prepareInput(e,t){const i=this._prepareInputValue(e,t);return!e.isFake||t.fakeInputsForDisplay||t.onlyAtomValues?i:{v:i,f:!0,t:e.type}}_plotsForAlert(){return(0,c.plotsForAlert)(this.metaInfo(),this.offset.bind(this))}_dependenciesForAlerts(){const e=this._getAllOwnerSources().filter(e=>e instanceof ut);return(0,c.dependenciesForAlerts)(e,this._model.studyMetaInfoRepository())}_calcIsActualInterval(){const e=this._isActualInterval;this._isActualInterval=(0,et.isActualInterval)(this._series.intervalObj(),this.properties().intervalsVisibilities),e!==this._isActualInterval&&(this._onIsActualIntervalChange.fire(),this._visibleChanged(),this.processHibernate())}_visibleChanged(){this._series.invalidateBarColorerCache()}_getNonPriceParent(){const e=this.source();if(e instanceof ut){const t=e.metaInfo();return t.is_price_study&&"Compare@tv-basicstudies"!==t.id?e._getNonPriceParent():e}return null}_updateInputValue(e,t){const i=this._properties.inputs;if(i[t.id])if("price"===t.type)i[t.id].setValue(e.price);else if("time"===t.type){const s=this._model.timeScale().indexToTimePoint(e.index);null!==s&&i[t.id].setValue(1e3*s)}}_initializeStudyInputsPaneViews(){const e=(0,Y.editableStudyInputs)(this._metaInfo.inputs);if(0===e.length)return;const t={convertPriceToCoordinate:e=>{const t=this.priceScale();if(null!==t&&!t.isEmpty()){const i=this.firstValue();if(null!==i)return t.priceToCoordinate(e,i)}return null},formatPrice:e=>{const t=this.priceScale();if(null!==t&&!t.isEmpty()){const i=this.firstValue();if(null!==i)return t.formatPrice(e,i)}return""},getInputValue:e=>{var t,i;return null!==(i=null===(t=this._properties.inputs[e])||void 0===t?void 0:t.value())&&void 0!==i?i:null},isSelected:()=>this._model.selection().isSelected(this),isHovered:()=>this===this._model.hoveredSource()};Promise.all([i.e(62183).then(i.bind(i,68031)),i.e(62183).then(i.bind(i,5355)),i.e(62183).then(i.bind(i,76248)),i.e(62183).then(i.bind(i,50693))]).then(i=>{const[s,r,n,a]=i;this._inputsAnchorsPaneView=new s.StudyInputsAnchorsPaneView(e,this._model,t);const o=e.filter(e=>!Array.isArray(e));this._inputsLinesPaneView=new r.StudyInputsLinesPaneView(o,this._model,t);let l=!1;e.forEach(e=>{if(Array.isArray(e)){const i="time"===e[0].type?e[0]:e[1],s="price"===e[0].type?e[0]:e[1];this._inputsTimeAxisPaneViews.push(new n.StudyInputTimeAxisPaneView(i,this._model,t.getInputValue)),this._inputsPriceAxisPaneViews.push(new a.StudyInputPriceAxisPaneView(s,t)),l=!0}else"time"===e.type?this._inputsTimeAxisPaneViews.push(new n.StudyInputTimeAxisPaneView(e,this._model,t.getInputValue)):(this._inputsPriceAxisPaneViews.push(new a.StudyInputPriceAxisPaneView(e,t)),l=!0)}),l&&this.formatterChanged().subscribe(this,this.invalidateTitleCache)})}}},85339:(e,t,i)=>{i.d(t,{StudyPriceAxisView:()=>r});var s=i(98424);class r extends s.PriceAxisView{constructor(e,t){super(),this._model=e.model(),this._source=e,this._data=t}
_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const s=this._source.model(),r=this._source.priceScale();if(null===r)return;if(!s.isPriceScaleVisible(r))return;const n=this._source.lastValueData(this._data.plotIndex,!1);if(n.noData)return;i.background=n.color;let a=n.color;"transparent"===a&&(a=this._model.properties().childs().scalesProperties.childs().backgroundColor.value()),i.textColor=this.generateTextColor(a),i.coordinate=n.coordinate,i.floatCoordinate=n.floatCoordinate,this._showAxisLabel()&&(e.text=n.text,e.visible=!0),this._updatePaneRendererData(t)}_showPaneLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyPlotLabels.value()||e.showFundamentalNameLabel.value())&&this._source.properties().showLabelsOnPriceScale.value()}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().showLabelsOnPriceScale.value()}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._source.priceLabelText(this._data.plotIndex),e.visible=!0)}}},48874:(e,t,i)=>{var s=i(32567),r=i(97639),n=i(88537).assert,a=i(95078).unpackNonSeriesData,o=i(49473).symbolTitle,l=i(89627).StudyBarColorer,h=i(85339).StudyPriceAxisView,d=i(74316).createGraphicsPriceAxisViews,u=i(61850).ChartApiInterface,c=i(75203).telemetry,_=i(66156),p=i(29588).createGoProDialog,m=i(46090).DefaultProperty,y=i(89765).PriceFormatter,f=i(91419).VolumeFormatter,g=i(65513).PercentageFormatter,S=i(52280).PlotList,b=i(70028),v=i(51954),w=i(18458),P=w.LineStudyPlotStyle,x=i(67850).StudyPriceLineAxisView,I=i(23083).studyPlotFunctionMap,C=i(23083).studyEmptyPlotValuePredicate,T=i(76543).makeNextStudyId,V=i(11688),A=i(7555).StudyBase,M=i(88230).InvalidationMask,L=i(6096),R=i(52500).IntervalsVisibilitiesProperty,D=L.StudyStatusType,E=L.convertStudyStatusToString,B=i(21386).colorToInteger,k=i(94543).intervalsVisibilitiesDefaults,O=i(11905).getLogger("Chart.Study"),N=V.enabled("datasource_copypaste"),F=V.enabled("study_symbol_ticker_description"),W=V.enabled("hide_unresolved_symbols_in_legend");function H(e,t,i){var s=new m(t,i,!0);s.removeProperty("intervalsVisibilities"),s.addChild("intervalsVisibilities",new R(i&&i.intervalsVisibilities)),s.addExclusion("visible"),s.addExclusion("precision"),s.addExclusion("minTick"),s.addExclusion("intervalsVisibilities");for(var r=0;r<e.inputs.length;++r){var n=e.inputs[r];n.isHidden&&(s.addExclusion("inputs."+r.toString()),s.addExclusion("inputs."+n.id))}return"PivotPointsStandard@tv-basicstudies"!==e.id&&"PivotPointsHighLow@tv-basicstudies"!==e.id||!s.hasChild("font")||s.removeProperty("font"),s}function U(e,t){if(t.plots)for(var i=0;i<t.plots.length;i++){var s=t.plots[i],r=s.id;if(!w.isColorerPlot(s)){var n={visible:!0,color:"#0496FF",linestyle:CanvasEx.LINESTYLE_SOLID,linewidth:2,plottype:P.Line,histogramBase:0,transparency:50,trackPrice:!1,joinPoints:!1};w.isBarColorerPlot(s)&&(n.transparency=0),n.plottype=s.type,n.title=r,
e.styles&&r in e.styles&&TradingView.merge(n,e.styles[r]),e.styles[r]=n}}}function z(e,t){return e&&e[t]&&e[t].hasOwnProperty("showLast")?e[t].showLast.value():null}class G extends A{constructor(e,t,i,s){super(e,t,i,s),this._resolvedSymbols={},this._priceAxisViewsBase=[],this._graphicsPriceAxisViews=[],this._priceLinesAxisViews=[],this._chartApi=e._chartApi,this._turnaroundCounter=0,this._turnaround="st"+this._turnaroundCounter,this._plotFields=[];var n=this.metaInfo().plots;if(n)for(var a=0,o=n.length;a<o;a++){var l=n[a].id;this._plotFields.push(l)}this._invalidateLastNonEmptyPlotRowCache(),this.m_data=new S(I(this._metaInfo),C),this._studyModified=!1,this._tagsChanged=new r,this._labelPaneViews=[],this._createViews();var h=this;this._handler=function(e){h.onData(e)},this._handler.isTVScriptStrategy=this._metaInfo.isTVScriptStrategy,this._recreatePriceFormattingDependencies(),this._properties.precision.listeners().subscribe(this,this._precisionChanged),this._showStudyArgumentsProperty.listeners().subscribe(this,this.invalidateTitleCache),this._properties.description.listeners().subscribe(this,this.invalidateTitleCache),this._properties.inputs.listeners().subscribe(this,this.invalidateTitleCache),this._properties.shortDescription&&this._properties.shortDescription.listeners().subscribe(this,this.invalidateTitleCache),V.enabled("update_study_formatter_on_symbol_resolve")&&e.mainSeries().dataEvents().symbolResolved().subscribe(this,this._recreatePriceFormattingDependencies),e.mainSeries().dataEvents().symbolResolved().subscribe(this,this.invalidateTitleCache);h=this;var d={};this._simplePlotsCount=s.plots.filter((function(e,t){if(w.isLinePlot(e))return!0;if(w.isOhlcPlot(e)){var i=h.metaInfo().plots[t].target;return!d[i]&&(d[i]=i,!0)}return!1})).length,this.hasBarColorer()&&this._properties.visible.listeners().subscribe(e.mainSeries(),e.mainSeries().invalidateBarStylesCache),this._childStudyByRebind=new r,this._formatterChanged=new r,this._priceStepChanged=new r,this._aboutToBeDestroyed=new r,this._ongoingDataUpdate=Promise.resolve(),this._isDestroyed=!1,this._definitionsViewModel=null,this._updateMaxOffsetValue()}series(){return this._series}model(){return this._model}clearData(){this._invalidateLastNonEmptyPlotRowCache(),this.data().clear(),this._graphics.clear&&this._graphics.clear(),this._plotOffsets={},this.hasBarColorer()&&this._model.mainSeries().invalidateBarStylesCache()}onTagsChanged(){return this._tagsChanged}properties(){return this._properties}idForAlert(){return this._collectDepsForAlert().idForAlert}alertCreationAvailable(){return!this.metaInfo().isTVLibrary&&super.alertCreationAvailable()}isSavedInStudyTemplates(){for(var e=0;e<this._metaInfo.inputs.length;e++)if("bar_time"===this._metaInfo.inputs[e].type)return!1;return!0}restart(e){this._restarting=!0,this.clearData(),(e||V.enabled("stop_study_on_restart"))&&this.stop(),setTimeout(this.start.bind(this),0)}stop(e){if(!0===e&&this._children)for(var t=0;t<this._children.length;++t)this._children[t].stop(!0);this._stopStudyOnServer(),this.clearData(),
this._unsubscribeToSessionId(),this.recalculate()}_allInputsAreValid(){for(var e=0;e<this._metaInfo.inputs.length;e++)if("bar_time"===this._metaInfo.inputs[e].type){var t=this._metaInfo.inputs[e].id,i=this._properties.inputs[t].value();if(void 0===i||null==i)return!1}return!0}sourceId(){return this._studyId}parentSource(){return this._source||this._series}symbolSource(){return this.parentSource().symbolSource()}source(){return this.parentSource()}ownerSource(){return this._isChildStudy?this._source:A.prototype.ownerSource.call(this)}setChild(e){e instanceof G&&e.source()===this&&(this._children||(this._children=[]),-1===this._children.indexOf(e)&&this._children.push(e))}unsetChild(e){if(e instanceof G&&e.source()===this&&this._children){var t=this._children.indexOf(e);~t&&this._children.splice(t,1)}}getAllChildren(){if(!Array.isArray(this._children))return[];for(var e=this._children.slice(),t=0;t<e.length;++t)for(var i=e[t].getAllChildren(),s=0;s<i.length;++s)~e.indexOf(i[s])||e.push(i[s]);return e}_debugId(){var e=[];return this._studyId&&e.push(this._studyId),e.push(this._metaInfo.fullId),e.push(this._metaInfo.description),JSON.stringify({study:e})}isStarted(){return!!this._studyId}_isStopped(){return!this.isStarted()}isRestarting(){return!!this._restarting}start(e,t){var i=this._model.mainSeries();if(!i.isStarted())return void i.dataEvents().completed().subscribe(this,(function(){this.start(e,t)}),!0);this._isChildStudy&&this._source.isHibernated()&&this._source.start();const s=!(!this._isChildStudy&&!this.hasChildren()&&!this.isVisible())||!0===t;this._chartApi&&this._chartApi.connected()&&s&&this._allSymbolsAreResolved().then(function(){this._startAfterSymbolsResolved(e,t)}.bind(this)).catch(function(e){O.logError("ERROR: "+this._debugId()+" start failed, "+e),delete this._restarting}.bind(this))}_startAfterSymbolsResolved(e,t){if(!this.isStarted()||this._restarting){if(this._isChildStudy){if(!this._source.isStarted()||this._source.isRestarting())return void this._source.onStart.subscribe(this,this._startAfterSymbolsResolved,!0);b.setChildStudyMetaInfoPropertiesSourceId(this._metaInfo,this._source.sourceId(),this._properties)}if(delete this._restarting,this._allInputsAreValid()&&(this._inputs=this.inputs({keepOptionalSymbolsEmpty:!0}),this._createStudyOnServer(),this._subscribeToSessionId(),this.onStart.fire(),!0===e&&this._children))for(var i=0;i<this._children.length;++i)this._children[i].start(!0,t)}}_createStudyOnServer(){var e=this._getStudyIdWithLatestVersion();this._studyId=T(),this._incrementTurnaround(),this._studyName=e,this._chartApi.createStudy(this._studyId,this._turnaround,this._isChildStudy?this._source.sourceId():this._series.seriesSource().instanceId(),this._studyName,this._inputs,this._handler,this._isChildStudy)}_modifyStudyOnServer(e){this._chartApi.modifyStudy(this._studyId,this._turnaround,e,this._handler)}_stopStudyOnServer(){this._chartApi&&this._chartApi.connected()&&this.isStarted()&&(this._chartApi.removeStudy(this._studyId,this._isChildStudy),this._setStatus({type:D.Undefined})),
this._studyId=null}inputsForAlert(){var e=this.offset(),t=this.inputs();return e&&t.push(e),t}_prepareInputValue(e,t){var i=e.id;if(t.valuesAsIsFromProperties)return this._properties.inputs[i].value();if("symbol"===e.type){var s=t&&t.symbolsForDisplay,r=this._properties.inputs[i].value(),n=s?r:this._getSymbolForApi(r),a=this._resolvedSymbols&&this._resolvedSymbols[this._getSymbolForResolve(n)];if(""===n&&e.optional){if(t&&t.keepOptionalSymbolsEmpty)return n;n=this._model.mainSeries().symbol(),a=this._model.mainSeries().symbolInfo()}if(s)if(a)if(F){switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":n=a.description;break;case"ticker-and-description":n=`${a.name}, ${a.description}`;break;case"ticker":n=a.name}}else n=o(a,t.noExchanges);else W&&(n="");else a&&(n=a.ticker||a.full_name),!this.isPine()&&t&&t.symbolsForChartApi&&(n=this.getSymbolString(n));return n}if("bar_time"===e.type){var l=this._properties.inputs[i].value();if(l<0){var h=this._rightOffsetToUnixTime(-l);l=h&&h>=0?h:l}return l}if(this._metaInfo.isTVScript||this._metaInfo.pine){if("text"===i)return this._metaInfo.defaults.inputs.text;if("pineId"===i)return this._metaInfo.scriptIdPart;if("pineVersion"===i)return this._metaInfo.pine?this._metaInfo.pine.version:"-1";if("color"===e.type&&this._metaInfo.isRGB){var d=this._properties.inputs[i].value();return B(d)}if("price"===e.type){var u=this._properties.inputs[i].value();return t.priceInputsForDisplay?this.formatter().format(u):u}return this._properties.inputs[i].value()}return this._properties.inputs[i].value()}_rebindToSource(e,t){var i=this.parentSource();if(this._isChildStudy){var s;this._source.unsetChild(this);var r=null;if(e===this._model.mainSeries())this._source=null,this._isChildStudy=!1,this._ownerSource=null,s=this._series.seriesSource().instanceId(),r=u.REBIND_STUDY_CHILD_TO_STANDALONE;else{if(!(e instanceof G))return O.logError("Unable to rebind study to source of this type"),!1;this._ownerSource=e,this._source=e,s=this._source.sourceId(),this._source.setChild(this),this._source.isHibernated()&&this._source.start()}this._incrementTurnaround(),this.disablePriceRangeReady(),this._chartApi.rebindStudy(this._studyId,this._turnaround,s,this._studyName,t,this._handler,r)}else{if(!(e instanceof G))return O.logError("Unable to rebind study to source of this type"),!1;var n=e.isHibernated();n&&e.start();var a=!1;if(this._canCreateStudyWithRebindType(u.REBIND_STUDY_STANDALONE_TO_CHILD)?(this._incrementTurnaround(),this.disablePriceRangeReady(),a=this._chartApi.rebindStudy(this._studyId,this._turnaround,e.sourceId(),this._studyName,t,this._handler,u.REBIND_STUDY_STANDALONE_TO_CHILD)):p({feature:"studyOnStudy"}),!a)return n&&e.stop(),!1;this._isChildStudy=!0,this._ownerSource=e,this._source=e,this._source.setChild(this),this._childStudyByRebind.fire()}var o=this.m_priceScale,l=e.priceScale();if(o!==l){var h=this._model.paneForSource(this),d=this._model.paneForSource(e);h===d&&d.move(this,l,!0)}const c=this.parentSource()
;return i.formatterChanged().unsubscribe(this,this._onSourceFormatterChanged),c.formatterChanged().subscribe(this,this._onSourceFormatterChanged),i.priceStepChanged().unsubscribe(this,this._onSourcePriceStepChanged),c.priceStepChanged().subscribe(this,this._onSourcePriceStepChanged),i.currencyChanged().unsubscribeAll(this),c.currencyChanged().subscribe(this,this._onSourceCurrencyChanged),i.unitChanged().unsubscribeAll(this),c.unitChanged().subscribe(this,this._onSourceUnitChanged),i.priceRangeReadyChanged().unsubscribeAll(this),c.priceRangeReadyChanged().subscribe(this,this._onSourcePriceRangeReadyChanged),this._recreatePriceFormattingDependencies(),!0}childStudyByRebind(){return this._childStudyByRebind}_changeInputsImpl(e,t){var i=this.source(),s=this._properties.inputs&&this._properties.inputs.state(),r=b.getSourceIdByInputs(this._metaInfo.inputs,s),n=!0;if(r)if("high"===r||"open"===r||"low"===r||"close"===r||"hl2"===r||"ohl3"===r||"ohlc4"===r)i=this._model.mainSeries();else for(var a=this._model.dataSources().filter((function(e){return e instanceof G&&e.canHaveChildren()})),o=0;o<a.length;++o)if(a[o].sourceId()===r){i=a[o];break}if(i!==this.source()){if(!this._rebindToSource(i,e)&&s)for(var l in t)if(t.hasOwnProperty(l)&&t[l]!==e[l]&&0===e[l].indexOf(r)){var h=this._properties.inputs[l],d=t[l];h.setValue(d),n=!1;break}}else this._incrementTurnaround(),this.disablePriceRangeReady(),this._modifyStudyOnServer(e);this.invalidateTitleCache(),n&&(this._studyModified=n)}_incrementTurnaround(){this._turnaround="st"+ ++this._turnaroundCounter}_tryChangeInputs(){var e=TradingView.clone(this._inputs);this.isStarted()&&this._chartApi.connected()?this._allInputsAreValid()?this._allSymbolsAreResolved().then(function(){var t=this.inputs({keepOptionalSymbolsEmpty:!0});const i=JSON.stringify(t)!==JSON.stringify(this._inputs);this._isStopped()?i&&this.disablePriceRangeReady():i&&(this._changeInputsImpl(t,e),this._inputs=t,this.model().alertsWatcher().syncSourceAlertLabels(this))}.bind(this)).catch(function(e){O.logError("ERROR: "+this._debugId()+" _tryChangeInputs: cannot modify study, "+e)}.bind(this)):this.stop():(this.stop(!0),this.start(!0)),this._tagsChanged.fire()}testInputValue(e,t){if(!b.canBeChild(this._metaInfo)||!b.isSourceInput(e))return!0;var i=this._properties.inputs&&this._properties.inputs[e.id];if(!i)return!0;var s=G.getInputRebindType(e,i.value(),t);return!!this._canCreateStudyWithRebindType(s)||(p({feature:"studyOnStudy"}),!1)}_canCreateStudyWithRebindType(e){return e!==u.REBIND_STUDY_STANDALONE_TO_CHILD||this._chartApi.isCanCreateStudy(!0)}changeStyles(){var e=void 0!==this._metaInfo.inputs.find((function(e){return"symbol"===e.type}));!this.isStarted()&&!e||this._restarting||(this._inputs?this._tryChangeInputs():this._chartApi&&this._chartApi.connected()&&this.restart(),this._metaInfo.isTVScript&&this._metaInfo.TVScriptMetaInfoExprs&&(this._pinePatchProps(),this.invalidateTitleCache()))}_recreatePaneViews(){this.hasBarColorer()&&this._model.mainSeries().invalidateBarStylesCache(),this._createViews(),
this.recalculate(!0),this.updateAllViews()}_onPropertiesChanged(){this.changeStyles(),this._recreatePaneViews(),v.emit("study_properties_changed",this._id)}_isModifiedStudyInputs(e){if(0===Object.keys(e).length)return!1;if(void 0===this._oldStudyInputs)return this._oldStudyInputs=e,!0;var t=Object.keys(this._oldStudyInputs);return n(t.length===Object.keys(e).length,"keys quantity should be equal"),t.forEach((function(t){n(e.hasOwnProperty(t),"key '"+t+"' should existing in studyInputs"),this._oldStudyInputs[t]!==e[t]&&(this._oldStudyInputs=e)}),this),this._oldStudyInputs===e}_pinePatchProps(){var e=this._prepareInputs({fakeInputsForDisplay:!1,symbolsForDisplay:!1,symbolsForChartApi:!0,skipHiddenInputs:!0,skipFakeInputs:!1,onlyAtomValues:!0,skipBooleanInputs:!1,skipColorInputs:!1,skipTimeInputs:!1,skipOptionalEmptySymbolInputs:!1,skippedGroups:[],skippedInputs:[],noExchanges:!1,noResolution:!1,keepOptionalSymbolsEmpty:!1});if(this._isModifiedStudyInputs(e)){var t=_.patchPropertiesAsync(this._properties,this._metaInfo,e),i=this._allSymbolsAreResolved();Promise.all([t,i]).then(function(){this._createViews(),this.recalculate(!0),this.updateAllViews()}.bind(this)).catch(function(e){O.logError("ERROR: "+this._debugId()+" _pinePatchProps failed, reason: "+e)}.bind(this))}}priceLabelText(e){var t,i=this._metaInfo.styles,s=this._metaInfo.ohlcPlots;i&&i[e]&&(t=i[e]),s&&s[e]&&(t=s[e]);var r=t.title;return 1!==this._simplePlotsCount||w.isPlotTitleDefined(r)?this._metaInfo.is_price_study&&r!==this._metaInfo.shortDescription?""===r?this._metaInfo.shortDescription:this._metaInfo.shortDescription+":"+r:r:this._metaInfo.shortDescription}createPriceAxisView(e){return new h(this,{plotIndex:e})}createPriceLineAxisView(e){return new x(this,e)}_concatPriceAxisViews(){this._priceAxisViews=[].concat(this._priceAxisViewsBase,this._graphicsPriceAxisViews)}recalculate(e){var t=this._model.paneForSource(this);this._model.recalculatePane(t,e),this._model.updateSource(this)}data(){return this.m_data}graphics(){return this._graphics}turnaround(e){var t=this.source();return!0===e?(t===this._series?t.seriesSource().turnaround():t.turnaround(!0))+"_"+this._turnaround:this._turnaround}_checkTurnaround(e){return e===this._turnaround||e===this._model.mainSeries().seriesSource().turnaround()||e===this.turnaround(!0)}_handleStudyError(e){this.clearData(),this._setStatus(e);var t=E(e),i=this._getTelemetryAdditionalData();if(void 0!==t){var s=t.indexOf("Command info");i.reason=s>=0?t.slice(0,s).trim():t}if(!/study in error state|the data vendor doesn\'t provide volume data for this symbol.|error in series|unsupported resolution/gi.test(i.reason.toLowerCase())){var r=this._getTelemetryObjectName();this._sendTelemetryCounter(r+"_error",i)}this._statusView.update(),this._model.updateSource(this)}_onStudyLoading(){this._setStatus({type:D.Loading,startTime:Date.now()}),this._statusView.update(),this._model.updateSource(this)}_onStudyError(e){var t="string"==typeof e?{error:e.split(":",2)[0]}:e;this._handleStudyError({type:D.Error,errorDescription:t}),
this._enablePriceRangeReady()}_onStudyCompleted(e){this._studyModified&&(this.clearData(),this._studyModified=!1),this._sendTelemetryCounter(this._getTelemetryObjectName()+"_loaded"),this._setStatus({type:D.Completed}),this._statusView.update();var t=this._model.paneForSource(this);this._model.recalculatePane(t),this._updateSources();var i=M.full();null!==this._model.appliedTimeFrame().value()&&i.lockVisibleTimeRangeOnResize(),this._model.invalidate(i)}onData(e){switch(e.method){case"study_loading":this._onStudyLoading();break;case"study_error":this._onStudyError(e.params[2]);break;case"study_completed":if(!this._checkTurnaround(e.params[1]))return;this._onStudyCompleted(e.params[e.params.length-1]);break;case"data_update":if(e.params.customId!==this.sourceId()||!this._checkTurnaround(e.params.turnaround))return;n(!!e.params.nonseries,"data.params.nonseries is missing"),this._onDataUpdate(e.params.plots,e.params.nonseries);break;case"clear_data":this._checkTurnaround(e.params.turnaround)&&this.clearData()}}_onDataUpdate(e,t){this._studyModified&&(this.clearData(),this._studyModified=!1);var i=a(t.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((function(){return i}),(function(){return i})).then(this._onDataUnpacked.bind(this,e,t.indexes)),this._ongoingDataUpdate}_onDataUnpacked(e,t,i){this._isDestroyed||("nochange"!==t&&this._processPlotOffsets(i),this.transformData(e),this._mergeData(e),null!==i&&(i.indexes_replace?(n("nochange"!==t),this._graphics.replaceIndexesTo(t)):("nochange"!==t&&this._graphics.replaceIndexesTo(t),void 0!==i.graphicsCmds&&this._graphics.processCommands(i.graphicsCmds,this._metaInfo.graphics))),this._onDataUpdated(e,i,t),this.priceRangeReady()||this._enablePriceRangeReady())}_onDataUpdated(e,t,i){if(this.hasBarColorer()&&e.length>0){var s=this.barColorer().firstColoredBar(e[0].index);this._model.mainSeries().invalidateBarStylesCache(s)}null!==t&&this._postProcessGraphics();var r=this._model.paneForSource(this);this._model.recalculatePane(r),this._updateSources()}transformData(e){}moveData(e){this._ongoingDataUpdate=this._ongoingDataUpdate.then(function(){this._invalidateLastNonEmptyPlotRowCache(),this.data().move(e)}.bind(this))}replaceData(e,t,i){this._invalidateLastNonEmptyPlotRowCache(),this.data().remove(e+1),this.data().addTail(i,t)}_updateSources(){this._model.updateSource(this),this.hasBarColorer()&&this._model.updateSource(this._model.mainSeries())}static processPlotOffsets(e,t){t&&t.indexes_replace||(e._plotOffsets=t&&t.offsets||{},e._updateMaxOffsetValue())}_processPlotOffsets(e){G.processPlotOffsets(this,e)}_mergeData(e){this._invalidateLastNonEmptyPlotRowCache(),this.data().merge(e)}_postProcessGraphics(){this._graphicsPriceAxisViews=d(this),this._concatPriceAxisViews()}static offset(e,t){var i=0;return e._plotOffsets&&void 0!==e._plotOffsets[t]&&(i+=e._plotOffsets[t]),e.properties().offsets&&void 0!==e.properties().offsets[t]&&(i+=e.properties().offsets[t].val.value()),e.properties().offset&&(i+=e.properties().offset.val.value()),i}offset(e){return G.offset(this,e)}
labelPaneViews(){return this.isSourceHidden()?null:this._labelPaneViews}_showLastValueOnPriceScale(){return this._model.properties().scalesProperties.showStudyLastValue.value()}hasBarColorer(){for(var e=0;e<this._metaInfo.plots.length;++e)if(w.isBarColorerPlot(this._metaInfo.plots[e]))return!0;return!1}barColorer(){const e=this._metaInfo.plots;let t=null;for(let i=0;i<e.length;++i)if(w.isBarColorerPlot(e[i])){const e=new l(this,i);null==t?t=e:t.pushBackBarColorer(e)}if(null==t)throw new Error("Cannot create BarColorer: study doesn't have a bar_colorer plot!");return t}base(){return 0}_priceScaleByProperties(){if("default"===this.properties().precision.value())return null;var e=parseInt(this.properties().precision.value());return isFinite(e)?Math.pow(10,e):null}_formatterByProperties(){var e=this._priceScaleByProperties();return null!==e?new y(e):null}_priceScaleByMetaInfo(){var e=this.metaInfo().format,t=isNumber(e.precision)?Math.pow(10,e.precision):void 0;if("price"===e.type||"percent"===e.type)return t||100;if("volume"===e.type){if(void 0===e.precision){var i=this.series().symbolInfo();if(null!==i&&isNumber(i.volume_precision))return Math.pow(10,i.volume_precision)}return 1}return"inherit"===e.type||O.logWarn("Unsupported format type: "+e.type),null}_formatterByMetaInfo(){var e=this.metaInfo().format,t=isNumber(e.precision)?Math.pow(10,e.precision):void 0;switch(e.type){case"price":return new y(t);case"volume":var i=e.precision;if(void 0===i){var s=this.series().symbolInfo();i=s&&isNumber(s.volume_precision)?s.volume_precision:0}return new f(i);case"percent":return new g(t);case"inherit":return null;default:return O.logWarn("Unsupported format type: "+e.type),null}}_onSourceFormatterChanged(){null===this._formatter&&(null!==this.priceScale()&&this.priceScale().updateFormatter(),this._formatterChanged.fire())}_onSourcePriceStepChanged(){null===this._priceStep&&this._priceStepChanged.fire()}_precisionChanged(){this._recreatePriceFormattingDependencies()}_recreatePriceFormattingDependencies(){this._recreateFormatter(),this._recreatePriceStep()}_recreateFormatter(){this._formatter=this._tryCreateFormatter(),this._formatterChanged.fire(),null!==this.priceScale()&&this.priceScale().updateFormatter(),this._model.fullUpdate()}_recreatePriceStep(){var e=null,t=this._tryToGetPriceScale();null!==t&&(e=1/t),this._priceStep!==e&&(this._priceStep=e,this._priceStepChanged.fire())}_tryToGetPriceScale(){var e=this._priceScaleByProperties();return null===e&&(e=this._priceScaleByMetaInfo()),e}_tryCreateFormatter(){var e=this._formatterByProperties();return null===e&&(e=this._formatterByMetaInfo()),e}priceStep(){return this._priceStep||this.parentSource().priceStep(!1)}setOwnerSource(e){super.setOwnerSource(e),this._recreatePriceFormattingDependencies()}nearestIndex(e,t,i){if(TradingView.isInteger(e)){var s=this.data().search(e,t,i);return null!==s?s.index:void 0}O.logDebug("nearestIndex: incorrect logicalPoint")}tags(){
return!this._metaInfo||!this._metaInfo.description||this._metaInfo.isTVScriptStub||this._metaInfo.is_hidden_study||this._metaInfo.isTVScript&&"tv-scripting"===this._metaInfo.productId?[]:[this._metaInfo.description]}onExtendedHoursChanged(){this.restart(!0)}hasSymbolInputs(){for(var e=this._metaInfo.inputs.length;e--;)if("symbol"===this._metaInfo.inputs[e].type)return!0;return!1}canOverrideMinTick(){return!1}_subscribeExtendedHours(){!this._isSubscribedToExtendedHours&&this.hasSymbolInputs()&&(this._series.onExtendedHoursChanged().subscribe(this,this.onExtendedHoursChanged),this._isSubscribedToExtendedHours=!0)}removeByRemoveAllStudies(){return!0}canHaveChildren(){return void 0===this._canHaveChildren&&(this._canHaveChildren=!!b.canHaveChildren(this._metaInfo)),this._canHaveChildren}static getInputRebindType(e,t,i){var s=b.isSourceInput(e);return s&&!~t.indexOf("$")&&~i.indexOf("$")?u.REBIND_STUDY_STANDALONE_TO_CHILD:s&&~t.indexOf("$")&&!~i.indexOf("$")?u.REBIND_STUDY_CHILD_TO_STANDALONE:0}getPlotFields(){return this._plotFields}getMinFirstBarIndexForPlot(e){var t=z(this._properties.styles,e)||z(this._properties.ohlcPlots,e)||z(this._properties.filledAreasStyle,e);if(null===t)return-1/0;var i=this.data().lastIndex();return null===i?-1/0:i-t+1}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){var e=this;return e._getPropertyDefinitionsViewModelClass().then((function(t){return null===t||e._isDestroyed?null:(null===e._definitionsViewModel&&(e._definitionsViewModel=new t(e._model.undoModel(),e)),e._definitionsViewModel)}))}return Promise.resolve(this._definitionsViewModel)}_getTelemetryObjectName(){return"study"}_getTelemetryAdditionalData(){var e="";return this._metaInfo.pine&&this._metaInfo.pine.version&&this._metaInfo.shortId.indexOf("USER")>=0&&(e="_v"+this._metaInfo.pine.version),{symbol:this.series().actualSymbol(),resolution:this.series().interval(),study:this._metaInfo.shortId+e}}_sendTelemetryReport(e,t,i){void 0===i&&(i=this._getTelemetryAdditionalData());var s=Object.assign(t,{additional:i});c.sendChartReport(e,s)}_sendTelemetryCounter(e,t){this._sendTelemetryReport(e,{count:1},t)}onAboutToBeDestroyed(){return this._aboutToBeDestroyed}destroy(){this._aboutToBeDestroyed.fire(),this._isDestroyed=!0,null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._properties.precision.listeners().unsubscribe(this,this._precisionChanged),this._showStudyArgumentsProperty.listeners().unsubscribe(this,this.invalidateTitleCache),this._properties.description.listeners().unsubscribe(this,this.invalidateTitleCache),this._properties.shortDescription&&this._properties.shortDescription.listeners().unsubscribe(this,this.invalidateTitleCache),this._model.mainSeries().dataEvents().symbolResolved().unsubscribeAll(this),this.hasBarColorer()&&this._properties.visible.listeners().unsubscribe(this._model.mainSeries(),this._model.mainSeries().invalidateBarStylesCache),
this._model.mainSeries().dataEvents().symbolResolved().unsubscribe(this,this._recreatePriceFormattingDependencies),void 0!==this._properties.offsets&&this._properties.offsets.listeners().unsubscribe(this,this._updateMaxOffsetValue),void 0!==this._properties.offset&&this._properties.offset.listeners().unsubscribe(this,this._updateMaxOffsetValue),super.destroy()}desiredPriceScalePosition(){return this.metaInfo().isTVScriptStub?"overlay":this.metaInfo().linkedToSeries?"as-series":void 0===this.metaInfo().priceScale?null:["right","left","overlay"][this.metaInfo().priceScale]}guiPlotName(e){var t=this.properties().styles;return t&&t[e]&&t[e].title?t[e].title.value():this.title()}formatterChanged(){return this._formatterChanged}copiable(){return N&&!this.isChildStudy()}setPriceScale(e){super.setPriceScale(e),v.emit("study_event",this.id(),"price_scale_changed")}getStudyName(){return this._studyName}}TradingView.Study=G,t.Study=G,t.prepareStudyProperties=function(e,t,r,a,o){return function(e,t,r,a,o,l){var h=function(e,t,r,a){var o=i(10498);if(b.versionOf(e)<1)throw new Error("This function cannot work with metainfo of the old format version. Required format version >= 1");var l=TradingView.clone(defaults("study"));U(l,e);var h=b.getStudyPropertyRootName(e),d=TradingView.clone(defaults(h,a));d.intervalsVisibilities=TradingView.clone(k),("Overlay"===e.shortId||"Compare"===e.shortId)&&(d.currencyId=null,d.unitId=null);e.isTVScript&&e.TVScriptSourceCode!==d.TVScriptSourceCode&&(d=TradingView.clone(TradingView.factoryDefaults(h,a)));TradingView.merge(l,d),t&&(n(!(t instanceof s),"propsState should not be an instance of Property"),TradingView.merge(l,t));var u=TradingView.clone(e),c={};o.mergeInputsObjPart(c,u.defaults.inputs),o.mergeInputsObjPart(c,l.inputs),l.inputs=c,delete u.inputs,delete u.defaults.inputs;var _={};if(TradingView.merge(_,u.defaults),TradingView.merge(_,TradingView.factoryDefaults(h)),TradingView.merge(_,l),TradingView.merge(_,u),delete _.defaults,l=_,null!==r){var p=r.model().studiesColorRotatorFactory().getColorRotator(e);null!==p&&("Overlay@tv-basicstudies"===e.id?l.lineStyle.color=p.getColor(l.lineStyle.color,e):TradingView.merge(l,function(e,t){for(var i in e.styles){var s=e.styles[i].color;s&&(e.styles[i].color=t.getColor(s))}return e}(l,p)))}t&&TradingView.merge(l.styles,t.styles);return l}(e,t,r,a),d=b.getSourceInputIds(e);if(d.length>0){var u=d[0];l instanceof G?h.inputs[u]="{pid}$0":void 0!==h.inputs[u]&&-1!==h.inputs[u].indexOf("$")&&(h.inputs[u]="close")}return H(e,o,h)}(e,t,r,a,b.getStudyPropertyRootName(e),o)},t.prepareStudyPropertiesForLoadChart=function(e,t,s,r,n,a){return function(e,t,s,r,n,a,o){var l=function(e,t,s,r,n,a){var o=i(10498);e.version&&s.version&&e.version!==s.version&&O.logWarn("Serialized metaInfo version "+e.version+" is not equal to the saved state version "+s.version);var l=TradingView.clone(defaults("study"));l.intervalsVisibilities=TradingView.clone(k),TradingView.merge(l,TradingView.factoryDefaults(b.getStudyPropertyRootName(e))),U(l,e),TradingView.merge(l,s),
l=n.updateStudyState(l,e,t),void 0!==a&&(l=a(s,l,e,t));var h=TradingView.clone(t||e);if(h&&b.versionOf(h)>=1){var d={};o.mergeInputsObjPart(d,(h.defaults||{}).inputs),o.mergeInputsObjPart(d,l.inputs),l.inputs=d,delete h.inputs,h.defaults&&delete h.defaults.inputs;var u={};TradingView.merge(u,h.defaults),TradingView.merge(u,TradingView.factoryDefaults(b.getStudyPropertyRootName(h))),TradingView.merge(u,l),delete h.defaults,TradingView.merge(u,h),l=u}return l}(e,t,s,0,n,o);return H(t||e,a,l)}(e,t,s,0,n,b.getStudyPropertyRootName(e),a)}},96989:(e,t,i)=>{i.d(t,{plotShapesData:()=>r});var s=i(87236);const r={shape_arrow_down:{guiName:(0,s.t)("Arrow Down"),id:"shape_arrow_down",paneRendererClass:"PaneRendererArrowDown",pineName:"shape.arrowdown",icon:"arrow_down"},shape_arrow_up:{guiName:(0,s.t)("Arrow Up"),id:"shape_arrow_up",paneRendererClass:"PaneRendererArrowUp",pineName:"shape.arrowup",icon:"arrow_up"},shape_circle:{guiName:(0,s.t)("Circle"),id:"shape_circle",paneRendererClass:"PaneRendererCircleShape",pineName:"shape.circle",icon:"circle"},shape_cross:{guiName:(0,s.t)("Cross"),id:"shape_cross",paneRendererClass:"PaneRendererCrossShape",pineName:"shape.cross",icon:"cross"},shape_diamond:{guiName:(0,s.t)("Diamond"),id:"shape_diamond",paneRendererClass:"PaneRendererDiamond",pineName:"shape.diamond",icon:"diamond"},shape_flag:{guiName:(0,s.t)("Flag"),id:"shape_flag",paneRendererClass:"PaneRendererFlagShape",pineName:"shape.flag",icon:"flag"},shape_label_down:{guiName:(0,s.t)("Label Down"),id:"shape_label_down",paneRendererClass:"PaneRendererLabelDown",pineName:"shape.labeldown",icon:"label_down"},shape_label_up:{guiName:(0,s.t)("Label Up"),id:"shape_label_up",paneRendererClass:"PaneRendererLabelUp",pineName:"shape.labelup",icon:"label_up"},shape_square:{guiName:(0,s.t)("Square"),id:"shape_square",paneRendererClass:"PaneRendererSquare",pineName:"shape.square",icon:"square"},shape_triangle_down:{guiName:(0,s.t)("Triangle Down"),id:"shape_triangle_down",paneRendererClass:"PaneRendererTriangleApexDown",pineName:"shape.triangledown",icon:"triangle_down"},shape_triangle_up:{guiName:(0,s.t)("Triangle Up"),id:"shape_triangle_up",paneRendererClass:"PaneRendererTriangleApexUp",pineName:"shape.triangleup",icon:"triangle_up"},shape_xcross:{guiName:(0,s.t)("X Cross"),id:"shape_xcross",paneRendererClass:"PaneRendererXCross",pineName:"shape.xcross",icon:"x_cross"}}},47527:(e,t,i)=>{i.d(t,{translateSessionDescription:()=>n,translateSessionShortDescription:()=>o,translateSessionExtendedDescription:()=>l});var s=i(87236);const r=new Map([["Premarket",(0,s.t)("Premarket",{context:"sessions"})],["Postmarket",(0,s.t)("Postmarket",{context:"sessions"})],["Regular Trading Hours",(0,s.t)("Regular trading hours",{context:"sessions"})],["Extended Trading Hours",(0,s.t)("Extended trading hours",{context:"sessions"})],["Electronic Trading Hours",(0,s.t)("Electronic trading hours",{context:"sessions"})]]);function n(e){var t;return null!==(t=r.get(e))&&void 0!==t?t:e}const a=new Map([["Premarket",(0,s.t)("PRE",{context:"sessions"
})],["Postmarket",(0,s.t)("POST",{context:"sessions"})],["Regular Trading Hours",(0,s.t)("RTH",{context:"sessions"})],["Extended Trading Hours",(0,s.t)("ETH",{context:"sessions"})],["Electronic Trading Hours",(0,s.t)("ETH",{context:"sessions"})]]);function o(e){var t;return null!==(t=a.get(e))&&void 0!==t?t:e}function l(e){var t;return null!==(t=r.get(e))&&void 0!==t?t:e}},5222:(e,t,i)=>{i.d(t,{TextWidthCache:()=>s});class s{constructor(e=150){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._tick2Labels=new Map,this._cache=new Map,this._maxSize=e}reset(){this._actualSize=0,this._cache.clear(),this._usageTick=1,this._oldestTick=1,this._tick2Labels.clear()}measureText(e,t){return this.getMetrics(e,t).width}yMidCorrection(e,t){const i=this.getMetrics(e,t);return((i.actualBoundingBoxAscent||0)-(i.actualBoundingBoxDescent||0))/2}getMetrics(e,t){const i=this._cache.get(t);if(void 0!==i)return i.metrics;if(this._actualSize===this._maxSize){const e=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(e),this._oldestTick++,this._actualSize--}e.save(),e.textBaseline="middle";const s=e.measureText(t);return e.restore(),0===s.width&&t.length||(this._cache.set(t,{metrics:s,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,t),this._actualSize++,this._usageTick++),s}}},11239:(e,t,i)=>{i.d(t,{createVisibilityController:()=>l});var s=i(87236),r=i(78785),n=i(60949),a=i(62802);function o(e){return"alwaysOn"===e||"alwaysOff"===e?e:"visibleOnMouseOver"}function l(e,t){let i,l;function h(){if(!i){i=(0,n.createPrimitiveProperty)();let s=a.getValue(e);void 0===s&&void 0!==t&&(s=a.getValue(t)),i.setValue(o(s)),i.subscribe(i,t=>{a.setValue(e,o(t.value()))})}return i}return{property:h,availableValues:function(){return[{id:"visibleOnMouseOver",value:"visibleOnMouseOver",title:(0,s.t)("Visible on mouse over")},{id:"alwaysOn",value:"alwaysOn",title:(0,s.t)("Always visible")},{id:"alwaysOff",value:"alwaysOff",title:(0,s.t)("Always invisible")}]},actualBehavior:function(){if(!l){l=(0,n.createPrimitiveProperty)();const e=h(),t=()=>{let t=e.value();"alwaysOn"!==t&&"alwaysOff"!==t&&(t=r.mobiletouch?"alwaysOn":"visibleOnMouseOver"),l&&l.setValue(t)};e.subscribe(l,t),t()}return l}}}},96159:(e,t,i)=>{i.d(t,{getSeriesDangerReason:()=>r});var s=i(70369);function r(e){if(e.isSpread())return s.DataSourceDangerReason.Spread;const t=e.symbolInfo();return t&&"CRYPTOCAP"===t.exchange?s.DataSourceDangerReason.CryptoCap:null}},75420:(e,t,i)=>{i.d(t,{initGA:()=>h,trackTiming:()=>d});var s=i(51954),r=i(61030),n=i(88948),a=i(38456),o=i(91805);let l=!1;function h(){if(l)return;(0,n.updateInitData)();const e=(0,n.getInitData)();if(!e.gaId)return;l=!0,(0,o.appendScript)("https://www.googletagmanager.com/gtag/js?id="+(0,n.getInitData)().gaId),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date);const t={optimize_id:e.optimizeId,anonymize_ip:!0};window.TVD&&(t.app_name="TVD",t.app_version=(0,a.desktopAppVersion)()),
e.gaVars&&window.gtag("set",e.gaVars),window.gtag("consent","default",{analytics_storage:(0,r.getCookieSetting)(r.CookieSettings.Analytics)?"granted":"denied"}),window.gtag("config",e.gaId,t),s.subscribe(r.cookieSettingsChangeEvent,(e,t)=>{e===r.CookieSettings.Analytics&&window.gtag("consent","update",{analytics_storage:t?"granted":"denied"})},null)}function d(e,t,i,s){h(),window.gtag("event","timing_complete",{name:t,value:i,event_category:e,event_label:s})}}}]);