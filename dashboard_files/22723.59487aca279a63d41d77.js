"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[22723],{74200:(e,t,s)=>{s.d(t,{SessionInfo:()=>a,BarBuilderBase:()=>o});var r=s(93987),i=s(70062),n=s(97753);class a{constructor(e,t,s,r){this.init(e,t,s,r),this._state={timezone:e,spec:t,holidays:s,corrections:r}}init(e,t,s,i){this.timezone=r.get_timezone(e),this.spec=new n.SessionSpec(e,t,s,i)}state(){return this._state}static fromState(e){return new a(e.timezone,e.spec,e.holidays,e.corrections)}}class o{alignTime(e){if(isNaN(e))return NaN;let t=this.indexOfBar(e);return t===i.SessionStage.POST_SESSION&&(this.moveTo(e),t=this.indexOfBar(e)),t<0?NaN:this.startOfBar(t)}}},12666:(e,t,s)=>{s.d(t,{BusinessDay:()=>i});var r=s(93987);class i{constructor(e,t,s){this.year=e,this.month=t,this.day=s}toString(){return`${this.year}-${this.month}-${this.day}`}compareTo(e){return this.year>e.year||this.year===e.year&&this.month>e.month||this.year===e.year&&this.month===e.month&&this.day>e.day?1:this.year===e.year&&this.month===e.month&&this.day===e.day?0:-1}before(e){return-1===this.compareTo(e)}toCalendar(e){return r.get_cal(r.get_timezone("Etc/UTC"),this.year,this.month-1,this.day)}addDays(e){const t=this.toCalendar(r.get_timezone("Etc/UTC"));return r.add_date(t,e),i.fromCalendar(t)}static fromCalendar(e){return new i(r.get_year(e),r.get_month(e)+1,r.get_day_of_month(e))}}},70062:(e,t,s)=>{var r;s.d(t,{SessionStage:()=>r}),function(e){e[e.PRE_SESSION=-1]="PRE_SESSION",e[e.POST_SESSION=-2]="POST_SESSION",e[e.LASTBAR_SESSION=-3]="LASTBAR_SESSION"}(r||(r={}))},97753:(e,t,s)=>{s.d(t,{SessionSpec:()=>g});var r=s(93987),i=s(77884),n=s(12666);function a(e,t){return e.compareTo(t)}class o{constructor(e,t,s){this._dayOfWeek=e,this._start=t,this._length=s}start(){return this._start+r.minutesPerDay*this.sessionStartDaysOffset()}startOffset(){return this._start}sessionStartDaysOffset(){return this._start>=0?0:this._start%r.minutesPerDay==0?-Math.ceil(this._start/r.minutesPerDay):-Math.floor(this._start/r.minutesPerDay)}sessionEndDaysOffset(){const e=this._start+this._length;return e>=0?0:e%r.minutesPerDay==0?-Math.ceil(e/r.minutesPerDay):-Math.floor(e/r.minutesPerDay)}isOvernight(){return this._start<0}dayOfWeek(){return this._dayOfWeek}sessionStartDayOfWeek(){let e=this._dayOfWeek-this.sessionStartDaysOffset();return e<r.SUNDAY&&(e+=7),e}sessionEndDayOfWeek(){let e=this.sessionStartDayOfWeek()+this.sessionEndDaysOffset();return e>r.SATURDAY&&(e=1),e}length(){return this._length}weight(){return this._dayOfWeek*r.minutesPerDay+this._start}compareTo(e){const t=this.weight(),s=t+this._length,r=e.weight(),i=r+e._length;return t<=r&&r<s||r<=t&&t<i?0:t>r?1:-1}contains(e){const t=60*r.get_hours(e)+r.get_minutes(e);let s=r.get_day_of_week(e)-this._dayOfWeek;s>0&&(s-=7);const i=s*r.minutesPerDay+t;return i>=this._start&&i<this._start+this._length}}class h{constructor(e,t,s){this.weekIndex=e,this.entryIndex=t,this.entries=s}getEntry(){return this.entries[this.entryIndex]}}var d=s(11905)
;const l=[r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY],u=[r.SUNDAY,r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY,r.SATURDAY],_=(0,d.getLogger)("Chart.Model.SessionSpec");function c(e){return e>=48&&e<=57}class m{constructor(){this.entries=[],this.firstDayOfWeek=r.MONDAY,this.weekEndsCount=-1,this.maxTradingDayLength=0}parseSessions(e,t){var s;let r=!1;this._clear(),this.timezone=e;const{hasErrors:i,spec:n}=this._parseFirstDayOfWeek(t);if("24x7"===n.toLowerCase())for(const e of u)this.entries.push(m._createSessionEntry(e,0,0,0,0));else{let e=!1;const t=new Map;for(const s of n.split("|")){const i=s.split(":");if(1!==i.length&&2!==i.length){r=!0,_.logError("Bad session section: "+s);continue}const n=1===i.length;if(n){if(e){r=!0,_.logError("Duplicated default section: "+s);continue}e=!0}const a=n?l:m._parseWorkingDays(i[1]);for(const e of a)n&&t.has(e)||t.set(e,i[0])}for(const e of u){const s=t.get(e);if(void 0!==s)for(const t of s.split(",")){const{hasErrors:s,sessionEntry:i}=m._parseSessionEntry(e,t);s&&(r=s),this.entries.push(i)}}}this.entries.sort(a);const o=new Map;for(const e of this.entries){const t=e.dayOfWeek();o.set(t,e.length()+(null!==(s=o.get(t))&&void 0!==s?s:0))}return this.maxTradingDayLength=0,o.forEach(e=>{this.maxTradingDayLength=Math.max(this.maxTradingDayLength,e)}),this.weekEndsCount=7-o.size,r||i}static parseHolidaysAndCorrections(e,t,s){const i=new Map,n=new Map,a=e=>{const t=this._parseDay(e),s=t.toString(),r=n.get(s);return void 0!==r?r:(n.set(s,t),t)};if(""!==t){const e=[];for(const s of t.split(",")){if(8!==s.length)throw new Error("bad holiday date: "+s);const t=a(s);i.set(t,e)}}if(""===s)return i;const h=r.get_timezone("Etc/UTC");for(const e of s.split(";")){const t=e.split(":");if(2!==t.length)throw new Error("bad correction section: "+e);const s=[];if("dayoff"!==t[0])for(const e of t[0].split(","))s.push(this._parseSessionEntry(1,e).sessionEntry);for(const e of t[1].split(",")){if(8!==e.length)throw new Error("bad correction date: "+e);const t=a(e),n=r.get_day_of_week(r.get_cal(h,t.year,t.month-1,t.day)),d=[];for(const e of s)d.push(new o(n,e.startOffset(),e.length()));i.set(t,d)}}return i}_clear(){this.entries=[],this.timezone="",this.firstDayOfWeek=r.MONDAY,this.weekEndsCount=-1}_parseFirstDayOfWeek(e){const t=e.split(";");if(t.length>2)return _.logError("Only one `first day` specification expected @ session "+e),{hasErrors:!0,spec:e};if(1===t.length)return{hasErrors:!1,spec:e};let s=1;let i=t[0].indexOf("-")>=0?NaN:parseInt(t[0]);return isNaN(i)&&(s=0,i=parseInt(t[1])),i<r.SUNDAY||i>r.SATURDAY?(_.logError(`Unexpected day index @ session: ${e}; day index ${i}`),{hasErrors:!0,spec:e}):(this.firstDayOfWeek=i,{hasErrors:!1,spec:t[s]})}static _parseDay(e){const t=parseInt(e.substring(0,4)),s=parseInt(e.substring(4,6)),r=parseInt(e.substring(6,8));return new n.BusinessDay(t,s,r)}static _parseSessionEntry(e,t){let s=!1,r=t.split("-");2!==r.length&&(s=!0,_.logError("Bad sessions entry: "+t),r=["0000","0000"]);let i=0,n=r[0];if(n.includes("F")){const e=n.split("F");n=e[0],
i=""!==e[1]?parseInt(e[1]):1}let a=0,o=r[1];if(o.includes("F")){const e=o.split("F");o=e[0],a=""!==e[1]?parseInt(e[1]):1}if(!this._isCorrectSession(n)||!this._isCorrectSession(o))throw new Error("Incorrect entry syntax: "+t);const h=n,d=o;return{hasErrors:s,sessionEntry:this._createSessionEntry(e,m._minutesFromHHMM(h),m._minutesFromHHMM(d),i,a)}}static _isCorrectSession(e){return 4===e.length&&c(e.charCodeAt(0))&&c(e.charCodeAt(1))&&c(e.charCodeAt(2))&&c(e.charCodeAt(3))}static _parseWorkingDays(e){const t=[];for(let s=0;s<e.length;s++){const r=+e[s];-1===t.indexOf(r)&&t.push(r)}return t}static _minutesFromHHMM(e){return r.get_minutes_from_hhmm(e)}static _createSessionEntry(e,t,s,i,n){0===s&&(s=r.minutesPerDay),i===n&&s<=t&&(i+=1),i>0&&(t-=i*r.minutesPerDay),n>0&&(s-=n*r.minutesPerDay);return new o(e,t,s-t)}}function y(e,t){return e.compareTo(t)<0}function f(e,t){const s=(0,i.lowerbound)(e,t,(e,t)=>-1===e.day.compareTo(t));return s===e.length?null:e[s]}class g{constructor(e="Etc/UTC",t="0000-0000",s="",i=""){this._entries=[],this._firstDayOfWeek=r.MONDAY,this._entriesHash=new Map,this._holidayAndCorrectionMap=new Map,this._holidaySessions=[];const n=new m;n.parseSessions(e,t),this._entries=n.entries,this._timezone=n.timezone,this._spec=t,this._firstDayOfWeek=n.firstDayOfWeek,this._weekEndsCount=n.weekEndsCount,this._maxTradingDayLength=n.maxTradingDayLength;const a=m.parseHolidaysAndCorrections(e,s,i),o=r.get_timezone(e);this._isThereCorrections=""!==s||""!==i,a.forEach((e,t)=>{this._holidayAndCorrectionMap.set(t.toString(),e),this._holidaySessions.push({day:t,sessions:e});const s=this.getWeekIndex(t.toCalendar(o));this._entriesHash.set(s,null)}),this._holidaySessions.sort((e,t)=>e.day.compareTo(t.day))}entries(){return this._entries}timezone(){return this._timezone}spec(){return this._spec}firstDayOfWeek(){return this._firstDayOfWeek}addSessionEntry(e,t,s,i,n){0===s&&(s=r.minutesPerDay),i===n&&s<=t&&(i+=1),i>0&&(t-=i*r.minutesPerDay),n>0&&(s-=n*r.minutesPerDay);const a=s-t;this._entries.push(new o(e,t,a))}longestSessionLength(){let e=0,t=0;for(const t of this._holidaySessions)t.sessions.forEach(t=>{e=Math.max(e,t.length())});return this._entries.forEach(e=>{t=Math.max(t,e.length())}),Math.max(e,t)}isWeekEnd(e){const t=(0,i.lowerbound)(this._entries,new o(e,0,0),(e,t)=>e.dayOfWeek()<t.dayOfWeek());return t>this._entries.length-1||this._entries[t].dayOfWeek()!==e}isCalWeekEnd(e){const t=r.get_day_of_week(e);if(!this._isThereCorrections)return this.isWeekEnd(t);const s=n.BusinessDay.fromCalendar(e),i=this._holidayAndCorrectionMap.get(s.toString());return void 0===i?this.isWeekEnd(t):0===i.length}hasWeekEnds(){return this.weekEndsCount()>0}weekEndsCount(){return this._weekEndsCount}maxTradingDayLength(){return this._maxTradingDayLength}holidaysFromYearStart(e){if(!this._isThereCorrections)return 0;const t=r.get_timezone(this._timezone),s=new n.BusinessDay(r.get_year(e),r.JANUARY,1),i=n.BusinessDay.fromCalendar(e);let a=0;const o=this._selectHolidays(s,i);for(let e=0;e<o.length;e++){const s=o[e].day.toCalendar(t)
;this.isWeekEnd(r.get_day_of_week(s))?a+=0===o[e].sessions.length?0:-1:a+=0===o[e].sessions.length?1:0}return a}intradayCanBeBuiltFrom24x7(e){return this._entries.every(t=>t.start()%e==0&&t.length()%e==0)}indexOfSession(e,t,s){const n=this._getEntriesForWeek(e);let a=(0,i.lowerbound)(n,new o(t,s,0),y);if(a!==n.length)return new h(e,a,n);let d=e;const l=7-t+this._firstDayOfWeek-1;for(s=-(r.minutesPerDay-s+l*r.minutesPerDay);;){d++;const e=this._getEntriesForWeek(d);if(0!==e.length)return a=(0,i.lowerbound)(e,new o(this._firstDayOfWeek,s,0),y),new h(d,a,e)}}findSession(e,t,s,r=0){const i=this.indexOfSession(e,t,s),n=i.entries;let a=i.entryIndex;if(0!==r){const e=n[a].dayOfWeek(),t=r>0?1:-1;for(;;){const s=a+t;if(s<0||s>=n.length||n[s].dayOfWeek()!==e)break;a=s}}return new h(i.weekIndex,a,n)}getWeekIndex(e){if(!this._isThereCorrections)return 0;const t=r.get_day_of_week(e)-r.SUNDAY,s=r.get_timezone("Etc/UTC"),i=r.get_cal(s,r.get_year(e),r.get_month(e),r.get_day_of_month(e)-t);return Math.floor((i.getTime()+621672192e5)/1e3/86400/7)}correctTradingDay(e){const t=r.get_day_of_week(e),s=60*r.get_hours(e)+r.get_minutes(e),i=this.getWeekIndex(e),n=this.findSession(i,t,s,0),a=n.getEntry().dayOfWeek()-t+7*(n.weekIndex-i);return 0!==a&&r.add_date(e,a),e}alignToSessionStart(e,t=0){const s=r.get_day_of_week(e),i=60*r.get_hours(e)+r.get_minutes(e),n=this.getWeekIndex(e),a=this.findSession(n,s,i,t),o=a.getEntry(),h=o.dayOfWeek()-s+7*(a.weekIndex-n);0!==h&&r.add_date(e,h);const d=o.startOffset();return r.set_hms(e,d/60,d%60,0,0,r.get_timezone(this._timezone)),o.length()}businessDaysToCalendarDays(e,t){let s=this.getWeekIndex(e),i=r.get_day_of_week(e),n=0,a=0;for(;a<t;){const e=this._getEntriesForWeek(s);let o=0;for(let s=i;s<=r.SATURDAY;s++){n++;let r=!0;for(;o<e.length&&!(e[o].dayOfWeek()>s);)e[o].dayOfWeek()<s||r&&(r=!1,a++),o++;if(a>=t)return n}s++,i=r.SUNDAY}return n}calendarDaysToBusinessDays(e,t){let s=this.getWeekIndex(e),i=r.get_day_of_week(e),n=0,a=0;for(;n<t;){const e=this._getEntriesForWeek(s);let o=0;for(let s=i;s<=r.SATURDAY;s++){n++;let r=!0;for(;o<e.length&&!(e[o].dayOfWeek()>s);)e[o].dayOfWeek()<s||r&&(r=!1,a++),o++;if(n>=t)return a}s++,i=r.SUNDAY}return a}alignToNearestSessionStart(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionStart.bind(this))}alignToNearestSessionEnd(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionEnd.bind(this))}leftBorderOfDailyBar(e){const t=this._getEntriesForDay(e);return 0===t.length?null:(t.sort(a),this._getLeftEntryBorder(e,t[0]))}bordersOfDailyBar(e){const t=this._getEntriesForDay(e);if(0===t.length)return null;t.sort(a);const s=this._getLeftEntryBorder(e,t[0]),i=t[t.length-1],n=r.clone(e);let o=60*(i.startOffset()+i.length())-1;const h=Math.floor(o/3600);return o-=3600*h,r.set_hms(n,h,o/60,o%60,0,r.get_timezone(this._timezone)),{from:s,to:n}}getEntriesForWeekByCalendar(e){const t=this.getWeekIndex(e);return this._getEntriesForWeek(t)}_getEntriesForWeek(e){let t=this._entriesHash.get(e);if(void 0===t)return this._entries;if(null!==t)return t
;const s=r.get_timezone(this._timezone);t=this._entries.slice();const i=this._weekIndexToCalendar(e),o=this._weekIndexToCalendar(e+1),h=n.BusinessDay.fromCalendar(i),d=n.BusinessDay.fromCalendar(o),l=this._selectHolidays(h,d);for(const e of l){const i=e.day.toCalendar(s),n=r.get_day_of_week(i);t=t.filter(e=>e.dayOfWeek()!==n),t=t.concat(e.sessions)}return t.sort(a),this._entriesHash.set(e,t),t}_selectHolidays(e,t){const s=[];let r=e;for(;;){const e=f(this._holidaySessions,r);if(null===e)return s;if(!e.day.before(t))return s;s.push(e),r=e.day.addDays(1)}}_weekIndexToCalendar(e){const t=1e3*(86400*e*7+86400)-621672192e5,s=r.get_cal_from_unix_timestamp_ms(r.get_timezone("Etc/UTC"),t),i=r.get_timezone("Etc/UTC");return r.get_cal(i,r.get_year(s),r.get_month(s),r.get_day_of_month(s))}_alignToNearestSessionValue(e,t,s){const i=r.get_day_of_week(e),n=60*r.get_hours(e)+r.get_minutes(e),a=this.getWeekIndex(e);let o=this.findSession(a,i,n);if(o.getEntry().contains(e)&&a===o.weekIndex||1===t)return s(o,r.clone(e),t);let d=o.entryIndex-1;if(d<0){let e=o.weekIndex,t=o.entries;for(;d<0;)e--,t=this._getEntriesForWeek(e),d+=t.length;o=new h(e,d,t)}else o=new h(o.weekIndex,d,o.entries);return s(o,r.clone(e),t)}_entrySessionStart(e,t,s){return this._entrySessionValue(e,t,s,e=>60*e.start())}_entrySessionEnd(e,t,s){return this._entrySessionValue(e,t,s,e=>60*(e.start()+e.length())-1)}_entrySessionValue(e,t,s,i){let n=r.get_day_of_week(t);const a=e.getEntry();let o=a.dayOfWeek()-a.sessionStartDaysOffset();const h=this.getWeekIndex(t);let d=e.weekIndex-h,l=!1;if(o<r.SUNDAY&&(d<=0?l=!0:d--,o+=7),(d>0&&s>=0||d<0&&s<0)&&r.add_date(t,7*d),!a.contains(t)){let e=o-n;l&&s<0&&(e=-(7-o+n)),r.add_date(t,e),n=r.get_day_of_week(t)}a.isOvernight()&&n===a.dayOfWeek()&&r.add_date(t,-a.sessionStartDaysOffset());let u=i(a);const _=Math.floor(u/3600);return u-=3600*_,r.set_hms(t,_,u/60,u%60,0,r.get_timezone(this._timezone)),t}_getEntriesForDay(e){const t=r.get_day_of_week(e);return this._getEntriesForWeek(this.getWeekIndex(e)).filter(e=>e.dayOfWeek()===t)}_getLeftEntryBorder(e,t){const s=r.clone(e),i=t.startOffset();return r.set_hms(s,i/60,i%60,0,0,r.get_timezone(this._timezone)),s}}},15693:(e,t,s)=>{function r(e){return Boolean(e.inputs)||function(e){return Boolean(e.replay)}(e)||e.session||e.adjustment||e["currency-id"]||e["unit-id"]?function(e){return"="+JSON.stringify(e)}(e):e.symbol}function i(e){return"="===e[0]}function n(e){if(!i(e))return{symbol:e};try{return JSON.parse(e.slice(1))}catch(t){return{symbol:e}}}function a(e){return"string"==typeof e?e:a(e.symbol)}s.d(t,{encodeExtendedSymbolOrGetSimpleSymbolString:()=>r,isEncodedExtendedSymbol:()=>i,decodeExtendedSymbol:()=>n,unwrapSimpleSymbol:()=>a})},8803:(e,t,s)=>{var r;s.d(t,{SymbolErrorPermissionDeniedReason:()=>r,permissionDenied:()=>i,invalidSymbol:()=>n}),function(e){e.Symbol="symbol",e.GroupPermission="group"}(r||(r={}));const i="permission denied",n="invalid symbol"},95078:(e,t,s)=>{s.d(t,{ensureTimePointIndexIndex:()=>a,unpackNonSeriesData:()=>o});var r=s(6617),i=s(88537);function n(e){
if(!(0,r.isObject)(e))throw new Error("Graphics commands should be wrapped in an object");if((0,r.hasProperty)(e,"create"),(0,r.hasProperty)(e,"erase")){const t=e.erase;(0,i.assert)(Array.isArray(t),"Collection of erase commands should be array");for(const e of t){if(!(0,r.isObject)(e)||!(0,r.hasProperty)(e,"action"))throw new Error("Command should be an object with 'action' property");(0,i.assert)("all"===e.action||"one"===e.action,"Erase command action should be 'all' or 'one'")}}return e}function a(e){if(e<0)throw new Error("TimePointIndexIndex should be non-negative integer");return e}async function o(e){if(""===e)return null;const t=JSON.parse(e);if(!(0,r.isObject)(t)||"function"==typeof t)throw new Error("Non-object content in the non-series envelope");if((0,r.hasProperty)(t,"indexes_replace"))return{indexes_replace:!0};const i={indexes_replace:!1};if((0,r.hasProperty)(t,"offsets")&&(i.offsets=t.offsets),(0,r.hasProperty)(t,"isUpdate")){if("boolean"!=typeof t.isUpdate)throw new Error('Invalid type of "isUpdate" field');i.isUpdate=t.isUpdate}if((0,r.hasProperty)(t,"data")&&(i.data=t.data),(0,r.hasProperty)(t,"graphicsCmds")&&(i.graphicsCmds=n(t.graphicsCmds)),(0,r.hasProperty)(t,"dataCompressed")||(0,r.hasProperty)(t,"graphicsCmdsCompressed")){const{default:e}=await Promise.all([s.e(93194),s.e(81578)]).then(s.t.bind(s,93194,23));if((0,r.hasProperty)(t,"dataCompressed")){const s=await(new e).loadAsync(t.dataCompressed,{base64:!0});i.data=JSON.parse(await s.file("").async("text"))}if((0,r.hasProperty)(t,"graphicsCmdsCompressed")){const s=await(new e).loadAsync(t.graphicsCmdsCompressed,{base64:!0});i.graphicsCmds=n(JSON.parse(await s.file("").async("text")))}return i}return i}},56074:(e,t,s)=>{s.d(t,{QuotesProvider:()=>o});var r=s(24418),i=s(97639),n=s.n(i),a=s(95935);class o{constructor(e="full"){this._quotes=null,this._quoteSessionSymbol=null,this._quoteSessionClientId="",this._quotesUpdate=new(n()),this._quoteSymbolChanged=new(n()),this._multiplexerType=e}setQuotesSessionSymbol(e){this._quoteSessionSymbol!==e&&(this._quoteSessionClientId||(this._quoteSessionClientId="series-"+(0,a.guid)()),this._unsubscribeQuoteSession(),e&&this._subscribeQuoteSession(e),this._quoteSymbolChanged.fire())}quotesUpdate(){return this._quotesUpdate}quoteSymbolChanged(){return this._quoteSymbolChanged}quotes(){return this._quotes}destroy(){this._unsubscribeQuoteSession()}_onUpdate(e,t){this._quotes=e&&e.values||null,t&&t.values&&this._quotesUpdate.fire(e,t)}_subscribeQuoteSession(e){this._quoteSessionSymbol=e,(0,r.getQuoteSessionInstance)(this._multiplexerType).subscribe(this._quoteSessionClientId,this._quoteSessionSymbol,this._onUpdate.bind(this))}_unsubscribeQuoteSession(){this._quoteSessionSymbol&&((0,r.getQuoteSessionInstance)(this._multiplexerType).unsubscribe(this._quoteSessionClientId,this._quoteSessionSymbol),this._quoteSessionSymbol=null,this._quotes=null)}}},3653:(e,t,s)=>{s.d(t,{seriesPlotFunctionMap:()=>h,barFunction:()=>d,SeriesData:()=>u});var r,i=s(88537),n=s(52280);!function(e){e[e.FromLeft=-1]="FromLeft",
e[e.FromRight=1]="FromRight"}(r||(r={}));const a={open:e=>e[1],high:e=>e[2],low:e=>e[3],close:e=>e[4],hl2:e=>(e[2]+e[3])/2,hlc3:e=>(e[2]+e[3]+e[4])/3,ohlc4:e=>(e[1]+e[2]+e[3]+e[4])/4},o=["open","high","low","close","hl2","hlc3","ohlc4"];function h(){const e=new Map;return o.forEach((t,s)=>{e.set(t,d(t))}),e}function d(e){return a[e]}function l(e,t){return null==e[t]}class u{constructor(){this.m_bars=new n.PlotList(h(),l),this.m_nsBars=new n.PlotList(h(),l)}bars(){return this.m_bars}nsBars(){return this.m_nsBars}size(){return this.m_bars.size()+this.m_nsBars.size()}each(e){this.m_bars.each(e),this.m_nsBars.each(e)}clear(){this.m_bars.clear(),this.m_nsBars.clear(),this.lastProjectionPrice=void 0}isEmpty(){return this.m_bars.isEmpty()&&this.m_nsBars.isEmpty()}first(){return this.m_bars.isEmpty()?this.m_nsBars.first():this.m_bars.first()}last(){return this.m_nsBars.isEmpty()?this.m_bars.last():this.m_nsBars.last()}search(e,t){return this.nsBars().isEmpty()?this.bars().search(e,t):this.bars().isEmpty()||(0,i.ensureNotNull)(this.nsBars().firstIndex())<=e?this.nsBars().search(e,t):this.bars().search(e,t)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}plotValueToTimePointIndex(e,t,s){if(s===r.FromRight){const s=(s,r)=>{const i=r[t];return null!=i&&e>=i},r=this.m_bars.findLast(s);if(null!==r)return r.index;const i=this.m_nsBars.findLast(s);return null!==i?i.index:this.m_bars.firstIndex()}if(s===r.FromLeft){const s=(s,r)=>{const i=r[t];return null!=i&&e<=i},r=this.m_bars.findFirst(s);if(null!==r)return r.index;const i=this.m_nsBars.findFirst(s);return null!==i?i.index:this.m_bars.lastIndex()}throw new Error("plotValueToTimePointIndex: unsupported search mode")}moveData(e){this.m_bars.move(e),this.m_nsBars.move(e)}}},80372:(e,t,s)=>{s.r(t),s.d(t,{SeriesDataSource:()=>p,initialRequestOptionsToNumBars:()=>g,parseJapaneseProjectionBars:()=>S});var r=s(88537),i=s(70617),n=s(15693),a=s(73044),o=s(3653),h=s(95078),d=s(8803),l=s(97639),u=s.n(l);class _{constructor(){this._modified=new(u()),this._loading=new(u()),this._completed=new(u()),this._error=new(u()),this._symbolError=new(u()),this._symbolResolved=new(u()),this._seriesError=new(u()),this._symbolNotPermitted=new(u()),this._symbolInvalid=new(u()),this._symbolGroupNotPermitted=new(u()),this._chartTypeNotPermitted=new(u()),this._intradaySpreadNotPermitted=new(u()),this._intradayExchangeNotPermitted=new(u()),this._customIntervalNotPermitted=new(u()),this._secondsIntervalNotPermitted=new(u()),this._tickMarksRangeChanged=new(u()),this._barReceived=new(u()),this._seriesTimeFrame=new(u()),this._dataUpdated=new(u())}destroy(){this._modified.destroy(),this._loading.destroy(),this._completed.destroy(),this._error.destroy(),this._symbolError.destroy(),this._symbolResolved.destroy(),this._seriesError.destroy(),this._symbolInvalid.destroy(),this._symbolNotPermitted.destroy(),this._symbolGroupNotPermitted.destroy(),this._chartTypeNotPermitted.destroy(),this._intradaySpreadNotPermitted.destroy(),this._intradayExchangeNotPermitted.destroy(),
this._customIntervalNotPermitted.destroy(),this._secondsIntervalNotPermitted.destroy(),this._tickMarksRangeChanged.destroy(),this._barReceived.destroy(),this._seriesTimeFrame.destroy(),this._dataUpdated.destroy()}modified(){return this._modified}loading(){return this._loading}completed(){return this._completed}error(){return this._error}symbolError(){return this._symbolError}symbolResolved(){return this._symbolResolved}seriesError(){return this._seriesError}symbolInvalid(){return this._symbolInvalid}symbolNotPermitted(){return this._symbolNotPermitted}symbolGroupNotPermitted(){return this._symbolGroupNotPermitted}chartTypeNotPermitted(){return this._chartTypeNotPermitted}intradaySpreadNotPermitted(){return this._intradaySpreadNotPermitted}intradayExchangeNotPermitted(){return this._intradayExchangeNotPermitted}customIntervalNotPermitted(){return this._customIntervalNotPermitted}secondsIntervalNotPermitted(){return this._secondsIntervalNotPermitted}tickMarksRangeChanged(){return this._tickMarksRangeChanged}barReceived(){return this._barReceived}seriesTimeFrame(){return this._seriesTimeFrame}dataUpdated(){return this._dataUpdated}fireCompleted(e,t){this._completed.fire(e,t)}fireModified(){this._modified.fire()}fireLoading(e){this._loading.fire(e)}fireError(){this._error.fire()}fireSymbolError(e){this._symbolError.fire(e),this.fireError()}fireSymbolResolved(e){this._symbolResolved.fire(e)}fireSeriesError(e){this._seriesError.fire(e),this.fireError()}fireSymbolInvalid(){this._symbolInvalid.fire()}fireSymbolNotPermitted(e){this._symbolNotPermitted.fire(e)}fireSymbolGroupNotPermitted(e){this._symbolGroupNotPermitted.fire(e)}fireChartTypeNotPermitted(e){this._chartTypeNotPermitted.fire(e),this.fireError()}fireIntradaySpreadNotPermitted(){this._intradaySpreadNotPermitted.fire(),this.fireError()}fireIntradayExchangeNotPermitted(){this._intradayExchangeNotPermitted.fire(),this.fireError()}fireCustomIntervalNotPermitted(){this._customIntervalNotPermitted.fire(),this.fireError()}fireSecondsIntervalNotPermitted(){this._secondsIntervalNotPermitted.fire(),this.fireError()}fireTickMarksRangeChanged(e){this._tickMarksRangeChanged.fire(e)}fireBarReceived(e){this._barReceived.fire(e)}fireSeriesTimeFrame(e,t,s,r,i){this._seriesTimeFrame.fire(e,t,s,r,i)}fireDataUpdated(e,t,s){this._dataUpdated.fire(e,t,s)}}const c=(0,s(11905).getLogger)("Chart.SeriesDataSource");var m;!function(e){e[e.Idle=0]="Idle",e[e.AwaitingConnection=1]="AwaitingConnection",e[e.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",e[e.Active=3]="Active"}(m||(m={}));let y=1;let f=1;function g(e){return e.startDate?e.endDate||e.count?e.endDate?["from_to",e.startDate,e.endDate]:["bar_count",e.startDate,(0,r.ensure)(e.count)]:["from_to",e.startDate]:e.count||300}class p{constructor(e,t,s,r){this._symbol=null,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new o.SeriesData,this._dataEvents=new _,this._status=m.Idle,this._turnaroundCounter=1,
this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=e,this._turnaroundPrefix=t,this._createSeriesParams=g(null!=s?s:{count:300}),this._timeFrame=r||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged)}modifySeries(e,t,s=null,n=!1){n&&(c.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._symbol=null,this._resolution=null);const o=this._symbol,h=this._resolution;if(this._symbol=e,this._resolution=t,null===this._instanceId)return void(this._timeFrame=s);const d=!(0,i.deepEquals)(o,e)[0],l=null===h||!a.Interval.isEqual(h,t);(d||l||null!==s)&&(this._timeFrame=null,(d||l)&&this._turnaroundCounter++,d&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,r.ensureNotNull)(this._symbolInstanceId),this._resolution,s,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(e){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,e,this._onMessage.bind(this))}requestMoreTickmarks(e){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,e,this._onMessage.bind(this))}isStarted(){return this._status!==m.Idle}isActive(){return this._status===m.Active}resolution(){return this._resolution}start(){this.isStarted()?c.logNormal("start: data source is already started, nothing to do"):((0,r.assert)(null!==this._symbol,"symbol must be set before start"),(0,r.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(m.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),this._changeStatusTo(m.Idle)):c.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}clearData(){this.isStarted()?this._enqueueUpdate(()=>this._clearDataImpl()):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._symbol}moveData(e){this._enqueueUpdate(()=>this._data.moveData(e))}_resolveSymbol(){null!==this._symbol&&(this._symbolInstanceId="sds_sym_"+y++,this._gateway.resolveSymbol(this._symbolInstanceId,(0,n.encodeExtendedSymbolOrGetSimpleSymbolString)(this._symbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(e){(0,r.assert)(this._status!==e,"Source and destination status should be distinct"),c.logNormal(`Status changed from ${m[this._status]} to ${m[e]}`),this._status=e}_createSeries(){(0,r.assert)(this._status!==m.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+f++,this._resolveSymbol(),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,
r.ensureNotNull)(this._symbolInstanceId),(0,r.ensureNotNull)(this._resolution),this._createSeriesParams,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(m.AwaitingFirstDataUpdate)}_onGatewayIsConnectedChanged(e){e?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===m.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==m.Idle&&this._status!==m.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(m.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(e){this._enqueueUpdate(()=>this._onMessageImpl(e))}async _onMessageImpl(e){switch(e.method){case"symbol_resolved":{const[t,s]=e.params;if(t!==this._symbolInstanceId){c.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${e.params[0]}`);break}this._onSymbolResolved(s);break}case"symbol_error":if(e.params[0]!==this._symbolInstanceId){c.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${e.params[0]}`);break}this._onSymbolError(e);break;case"series_timeframe":{const[t,s,r,i,n,a,o]=e.params;if(!this._checkTurnaround(t,s)){c.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t} (${s})`);break}this._onSeriesTimeFrame(r,i,n,a,o);break}case"series_error":{const[t,s]=e.params;if(!this._checkTurnaround(t,s)){c.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t} (${s})`);break}this._onSeriesError(e.params[2]);break}case"series_loading":{const[t,s]=e.params;if(!this._checkTurnaround(t,s))break;this._onSeriesLoading(e.time);break}case"series_completed":{const[t,s,r]=e.params;if(!this._checkTurnaround(t,r)){c.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t} (${r})`);break}this._onSeriesCompleted(s,e.time);break}case"data_update":if(!this._checkTurnaround(e.params.customId,e.params.turnaround)){c.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e.params.customId} (${e.params.turnaround})`);break}await this._onDataUpdate(e.params.plots,e.params.nonseries,e.params.lastBar);break;case"clear_data":if(e.params.turnaround!==this.turnaround()){c.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${e.params.turnaround}`);break}this._clearDataImpl(),this._dataEvents.fireDataUpdated(void 0,!1,null)}}_onSeriesError(e){let t,s;if("string"==typeof e)s={error:e},t=e;else if(s=e,e.ctx){const s={};Object.entries(e.ctx).forEach(([e,t])=>{s[e]=t.toString()}),t=e.error.format(s)}else t=e.error;if(t.startsWith("study_not_auth:")){const e=t.split(":",2)[1].split("@",2)[0];["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(e)?this._dataEvents.fireChartTypeNotPermitted(e):"BarSetSpread"===e?this._dataEvents.fireIntradaySpreadNotPermitted():"BarSetRange"===e&&this._dataEvents.fireCustomIntervalNotPermitted()
}else"resolution_not_entitled"===t?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===t?this._dataEvents.fireCustomIntervalNotPermitted():"seconds_not_entitled"===t&&this._dataEvents.fireSecondsIntervalNotPermitted();this._dataEvents.fireSeriesError(s)}_onSeriesTimeFrame(e,t,s,r,i){this._dataEvents.fireSeriesTimeFrame(e,t,s,null==r||r,i)}_onSymbolError(e){if(e.params[1]===d.permissionDenied)switch(e.params[2]){case d.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(e.params[3]);break;case d.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(e.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(e.params[2])}else e.params[1]===d.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(e.params[1])}_onSymbolResolved(e){this._dataEvents.fireSymbolResolved(e)}async _onDataUpdate(e,t,s){this._onDataUnpacked(e,s,await S(t))}_enqueueUpdate(e){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(e,e),this._ongoingDataUpdate}_onDataUnpacked(e,t,s){if(this._status===m.Idle)return;this._status===m.AwaitingFirstDataUpdate&&(this._changeStatusTo(m.Active),this._clearDataImpl());const r=this._data.bars().size(),i=this._data.bars().firstIndex(),n=this._data.bars().merge(e);null!==s&&(this._data.nsBars().clear(),this._data.nsBars().merge(s.projectionPlots),this._data.lastProjectionPrice=s.lastPrice,null!==s.boxSize&&(this._data.boxSize=s.boxSize),this._data.reversalAmount=s.reversalAmount);const a=null===i||null!==n&&n.index<i;this._dataEvents.fireDataUpdated(t,a,n),r!==this._data.bars().size()&&null!==n&&this._dataEvents.fireBarReceived(n)}_onSeriesLoading(e){this._dataEvents.fireLoading(e)}_onSeriesCompleted(e,t){this._dataEvents.fireCompleted(e,t)}_checkTurnaround(e,t){return this._instanceId===e&&(void 0===t||t===this.turnaround())}}async function S(e){if(void 0===e)return{projectionPlots:[],boxSize:null};if(""===e.d||"nochange"===e.indexes)return null;const t=await(0,h.unpackNonSeriesData)(e.d);if(null===t||t.indexes_replace)return null;const s=e.indexes,{bars:r,price:i,boxSize:n,reversalAmount:a}=t.data;return{lastPrice:i,projectionPlots:(r||[]).map(e=>{let t;return"factor"in e?t=e.factor:"additionalPrice"in e&&(t=e.additionalPrice),{index:s[e.time],value:[0,e.open,e.high,e.low,e.close,e.volume,t]}}),reversalAmount:a,boxSize:n}}}}]);